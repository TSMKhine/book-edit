/**
   Zwibbler

   Copyright 2022 Hanov Solutions Inc. All Rights Reserved. This software is
   NOT open source. For licensing information, contact the author.

   steve.hanov@gmail.com

   @license
 */
/* eslint-disable */
;(function(globalModule){var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function () { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function () { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __values = (this && this.__values) || function (o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(){ca=function(){};ba.Symbol||(ba.Symbol=fa)}var fa=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function ha(){ca();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return ia(this)}});ha=function(){}}function ia(c){var a=0;return ja(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function ja(c){ha();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function ka(c,a){ha();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}function la(c,a){if(a){var b=ba;c=c.split(".");for(var d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
la("Array.prototype.values",function(c){return c?c:function(){return ka(this,function(a,b){return b})}});function ma(c,a,b){if(null==c)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return c+""}
la("String.prototype.startsWith",function(c){return c?c:function(a,b){var d=ma(this,a,"startsWith");a+="";var e=d.length,c=a.length;b=Math.max(0,Math.min(b|0,d.length));for(var h=0;h<c&&b<e;)if(d[b++]!=a[h++])return!1;return h>=c}});function na(c){ha();var a=c[Symbol.iterator];return a?a.call(c):ia(c)}
la("Promise",function(c){function a(a){this.Ol=0;this.Js=void 0;this.lj=[];var b=this.rq();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}}function b(){this.Bg=null}function d(b){return b instanceof a?b:new a(function(a){a(b)})}if(c)return c;b.prototype.Iu=function(a){null==this.Bg&&(this.Bg=[],this.vA());this.Bg.push(a)};b.prototype.vA=function(){var a=this;this.Ju(function(){a.fC()})};var e=ba.setTimeout;b.prototype.Ju=function(a){e(a,0)};b.prototype.fC=function(){for(;this.Bg&&this.Bg.length;){var a=
this.Bg;this.Bg=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.wA(n)}}}this.Bg=null};b.prototype.wA=function(a){this.Ju(function(){throw a;})};a.prototype.rq=function(){function a(a){return function(e){d||(d=!0,a.call(b,e))}}var b=this,d=!1;return{resolve:a(this.JF),reject:a(this.Bs)}};a.prototype.JF=function(b){if(b===this)this.Bs(new TypeError("A Promise cannot resolve to itself"));else if(b instanceof a)this.NG(b);else{a:switch(typeof b){case "object":var d=null!=b;break a;
case "function":d=!0;break a;default:d=!1}d?this.IF(b):this.Qv(b)}};a.prototype.IF=function(a){var b=void 0;try{b=a.then}catch(l){this.Bs(l);return}"function"==typeof b?this.OG(b,a):this.Qv(a)};a.prototype.Bs=function(a){this.Dy(2,a)};a.prototype.Qv=function(a){this.Dy(1,a)};a.prototype.Dy=function(a,b){if(0!=this.Ol)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.Ol);this.Ol=a;this.Js=b;this.gC()};a.prototype.gC=function(){if(null!=this.lj){for(var a=0;a<this.lj.length;++a)f.Iu(this.lj[a]);
this.lj=null}};var f=new b;a.prototype.NG=function(a){var b=this.rq();a.Dm(b.resolve,b.reject)};a.prototype.OG=function(a,b){var d=this.rq();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};a.prototype.then=function(b,d){function e(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(z){f(z)}}:b}var c,f,h=new a(function(a,b){c=a;f=b});this.Dm(e(b,c),e(d,f));return h};a.prototype.catch=function(a){return this.then(void 0,a)};a.prototype.Dm=function(a,b){function d(){switch(e.Ol){case 1:a(e.Js);
break;case 2:b(e.Js);break;default:throw Error("Unexpected state: "+e.Ol);}}var e=this;null==this.lj?f.Iu(d):this.lj.push(d)};a.resolve=d;a.reject=function(b){return new a(function(a,d){d(b)})};a.race=function(b){return new a(function(a,e){for(var c=na(b),f=c.next();!f.done;f=c.next())d(f.value).Dm(a,e)})};a.all=function(b){var e=na(b),c=e.next();return c.done?d([]):new a(function(a,b){function f(b){return function(d){h[b]=d;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,d(c.value).Dm(f(h.length-
1),b),c=e.next();while(!c.done)})};return a});la("Array.prototype.keys",function(c){return c?c:function(){return ka(this,function(a){return a})}});la("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});function oa(c,a){return Object.prototype.hasOwnProperty.call(c,a)}
la("WeakMap",function(c){function a(a){this.Rk=(f+=Math.random()+1).toString();if(a){ca();ha();a=na(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}}function b(a){oa(a,e)||aa(a,e,{value:{}})}function d(a){var d=Object[a];d&&(Object[a]=function(a){b(a);return d(a)})}if(function(){if(!c||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),d=new c([[a,2],[b,3]]);if(2!=d.get(a)||3!=d.get(b))return!1;d.delete(a);d.set(b,4);return!d.has(a)&&4==d.get(b)}catch(n){return!1}}())return c;
var e="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var f=0;a.prototype.set=function(a,d){b(a);if(!oa(a,e))throw Error("WeakMap key fail: "+a);a[e][this.Rk]=d;return this};a.prototype.get=function(a){return oa(a,e)?a[e][this.Rk]:void 0};a.prototype.has=function(a){return oa(a,e)&&oa(a[e],this.Rk)};a.prototype.delete=function(a){return oa(a,e)&&oa(a[e],this.Rk)?delete a[e][this.Rk]:!1};return a});
la("Map",function(c){function a(){var a={};return a.Ca=a.next=a.head=a}function b(a,b){var d=a.$f;return ja(function(){if(d){for(;d.head!=a.$f;)d=d.Ca;for(;d.next!=d.head;)return d=d.next,{done:!1,value:b(d)};d=null}return{done:!0,value:void 0}})}function d(a,b){var d=b&&typeof b;"object"==d||"function"==d?f.has(b)?d=f.get(b):(d=""+ ++h,f.set(b,d)):d="p_"+b;var e=a.lk[d];if(e&&oa(a.lk,d))for(a=0;a<e.length;a++){var c=e[a];if(b!==b&&c.key!==c.key||b===c.key)return{id:d,list:e,index:a,Zc:c}}return{id:d,
list:e,index:-1,Zc:void 0}}function e(b){this.lk={};this.$f=a();this.size=0;if(b){b=na(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),b=new c(na([[a,"s"]]));if("s"!=b.get(a)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var d=b.entries(),e=d.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||
"t"!=e.value[1]||!d.next().done?!1:!0}catch(u){return!1}}())return c;ca();ha();var f=new WeakMap;e.prototype.set=function(a,b){a=0===a?0:a;var e=d(this,a);e.list||(e.list=this.lk[e.id]=[]);e.Zc?e.Zc.value=b:(e.Zc={next:this.$f,Ca:this.$f.Ca,head:this.$f,key:a,value:b},e.list.push(e.Zc),this.$f.Ca.next=e.Zc,this.$f.Ca=e.Zc,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.Zc&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.lk[a.id],a.Zc.Ca.next=a.Zc.next,a.Zc.next.Ca=
a.Zc.Ca,a.Zc.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.lk={};this.$f=this.$f.Ca=a();this.size=0};e.prototype.has=function(a){return!!d(this,a).Zc};e.prototype.get=function(a){return(a=d(this,a).Zc)&&a.value};e.prototype.entries=function(){return b(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return b(this,function(a){return a.key})};e.prototype.values=function(){return b(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var d=this.entries(),
e;!(e=d.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var h=0;return e});la("String.prototype.codePointAt",function(c){return c?c:function(a){var b=ma(this,null,"codePointAt"),d=b.length;a=Number(a)||0;if(0<=a&&a<d){a|=0;var e=b.charCodeAt(a);if(55296>e||56319<e||a+1===d)return e;a=b.charCodeAt(a+1);return 56320>a||57343<a?e:1024*(e-55296)+a+9216}}});
la("String.fromCodePoint",function(c){return c?c:function(a){for(var b="",d=0;d<arguments.length;d++){var e=Number(arguments[d]);if(0>e||1114111<e||e!==Math.floor(e))throw new RangeError("invalid_code_point "+e);65535>=e?b+=String.fromCharCode(e):(e-=65536,b+=String.fromCharCode(e>>>10&1023|55296),b+=String.fromCharCode(e&1023|56320))}return b}});
la("String.prototype.endsWith",function(c){return c?c:function(a,b){var d=ma(this,a,"endsWith");a+="";void 0===b&&(b=d.length);b=Math.max(0,Math.min(b|0,d.length));for(var e=a.length;0<e&&0<b;)if(d[--b]!=a[--e])return!1;return 0>=e}});la("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}});
la("Set",function(c){function a(a){this.uf=new Map;if(a){a=na(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.uf.size}if(function(){if(!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new c(na([a]));if(!d.has(a)||1!=d.size||d.add(a)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=a||f.value[1]!=a)return!1;f=e.next();return f.done||f.value[0]==a||4!=f.value[0].x||
f.value[1]!=f.value[0]?!1:e.next().done}catch(h){return!1}}())return c;ca();ha();a.prototype.add=function(a){a=0===a?0:a;this.uf.set(a,a);this.size=this.uf.size;return this};a.prototype.delete=function(a){a=this.uf.delete(a);this.size=this.uf.size;return a};a.prototype.clear=function(){this.uf.clear();this.size=0};a.prototype.has=function(a){return this.uf.has(a)};a.prototype.entries=function(){return this.uf.entries()};a.prototype.values=function(){return this.uf.values()};a.prototype.keys=a.prototype.values;
a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(a,d){var b=this;this.uf.forEach(function(e){return a.call(d,e,e,b)})};return a});la("Array.prototype.entries",function(c){return c?c:function(){return ka(this,function(a,b){return[a,b]})}});
la("Array.from",function(c){return c?c:function(a,b,d){ha();b=null!=b?b:function(a){return a};var e=[],c=a[Symbol.iterator];if("function"==typeof c){a=c.call(a);for(var h=0;!(c=a.next()).done;)e.push(b.call(d,c.value,h++))}else for(c=a.length,h=0;h<c;h++)e.push(b.call(d,a[h],h));return e}});
var q=function(){function c(a,b){this.type=a;this.values=b}c.Ak=function(a){a.toLowerCase()in c.Qt&&(a=c.Qt[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/,f=/hsl\( *([0-9]+) *, *([0-9]+)% *, *([0-9]+)% *\)/;var h=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])?/i.exec(a);if(null!==h)a=parseInt(h[1],16)/255,b=parseInt(h[2],16)/255,d=parseInt(h[3],
16)/255,h=h[4]?parseInt(h[4],16)/255:1;else if(h=e.exec(a),null!==h)a=parseFloat(h[1])/255,b=parseFloat(h[2])/255,d=parseFloat(h[3])/255,h=parseFloat(h[4]);else if(h=d.exec(a),null!==h)a=parseFloat(h[1])/255,b=parseFloat(h[2])/255,d=parseFloat(h[3])/255,h=1;else if(h=b.exec(a),null!==h)a=parseInt(h[1],16),a=(16*a+a)/255,b=parseInt(h[2],16),b=(16*b+b)/255,d=parseInt(h[3],16),d=(16*d+d)/255,h=1;else if(h=f.exec(a),null!==h)a=parseFloat(h[1])/360,b=parseFloat(h[2])/100,h=parseFloat(h[3])/100,0==b?b=
h=d=h:(d=.5>h?h*(1+b):h+b-h*b,e=2*h-d,b=pa(e,d,a+1/3),h=pa(e,d,a),d=pa(e,d,a-1/3)),a=b,b=h,h=1;else return null;return new c(c.RGBA,[a,b,d,h])};c.Wf=function(a){return c.Ak(a)||new c(c.RGBA,[1,0,1,1])};c.II=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};c.prototype.toString=function(){function a(a){a=Math.min(Math.floor(256*a),255);return 16>a?"0"+a.toString(16):a.toString(16)}var b=this.Ki(c.RGBA),d="#"+a(b.values[0])+a(b.values[1])+
a(b.values[2]);1>b.values[3]&&(d+=a(b.values[3]));return d};c.prototype.Ki=function(a){return c.iB[this.type][a](this)};c.prototype.ic=function(a){a.type!==this.type&&(a=a.Ki(this.type));if(this.type===c.xi){var b=this.values[0],d=a.values[0];b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-
a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.prototype.FB=function(a){var b=a;var d=this.Ki(q.yp);b=b.Ki(q.yp);a=d.values[0];var e=d.values[1],c=d.values[2],h=b.values[0],k=b.values[1],l=b.values[2];b=qa(ra(e,2)+ra(c,2));d=qa(ra(k,2)+ra(l,2));var n=(b+d)/2;n=.5*(1-qa(ra(n,7)/(ra(n,7)+ra(25,7))));e*=1+n;var r=(1+n)*k;k=qa(ra(e,2)+ra(c,2));n=qa(ra(r,2)+ra(l,2));var u=sa(c,e);r=sa(l,r);c=h-a;l=n-k;if(0===b*d)e=
0;else if(180>=ta(r-u))e=r-u;else if(180<r-u)e=r-u-360;else if(-180>r-u)e=r-u+360;else throw Error();e=2*qa(k*n)*ua(va/180*e/2);a=(a+h)/2;h=(k+n)/2;if(0===b*d)d=u+r;else if(180>=ta(u-r))d=(u+r)/2;else if(180<ta(u-r)&&360>u+r)d=(u+r+360)/2;else if(180<ta(u-r)&&360<=u+r)d=(u+r-360)/2;else throw Error();b=1-.17*wa(va/180*(d-30))+.24*wa(va/180*d*2)+.32*wa(va/180*(3*d+6))-.2*wa(va/180*(4*d-63));d=30*za(-ra((d-275)/25,2));k=qa(ra(h,7)/(ra(h,7)+ra(25,7)));a=1+.015*ra(a-50,2)/qa(20+ra(a-50,2));n=1+.045*h;
b=1+.015*h*b;d=-2*k*ua(va/180*d*2);return qa(ra(c/(1*a),2)+ra(l/(1*n),2)+ra(e/(1*b),2)+l/(1*n)*d*(e/(1*b)))};c.RGBA=0;c.Yt=1;c.xi=2;c.yp=3;c.gI=3;c.he="transparent";c.Od="#ffffff";c.Oa="#000000";c.zp="#ff00ff";c.iB=[[Aa,Ba,Ca,Da],[Ea,Aa,Fa,Ga],[Ha,Ia,Aa,Ja],[Ka,La,Ma,Aa]];c.Qt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",
cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",
deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",
lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",
mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",
purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",
yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Na=.9505,Oa=1,Pa=1.089;function Ha(c){var a=c.values[0],b=Math.min(1,Math.max(0,c.values[1])),d=Math.min(1,Math.max(0,c.values[2]));0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),h=d*(1-e*b);b=d*(1-(1-e)*b);var k=e=0,l=0;switch(Math.floor(a/60)%6){case 0:e=d;k=b;l=f;break;case 1:e=h;k=d;l=f;break;case 2:e=f;k=d;l=b;break;case 3:e=f;k=h;l=d;break;case 4:e=b;k=f;l=d;break;case 5:e=d,k=f,l=h}return new q(q.RGBA,[e,k,l,c.values[3]])}
function Ca(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new q(q.xi,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function Ga(c){function a(a){return a>6/29*(6/29)*(6/29)?Math.pow(a,1/3):1/3*(29/6)*(29/6)*a+4/29}var b=a(c.values[1]/Oa);return new q(q.yp,[116*b-16,500*(a(c.values[0]/Na)-b),200*(b-a(c.values[2]/Pa)),c.values[3]])}
function La(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new q(q.Yt,[b>e?Na*b*b*b:3*(b-16/116)*e*e*Na,a>e?Oa*a*a*a:3*(a-16/116)*e*e*Oa,d>e?Pa*d*d*d:3*(d-16/116)*e*e*Pa,c.values[3]])}function Ba(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new q(q.Yt,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function Ea(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new q(q.RGBA,b)}function Aa(c){return new q(c.type,c.values.concat())}function Da(c){return Ga(Ba(c))}function Ka(c){return Ea(La(c))}function Fa(c){return Ca(Ea(c))}
function Ia(c){return Ba(Ha(c))}function Ja(c){return Da(Ha(c))}function Ma(c){return Fa(La(c))}var qa=Math.sqrt,ra=Math.pow,wa=Math.cos,Qa=Math.atan2,ua=Math.sin,ta=Math.abs,za=Math.exp,va=Math.PI;function sa(c,a){if(0===c&&0===a)return 0;c=Qa(c,a)*(180/va);return 0<=c?c:c+360}function pa(c,a,b){0>b&&(b+=1);1<b&&--b;return b<1/6?c+6*(a-c)*b:.5>b?a:b<2/3?c+(a-c)*(2/3-b)*6:c};function Ra(c,a){void 0===a&&(a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");for(var b="",d,e,f,h,k,l,n=0;n<c.length;)d=c[n++],e=c[n++],f=c[n++],h=d>>2,d=(d&3)<<4|e>>4,k=(e&15)<<2|f>>6,l=f&63,isNaN(e)?k=l=64:isNaN(f)&&(l=64),b=b+a.charAt(h)+a.charAt(d)+a.charAt(k)+a.charAt(l);return b};function Sa(c){for(var a=c.length,b=0,d,e,f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d)if(f===a&&(b+=3),e=c.charCodeAt(f),56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b+=4;continue}}else b+=3;b=127>=d?b+1:2047>=d?b+2:b+3}b=new Uint8Array(b);var h=-1;for(f=0;f!==a;){d=c.charCodeAt(f);f+=1;if(55296<=d&&56319>=d){if(f===a){b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;break}e=c.charCodeAt(f);if(56320<=e&&57343>=e){if(d=1024*(d-55296)+e-56320+65536,f+=1,65535<d){b[h+=1]=240|d>>>
18;b[h+=1]=128|d>>>12&63;b[h+=1]=128|d>>>6&63;b[h+=1]=128|d&63;continue}}else{b[h+=1]=239;b[h+=1]=191;b[h+=1]=189;continue}}127>=d?b[h+=1]=0|d:(2047>=d?b[h+=1]=192|d>>>6:(b[h+=1]=224|d>>>12,b[h+=1]=128|d>>>6&63),b[h+=1]=128|d&63)}return b};var v=new (function(){function c(){this.disabled={};this.tf=[];this.dv=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.qE(a,arguments)}};c.prototype.addListener=function(a){this.tf.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.tf.length;b++)if(this.tf[b]===a){this.tf.splice(b,1);break}};c.prototype.aC=
function(){this.dv||(this.dv=!0,this.addListener(function(a,b){console.log(a+": "+b)}))};c.prototype.qE=function(a,b){var d=[],e;if(0!==this.tf.length){var c=b[0].split("%s");d.push(c[0]);for(e=1;e<c.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(c[e]);b=
d.join("");d=0;for(e=this.tf;d<e.length;d++)(0,e[d])(a,b)}};return c}());function Ta(c){return parseFloat(c||"")||0}
var Va=function(){function c(a){this.ea=a}c.prototype.Va=function(a){for(var b in a){if(0<=b.indexOf("-"))throw Error("setStyle: styles must be camelcase; not "+b);this.ea.style[b]=""+a[b]}return this};c.prototype.Cl=function(a){for(var b in a)this.ea.setAttribute(b,a[b]);return this};c.prototype.ke=function(a){a.appendChild(this.ea);return this};c.prototype.Kr=function(a){a.parentNode&&a.parentNode.insertBefore(this.ea,a.nextSibling)};c.prototype.insertBefore=function(a){a.parentNode&&a.parentNode.insertBefore(this.ea,
a);return this};c.prototype.remove=function(){this.ea.parentNode&&this.ea.parentNode.removeChild(this.ea);return this};c.prototype.pf=function(a){return window.getComputedStyle(this.ea)[a]||""};c.prototype.wb=function(){var a;void 0===a&&(a=!1);var b=this.ea.getBoundingClientRect();b={top:b.top+window.pageYOffset,left:b.left+window.pageXOffset,width:b.width,height:b.height};a&&(a=this.Ti(),b.top-=a.top,b.height+=a.top+a.bottom,b.left-=a.left,b.width+=a.left+a.right);return b};c.prototype.Aj=function(a){var b=
(b=this.AD())?b.wb():{left:0,top:0};this.ea.style.left=a.left-b.left+"px";this.ea.style.top=a.top-b.top+"px"};c.prototype.AD=function(){if(!(this.ea instanceof HTMLElement)||"fixed"===this.pf("position"))return Ua(document.body);for(var a=this.ea.parentElement;a&&"static"===Ua(a).pf("position");)a=a.parentElement;return a?Ua(a):null};c.prototype.Ti=function(){var a=window.getComputedStyle(this.ea),b={left:Ta(a.marginLeft),top:Ta(a.marginTop),right:Ta(a.marginRight),bottom:Ta(a.marginBottom),Vr:0,
Ls:0,vt:0,bq:0};"content-box"===a.boxSizing&&(b.Vr+=Ta(a.borderLeftWidth)+Ta(a.paddingLeft),b.vt+=Ta(a.borderTopWidth)+Ta(a.paddingTop),b.Ls+=Ta(a.borderRightWidth)+Ta(a.paddingRight),b.bq+=Ta(a.borderBottomWidth)+Ta(a.paddingBottom));return b};c.prototype.ie=function(a){this.ea.classList.add(a);return this};c.prototype.rt=function(a,b){b?this.ea.classList.add(a):this.ea.classList.remove(a)};c.prototype.addEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.ea.addEventListener(a[e],
b,d);return this};c.prototype.removeEventListener=function(a,b,d){void 0===d&&(d=!1);var e=0;for(a=a.split(" ");e<a.length;e++)this.ea.removeEventListener(a[e],b,d);return this};c.prototype.matches=function(a){var b=this.ea;if(this.ea.matches)return this.ea.matches(a);if(b.msMatchesSelector)return b.msMatchesSelector(a);b=0;for(a=a.split(",");b<a.length;b++){var d=a[b];d=d.trim();if(0!=d.length)return"["==d[0]?this.ea.hasAttribute(d.substr(1,d.length-2)):this.ea.tagName===d.toUpperCase()}return!1};
c.prototype.query=function(a,b){this.matches(a)&&this.ea instanceof HTMLElement&&b(this.ea);Array.prototype.forEach.call(this.ea.querySelectorAll(a),b)};c.prototype.clear=function(){for(;null!==this.ea.firstChild;)this.ea.removeChild(this.ea.firstChild);return this};c.prototype.kd=function(a){this.ea instanceof HTMLElement&&(this.ea.innerText=a);return this};c.prototype.Ag=function(){if(!(this.ea instanceof HTMLElement))throw Error("Expected an HTML element: "+this.ea.outerHTML);return this.ea};return c}();
function Ua(c,a){if("string"===typeof c){if("<"==c[0])return a=Ua.Zm(c),new Va(a[0]);c=new Va(document.createElement(c));a&&c.Cl(a);return c}return new Va(c)}var Wa=null;
(function(c){c.Fc=function(a){return a instanceof HTMLElement?a:"string"===typeof a?document.querySelector(a):"jQuery"in window&&a instanceof window.jQuery?a[0]:null};c.Fn=function(){var a=document.documentElement,b=a.scrollWidth>a.clientWidth;a=a.scrollHeight>a.clientHeight?c.An():0;b=b?c.An():0;b={width:window.innerWidth-a,height:window.innerHeight-b,left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};a=window.visualViewport;
navigator.userAgent.toLowerCase().match(/(iphone|ipad)/)&&a&&(b.left=a.pageLeft,b.top=a.pageTop,b.width=a.width,b.height=a.height);return b};c.An=function(){if(null===Wa){var a=document.createElement("div");a.style.visibility="hidden";a.style.width="100px";document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%";a.appendChild(d);d=d.offsetWidth;a.parentNode.removeChild(a);Wa=b-d}return Wa};c.Yv=function(){for(var a=document.getElementsByTagName("*"),
b=0,d=0;d<a.length;d++){var e=parseInt(c(a[d]).pf("z-index"),10)||0;e>b&&(a[d].classList.contains("ZwibblerMousePointer")||a[d].classList.contains("zwibbler-tooltip")||(b=e))}return b};c.GD=function(){var a=!1;screen.orientation?a=screen.orientation.type.startsWith("landscape"):"number"===typeof window.orientation&&(a=90===Math.abs(window.orientation));return a?{width:screen.height,height:screen.width}:{width:screen.width,height:screen.height}};c.Zm=function(a){var b=document.createElement("div");
b.innerHTML=a;a=[];for(var d=b.firstChild;d;)(d instanceof HTMLElement||d instanceof SVGElement)&&a.push(d),d=d.nextSibling;for(d=0;d<a.length;d++)b.removeChild(a[d]);return a};c.uI=function(a){for(var b=[],d=0;d<a.length;d++)b.push(a[d].outerHTML);return b.join("")};c.dg=function(a,b){if(!(a instanceof HTMLElement))return!1;switch(a.tagName){case "INPUT":case "TEXTAREA":case "OPTION":case "SELECT":return!0;case "BUTTON":return b instanceof KeyboardEvent?"Enter"===b.key:!0}return a.isContentEditable?
!0:!1};c.fE=function(a){var b=a;if(!("ZwibblerTainted"in b)){if(!(a instanceof HTMLCanvasElement)){var d=document.createElement("canvas");d.getContext("2d").drawImage(a,0,0,1,1,0,0,1,1);a=d}try{a.getContext("2d").getImageData(0,0,1,1),b.ZwibblerTainted=!1}catch(e){b.ZwibblerTainted=!0}}return b.ZwibblerTainted};c.dC=function(a){var b=document.createElement("div");b.innerText=a;return b.innerHTML}})(Ua||(Ua={}));
function Xa(c){return new Promise(function(a,b){var d=new XMLHttpRequest;c.mimeType&&d.overrideMimeType(c.mimeType);c.withCredentials&&(d.withCredentials=!0);c.responseType&&(d.responseType=c.responseType);var e=c.method||"GET",f=c.qs||{},h=c.url,k="",l=!0,n=!1,r=null,u;for(u in f){if(f[u]instanceof Blob){n=!0;e="POST";break}l||(k+="&");l=!1;k+=u+"="+encodeURIComponent(f[u])}"GET"===e&&0<k.length&&(h+="?"+k,k="");if(n){r=new FormData;for(var x in f)r.append(x,f[x])}d.onreadystatechange=function(){if(4===
d.readyState)if(200===d.status)a(d);else{var e=d.statusText;0===d.status?e="Could not contact server.":d.getResponseHeader("status")&&(e=d.getResponseHeader("status"));b(Error(d.status+" "+e))}};d.open(e,h,!0);if(c.headers)for(var w in c.headers)d.setRequestHeader(w,c.headers[w]);var y="string"===typeof c.data?c.data:r?r:k;c.contentType?d.setRequestHeader("Content-type","application/json"):"POST"!==e||n||d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.cancel&&c.cancel.then(function(){d.abort()});
c.ov?setTimeout(function(){d.send(y)},c.ov):d.send(y)})}
var Ya=function(){function c(){this.Mr=[];this.qc=null}c.prototype.Ir=function(a){for(var b=0,d=this.Mr;b<d.length;b++)if(d[b]===a)return;this.Mr.push(a);this.qc||(this.qc=document.createElement("style"),document.head&&document.head.insertBefore(this.qc,document.head.firstChild));this.qc.appendChild(document.createTextNode(a))};c.prototype.Sa=function(){this.qc&&(Ua(this.qc).remove(),this.qc=null);this.Mr.length=0};return c}(),Za=function(){function c(){this.input=null}c.prototype.Sa=function(){this.input&&
this.input.parentNode&&this.input.parentNode.removeChild(this.input)};c.prototype.open=function(a){return this.Rz(a).then(function(a){return a[0]})};c.prototype.Rz=function(a){var b=this;return new Promise(function(d){function e(b){var e=new FileReader;c++;e.addEventListener("load",function(){h.push({contentType:b.type,data:e.result});c--;console.log("Done reading; numReaders now ",c);0===c&&d(h)});"data-uri"===a.format?e.readAsDataURL(b):"text"===a.format?e.readAsText(b):"ArrayBuffer"===a.format&&
e.readAsArrayBuffer(b);console.log("Started reading; numReaders=",c)}b.input&&b.input.parentNode&&b.input.parentNode.removeChild(b.input);b.input=document.createElement("input");b.input.style.display="none";b.input.setAttribute("id","ZwibblerFileInput");b.input.setAttribute("type","file");"string"===typeof a.capture&&b.input.setAttribute("capture",a.capture);document.body.appendChild(b.input);a.accept&&b.input.setAttribute("accept",a.accept);var c=0,h=[];b.input.addEventListener("change",function(){var b=
this.files;if(b&&0<b.length)if("File"===a.format){for(var c=0;c<b.length;c++)h.push({contentType:b[c].type,data:b[c]});d(h)}else for(c=0;c<b.length;c++)e(b[c])});b.input.value="";b.input.click()})};return c}(),$a=function(){function c(){this.Pb=[];this.log=v.create("FileSaver")}c.prototype.Sa=function(){for(var a=this.Pb.length-1;0<=a;a--)this.Xu(this.Pb[a])};c.prototype.Xu=function(a){clearTimeout(a.timeout);window.URL.revokeObjectURL(a.LE);a.anchor.parentNode&&a.anchor.parentNode.removeChild(a.anchor);
for(var b=0;b<this.Pb.length;b++)if(this.Pb[b]===a){this.Pb.splice(b,1);break}};c.prototype.RF=function(a,b){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var e=new ArrayBuffer(d.length),c=new Uint8Array(e),h=0;h<d.length;h++)c[h]=d.charCodeAt(h);d=[e];a={type:a};try{var k=new File(d,b,a)}catch(l){k=new Blob(d,a)}this.Ms(k,b)};c.prototype.Ms=function(a,b){var d=this;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,b);else{var e=window.URL.createObjectURL(a),
c=/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,h=!!navigator.userAgent.toLowerCase().match(/(iphone|ipad)/);this.log("isIPadPro=%s isIPad=%s isPDF=%s",c,h,"application/pdf"===a.type);this.log("Using blob object url %s",e);if(h)this.log("iIOS; open in new tab"),window.open(e,"_blank");else{this.log("Sane browser; open using <a download> tag");var k={LE:e,timeout:0,anchor:document.createElement("a")};this.Pb.push(k);k.anchor.innerHTML="download";k.anchor.setAttribute("href",e);k.anchor.setAttribute("download",
b);k.anchor.style.display="none";document.body.appendChild(k.anchor);k.anchor.click();k.timeout=setTimeout(function(){d.Xu(k)},1E3)}}};return c}(),ab=function(){function c(a,b){this.element=a;this.Vg=null;"ResizeObserver"in window&&(this.Vg=new window.ResizeObserver(function(){b()}),this.Vg.observe(a))}c.prototype.Sa=function(){this.Vg&&this.Vg.unobserve(this.element)};c.Iz=function(){return"ResizeObserver"in window};return c}(),B=Ua;var bb=function(){function c(a,b,d,e,c){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===c&&(c=0);this.td=a;this.left=b;this.top=d;this.right=e;this.bottom=c;this.zIndex=1;this.insertBefore=null;this.wa=document.createElement("div");this.wa.addEventListener("contextmenu",function(a){a.preventDefault()})}c.prototype.ag=function(){this.wa&&B(this.wa).remove()};c.prototype.show=function(a){B(this.wa).Va({position:"fixed",background:this.td,left:this.left+"px",
top:this.top+"px",right:this.right+"px",bottom:this.bottom+"px",display:"block"}).ie("zwibbler-popup-overlay");this.wa.addEventListener("click",a);this.wa.style.zIndex=this.zIndex.toString();this.insertBefore?this.insertBefore.parentNode&&this.insertBefore.parentNode.insertBefore(this.wa,this.insertBefore):document.body.appendChild(this.wa)};return c}();var cb=v.create("DRAGSORT");
function db(c){function a(a){"dragover"!==a.type&&cb(a.type);for(var b=a.target;b.parentNode!==c.parent&&b.parentNode;)b=b.parentNode;if(1===b.nodeType&&b.getAttribute("draggable")&&"false"!==b.getAttribute("draggable").toLowerCase()&&b.parentNode===c.parent)if("dragstart"===a.type){for(var d=c.parent.children,e=0;e<d.length;e++)null!==d[e].getAttribute(c.Nu)&&d[e].setAttribute("sort-index",e.toString());a.dataTransfer.setData("text",b.id);a.dataTransfer.dropEffect="move";h=f=b;a.stopPropagation()}else"dragover"===
a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.os),h=b,h.classList.add(c.os),a.preventDefault()):"dragend"===a.type&&h&&f.parentNode===b.parentNode?(h.classList.remove(c.os),b=parseInt(h.getAttribute("sort-index")||"0"),d=parseInt(f.getAttribute("sort-index")||"0"),c.UE(d,b),a.preventDefault(),a.stopPropagation()):"drop"===a.type&&(a.preventDefault(),a.stopPropagation())}var b=c.parent.Kz;c.parent.Kz=!0;for(var d=c.parent.children,e=0;e<d.length;e++)null!==d[e].getAttribute(c.Nu)&&d[e].setAttribute("draggable",
"true");if(b)return function(){};B(c.parent).addEventListener("dragstart dragover dragend drop",a);var f,h;return function(){B(c.parent).removeEventListener("dragstart dragover dragend drop",a)}};var eb=function(){function c(a,b){this.name=b;this.wa=B("div").Va({borderTop:"1px solid #888",padding:"5px",cursor:"default"}).ke(a);this.update(0)}c.prototype.update=function(a){this.wa.kd(this.name+"... "+Math.round(100*a)+"%")};c.prototype.error=function(a){var b=this,d=document.createElement("input");d.setAttribute("type","button");d.value="OK";d.addEventListener("click",function(){b.done()});this.wa.kd(this.name+"... "+a+" ");this.wa.ea.appendChild(d)};c.prototype.done=function(){this.wa.remove()};
c.all=[];return c}();var fb=function(){function c(a,b,d){this.parentElement=a;this.stack=[];this.ki=!1;this.sg=[];this.VG=!1;this.Cx="red";this.Zx=0;this.first=B("CANVAS",{width:b,height:d}).ke(a).ea;this.stack.push({canvas:this.first,ma:this.first.getContext("2d"),Em:{}});this.Me=c.Tt(this.stack[0].ma);this.width=this.first.width;this.height=this.first.height;this.om(this.first)}c.prototype.GG=function(a){this.stack[1].canvas.style.display=a?"":"none"};c.prototype.AG=function(a){for(var b=0,d=this.stack;b<d.length;b++)d[b].canvas.style.outline=
"4px solid "+a;this.Cx=a};c.prototype.$z=function(){if(void 0===a)var a=this.stack.length;var b=B("CANVAS").Va({position:"absolute",left:this.first.offsetLeft+"px",top:this.first.offsetTop+"px",pointerEvents:"none",outline:"4px solid "+this.Cx}).ie("zwibbler-overlay").ea;this.om(b);this.stack.splice(a,0,{canvas:b,ma:b.getContext("2d"),Em:{}});a===this.stack.length-1?this.parentElement.insertBefore(b,null):this.parentElement.insertBefore(b,this.stack[a+1].canvas);b.getContext("2d")};c.prototype.gd=
function(a,b,d,e){var c=this;void 0===e&&(e=!0);this.stack[a].Em[b]=d;e?this.ki||(this.ki=!0,this.Zx=(new Date).getTime(),requestAnimationFrame(function(){return c.fu()})):this.fu()};c.prototype.fu=function(){var a=(new Date).getTime(),b=this.dr();this.ki=!1;for(var d=0,e=this.stack;d<e.length;d++){var c=e[d],h=!0,k=c.Em;c.Em={};for(var l in k){var n=c.ma;h&&(n.setTransform(b,0,0,b,0,0),n.clearRect(0,0,this.width,this.height),h=!1);k[l](n,b)}}if(this.VG){this.sg.push({Rb:a,latency:a-this.Zx,XB:(new Date).getTime()-
a});25<this.sg.length&&this.sg.shift();n=e=d=0;for(c=this.sg;n<c.length;n++)h=c[n],d+=h.latency,e+=h.XB;d=Math.round(d/this.sg.length*10)/10;e=Math.round(e/this.sg.length*10)/10;a=1<this.sg.length?Math.round(this.sg.length/((a-this.sg[0].Rb)/1E3)*100)/100:0;n=this.get(0);n.setTransform(b,0,0,b,0,0);n.fillStyle="white";b="latency="+d+"ms drawTime="+e+"ms fps="+a;n.fillRect(0,0,n.measureText("latency=MM.MMms drawTime=MM.MMms fps=MM").width,13);n.textBaseline="top";n.font="10px arial";n.fillStyle="red";
n.fillText(b,2,2)}};c.prototype.get=function(a){return this.stack[a].ma};c.prototype.dr=function(){var a=c.Tt(this.stack[0].ma);if(a!==this.Me){this.Me=a;a=0;for(var b=this.stack;a<b.length;a++)this.om(b[a].canvas)}return this.Me};c.prototype.hh=function(a,b){this.width=a;this.height=b;a=0;for(b=this.stack;a<b.length;a++)this.om(b[a].canvas)};c.Tt=function(a){return(window.devicePixelRatio||1)/(a.UH||a.BE||a.EE||a.KE||a.zA||1)};c.prototype.om=function(a){a.width=this.width*this.Me;a.height=this.height*
this.Me;a.style.width=this.width+"px";a.style.height=this.height+"px";a.getContext("2d").setTransform(this.Me,0,0,this.Me,0,0)};return c}();var hb=function(){function c(){this.items=[];this.next=0;this.Qf=!1;this.log=v.create("UNDOSTACK")}c.prototype.Ea=function(a,b,d){void 0===b&&(b=!1);a=a instanceof gb?[a]:a;if(0!==a.length){this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].Ec(d);for(d=this.top();d;)if(d[d.length-1].Uh(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.Qf=!0;this.next=this.items.length}};c.prototype.nd=function(a){this.log("Undo index %s of %s",
this.next,this.items.length);if(this.Lf()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].nd(a);return this.Qf=!0}return!1};c.prototype.We=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.Kf()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].Ec(a);return this.Qf=!0}return!1};c.prototype.Lf=function(){return 0<this.next};c.prototype.Kf=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.Qf=
!1};c.prototype.top=function(){return this.items.length?this.items[this.items.length-1]:null};c.prototype.rr=function(){return this.items.length};return c}(),gb=function(){function c(){}c.prototype.Ec=function(){};c.prototype.nd=function(){};c.prototype.Uh=function(){return!1};return c}();var jb=function(){function c(){this.mk=[];this.log=v.create("DESTRUCTOR")}c.prototype.add=function(a){this.mk.push(a)};c.prototype.addEventListener=function(a,b,d,e){function c(b){a.addEventListener(b,d,e);h.add(function(){a.removeEventListener(b,d,e)})}var h=this;void 0===e&&(e=!1);var k=0;for(b=b.split(" ");k<b.length;k++)c(b[k])};c.prototype.pa=function(a,b,d){a.pa(b,d);this.add(function(){a.removeListener(b,d)})};c.prototype.Sa=function(){this.log("Running %s destructors",this.mk.length);for(var a=
this.mk.length-1;0<=a;a--)this.mk[a]();this.mk.length=0};return c}();var kb=function(){function c(a,b,d){var e=this;void 0===d&&(d=!1);this.wa=a;this.fl=0;this.Tr={};this.Wb=!1;this.timeout=null;this.lines=[];this.filter=null;this.$A="#5da700 #ed81ff #02ab34 #f92798 #59ff91 #ff6b80 #3cffe4 #ffd32b #5e8caa #ffdb7f #e5cdff #00c17e #f6f6f5 #9a861e #daff9d #808d40".split(" ");this.aB="#2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #805221 #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.Ii=[];var c=new Ya;c.Ir('\n\n.z-inner-debug.black {\n    background: #000;\n    white-space: pre-wrap;\n}\n\n.z-inner-debug.white {\n    background: #fff;\n}\n\n.z-debug-panel {\n    font-family: "monospace";\n    font-size: 12px;\n    display: flex;\n    flex-flow: column nowrap;\n    text-align: left;\n}\n\n.z-inner-debug {\n    flex: 1 1 auto;\n    overflow: scroll;\n}\n\n.z-inner-debug.black div {\n    border-bottom: 1px solid #222;\n    margin-bottom: 3px;\n}\n\n.z-inner-debug.white div {\n    border-bottom: 1px solid #eee;\n    margin-bottom: 3px;\n}\n');
a.classList.add("z-debug-panel");var h=0;B("input").Cl({type:"text",placeholder:"regexp...",onclick:"this.select()"}).ke(a).addEventListener("input",function(a){h&&window.clearTimeout(h);h=setTimeout(function(){e.mG(a.target.value);h=0},200)});this.we=B("div").ie("z-inner-debug").ke(a).Ag();B("button").ke(this.wa).Va({flex:"0 0 auto"}).kd("Scroll to bottom/top").addEventListener("click",function(){e.we.scrollTop=e.Ku()?0:e.we.scrollHeight});this.nE=v.addListener(function(a,b){return e.yu(a,b)});b.add(function(){v.removeListener(e.nE);
c.Sa()});this.yu("DEBUG","Debug window starting");B(this.we).ie(d?"white":"black");this.Ii=d?this.aB:this.$A}c.prototype.show=function(){this.wa.style.display="flex";this.Wb=!0;this.au();this.we.scrollTop=this.we.scrollHeight};c.prototype.ag=function(){this.wa.style.display="none";this.Wb=!1};c.prototype.MC=function(a){a in this.Tr||(this.Tr[a]=this.Ii[this.fl],this.fl=(this.fl+1)%this.Ii.length);return this.Tr[a]};c.prototype.yu=function(a,b){var d=this;1024<b.length&&(b=b.substr(0,1021)+"...");
var e=0;for(b=b.split("\n");e<b.length;e++)this.lines.push({key:a,line:b[e]});this.Wb&&null===this.timeout&&(this.timeout=setTimeout(function(){d.timeout=null;d.au()},100))};c.prototype.mG=function(a){if(2>a.length)this.filter=null;else try{this.filter=new RegExp(a,"i")}catch(d){}for(a=this.we.firstChild;a;){var b=a;1===b.nodeType&&"DIV"===b.tagName&&(!this.filter||this.filter.exec(b.textContent)?b.style.display="block":b.style.display="none");a=a.nextSibling}};c.prototype.Ku=function(){return this.we.scrollTop>=
this.we.scrollHeight-this.we.clientHeight};c.prototype.au=function(){for(var a=this.Ku(),b=0,d=this.lines;b<d.length;b++){var e=d[b],c=this.MC(e.key),h=document.createElement("div");h.style.color=c;e=e.key+": "+e.line;this.filter&&!this.filter.exec(e)&&(h.style.display="none");h.appendChild(document.createTextNode(e));this.we.appendChild(h)}a&&(this.we.scrollTop=this.we.scrollHeight);this.lines.length=0};return c}();var lb=function(){function c(a){this.code="en";this.data={};this.log=v.create("LANGUAGE");this.data=this.Fx(a,{})}c.prototype.xy=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Sp=function(a){this.Fx(a,this.data)};c.prototype.Fx=function(a,b){a=a.split("\n");for(var d=/^([ \t]*)([^:]+):([^:]+):(.*)/,
e=0;e<a.length;e++){var c=d.exec(a[e]);if(c){var h=c[2],k=c[3];c=c[4];h in b||(b[h]={});k in b[h]&&this.log("Warning: Replacing %s:%s",h,k);b[h][k]=c}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.iu(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.iu(a,b)};c.prototype.iu=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(a=0;a<b.length;a++)d=d.replace("^"+a,b[a]);return d};return c}();function mb(c,a,b){this.Ma=c;this.Xo=a;this.fn=b;this.cp=0}
var nb=0,ob=new (function(){function c(){this.nc=[];this.pt=!1;this.log=v.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.nc.length);for(var b=0;b<this.nc.length;b++)this.nc[b].Ma.complete?this.nc[b].fn(this.nc[b].Ma,this.nc[b].Xo):5E3>this.nc[b].cp?(this.nc[b].cp+=250,a.push(this.nc[b])):this.nc[b].fn(this.nc[b].Ma,this.nc[b].Xo);this.nc=a;this.nc.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.pt=!1)};c.prototype.load=
function(a,b,d){var e=this;void 0===d&&(d=!1);0==nb?this.mu(a,b,d):setTimeout(function(){e.mu(a,b,d)},nb)};c.prototype.mu=function(a,b,d){function e(a){for(var b=0;b<c.nc.length;b++){var d=c.nc[b];if(d.Ma===a)return c.nc.splice(b,1),d}return null}var c=this,h=document.createElement("img"),k=new mb(h,a,b);this.nc.push(k);var l=0<=a.indexOf("://"),n="://"+window.location.host,r=0!==a.indexOf("data:")&&l&&-1===a.indexOf(n);r&&!d&&(this.log("Using cross origin request for img"),h.crossOrigin="");h.addEventListener("load",
function(){if(h.complete){var a=e(h);a&&b(h,a.Xo)}else c.pt||(c.pt=!0,setTimeout(c.timeout,250),k.cp=250)},!1);h.addEventListener("error",function(){c.log("Error loading %s; useCors=%s disableCors=%s",a,r,d);e(h);!r||d?b(null,k.Xo):c.load(a,b,!0)},!1);h.src=a};c.prototype.hG=function(a){nb=a};return c}());var pb=function(){function c(){this.images={}}c.prototype.add=function(a,b){var d=this.images[a];d||(d={Ma:null,Ho:0},ob.load(b,function(a){d.Ma=a}),this.images[a]=d);d.Ho+=1};c.prototype.release=function(a){var b=this.images[a];b&&(--b.Ho,0>=b.Ho&&delete this.images[a])};c.prototype.get=function(a){return(a=this.images[a])&&a.Ma?a.Ma:null};return c}();var qb=v.create("EventEmitter"),rb=function(){function c(){this.hl=!1;this.sb={};this.lf=[];this.$m={}}c.prototype.ua=function(a){for(var b=this,d=1;d<arguments.length;d++);this.lf.push(Array.prototype.slice.apply(arguments));1===this.lf.length&&setTimeout(function(){for(var a=0;a<b.lf.length;a++)b.zq.apply(b,b.lf[a]);b.lf.length=0},0)};c.prototype.Nb=function(a){for(var b=1;b<arguments.length;b++);this.lf.push(Array.prototype.slice.apply(arguments));if(1===this.lf.length){for(b=0;b<this.lf.length;b++)this.zq.apply(this,
this.lf[b]);this.lf.length=0}};c.prototype.pe=function(a){for(var b=this,d=1;d<arguments.length;d++);d=Array.prototype.slice.apply(arguments);var e=d[0];e in this.$m||setTimeout(function(){var a=b.$m[e];delete b.$m[e];b.zq.apply(b,a)},0);this.$m[e]=d};c.prototype.zq=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a in this.sb){d=this.sb[a];this.hl||qb("Emit %s",a);for(var e=0;e<d.length;e++)d[e].apply(null,b)}};c.prototype.pa=function(a,b){this.sb||(this.sb={});var d=0;
for(a=a.split(" ");d<a.length;d++)this.bind(a[d],b)};c.prototype.once=function(a,b){function d(){e.Wy(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.sb?this.sb[a].push(b):this.sb[a]=[b];return b};c.prototype.removeListener=function(a,b){return this.Wy(a,b)};c.prototype.Wy=function(a,b){var d,e;if(a in this.sb){var c=this.sb[a];var h=d=0;for(e=c.length-1;d<=e;h=d+=1)if(c[h]===b){c.splice(h,1);break}0===c.length&&delete this.sb[a]}};c.prototype.bk=function(){this.sb=
{}};return c}();var sb=function(c){function a(){var a=c.call(this)||this;a.keys={};a.hl=!0;a.$G=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(a,b){return b.length-a.length}).join("|"),"g");a.log=v.create("KEYMAP");a.In=function(b){a.TD(b)};return a}__extends(a,c);a.prototype.map=function(a,d,e){void 0===e&&(e=!0);a=a.toLowerCase().split(",");var b;if("string"===typeof d)for(d=d.split(","),
b=0;b<a.length;b++)for(var c=0;c<d.length;c++)this.bu(a[b],d[c],!e);else for(b=0;b<a.length;b++)this.bu(a[b],d,!e)};a.prototype.zt=function(a,d){this.map(a,d,!1)};a.prototype.bu=function(a,d,e){if(0!==a.length){var b=!1;0===a.indexOf("up:")&&(a=a.substr(3),b=!0);var c=a.match(this.$G)||[],k=!1,l=!1,n=!1,r=!1,u=[],x;for(x=0;x<c.length;x++)switch(c[x]){case "alt":n=!0;break;case "control":case "ctrl":l=!0;break;case "shift":k=!0;break;case "home":u.push(36);break;case "end":u.push(35);break;case "pageup":u.push(33);
break;case "pagedown":u.push(34);break;case "delete":case "del":u.push(46);break;case "backspace":u.push(8);break;case "up":u.push(38);break;case "right":u.push(39);break;case "down":u.push(40);break;case "left":u.push(37);break;case "escape":case "esc":u.push(27);break;case "enter":u.push(13);break;case "ins":case "insert":u.push(45);break;case "space":u.push(32);break;case "f4":u.push(115);break;case "meta":case "command":case "cmd":case "\u2318":r=!0;break;default:alert("key entry not found: "+
c[x])}var w=this;c=function(a){b&&(a="up:"+a);k&&-1===a.indexOf("-shift")&&(a+="-shift");l&&-1===a.indexOf("-control")&&(a+="-control");n&&-1===a.indexOf("-alt")&&(a+="-alt");r&&-1===a.indexOf("-meta")&&(a+="-meta");"string"===typeof d?w.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,d):w.log("%sKeyboard mapping: %s->%s",e?"Remove ":"",a,"function()");if(e){if(a in w.keys){for(var c=[],f=0,h=w.keys[a];f<h.length;f++){var u=h[f];u!==d&&c.push(u)}w.keys[a]=c}}else if(a in w.keys){f=w.keys[a];for(c=
0;c<f.length&&f[c]!==d;c++);c===f.length&&w.keys[a].push(d)}else w.keys[a]=[d]};if(0===u.length)switch(a.toLowerCase()){case "alt":c("18");break;case "shift":c("16");break;case "control":case "ctrl":c("17");break;default:switch(a=a.toUpperCase().charAt(a.length-1),a){case "=":c("107-shift");c("187");c("61");break;case "+":c("107");c("61-shift");break;case "-":c("109");c("189");c("173");break;default:u.push(a.charCodeAt(0))}}for(x=0;x<u.length;x++)c(""+u[x])}};a.prototype.jD=function(a){var b="";"keyup"===
a.type&&(b="up:");a.keyCode&&(b+=a.keyCode);if(a.shiftKey||16===a.keyCode)b+="-shift";if(a.ctrlKey||17===a.keyCode)b+="-control";if(a.altKey||18===a.keyCode)b+="-alt";a.metaKey&&(b+="-meta");return b};a.prototype.translate=function(a){var b=[],e=this.jD(a);e in this.keys&&(b=this.keys[e]);(32>a.keyCode||126<=a.keyCode)&&this.log("%s",e);return b};a.prototype.TD=function(a){for(var b=0,e=this.translate(a);b<e.length;b++){var c=e[b];"string"===typeof c?(this.log("action: %s",c),this.Nb("*",c,a)):c(a)}};
a.prototype.Lu=function(a){var b;void 0===b&&(b=!1);a.addEventListener("keydown",this.In,b);a.addEventListener("keyup",this.In,b)};a.prototype.detach=function(a,d){void 0===d&&(d=!1);a.removeEventListener("keydown",this.In,d);a.removeEventListener("keyup",this.In,d)};return a}(rb);var ub={1:"INITIAL CONNECTION",2:"APPEND_V2",3:"SET-KEY",4:"BROADCAST",5:"APPEND",128:"ERROR",129:"ACK/NACK",130:"KEY-INFORMATION",131:"SET-KEY-ACK",255:"CONTINUATION"},vb={0:"No",1:"Yes"},wb={0:"POSSIBLY_CREATE",1:"NEVER_CREATE",2:"ALWAYS_CREATE"},xb={0:"NACK",1:"ACK"};function D(c,a,b,d){return{length:c,type:a,name:b,tI:d}}
var yb={1:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(2,0,"protocolVersion"),D(4,0,"maxSize"),D(1,0,"creationMode",wb),D(4,0,"generation"),D(8,0,"offset"),D(4,0,"docIDLength"),D(-1,1,"docID"),D(-2,1,"data")],2:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(8,0,"offset"),D(-2,1,"data")],3:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(2,0,"requestID"),D(1,0,"lifetime",{0:"CLIENT-LIFETIME",1:"SESSION-LIFETIME"}),D(4,0,"oldVersion"),D(4,0,"newVersion"),D(4,0,"nameLength"),D(-1,1,"name"),D(4,0,"valueLength"),
D(-1,1,"value")],4:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(4,0,"dataLength"),D(-1,1,"data")],5:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(4,0,"generation"),D(8,0,"offset"),D(-2,1,"data")],128:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(2,0,"errorCode",{0:"UNSPECIFIED",1:"DOES_NOT_EXIST",2:"ALREADY_EXISTS",3:"INVALID_OFFSET"}),D(-2,1,"description")],129:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(2,0,"ack",xb),D(8,0,"offset")],130:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(0,2,"keys"),D(4,0,
"version"),D(4,0,"nameLength"),D(-1,1,"name"),D(4,0,"valueLength"),D(-1,1,"value")],131:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(2,0,"ack",xb),D(2,0,"requestID")],255:[D(1,0,"messageType",ub),D(1,0,"more",vb),D(-2,1,"data")]},zb=[D(1,0,"messageType",ub),D(1,0,"more",vb),D(2,0,"protocolVersion"),D(4,0,"maxSize"),D(1,0,"creationMode",wb),D(8,0,"offset"),D(1,0,"docIDLength"),D(-1,1,"docID"),D(-2,1,"data")];
function Ab(c){var a=yb[c.messageType];if(!a)throw Error("no encoder for message type "+c.messageType);1===c.messageType&&2===c.protocolVersion&&(a=zb);for(var b=[],d=0;d<a.length;d++){var e=a[d];if(!(e.name in c))throw Error("missing field "+e.name);var f=c[e.name];if(0===e.type){var h=b;e=e.length;do--e,h.push(Math.floor(f/Math.pow(2,8*e)%256));while(0<e)}else if(f instanceof Uint8Array)for(h=0;h<f.length;h++)b.push(f[h]);else for(h=b,f=Sa(f),e=0;e<f.length;e++)h.push(f[e])}return new Uint8Array(b)}
function Bb(c){var a=yb[c[0]];if(!a)return null;1===c[0]&&0===c[2]&&2===c[3]&&(a=zb);for(var b={},d=b,e=0,f=0,h="",k=0,l=0;l<a.length;l++){var n=a[l],r;if(2===n.type)h=n.name,b={},d[h]=[b],k=l;else{if(0===n.type){e=f;var u=n.length;for(r=0;u;)r=256*r+c[e],--u,e+=1;r=e=r;f+=n.length}else{u=e;-2===n.length&&(u=c.length-f,b[n.name+"_length"]=u);r=u;void 0===r&&(r=c.length-f);r=Cb(c,f,f+r);for(var x="",w=0;w<r.length;w++){var y=r[w];if(0===(y&128))x+=String.fromCharCode(y);else if(192===(y&224)){var z=
r[++w]&63;x+=String.fromCharCode((y&31)<<6|z)}else if(224===(y&240)){z=r[++w]&63;var A=r[++w]&63;x+=String.fromCharCode((y&31)<<12|z<<6|A)}else if(240===(y&248)){z=r[++w]&63;A=r[++w]&63;var G=r[++w]&63;y=(y&7)<<18|z<<12|A<<6|G;65535<y&&(y-=65536,x+=String.fromCharCode(y>>>10&1023|55296),y=56320|y&1023);x+=String.fromCharCode(y)}}r=x;f+=u}b[n.name]=r;f<c.length&&l+1==a.length&&h.length&&(b={},d[h].push(b),l=k)}}return d}
function Cb(c,a,b){return c.slice?c.slice(a,b):new Uint8Array(Array.prototype.slice.call(c,a,b))}
var Db=function(c){function a(a,d){var b=c.call(this)||this;b.sc=a;b.eo=d;a.binaryType="arraybuffer";a.onopen=function(){b.ua({type:"open"})};a.onerror=function(){b.ua({type:"error"});a.onerror=a.onclose=null};a.onclose=function(){b.ua({type:"close"});a.onerror=a.onclose=null};a.onmessage=function(a){b.ua({type:"message",message:new Uint8Array(a.data)})};return b}__extends(a,c);a.prototype.close=function(){this.sc.close()};a.prototype.read=function(){return __awaiter(this,void 0,void 0,function(){var a,
d,e,c,h;return __generator(this,function(b){switch(b.label){case 0:a=[],b.label=1;case 1:return[4,this.jx()];case 2:d=b.sent();if("message"!==d.type||0===a.length&&!d.message[1])return[2,d];e=0;c=d.message;a.length&&(e=2);for(h=e;h<c.length;h++)a.push(c[h]);return d.message[1]?[3,1]:[2,{type:"message",message:new Uint8Array(a)}];case 3:return[2]}})})};a.prototype.send=function(a){var b=this.sc,e=0,c=a.length;c>this.eo&&(c=this.eo,a[1]=1);b.send(Cb(a,e,e+c));for(e+=c;e<a.length;){c=a.length-e;c>this.eo-
2&&(c=this.eo-2);var h={messageType:255,more:e+c<a.length?1:0,data:Cb(a,e,e+c)};b.send(Ab(h));e+=c}};return a}(function(){function c(){this.Jt=[];this.sb=[]}c.prototype.jx=function(){var a=this;return(new Promise(function(b){a.sb.length?b(a.sb.shift()):a.Jt.push(b)})).then(null,function(a){throw a;})};c.prototype.ua=function(a){this.Jt.length?this.Jt.shift()(a):this.sb.push(a)};return c}()),Eb=function(){function c(){var a=this;this.timeout=0;this.wo=function(){a.cancel();a.resolve&&(a.resolve(),
a.resolve=null)};this.resolve=null}c.prototype.wait=function(a){var b=this;return new Promise(function(d){b.resolve=d;b.timeout=setTimeout(function(){return b.wo()},a);window.addEventListener("online",b.wo)})};c.prototype.cancel=function(){clearTimeout(this.timeout);window.removeEventListener("online",this.wo)};c.prototype.aE=function(){this.wo()};return c}(),Fb=function(c){function a(a,d,e,f,h,k){var b=c.call(this)||this;b.ma=a;b.ny=d;b.latency=e;b.WebSocket=f;b.Qx=h;b.xE=k;b.log=v.create("Sharing");
b.keys={};b.Aw="";b.sv="";b.timeout=null;b.yx=function(){b.yh()};b.yo=function(a){b.connected&&("online"===a.type?b.ua("connected"):b.ua("connect-error"))};b.xo=function(){};b.si=!1;b.connected=!1;b.sc=null;b.Ax=function(){for(var a=0,d=b.ma.bw();a<d.length;a++){var e=d[a];b.tG(e.name,e.value,e.persistent)}b.yh()};b.jc=0;b.At=!1;b.He="";b.ws=[];b.vl=[];b.No=[];b.HE=1;b.Yk=0;return b}__extends(a,c);a.prototype.uG=function(a){this.latency=a};a.prototype.FG=function(a){this.log("SharedSession set server name to %s",
a);this.ny=a;this.timeout&&this.timeout.aE();this.sc&&this.sc.close()};a.prototype.start=function(a,d){var b=this;this.sv=a;return new Promise(function(e,c){b.log("Start shared session: createMode=%s",d);b.xo=e;b.ma.pa("local-changes",b.yx);b.ma.pa("local-keys",b.Ax);window.addEventListener("online",b.yo);window.addEventListener("offline",b.yo);if(1===d)b.cv(a,d,"").then(null,c);else{e=b.ma.sr();if(""===e)throw Error("getLocalChanges() returned null on first batch");b.Aw=e;b.cv(a,d,e).then(null,c)}})};
a.prototype.stop=function(){this.log("stop() -- shut down session");this.si=!1;this.sc&&this.sc.close();this.ma.removeListener("local-changes",this.yx);this.ma.removeListener("local-keys",this.Ax);window.removeEventListener("online",this.yo);window.removeEventListener("offline",this.yo);this.Yk&&clearTimeout(this.Yk)};a.prototype.Us=function(a){this.ws.push(a);this.yh()};a.prototype.tG=function(a,d,e){try{d=JSON.stringify(d)}catch(n){throw console.error("Object cannot be converted to JSON: ",d),n;
}for(var b=null,c=0,k=this.vl;c<k.length;c++){var l=k[c];l.name===a&&(b=l)}c=0;k=1;a in this.keys&&(c=this.keys[a].version,k=c+1);e||(k=c=0);b?b.value=d:(b={name:a,value:d,oldVersion:c,newVersion:k,kF:e,be:this.HE++},this.vl.push(b))};a.prototype.cv=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.si=!0,b=0,f.label=1;case 1:if(!this.si)return[3,10];this.connected=!1;if(!b)return[3,3];this.log("Waiting %sms before reconnecting",
b);this.timeout=new Eb;return[4,this.timeout.wait(b)];case 2:f.sent(),this.timeout=null,f.label=3;case 3:return b=Math.max(Math.min(2*b,1E3*this.xE),1E3),[4,this.connect()];case 4:return f.sent()?[4,this.XD(a,d,e)]:[3,1];case 5:if(!f.sent())return[3,1];this.xo&&(this.xo(),this.xo=function(){});this.ua("connected");d=1;this.He=this.Aw=e="";this.connected=!0;this.yh();f.label=6;case 6:return f.trys.push([6,8,,9]),[4,this.qA()];case 7:return f.sent(),[3,9];case 8:return c=f.sent(),c instanceof Error&&
this.log("Synchronization error: "+c.message),console.log("Synchronization error: ",c),[3,9];case 9:return this.connected=!1,b=0,this.ua("connect-error"),[3,1];case 10:return[2]}})})};a.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var a,d,e;return __generator(this,function(b){switch(b.label){case 0:return a=this.ny,this.sc&&this.sc.close(),this.sc=d=new Db(new this.WebSocket(a),102400),this.log("Connect to %s; wait for event",a),[4,d.jx()];case 1:e=b.sent();if("open"!==
e.type)return this.log("Received unexpected event: %s",e.type),[2,!1];this.log("Connected to %s",a);return[2,!0]}})})};a.prototype.XD=function(a,d,e){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(f){switch(f.label){case 0:this.log("Send INIT message docLen=%s changes=%s",this.jc,e.toString().length);if(!this.sc)throw Error("ws is null");try{this.sc.send(Ab({messageType:1,more:0,maxSize:102400,protocolVersion:this.Qx,creationMode:d,generation:0,offset:this.jc,
docIDLength:Sa(a).length,docID:a,data:e}))}catch(l){throw console.log("Got error ",l),l;}return[4,this.sc.read()];case 1:b=f.sent();if("message"!=b.type)return this.log("Expected message; got "+b.type),[2,!1];c=Bb(b.message);if(128===c.messageType)throw this.log("Got error response: %s",c.description),Error(c.description);if(5===c.messageType||2===c.messageType)0<c.offset&&e.length&&this.ma.bl(e),this.log("Got initial changes at offset %s=>%s",c.offset,c.offset+c.data_length),(c.data.length||0===
c.offset)&&this.ma.wh(c.data,0===c.offset),0===c.offset&&(this.He=""),this.jc=c.offset+c.data_length;this.log("Connected and initialized.");return[2,!0]}})})};a.prototype.DG=function(a){(this.At=a)||this.yh()};a.prototype.yh=function(){var a=this;this.Yk||this.At||(this.Yk=setTimeout(function(){var b;a.Yk=0;if(a.connected&&a.sc){if(""===a.He&&(a.He=a.ma.sr(),a.He)){a.log("Sent changes %s->%s",a.jc,a.jc+a.He.length);var e=5;3>a.Qx&&(e=2);a.sc.send(Ab({messageType:e,offset:a.jc,more:0,generation:0,
data:a.He}))}e=0;for(var c=a.ws;e<c.length;e++){var h=c[e];a.sc.send(Ab({messageType:4,more:0,dataLength:Sa(h).length,data:h}))}e=a.ws.length=0;for(c=a.vl;e<c.length;e++)h=c[e],a.sc.send(Ab({messageType:3,more:0,requestID:h.be,lifetime:h.kF?1:0,oldVersion:h.oldVersion,newVersion:h.newVersion,nameLength:Sa(h.name).length,name:h.name,valueLength:Sa(h.value).length,value:h.value}));(b=a.No).push.apply(b,a.vl);a.vl.length=0}},this.latency))};a.prototype.qA=function(){return __awaiter(this,void 0,void 0,
function(){var a,d,e,c,h,k,l,n,r;return __generator(this,function(b){switch(b.label){case 0:return[4,this.sc.read()];case 1:a=b.sent();if("message"!==a.type)return this.log("Expected message; got "+a.type),[2];d=Bb(a.message);if(5===d.messageType||2===d.messageType){if(this.jc!==d.offset)throw e=this.jc,this.jc=0,Error("Error: docLength ="+e+" but got offset "+d.offset);this.ma.wh(d.data,!1);this.log("From server: APPEND "+this.jc+"->"+(this.jc+d.data_length));this.jc+=d.data_length;this.yh()}else if(129===
d.messageType)if(d.ack)this.log("Received ACK "+this.jc+"=>"+d.offset),this.ma.bl(this.He),this.He="",this.jc=d.offset;else{this.log("Received NACK "+this.jc+"!="+d.offset+" "+this.He.substr(0,22));if(d.offset<this.jc)throw this.sc.send(Ab({messageType:4,more:0,dataLength:Sa("lost-write").length,data:"lost-write"})),this.jc=0,Error("lost write detected. disconnecting");this.He="";this.yh()}else if(4===d.messageType){if("lost-write"===d.data)throw this.jc=0,Error("lost write detected. disconnecting");
this.ua("broadcast",d.data)}else if(130===d.messageType){c=[];h=0;for(k=d.keys;h<k.length;h++)l=k[h],l.value=""===l.value?null:JSON.parse(l.value),n={name:l.name,value:l.value,version:l.version},c.push(l),null===n.value?delete this.keys[n.name]:this.keys[n.name]=n;this.ua("set-keys",c)}else if(131===d.messageType)for(r=0;r<this.No.length;r++){if(l=this.No[r],l.be===d.requestID){this.log("key %s ACKED:%s",l.name,d.ack);d.ack&&(this.keys[l.name]={name:l.name,value:JSON.parse(l.value),version:l.newVersion});
this.No.splice(r,1);break}}else throw Error("Unexpected message type "+d.messageType);b.label=2;case 2:return[3,0];case 3:return[2]}})})};return a}(rb);var Gb=function(){function c(a){this.next=a}c.prototype.gz=function(a){for(var b=0;b<a.length;b++)this.Sb(a.charCodeAt(b))};c.prototype.Sb=function(a){this.next.Sb(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.Jh=function(){return this.next.Jh()};return c}(),Hb=function(){function c(){this.data="";this.log=v.create("BYTESTREAM")}c.prototype.gz=function(a){for(var b=0;b<a.length;b++)this.Sb(a.charCodeAt(b))};c.prototype.Jh=function(){return this};c.prototype.Sb=function(a){if(255<
a||0>a)throw Error("Bad data written to byte buffer");this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.Jc=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.prototype.toBlob=function(a){for(var b=new Uint8Array(this.data.length),d=0;d<this.data.length;d++)b[d]=this.data.charCodeAt(d);return new Blob([b],{type:a})};c.Wt=function(a,b){c.St[a]=b};c.qh=function(a){var b=new c;a=a.split(",");
a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.St[e](b))}return b};c.St={};return c}();var Ib=function(c){function a(a){a=c.call(this,a)||this;a.$j=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}__extends(a,c);a.prototype.Sb=function(a){this.$j=this.$j<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.Sb(this.keys.charCodeAt(this.$j>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.Sb(this.keys.charCodeAt(this.$j>>this.size-6&63)),this.$j=this.size=0);for(;a--;)this.next.Sb(61);
this.next.flush()};return a}(Gb);Hb.Wt("Base64Encoder",function(c){return new Ib(c)});var Jb=function(c){function a(a){a=c.call(this,a)||this;a.$h=0;a.zf=0;a.ax=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];a.log=v.create("BITWRITER");return a}__extends(a,c);a.prototype.Sb=function(a){this.fz(a,8)};a.prototype.fz=function(a,d){this.$h=this.$h<<d|a&this.ax[d];for(this.zf+=d;8<=this.zf;)this.next.Sb(this.$h>>>this.zf-8&255),this.zf-=8,this.$h&=this.ax[this.zf]};a.prototype.flush=function(){this.zf&&(this.next.Sb(this.$h<<8-this.zf),this.$h=this.zf=0);this.next.flush()};return a}(Gb);var Kb=function(c){function a(a){var b=c.call(this,a)||this;b.ij=258;b.qI=0;b.ui=0;b.first=!0;b.ek=[];b.us=[];b.Yp=[];b.DI=0;b.kq=9;b.log=v.create("LZWEncoder");b.BA=new Jb(a);b.eu();return b}__extends(a,c);a.prototype.Sb=function(a){if(this.first)this.ui=a,this.first=!1;else{var b=this.Nz(this.ui,a);void 0!==this.ek[b]?this.ui=this.ek[b]:(this.km(this.ui),this.ek[b]=this.ij,this.us[b]=this.ui,this.ui=this.Yp[b]=a,4095>this.ij?(this.ij+=1,this.kq=Math.ceil(Math.log(this.ij)/Math.log(2))):this.eu())}};
a.prototype.Nz=function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.ek[c]||this.us[c]===a&&this.Yp[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.eu=function(){this.km(a.nz);this.ij=258;this.kq=9;this.ek.length=0;this.us.length=0;this.Yp.length=0};a.prototype.flush=function(){this.first||(this.km(this.ui),this.km(a.uz))};a.prototype.km=function(a){this.BA.fz(a,this.kq)};a.nz=256;a.uz=257;return a}(Gb);Hb.Wt("LZWEncoder",function(c){return new Kb(c)});function Lb(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function Mb(c,a){var b;var d={};a=c.indexOf(a||"?");0<=a&&(c=c.substr(a+1));a=c.indexOf("#");0<=a&&(c=c.substr(0,a));c=c.split("&");a=0;for(b=c.length;a<b;a++){var e=c[a];var f=e.split("=");e=Lb(f[0]);"/"==e[0]&&-1===e.indexOf(".")&&(e=e.substr(1));f=1<f.length?Lb(f[1]):"";e.length&&(d[e]=f)}return d}function Ob(){if(void 0===c)var c=window.location.hash;return Mb(c,"#")}
function Pb(c){void 0===c&&(c=window.location.href);return Mb(c,"?")};var Qb=v.create("CONFIG"),Rb=function(c){function a(a,d,e){var b=c.call(this)||this;b.Hh={};for(var h in d)b.Hh[h.toLowerCase()]=h;b.options=JSON.parse(JSON.stringify(d));for(var k in e)k.toLowerCase()in b.Hh||alert("Zwibbler: Unknown option '"+k+"'"),b.set(k,e[k],!0);a.addEventListener(window,"hashchange",function(){Qb("Reload parameters from url hash");b.Wr()});a.add(function(){b.sb={}});b.Wr();for(var l in b.options)Qb("%s=%s",l,b.options[l]);return b}__extends(a,c);a.prototype.Wr=function(){var a=
Ob(),d;for(d in a)this.set(d,a[d])};a.prototype.has=function(a){return a.toLowerCase()in this.Hh};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);if(this.has(a)){if(a.toLowerCase()in this.Hh&&(a=this.Hh[a.toLowerCase()]),d=this.Hv(a,d)){Qb("Set config %s=%s",d.name,d.value);var b=this.options[d.name];this.options[d.name]=d.value;!e&&this.Fy(a,b,d.value)&&(this.Nb("update",d.name,d.value,b),this.Nb(d.name,d.value,!1))}}else console.warn("Warning: %s is not a configuration option.",a)};a.prototype.Fy=
function(a,d,e){return d!==e};a.prototype.Hv=function(a,d){if("string"===typeof d&&"number"===typeof this.options[a]&&(d=parseFloat(d),isNaN(d))){console.log(Error("Config option "+a+" expects a number"));return}return{name:a,value:d}};a.prototype.pa=function(a,d){if("update"!==a&&!(a in this.options))throw Error(a+" is not a valid config setting.");"update"!==a&&d(this.options[a],!0,null);return c.prototype.pa.call(this,a,d)};a.prototype.get=function(a){if(!this.has(a))throw Error(a+" is not a valid config setting.");
a.toLowerCase()in this.Hh&&(a=this.Hh[a.toLowerCase()]);return this.options[a]};return a}(rb);function Sb(){for(var c=E.iv,a=B.Zm('<div><div class="zwibbler-property-panel">\n<h3>Shape options</h3>\n<div z-if="ctx.summary.empty">\n    There are no selected shapes.\n</div>\n<div z-has="AnyNode">\n    <button z-click="ctx.deleteNodes()">Delete</button>                    \n    <button z-click="ctx.bringToFront()">\n        Move to front\n    </button>\n    <button z-click="ctx.sendToBack()">\n        Send to back\n    </button>\n</div>\n<div z-custom-properties></div>\n<div z-has="fontName" z-if="ctx.getConfig(\'showFontNameProperty\')">\n    <h3>Font</h3>\n    <select z-property="fontName">\n        <option z-for="font in ctx.getConfig(\'fonts\')" z-text="font" z-bind:value="font"></option>\n    </select>\n</div>\n<div z-has="fontSize" z-if="ctx.getConfig(\'showFontSizeProperty\')">\n    <h3>Font size</h3>\n    <select z-property="fontSize">\n        <option value="8">8</option>\n        <option value="10">10</option>\n        <option value="12">12</option>\n        <option value="16">16</option>\n        <option value="20">20</option>\n        <option value="24">24</option>\n        <option value="50">50</option>\n    </select>\n</div>\n<div z-has="fillStyle|strokeStyle|background">\n    <h3>Colours</h3>\n    <div class="colour-picker" z-has="fillStyle">\n        <div swatch z-property="fillStyle" z-colour></div>\n        Fill style\n    </div>\n    <div class="colour-picker" z-has="strokeStyle">\n        <div swatch z-property="strokeStyle" z-colour></div>\n        Outline\n    </div>\n    <div class="colour-picker" z-has="background">\n        <div swatch z-property="background" z-colour></div>\n        Background\n    </div>\n</div>\n<div z-has="arrowSize">\n    <h3>Arrows</h3>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="0">None</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="10">Small</button>\n    <button class="zwibbler-option" z-property="arrowSize" z-value="15">Large</button>\n    <hr>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="solid">Solid</button>\n    <button class="zwibbler-option" z-property="arrowStyle" z-value="open">Open</button>\n</div>\n<div z-has="lineWidth">\n        <h3>Line width</h3> \n        <select z-property="lineWidth">\n            <option value="0">None</option>\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="4">4</option>\n            <option value="8">8</option>\n        </select>\n    </div>\n<div z-has="dashes">\n    <h3>Line style</h3>\n    <button class="zwibbler-option" z-property="dashes" z-value="">Solid</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="3,3">Dots</button>\n    <button class="zwibbler-option" z-property="dashes" z-value="8,2">Dashes</button>\n</div>\n<div z-has="opacity">\n    <h3>Opacity</h3>\n    <input z-property="opacity" type="range" min="0.1" max="1.0" step="0.05">\n</div>              \n</div>')[0],
b="",d=0;d<c.length;d++){var e=c[d];b+=e.style||"";if("string"===typeof e.template){var f=B.Zm(e.template);if(0!==f.length)if(e.insertBefore){if((e=a.querySelector(e.insertBefore))&&e.parentNode)for(var h=0,k=f;h<k.length;h++)f=k[h],e.parentNode.insertBefore(f,e)}else if(e.insertAfter){if((e=a.querySelector(e.insertAfter))&&e.parentNode){h=e.nextSibling;k=0;for(var l=f;k<l.length;k++)f=l[k],e.parentNode.insertBefore(f,h)}}else if(e=a.querySelector("[custom-properties]"))for(h=0,k=f;h<k.length;h++)f=
k[h],e.appendChild(f)}}return{style:".zwibbler-property-panel {\n    width: 200px;\n    background: #f5f5f5;\n    display:flex;\n    flex-flow: column nowrap;\n    overflow-y: scroll;\n    padding: 10px;\n    font-family: sans-serif;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none;     \n}\n\n.zwibbler-property-panel h3 {\n    margin-bottom: 0.5em;\n}\n\n.zwibbler-property-panel button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    display: block;\n    background-color: white;\n    color: black;\n    border: none;\n    border-radius: 2px;\n    border-bottom: 2px solid #ddd;\n    width: 100%;\n}\n\n.zwibbler-property-panel button[tool] {\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    font-size: 30px;\n}\n\n.zwibbler-property-panel button.zwibbler-option {\n    border: 0;\n    padding: 10px;\n    border-radius: 3px;\n    background: transparent;\n    text-align: left;\n}\n\n.zwibbler-property-panel button.selected {\n    background: #9fb3e7;\n}\n\n.zwibbler-property-panel button.hover {\n    background: #ddd;\n}\n\n.zwibbler-property-panel hr {\n    border: none;\n    border-top: 1px solid #ccc;\n}\n\n.zwibbler-property-panel select {\n    width: 100%;\n}\n\n.zwibbler-property-panel .colour-picker {\n    padding: 10px 0;\n}\n\n.zwibbler-property-panel [swatch] {\n    border: 1px solid black;\n    display: inline-block;\n    height: 2em;\n    width: 4em;\n    vertical-align:middle;\n    margin-right: 10px;\n}\n"+
b,cj:a.innerHTML}};var Ub={style:"\n.zwibbler-colour-panel {\n    overflow:hidden;\n    border-top: 1px solid black;\n    white-space: nowrap;\n    font-size: 0;\n}\n\n.zwibbler-colour-panel div { \n    display: inline-block;\n}",cj:'<div class="zwibbler-colour-panel" z-style="{height:ColourPanelWidth()+\'px\'}">\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'clear\'}"\n        z-on:click="setColour(\'rgba(0,0,0,0.0)\', true)"\n        z-on:contextmenu="setColour(\'rgba(0,0,0,0.0)\', false)">\n    </canvas>\n    <canvas z-clear-glyph="{width: ColourPanelWidth(), style:\'transparent\'}"\n        z-on:click="setOpacity(0.5, true)"\n        z-on:contextmenu="setOpacity(0.5, false)">\n    </canvas>\n    <div z-for="colour in ColourPanelColours"\n        z-style="{width: ColourPanelWidth()+\'px\', height: ColourPanelWidth()+\'px\', background: colour}"\n        z-on:click="setColour(colour, true)"\n        z-on:contextmenu="setColour(colour, false)">\n    </div>\n</div>\n',
controller:function(c){var a=Tb(),b=c.ma||c;a.shift();a.shift();c.ColourPanelColours=a;c.ColourPanelWidth=function(){return b.Zb("useTouch")?40:20}}};
function Tb(){function c(b){for(var d=30;100>d;d+=20)b.values[2]=d/100,a.push(b.toString())}var a=[q.he,"rgba(0,0,0,0.5)",q.Oa,q.Od,"#000088","#008800","#008888","#880000","#880088","#884400","#888888","#444444","#0000ff","#00ff00","#00ffff","#ff0000","#ff00ff","#ffff00"];c(new q(q.xi,[0,0,0,1]));for(var b=0;720>b;b+=35){var d=new q(q.xi,[b,.5,0,1]);c(d)}return a};var Vb=HTMLElement,Wb=Element,Xb=Object,Yb;
(function(c){function a(a){return{type:a,match:function(b){return typeof b===a}}}function b(a){return{type:a.name,match:function(b){return b instanceof a}}}function d(a){return{type:""+a,match:function(b){return b===a}}}function e(a){return{type:a.type+"[]",match:function(b){return b instanceof Array&&(0===b.length||a.match(b[0]))}}}function f(a){return{type:a.type+"?",match:function(b){return void 0===b||null===b||a.match(b)}}}c.bm=b;c.Nd=d;c.ph={type:"any",match:function(a){return"undefined"!==
typeof a}};c.Zl=e;c.Wa=f;c.cb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++)b.push(a[d].type);return{type:"("+b.join("|")+")",match:function(b){for(var d=0;d<a.length;d++)if(!0===a[d].match(b))return!0;return!1}}};c.Mc=function(a,b){return{type:a,match:function(a){if("object"!==typeof a)return!1;for(var d in b)if(!b[d].match(a[d]))return"The "+d+" member should be a "+b[d].type+", not "+Zb(a[d]);return!0}}};c.wi=function(){for(var a=[],b=0;b<
arguments.length;b++)a[b]=arguments[b];return{type:"("+a.join("|")+")",match:function(b){for(var d=0;d<a.length;d++)if(a[d]===b)return!0;return!1}}};c.Ez=f(c.ph);c.sh=d(null);c.String=a("string");c.dc=f(c.String);c.Number={type:"number",match:function(a){return"number"===typeof a&&isFinite(a)?!0:a+" is not a number."}};c.Dz=function(){return{type:"number(0..1)",match:function(a){return"number"===typeof a&&0<=a&&1>=a?!0:a+" is not a number between 0 and 1."}}};c.Qa=f(c.Number);c.cm=e(c.Number);c.Function=
a("function");c.wg=f(c.Function);c.Boolean=a("boolean");c.Nc=f(c.Boolean);c.HTMLElement=b(Vb);c.Element=b(Wb);c.Object=b(Xb);c.qd=f(c.Object);c.iI=e(c.Object);c.cc={type:"integer",match:function(a){return"number"===typeof a&&(a|0)===a?!0:a+" is not a whole number."}};c.ge=f(c.cc);c.yz=e(c.cc);c.ha=function(a,b){for(var d=[],e=2;e<arguments.length;e++)d[e-2]=arguments[e];for(e=0;e<d.length;e++){var c=d[e],f=b[e],h=c.match(f);if(!0!==h)throw console.log("arguments: ",b),Error("Error calling "+a+": "+
$b(e+1)+" argument is '"+Zb(f)+"' but expected '"+c.type+"'. "+(!1===h?"":h)+"'");}}})(Yb||(Yb={}));function $b(c){switch(c%10){case 1:return c+"st";case 2:return c+"nd";case 3:return c+"rd"}return c+"th"}function Zb(c){return c instanceof Array?c.length?Zb(c[0])+"[]":"Array":null===c?"null":typeof c}var F=Yb;var ac=function(){function c(){var a=this;this.oF=new Promise(function(b,d){a.resolve=b;a.reject=d})}c.prototype.then=function(a,b){return this.oF.then(a,b)};return c}();var bc=new ac;v.create("Graphics",!0);
var J=function(){function c(a,b){this.x=a;this.y=b}c.prototype.ic=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.xd=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.kt=function(a){return new c(this.x-a.x,this.y-a.y)};c.prototype.qv=function(a,b){var d=a.x,e=a.y,c=this.x,h=this.y,k=b.x-d;b=b.y-e;var l=k*k+b*b;if(0===l)return this.ic(a);
a=((c-d)*k+(h-e)*b)/l;1<a?a=1:0>a&&(a=0);d=d+a*k-c;e=e+a*b-h;return Math.sqrt(d*d+e*e)};c.xp=function(a){for(var b=[],d=a.length-(a.length&1),e=0;e<d;e+=2)b.push(new c(a[e],a[e+1]));return b};return c}();function cc(c){var a=dc(c);c.sort(function(b,d){return Math.atan2(b.y-a.y,b.x-a.x)-Math.atan2(d.y-a.y,d.x-a.x)})}function ec(c,a,b){function d(a,b,d){return{x:a.x+(b.x-a.x)*d,y:a.y+(b.y-a.y)*d}}return d(d(c[0],c[1],a),d(c[3],c[2],a),b)}
var fc=function(){function c(a,b){this.width=a;this.height=b}c.prototype.toString=function(){return"Size("+this.width+","+this.height+")"};c.prototype.Gv=function(a,b){var d=1;void 0!==a&&void 0!==b?d=Math.min(a/this.width,b/this.height):void 0!==a?d=a/this.width:void 0!==b&&(d=b/this.height);this.width*=d;this.height*=d;return d};return c}();function gc(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function hc(c,a,b,d){var e=gc(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}
function dc(c){if(0===c.length)return new J(0,0);for(var a=c[0].x,b=c[0].y,d=1;d<c.length;d++)a+=c[d].x,b+=c[d].y;return new J(a/c.length,b/c.length)}
var K=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.EF()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.Ee=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,h=1;h<a.length;h++)a[h].x<b&&(b=a[h].x),a[h].x>d&&(d=a[h].x),a[h].y<e&&(e=a[h].y),a[h].y>f&&(f=a[h].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.xd=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Oj=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.Dw=function(a){a.x>this.x&&(this.width-=a.x-this.x,this.x=a.x);a.x+a.width<
this.x+this.width&&(this.width-=this.x+this.width-a.x-a.width);a.y>this.y&&(this.height-=a.y-this.y,this.y=a.y);a.y+a.height<this.y+this.height&&(this.height-=this.y+this.height-a.y-a.height)};c.prototype.yt=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>
a.y+a.height};c.prototype.Ex=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.Ei=function(){return this.width*this.height};c.prototype.Dx=function(a){return this.Ex(a)?(Math.min(this.right(),a.right())-Math.max(this.x,a.x))*(Math.min(this.bottom(),a.bottom())-Math.max(this.y,a.y)):0};c.prototype.Xc=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.EF=
function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.dd=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=
Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.me=function(){return new J(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};c.prototype.mq=function(a){var b=this.x,d=this.y;this.right()>a.right()&&(this.x-=this.right()-a.right());this.bottom()>
a.bottom()&&(this.y-=this.bottom()-a.bottom());this.y<a.y&&(this.y=a.y);this.x<a.x&&(this.x=a.x);return{x:this.x-b,y:this.y-d}};return c}();function ic(c){return 0!==c?c:-Infinity===1/c?-1E-11:1E-11}
var L=function(){function c(){this.log=v.create("MATRIX");if(0===arguments.length)this.m11=1,this.m21=this.m12=0,this.m22=1,this.Ia=this.Ha=0;else if(1===arguments.length)if("string"===typeof arguments[0]){var a=arguments[0].match(/-?\d+\.?[\deE\+\-]*/g);if(!a||6!=a.length)throw Error("Bad initializer for matrix: "+arguments[0]);this.m11=parseFloat(a[0]);this.m21=parseFloat(a[1]);this.m12=parseFloat(a[2]);this.m22=parseFloat(a[3]);this.Ha=parseFloat(a[4]);this.Ia=parseFloat(a[5])}else{if(6!==arguments[0].length)throw Error("Bad array initializer for Matrix.");
this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Ha=arguments[0][4];this.Ia=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Ha=arguments[4],this.Ia=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.Ha+"    "+this.m21+" "+this.m22+" "+this.Ia+"    0 0 1 ]"};c.prototype.Jc=function(){return[this.m11,this.m12,this.m21,this.m22,this.Ha,this.Ia]};
c.prototype.round=function(a){return new c(parseFloat(this.m11.toFixed(a)),parseFloat(this.m12.toFixed(a)),parseFloat(this.m21.toFixed(a)),parseFloat(this.m22.toFixed(a)),parseFloat(this.Ha.toFixed(a)),parseFloat(this.Ia.toFixed(a)))};c.prototype.Gw=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Ha&&0===this.Ia};c.prototype.xd=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Ha===a.Ha&&this.Ia===a.Ia};c.prototype.multiply=
function(a){var b=new c;b.m11=ic(this.m11*a.m11+this.m12*a.m21);b.m21=this.m21*a.m11+this.m22*a.m21;b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=ic(this.m21*a.m12+this.m22*a.m22);b.Ha=this.m11*a.Ha+this.m12*a.Ia+this.Ha;b.Ia=this.m21*a.Ha+this.m22*a.Ia+this.Ia;if(!b.isFinite())throw Error("Multiplied matrix has NaN values: "+b.Ff()+" after multiplying with "+a.Ff());return b};c.prototype.isFinite=function(){function a(a){return isFinite(a)&&"number"===typeof a}return a(this.m11)&&a(this.m12)&&a(this.m21)&&
a(this.m22)&&a(this.Ha)&&a(this.Ia)};c.prototype.apply=function(a,b){return new J(this.m11*a+this.m12*b+this.Ha,this.m21*a+this.m22*b+this.Ia)};c.prototype.rc=function(a,b){void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Ha,this.Ia):a.transform(this.m11,this.m21,this.m12,this.m22,this.Ha,this.Ia)};c.prototype.clone=function(){return new c(this.m11,this.m12,this.m21,this.m22,this.Ha,this.Ia)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/
a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Ia-this.Ha*this.m22)/a,(this.Ha*this.m21-this.m11*this.Ia)/a)};c.prototype.hp=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),h=Math.sqrt(d*d+e*e);return new c(a/f,d/h,b/f,e/h,this.Ha,this.Ia)};c.prototype.Ar=function(){var a=this.ub(!0);return(Math.atan2(this.m21/a.y,this.m11/a.x)+Math.atan2(this.m22/a.y,this.m12/a.x))/2-Math.PI/4};c.prototype.ub=function(a){var b=Math.sqrt(this.m11*this.m11+this.m21*this.m21),d=
Math.sqrt(this.m12*this.m12+this.m22*this.m22);a&&0>this.m11&&(b=-b);a&&0>this.m22&&(d=-d);return new J(b,d)};c.prototype.Mw=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new jc(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new kc(a,b,d))};c.prototype.Ff=function(){return"matrix("+this.m11+", "+this.m21+", "+this.m12+", "+this.m22+", "+this.Ha+", "+this.Ia+")"};c.prototype.iH=function(){return new DOMMatrix([this.m11,
this.m21,this.m12,this.m22,this.Ha,this.Ia])};c.prototype.toJSON=function(){if(!this.isFinite())throw Error("Tried to encode matrix with NaN/Inf values: "+this.Ff());return this.Ff()};return c}(),kc=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}__extends(a,c);return a}(L),jc=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}__extends(a,c);return a}(L),lc=function(c){function a(a,d,e,f){return void 0===e||void 0===
f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}__extends(a,c);return a}(L),mc=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}__extends(a,c);return a}(L);
function qc(c,a,b,d,e,f,h,k,l,n){if(!(8<++qc.depth)){var r=(a+d)/2,u=(b+e)/2,x=(d+f)/2,w=(e+h)/2,y=(f+k)/2,z=(h+l)/2,A=(r+x)/2,G=(u+w)/2;x=(x+y)/2;w=(w+z)/2;var I=(A+x)/2,C=(G+w)/2,M=k-a,H=l-b;d=Math.abs((d-k)*H-(e-l)*M);f=Math.abs((f-k)*H-(h-l)*M);(d+f)*(d+f)<n*(M*M+H*H)?c.push(new J(I,C)):(qc(c,a,b,r,u,A,G,I,C,n),qc(c,I,C,x,w,y,z,k,l,n))}--qc.depth}(qc||(qc={})).depth=0;
function rc(c,a,b,d,e,f,h,k){if(!(8<++qc.depth)){var l=(a+d)/2,n=(b+e)/2,r=(d+f)/2,u=(e+h)/2,x=(l+r)/2,w=(n+u)/2,y=f-a,z=h-b;d=Math.abs((d-f)*z-(e-h)*y);d*d<=k*(y*y+z*z)?c.push(new J(x,w)):(rc(c,a,b,l,n,x,w,k),rc(c,x,w,r,u,f,h,k))}--qc.depth}
function sc(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var h=c[f-1].x;var k=c[f-1].y;for(d=0;d<f;d++){var l=c[d].x;var n=c[d].y;if(l>h){var r=h;var u=l;var x=k;k=n}else r=l,u=h,x=n;l<a===a<=h&&(b-x)*(u-r)<(k-x)*(a-r)&&(e=!e);h=l;k=n}return e}function tc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,h=c[e-1].y,k=c[e].x-f,l=c[e].y-h,n=((a-f)*k+(b-h)*l)/(k*k+l*l);1<n?n=1:0>n&&(n=0);f=f+n*k-a;h=h+n*l-b;if(f*f+h*h<=d)return!0}return!1}
(function(){function c(a){this.image=a}c.prototype.clear=function(){for(var a=0;a<this.image.width*this.image.height*4;a++)this.image.data[a]=0};c.prototype.getImageData=function(){return this.image};c.prototype.width=function(){return this.image.width};c.prototype.height=function(){return this.image.height};c.prototype.get=function(a,b){a=this.image.width*b*4+4*a;return this.image.data[a]|this.image.data[a+1]<<8|this.image.data[a+2]<<16|this.image.data[a+3]<<24};c.prototype.set=function(a,b,d){a=
this.image.width*b*4+4*a;this.image.data[a]=d&255;this.image.data[a+1]=d>>8&255;this.image.data[a+2]=d>>16&255;this.image.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.Di=a;this.im=b;this.data=[]}c.prototype.width=function(){return this.Di};c.prototype.height=function(){return this.im};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.Di;a.height=this.im;a=a.getContext("2d").getImageData(0,0,this.Di,this.im);for(var b=this.Di*this.im,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.Di*b+a]};c.prototype.set=function(a,b,d){this.data[this.Di*b+a]=d};return c})();
var vc=function(){function c(a){this.closed=!1;this.ga=[];a instanceof K?this.rect(a.x,a.y,a.width,a.height):a instanceof Array&&(this.ga=a)}c.prototype.clear=function(){this.closed=!1;this.ga=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(a,b,d,e){this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+e);this.lineTo(a,b+e);this.lineTo(a,b);this.closePath()};c.prototype.moveTo=function(a,b){this.ga.push(c.Wc,a,b)};c.prototype.lineTo=function(a,b){this.ga.push(c.Ld,a,b)};c.prototype.bezierCurveTo=
function(a,b,d,e,f,h){this.ga.push(c.vg,a,b,d,e,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ga.push(c.xg,a,b,d,e)};c.prototype.arc=function(a,b,d,e,c,h){uc(this,a,b,d,e,c,h)};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.ga.push(c.Kd)};c.prototype.ka=function(a){for(var b=0;b<this.ga.length;){switch(this.ga[b]){case c.Wc:a.moveTo&&a.moveTo(this.ga[b+1],this.ga[b+2]);break;case c.Ld:a.lineTo&&a.lineTo(this.ga[b+1],this.ga[b+2]);break;case c.vg:a.bezierCurveTo&&
a.bezierCurveTo(this.ga[b+1],this.ga[b+2],this.ga[b+3],this.ga[b+4],this.ga[b+5],this.ga[b+6]);break;case c.xg:a.quadraticCurveTo&&a.quadraticCurveTo(this.ga[b+1],this.ga[b+2],this.ga[b+3],this.ga[b+4]);break;case c.Kd:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.Md[this.ga[b]]}};c.prototype.KF=function(){for(var a=0,b=0,d=0,e=[];a<this.ga.length;){switch(this.ga[a]){case c.Kd:e.push([c.Kd]);break;case c.Wc:b=this.ga[a+1];d=this.ga[a+2];break;case c.Ld:e.push([c.Ld,b,d]);b=this.ga[a+
1];d=this.ga[a+2];break;case c.vg:e.push([c.vg,this.ga[a+3],this.ga[a+4],this.ga[a+1],this.ga[a+2],b,d]);b=this.ga[a+5];d=this.ga[a+6];break;case c.xg:e.push([c.xg,this.ga[a+1],this.ga[a+2],b,d]),b=this.ga[a+3],d=this.ga[a+4]}a+=c.Md[this.ga[a]]}this.ga.length&&e.push([c.Wc,b,d]);a=new c;for(b=e.length-1;0<=b;b--)Array.prototype.push.apply(a.ga,e[b]);a.closed=this.closed;return a};c.prototype.fe=function(){for(var a=0,b,d=[],e=[d],f=!1;a<this.ga.length;){var h=c.Vt[this.ga[a]];this.ga[a]===c.Wc&&
0<d.length&&(f?(d=[],e.push(d),f=!1):d.length=0);this.ga[a]!==c.Wc&&(f=!0);for(b=0;b<h;b++)d.push(new J(this.ga[a+1+2*b],this.ga[a+1+2*b+1]));a+=c.Md[this.ga[a]]}return e};c.prototype.transform=function(a){for(var b=0,d,e;b<this.ga.length;){e=c.Vt[this.ga[b]];for(d=0;d<e;d++){var f=a.apply(this.ga[b+1+2*d],this.ga[b+1+2*d+1]);this.ga[b+1+2*d]=f.x;this.ga[b+1+2*d+1]=f.y}b+=c.Md[this.ga[b]]}};c.prototype.clone=function(){var a=new c;a.ga=this.ga.concat();return a};c.prototype.cq=function(a){for(var b=
0,d,e=d=0,f=new K(this.ga[1]||0,this.ga[2]||0,0,0),h;b<this.ga.length;){switch(this.ga[b]){case c.Wc:case c.Ld:d=this.ga[b+1];e=this.ga[b+2];f.yt(d,e);break;case c.vg:var k=h=[],l=this.ga[b+5],n=this.ga[b+6];qc(k,d,e,this.ga[b+1],this.ga[b+2],this.ga[b+3],this.ga[b+4],l,n,a*a);k.push(new J(l,n));for(d=0;d<h.length;d++)f.yt(h[d].x,h[d].y);d=this.ga[b+5];e=this.ga[b+6];break;case c.xg:k=h=[];l=this.ga[b+3];n=this.ga[b+4];rc(k,d,e,this.ga[b+1],this.ga[b+2],l,n,a*a);k.push(new J(l,n));for(d=0;d<h.length;d++)f.yt(h[d].x,
h[d].y);d=this.ga[b+3];e=this.ga[b+4]}b+=c.Md[this.ga[b]]}return f};c.prototype.append=function(a){this.ga=this.ga.concat(a.ga)};c.prototype.mh=function(a){for(var b=0,d=0,e=0,f=new c,h;b<this.ga.length;){switch(this.ga[b]){case c.Wc:d=this.ga[b+1];e=this.ga[b+2];f.moveTo(d,e);break;case c.Ld:d=this.ga[b+1];e=this.ga[b+2];f.lineTo(d,e);break;case c.vg:var k=h=[],l=this.ga[b+5],n=this.ga[b+6];qc(k,d,e,this.ga[b+1],this.ga[b+2],this.ga[b+3],this.ga[b+4],l,n,a*a);k.push(new J(l,n));2===h.length&&1E-4>
d*(h[0].y-h[1].y)+h[0].x*(h[1].y-e)+h[1].x*(e-h[0].y)&&(h[0]=h[1],h.length=1);for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.ga[b+5];e=this.ga[b+6];break;case c.xg:k=h=[];l=this.ga[b+3];n=this.ga[b+4];rc(k,d,e,this.ga[b+1],this.ga[b+2],l,n,a*a);k.push(new J(l,n));for(d=0;d<h.length;d++)f.lineTo(h[d].x,h[d].y);d=this.ga[b+3];e=this.ga[b+4];break;case c.Kd:f.closePath()}b+=c.Md[this.ga[b]]}return f};c.prototype.lF=function(a,b,d){void 0===d&&(d=0);for(var e=0,c=this.fe();e<c.length;e++)if(sc(c[e],
a,b))return!0;return 0<d&&this.Kx(a,b,d)};c.prototype.Kx=function(a,b,d){var e=0,f=0,h=0;for(d*=d;h<this.ga.length;){switch(this.ga[h]){case c.Wc:e=this.ga[h+1];f=this.ga[h+2];break;case c.Ld:var k=this.ga[h+1];var l=this.ga[h+2];var n=k-e;var r=l-f;var u=n*n+r*r;u=((a-e)*n+(b-f)*r)/u;1<u?u=1:0>u&&(u=0);e+=u*n;r=f+u*r;f=e-a;r-=b;f=f*f+r*r;if(f<=d)return!0;e=k;f=l}h+=c.Md[this.ga[h]]}return!1};c.prototype.Vm=function(a,b){for(var d=0,e=0,f=b[0],h,k=new J(0,0),l;d<this.ga.length;){switch(this.ga[d]){case c.Wc:l=
this.ga[d+1];h=this.ga[d+2];a.moveTo(l,h);k=new J(l,h);break;case c.Ld:l=this.ga[d+1];var n=h=this.ga[d+2],r=new J(l,n);h=k.ic(r);if(!(0>=h||0>f)){for(;h>f;)k.x+=(r.x-k.x)*f/h,k.y+=(r.y-k.y)*f/h,e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),h-=f,e=(e+1)%b.length,f=b[e];h<=f&&(k=new J(l,n),e&1?a.moveTo(k.x,k.y):a.lineTo(k.x,k.y),f-=h)}}d+=c.Md[this.ga[d]]}};c.prototype.Ei=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.ga.length;){switch(this.ga[b]){case c.Wc:d=this.ga[b+1];
e=this.ga[b+2];break;case c.Ld:a(this.ga[b+1],this.ga[b+2]);break;case c.vg:a(this.ga[b+5],this.ga[b+6]);break;case c.xg:a(this.ga[b+3],this.ga[b+4])}b+=c.Md[this.ga[b]]}return f/2};c.prototype.Jq=function(a){for(var b=0,d=0,e=0,f=!1;b<this.ga.length;){switch(this.ga[b]){case c.Wc:d=this.ga[b+1];e=this.ga[b+2];f=!0;break;case c.Ld:a(d,e,this.ga[b+1],this.ga[b+2],f),d=this.ga[b+1],e=this.ga[b+2],f=!1}b+=c.Md[this.ga[b]]}};c.prototype.Pu=function(){var a=0;this.Jq(function(b,d,e,c){a+=gc(b,d,e,c)});
return a};c.prototype.NA=function(a){var b=new c,d=0;this.Jq(function(e,c,h,k,l){if(d<=a){l&&b.moveTo(e,c);l=gc(e,c,h,k);if(d+l>=a){var f=a-d;h=e+(h-e)*f/l;k=c+(k-c)*f/l}d+=l;b.lineTo(h,k)}});return b};c.prototype.trim=function(a,b){var d=0,e=new c,f=!0;this.Jq(function(c,k,l,n,r){var h=gc(c,k,l,n);f=f||r;if(!(d+h<a||d>b)){r=d<b&&d+h>b;if(d<a&&d+h>a){var x=a-d;c+=(l-c)*x/h;k+=(n-k)*x/h}r&&(x=b-d,l=c+(l-c)*x/h,n=k+(n-k)*x/h);f&&(e.moveTo(c,k),f=!1);e.lineTo(l,n)}d+=h});return e};c.Wc=0;c.Ld=1;c.vg=
2;c.xg=3;c.Kd=4;c.Md=[3,3,7,5,1];c.Vt=[1,1,3,2,0];return c}();function wc(c,a,b,d,e,f,h){void 0===h&&(h=f);0===f&&0===h?c.rect(a,b,d,e):(d=a+d,e=b+e,c.moveTo(a+f,b),c.lineTo(d-f,b),c.quadraticCurveTo(d,b,d,b+h),c.lineTo(d,e-h),c.quadraticCurveTo(d,e,d-f,e),c.lineTo(a+f,e),c.quadraticCurveTo(a,e,a,e-h),c.lineTo(a,b+h),c.quadraticCurveTo(a,b,a+f,b),c.closePath())}
function xc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var h=c[b],k=c[d-1],l=0,n=0;for(f=b+1;f<d;f++){var r=c[f].qv(h,k);r>l&&(l=r,n=f)}0<n&&l>a?(xc(c,a,b,n,e),xc(c,a,n,d,e)):e.push(h)}}function yc(c,a){var b=[];xc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].xd(b[b.length-1])&&b.push(c[c.length-1]);return b}
var zc=function(){function c(){this.na=[];if(1===arguments.length){var a=arguments[0];if(a instanceof K)this.na.push(new J(a.x,a.y)),this.na.push(new J(a.right(),a.y)),this.na.push(new J(a.right(),a.bottom())),this.na.push(new J(a.x,a.bottom()));else if(a instanceof Array)this.na=a;else throw alert("Bad parameter passed to Polygon() constructor."),Error("Bad parameter passed to Polygon() constructor.");}}c.prototype.$D=function(a){var b=this.fe();a=a.fe();for(var d=0;d<b.length;d++){var e=b[d];if(!sc(a,
e.x,e.y))return!1}return!0};c.prototype.zF=function(){var a=this.na;if(1<a.length){var b=a[0],d=a[a.length-1];b.x===d.x&&b.y===d.y&&a.length--}};c.prototype.transform=function(a){for(var b=0;b<this.na.length;b++)this.na[b]=a.apply(this.na[b].x,this.na[b].y)};c.prototype.add=function(a,b){this.na.push(new J(a,b))};c.prototype.Xc=function(a,b,d){void 0===d&&(d=0);return sc(this.na,a,b)||d&&tc(this.na,a,b,d)};c.prototype.Cm=function(){return K.Ee(this.na)};c.prototype.clone=function(){return new c(this.na.slice(0))};
c.prototype.xd=function(a){if(this.na.length!==a.na.length)return!1;for(var b=0;b<this.na.length;b++){var d=this.na[b],e=a.na[b];if(d.x!==e.x||d.y!==e.y)return!1}return!0};c.prototype.dd=function(a){for(var b=[],d=0;d<this.na.length;d++){var e=this.na[0===d?this.na.length-1:d-1],c=this.na[d],h=this.na[d===this.na.length-1?0:d+1],k=gc(e.x,e.y,c.x,c.y),l=gc(h.x,h.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/k+(c.x-h.x)/l)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/k+(c.y-h.y)/l)/Math.sqrt(2)*a})}this.na=b};c.prototype.kw=
function(a){var b=[];if(2>this.na.length)return b;for(var d=this.na[this.na.length-1],e=0;e<this.na.length;e++){var c=this.na[e];if(a===d.y&&d.y===c.y)b.push(d.x),b.push(c.x);else if(d.y<a&&c.y>a||d.y>a&&c.y<a){var h=c.x-d.x;var k=c.y-d.y;b.push(d.x+h*(a-d.y)/k)}d=c}b.sort(function(a,b){return a-b});return b};c.prototype.ka=function(a){if(!(1>this.na.length)){a.moveTo(this.na[0].x,this.na[0].y);for(var b=1;b<this.na.length;b++)a.lineTo(this.na[b].x,this.na[b].y);a.closePath()}};c.prototype.fe=function(){return this.na};
c.oz=function(a){for(var b=0,d=0,e=[],c=[],h=0;h<a.length;h++)c.push(0);for(;;){var k=0,l=-1;for(h=0;h<a.length;h++)if(c[h]<a[h].length){var n=a[h][c[h]];if(0===h||n<k){k=n;l=h;var r=1-c[h]%2}}if(-1===l)return e;c[l]+=1;r?(d+=1,d===a.length&&(b=k)):(d===a.length&&(e.push(b),e.push(k)),--d)}};return c}();function Ac(c,a,b){void 0===a&&(a=0);void 0===b&&(b=0);var d=[],e=0,f=0;for(c=c.split(",");f<c.length;f++){var h=parseFloat(c[f]);isNaN(h)||(h=e&1?h+a:h+b,d.push(h));e++}return d}
function Bc(c,a,b){if(0!==a.length)if(c.moveTo(a[0].x,a[0].y),0===b.length)for(b=1;b<a.length;b++)c.lineTo(a[b].x,a[b].y);else for(var d=0,e=1,f=b[0],h=a[0].clone(),k;e<a.length;)k=h.ic(a[e]),0===k?e+=1:k<=f?(h=a[e].clone(),d&1?c.moveTo(h.x,h.y):c.lineTo(h.x,h.y),f-=k,e+=1):(h.x+=(a[e].x-h.x)*f/k,h.y+=(a[e].y-h.y)*f/k,d&1?c.moveTo(h.x,h.y):c.lineTo(h.x,h.y),d=(d+1)%b.length,f=b[d])}
function Cc(c,a,b,d,e,f,h,k){b-=c;d-=a;h-=e;k-=f;var l=-h*d+b*k;if(0===l)return null;e=(h*(a-f)-k*(c-e))/l;return new J(c+e*b,a+e*d)}
function Dc(c,a){function b(a){var b,e;var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];a[b+1]&&(c[b]=d(n,a[b+1]));b+=1}return c}function d(a,b){return new J(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Dc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var l=b=0;for(e=a.length;l<e;l++){var n=a[l];c[2*b]=n;a[b+1]&&(c[2*b+1]=d(n,a[b+1]));b+=1}return c}(c))),a-1):c}
function Ec(c,a){var b=0,d=0,e=0,f=0,h=0,k=0,l=0,n=0;Fc(a,function(a,u){switch(a){case "M":for(var r=0;r<u.length;r+=2)b=u[r],d=u[r+1],0==r?(c.moveTo(b,d),e=b,f=d):c.lineTo(b,d);break;case "m":for(r=0;r<u.length;r+=2)b+=u[r],d+=u[r+1],0==r?(c.moveTo(b,d),e=b,f=d):c.lineTo(b,d);break;case "L":for(r=0;r<u.length;r+=2)b=u[r],d=u[r+1],c.lineTo(u[r],u[r+1]);break;case "l":for(r=0;r<u.length;r+=2)b+=u[r],d+=u[r+1],c.lineTo(b,d);break;case "H":for(r=0;r<u.length;r++)b=u[r],c.lineTo(b,d);break;case "h":for(r=
0;r<u.length;r++)b+=u[r],c.lineTo(b,d);break;case "V":for(r=0;r<u.length;r++)d=u[r],c.lineTo(b,d);break;case "v":for(r=0;r<u.length;r++)d+=u[r],c.lineTo(b,d);break;case "Q":for(r=0;r<u.length;r+=4)l=u[r],n=u[r+1],b=u[r+2],d=u[r+3],c.quadraticCurveTo(l,n,b,d);break;case "q":for(r=0;r<u.length;r+=4)l=u[r]+b,n=u[r+1]+d,b=u[r+2]+b,d=u[r+3]+d,c.quadraticCurveTo(l,n,b,d);break;case "T":for(r=0;r<u.length;r+=2)l=b+b-l,n=d+d-n,b=u[r],d=u[r+1],c.quadraticCurveTo(l,n,b,d);break;case "t":for(r=0;r<u.length;r+=
2)l=b+b-l,n=d+d-n,b=u[r]+b,d=u[r+1]+d,c.quadraticCurveTo(l,n,b,d);break;case "C":for(r=0;r<u.length;r+=6)h=u[r+2],k=u[r+3],b=u[r+4],d=u[r+5],c.bezierCurveTo(u[r],u[r+1],h,k,b,d);break;case "c":for(r=0;r<u.length;r+=6){var w=u[r]+b,y=u[r+1]+d;h=u[r+2]+b;k=u[r+3]+d;b=u[r+4]+b;d=u[r+5]+d;c.bezierCurveTo(w,y,h,k,b,d)}break;case "S":for(r=0;r<u.length;r+=4)w=b+b-h,y=d+d-k,c.bezierCurveTo(w,y,u[r],u[r+1],u[r+2],u[r+3]),h=u[r],k=u[r+1],b=u[r+2],d=u[r+3];break;case "s":for(r=0;r<u.length;r+=4)w=b+b-h,y=d+
d-k,c.bezierCurveTo(w,y,u[r]+b,u[r+1]+d,u[r+2]+b,u[r+3]+d),h=u[r]+b,k=u[r+1]+d,b=u[r+2]+b,d=u[r+3]+d;break;case "A":case "a":for(r=0;r<u.length;r+=7){var z=u[r+0],A=u[r+1];w=u[r+2]/Math.PI;var G=1===u[r+3];y=1===u[r+4];var I=u[r+5],C=u[r+6];"a"==a&&(I+=b,C+=d);z=Math.abs(z);A=Math.abs(A);var M=(b-I)/2,H=(d-C)/2,V=Math.cos(w)*M+Math.sin(w)*H;M=-Math.sin(w)*M+Math.cos(w)*H;H=z*z;var ya=A*A,xa=V*V,Z=M*M,ea=xa/H+Z/ya;1<ea&&(H=Math.sqrt(ea),z*=H,A*=H,H=z*z,ya=A*A);xa=H*Z+ya*xa;0===xa?z=null:(H=Math.sqrt(Math.max(0,
(H*ya-xa)/xa)),G==y&&(H=-H),G=H*z*M/A,Z=-H*A*V/z,H=Math.cos(w)*G-Math.sin(w)*Z+(b+I)/2,ya=Math.sin(w)*G+Math.cos(w)*Z+(d+C)/2,xa=Gc(1,0,(V-G)/z,(M-Z)/A),V=Gc((V-G)/z,(M-Z)/A,(-V-G)/z,(-M-Z)/A),y||(V-=2*Math.PI),V%=2*Math.PI,z={kv:H,lv:ya,start:xa,EB:V,gy:z,hy:A});z&&(c.translate(z.kv,z.lv),c.scale(z.gy,z.hy),c.rotate(w),c.arc(0,0,1,z.start,z.start+z.EB,!y),c.rotate(-w),c.scale(1/z.gy,1/z.hy),c.translate(-z.kv,-z.lv),b=I,d=C)}break;case "Z":case "z":c.closePath();b=e;d=f;break;default:throw Error("Unknown draw command: "+
a);}switch(a){case "C":case "c":case "S":case "s":l=b;n=d;break;case "Q":case "q":case "T":case "t":h=b;k=d;break;default:h=b,k=d,l=b,n=d}})}
function Fc(c,a){function b(){if(0<=h){var a=parseFloat(c.substr(h,h+f));if(isNaN(a))throw Error("Error parsing number: "+c.substr(h,h+f)+" in "+c);e.push(a);h=-1;l=k=!1}}for(var d="",e=[],f=0,h=-1,k=!1,l=!1;f<c.length;f++){var n=c[f];if(0<h&&"-"==n&&!l||k&&"."==n)b(),h=f,"."===n&&(k=!0);else if("0"<=n&&"9">=n||"-"==n||"+"==n||0<=h&&("E"==n||"e"==n)||"."==n)if(-1==h&&(h=f),"."==n)k=!0;else{if("e"===n||"E"===n)l=!0}else"A"<=n&&"Z">=n||"a"<=n&&"z">=n?(b(),""!=d&&(a(d,e),e=[],d=""),d=n):b()}b();""!=
d&&a(d,e)}function Gc(c,a,b,d){var e=(c*b+a*d)/(gc(0,0,c,a)*gc(0,0,b,d));e=Math.acos(-1>e?-1:1<e?1:e);0>c*d-a*b&&(e=-e);return e}
(function(){function c(){this.items=[];this.qa=new L}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){a=this.qa.apply(a,b);this.items.push("M",a.x,a.y)};c.prototype.lineTo=function(a,b){a=this.qa.apply(a,b);this.items.push("L",a.x,a.y)};c.prototype.transform=function(a,b,d,e,c,h){a=new L(a,
d,b,e,c,h);this.qa=this.qa.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,h){a=this.qa.apply(a,b);d=this.qa.apply(d,e);c=this.qa.apply(c,h);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c})();
function Hc(c,a,b,d,e){for(var f=0;f<a.length;f++){var h=a[f];if(!(2>h.length)){void 0===d&&(d=!0);void 0===e&&(e=!0);var k=h[0].x===h[h.length-1].x&&h[0].y===h[h.length-1].y,l=[],n=[],r=new J(0,0),u=r,x=r,w=r,y=r,z=[],A=b/2,G;for(G=1;G<h.length;G++){x=h[G-1];y=h[G];w=hc(x.x,x.y,y.x,y.y);r=new J(w.y,-w.x);u=new J(x.x-w.x*A-r.x*A,x.y-w.y*A-r.y*A);x=new J(x.x-w.x*A+r.x*A,x.y-w.y*A+r.y*A);if(n.length){var I=n[n.length-1];var C=z[z.length-1];u=Cc(I.x,I.y,I.x+C.x,I.y+C.y,u.x,u.y,u.x+w.x,u.y+w.y)||u;I=
l[l.length-1];x=Cc(I.x,I.y,I.x+C.x,I.y+C.y,x.x,x.y,x.x+w.x,x.y+w.y)||x}n.push(u);l.push(x);z.push(w)}k?(I=n[0],C=z[0],u=Cc(I.x,I.y,I.x+C.x,I.y+C.y,u.x,u.y,u.x+w.x,u.y+w.y)||u,I=l[0],x=Cc(I.x,I.y,I.x+C.x,I.y+C.y,x.x,x.y,x.x+w.x,x.y+w.y)||x,n[0].x=u.x,n[0].y=u.y,l[0].x=x.x,l[0].y=x.y,n.push(u),l.push(x)):(n.push(new J(y.x+w.x*A-r.x*A,y.y+w.y*A-r.y*A)),l.push(new J(y.x+w.x*A+r.x*A,y.y+w.y*A+r.y*A)));if(e){c.moveTo(n[0].x,n[0].y);for(G=1;G<n.length;G++)c.lineTo(n[G].x,n[G].y);k&&(c.closePath(),c.moveTo(l[l.length-
1].x,l[l.length-1].y))}else d&&c.moveTo(l[l.length-1].x,l[l.length-1].y);if(d){for(G=l.length-1;0<=G;G--)c.lineTo(l[G].x,l[G].y);!k&&e&&c.lineTo(n[0].x,n[0].y)}}}}
(function(){function c(a){this.na=a;this.n=0;this.ac=new J(0,0)}c.prototype.next=function(a){if(0===this.na.length)return null;if(0===this.n)return this.ac=this.na[0].clone(),this.n+=1,this.ac.clone();for(;this.n<this.na.length;){var b=this.ac.ic(this.na[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.ac.x+=(this.na[this.n].x-this.ac.x)*a/b,this.ac.y+=(this.na[this.n].y-this.ac.y)*a/b,this.ac.clone()}return null};return c})();
var Ic=function(){function c(){this.path=[]}c.prototype.vh=function(a,b){0<this.path.length&&a===this.path[this.path.length-1].x&&b===this.path[this.path.length-1].y||this.path.push(new J(a,b))};c.prototype.xr=function(){return this.path};return c}();function Jc(c,a){c.length>a&&(c=c.slice(c.length-a));return c}
var Kc=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Ll=[];a.order=3;a.lt=3;a.ly=Math.pow(2,a.order);a.sampleSize=a.lt+1;return a}__extends(a,c);a.prototype.xr=function(){return this.Ll};a.prototype.vh=function(a,d){c.prototype.vh.call(this,a,d);this.path.length<this.sampleSize?this.Ll=Dc(this.path,this.order):(a=Jc(Dc(Jc(this.path,this.sampleSize),this.order),this.ly*this.lt),this.Ll=this.Ll.slice(0,this.Ll.length-this.ly*(this.lt-1)).concat(a))};return a}(Ic);
function Lc(c){var a,b,d,e,f,h,k;return __generator(this,function(l){switch(l.label){case 0:return 2>c.length?[2]:[4,{pj:c[0],length:0}];case 1:a=l.sent(),b=c[0],d=1,l.label=2;case 2:if(!(d<c.length))return[3,7];e=c[d];f=gc(b.x,b.y,e.x,e.y);if(1E-5>f)return d++,[3,2];h=(e.x-b.x)/f;k=(e.y-b.y)/f;l.label=3;case 3:if(!(f>a))return[3,5];b={x:b.x+h*a,y:b.y+k*a};f-=a;return[4,{pj:b,length:a}];case 4:return a=l.sent(),[3,3];case 5:return[4,{pj:{x:e.x,y:e.y},length:f}];case 6:return a=l.sent(),b=e,d++,[3,
2];case 7:return[2]}})}function Mc(c,a,b,d,e,f){void 0===d&&(d=1);void 0===e&&(e=0);void 0===f&&(f=0);var h=[];"number"!==typeof b&&(b=1===d&&0==(c&1)?Math.PI/c:1!==d&&0==(c&3)?Math.PI/c*2:0);for(var k=0;k<=c;k++){var l=Math.sin(b)*a,n=-Math.cos(b)*a;k&1&&(l*=d,n*=d);l=new J(l+e*n,n+f*n);h.push(l);b+=2*Math.PI/c}c=K.Ee(h).me();for(a=0;a<h.length;a++)b=h[a],b.x-=c.x,b.y-=c.y;return h}
var Nc=function(){function c(a,b){void 0===b&&(b=new L);this.uk=[];this.inverse=b.inverse();for(var d=-1,e=0;e<a.length;e++){var c=a[e];d++;if(!(1>c.length))for(var h=b.apply(c[0].x,c[0].y),k=1;k<c.length;k++){var l=b.apply(c[k].x,c[k].y);if(1<Math.abs(h.y-l.y)){var n=l.y<h.y,r=Math.min(h.y,l.y),u=Math.max(h.y,l.y),x=(l.x-h.x)/(u-r);n&&(x*=-1);this.uk.push({Ey:d,fj:n?l.x:h.x,wf:r,fx:u,Mn:x})}h=l}}this.uk.sort(function(a,b){return a.wf!=b.wf?a.wf-b.wf:a.fj-b.fj})}c.prototype.hD=function(a){var b;void 0===
b&&(b=0);if(1>this.uk.length||0>=a)return[];var d=this.uk,e=this.uk[0].wf+b;b=0;for(var c=[],h=[];;){for(var k=0;k<c.length;k++)e>c[k].mb.fx&&(c[k]=c[c.length-1],--c.length);if(0===c.length&&b===d.length)break;for(;b<d.length&&d[b].wf<=e;b++)d[b].fx>=e&&c.push({y:e,mb:d[b]});c.sort(function(a,b){var d=a.mb.fj+(e-a.mb.wf)*a.mb.Mn,c=b.mb.fj+(e-b.mb.wf)*b.mb.Mn;return 1E-5<Math.abs(d-c)?d-c:a.mb.Ey-b.mb.Ey});for(k=1;k<c.length;k+=2){var l=c[k-1].mb,n=c[k].mb;n=n.fj+(e-n.wf)*n.Mn;h.push({start:this.inverse.apply(l.fj+
(e-l.wf)*l.Mn,e),end:this.inverse.apply(n,e)})}e+=a}return h};return c}();function Oc(c,a,b){c=(a.y-c.y)*(b.x-a.x)-(a.x-c.x)*(b.y-a.y);return 0==c?0:0<c?1:2}
function Pc(c){var a=c.concat();if(3>a.length)return c;for(var b=a[0].y,d=0,e=1;e<a.length;e++){var f=a[e].y;if(f<b||b===f&&a[e].x<a[d].x)b=a[e].y,d=e}var h=a[d];a[d]=a[a.length-1];--a.length;a.sort(function(a,b){var d=Oc(h,a,b);return 0==d?gc(h.x,h.y,b.x,b.y)>=gc(h.x,h.y,a.x,a.y)?-1:1:2==d?-1:1});for(e=b=0;e<a.length;e++){for(;e<a.length-1&&0==Oc(h,a[e],a[e+1]);)e++;a[b]=a[e];b++}if(2>b)return c;c=[];c.push(h);c.push(a[0]);c.push(a[1]);for(e=2;e<b;e++){for(;1<c.length&&2!=Oc(c[c.length-2],c[c.length-
1],a[e]);)c.pop();c.push(a[e])}Qc(c);return c}function Qc(c){if(!(2>c.length)){var a=c[c.length-1],b=c[0];a.x===b.x&&a.y===b.y||c.push(b)}}
function Rc(c,a){if(!(2>a.na.length)){var b=a.YD||0,d=a.expand||0;if(a.reverse){var e=a.na[1];var f=a.na[0]}else f=a.na.length,e=a.na[f-2],f=a.na[f-1];var h=f.x-e.x;e=f.y-e.y;var k=gc(0,0,h,e);0!==k?(h/=k,e/=k):(h=1,e=0);d&&(f=new J(f.x+h*d,f.y+e*d));"ball"===a.style||"circle"===a.style?(c.moveTo(f.x+a.If,f.y),c.arc(f.x,f.y,a.If,0,2*Math.PI)):(d=-e,k=h,c.moveTo(f.x,f.y),c.lineTo(f.x-h*a.Hf+d*a.If,f.y-e*a.Hf+k*a.If),"solid"===a.style?(c.lineTo(f.x-h*(a.Hf-b),f.y-e*(a.Hf-b)),c.lineTo(f.x-h*a.Hf-d*a.If,
f.y-e*a.Hf-k*a.If),c.lineTo(f.x,f.y)):(c.moveTo(f.x,f.y),c.lineTo(f.x-h*a.Hf-d*a.If,f.y-e*a.Hf-k*a.If)))}}
var Sc=function(){function c(a,b){if(a&&a.strokeStyle&&b&&b.width&&b.height){var d=document.createElement("canvas");d.width=Math.round(b.width);d.height=Math.round(b.height);var e=d.getContext("2d");e.drawImage(b,0,0,d.width,d.height);b=document.createElement("canvas");b.width=a.canvas.width;b.height=a.canvas.height;b=b.getContext("2d");this.ef=a;this.jv=d;this.xB=e;this.tq=b}}c.prototype.ka=function(a){var b=a.qH,d=a.rH,e=a.sH,c=a.tH,h=a.FA,k=a.GA,l=a.DA;a=a.EA;var n=[Math.sqrt(Math.pow(b-e,2)+Math.pow(d-
c,2)),Math.sqrt(Math.pow(e-h,2)+Math.pow(c-k,2)),Math.sqrt(Math.pow(h-l,2)+Math.pow(k-a,2)),Math.sqrt(Math.pow(l-b,2)+Math.pow(a-d,2))],r=K.Ee([{x:b,y:d},{x:e,y:c},{x:h,y:k},{x:l,y:a}]),u=document.createElement("canvas");u.width=r.width;u.height=r.height;this.tq=u.getContext("2d");this.tq.translate(-r.x,-r.y);u=this.jv.width;for(var x=this.jv.height,w=0,y=0,z=0,A=0;4>A;A++){var G=A%2?n[A]/u:n[A]/x;G>y&&(w=A,y=G);0==n[A]&&z++}if(!(1<z)){n=this.xB;y=this.tq;y.clearRect(0,0,y.canvas.width,y.canvas.height);
if(0==w%2){w=this.fv(u,10);w.globalCompositeOperation="copy";z=w.canvas;for(var I=0;I<x;I+=2){var C=I/x;A=b+(l-b)*C;G=d+(a-d)*C;var M=e+(h-e)*C,H=c+(k-c)*C;C=Math.atan((H-G)/(M-A));M=Math.sqrt(Math.pow(M-A,2)+Math.pow(H-G,2))/u;w.setTransform(1,0,0,1,0,-I);w.drawImage(n.canvas,0,0);y.translate(A,G);y.rotate(C);y.scale(M,M);y.drawImage(z,0,0);y.setTransform(1,0,0,1,-r.x,-r.y)}}else if(1==w%2)for(w=this.fv(10,x),w.globalCompositeOperation="copy",z=w.canvas,I=0;I<u;I+=2)C=I/u,A=b+(e-b)*C,G=d+(c-d)*C,
M=l+(h-l)*C,H=a+(k-a)*C,C=Math.atan((A-M)/(H-G)),M=Math.sqrt(Math.pow(M-A,2)+Math.pow(H-G,2))/x,w.setTransform(1,0,0,1,-I,0),w.drawImage(n.canvas,0,0),y.translate(A,G),y.rotate(C),y.scale(M,M),y.drawImage(z,0,0),y.setTransform(1,0,0,1,-r.x,-r.y);this.ef.save();this.ef.beginPath();this.ef.moveTo(b,d);this.ef.lineTo(e,c);this.ef.lineTo(h,k);this.ef.lineTo(l,a);this.ef.closePath();this.ef.clip();this.ef.drawImage(y.canvas,r.x,r.y);this.ef.restore()}};c.prototype.fv=function(a,b){var d=document.createElement("canvas");
d.width=a;d.height=b;return d.getContext("2d")};return c}();
function uc(c,a,b,d,e,f,h){h&&(h=e,e=f,f=h);for(;0>e;)e+=2*Math.PI;for(;0>f;)f+=2*Math.PI;e>f&&(e-=2*Math.PI);var k=2*Math.PI;var l=e%k;var n=f%k;n===l&&(n+=2*Math.PI);f=[];e=Math.PI/2;h=l<n?1:-1;var r=l;for(k=Math.min(k,Math.abs(n-l));1E-5<k;){l=r+h*Math.min(k,e);var u=(l-r)/2,x=d*Math.cos(u),w=d*Math.sin(u),y=.5522847498*Math.tan(u);n=x+y*w;x=-w+y*x;w=-x;y=u+r;u=Math.cos(y);y=Math.sin(y);f.push({VH:d*Math.cos(r),Uc:d*Math.sin(r),WH:n*u-x*y,Vc:n*y+x*u,XH:n*u-w*y,$H:n*y+w*u,YH:d*Math.cos(l),aI:d*
Math.sin(l)});k-=Math.abs(l-r);r=l}for(d=0;d<f.length;d++)e=f[d],0===d&&c.moveTo(e.VH+a,e.Uc+b),c.bezierCurveTo(e.WH+a,e.Vc+b,e.XH+a,e.$H+b,e.YH+a,e.aI+b)};function N(c){return 0!=(c.jb&1)}function Tc(c){return 0!=(c.jb&4)}function Uc(c){return 5===(c.jb&5)&&c.ea}function Vc(c){return 0!=(c.jb&8)};var Wc=function(){function c(){this.Pb=[]}c.prototype.BF=function(a){for(var b=0;b<this.Pb.length;b++)this.Pb[b].parent===a&&(this.Pb[b]=this.Pb[this.Pb.length-1],this.Pb.length--,b--)};c.prototype.oy=function(a,b){for(var d=0;d<this.Pb.length;d++)this.Pb[d].parent===a&&(b.length?this.Pb[d].sd=b.pop():(this.Pb[d]=this.Pb[this.Pb.length-1],this.Pb.length--,d--));for(d=0;d<b.length;d++)this.Pb.push({parent:a,sd:b[d]})};c.prototype.Wq=function(a){for(var b={},d=[],e={},c=0;c<a.length;c++)b[a[c]]=1;for(a=
!0;a;){a=!1;c=0;for(var h=this.Pb;c<h.length;c++){var k=h[c];k.sd in b&&!(k.parent in e)&&(e[k.parent]=1,d.push(k.parent),a=!0)}}return d};c.prototype.sort=function(a){for(var b={},d=0,e=this.Pb;d<e.length;d++){var c=e[d];b[c.parent+":"+c.sd]=1;b[c.sd+":"+c.parent]=-1}a.sort(function(a,d){return b[a.id+"_"+d.id]||0})};return c}();var Xc=function(){function c(a,b){var d=this;this.ma=a;this.Qm=b;this.height=0;this.x=b.x||0;this.y=b.y||0;this.ZH=b.xoffset||0;this.bI=b.yoffset||0;this.width=b.width||0;this.Ma=document.createElement("img");this.Ma.src=b.image||"";this.Ma.onload=function(){d.width=d.width||d.Ma.naturalWidth;d.height=d.width/d.Ma.naturalWidth*d.Ma.naturalHeight;a.gd()};b.hoverImage?(this.On=document.createElement("img"),this.On.src=b.hoverImage):this.On=this.Ma;this.vu=this.Ma}c.prototype.Eu=function(a){return this.Qm.appliesTo?
this.Qm.appliesTo(a.id,this.ma):!0};c.prototype.hw=function(a){var b=a.xa;a=a.Pa().ub(!1);return new K(b.x+this.x*b.width+(this.ZH-this.width/2)/a.x,b.y+this.y*b.height+(this.bI-this.height/2)/a.y,this.width/a.x,this.height/a.y)};c.prototype.Db=function(a,b,d,e){var c=this.hw(a);a=a.Pa().inverse().apply(b,d);return c.Xc(a.x,a.y,e)};c.prototype.ka=function(a,b,d){this.vu.complete&&(a.save(),b.Pa().rc(a),b=this.hw(b),this.On.complete&&d?a.drawImage(this.On,b.x,b.y,b.width,b.height):a.drawImage(this.vu,
b.x,b.y,b.width,b.height),a.restore())};c.prototype.click=function(a,b){if(this.Qm.onclick)try{this.Qm.onclick(a.id,this.ma,b)}catch(d){console.log("Error in decoration onclick handler: ",d)}};return c}();var Yc=v.create("MISC");function Zc(c){var a=document.createElement("canvas");c&&c.appendChild(a);a.style.background="transparent";return a}function $c(){return 0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")}function ad(c,a){c=q.Wf(c);c.values[3]=a;return c.toString()}function bd(c,a){a=a?B(a).wb():B.Fn();var b=B(c).wb();b.left=Math.min(b.left,a.left+a.width-c.offsetWidth);b.top=Math.min(b.top,a.top+a.height-c.offsetHeight);B(c).Aj(b)}
function cd(c,a){"erase"===a?(a=c.$t)?(c.save(),c.strokeStyle=q.Oa,c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.lineWidth+=2,a(!1),c.restore()):(c.strokeStyle=q.Oa,c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())}
function dd(){for(var c=0;c<arguments.length;c++);c=arguments[0];for(var a=1;a<arguments.length;a++){var b=arguments[a],d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}return c}function ed(c,a){if("string"===typeof a)switch(typeof c){case "number":a=parseFloat(a);break;case "boolean":a=a&&"0"!==a&&"false"!==a}return a}function fd(c){return/^data:image\/svg|\.svg(\?.*)?$/i.test(c)}
function gd(c,a,b){if("image/bmp"===a){a:if(a=c.getContext("2d"),null===a)b="error";else{var d=a.getImageData(0,0,c.width,c.height);c=d.width;var e=d.height;a=c*e*3;var f=a+54,h=[66,77,f&255,f>>8&255,f>>16&255,f>>24&255,0,0,0,0,54,0,0,0],k=[40,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,e&255,e>>8&255,e>>16&255,e>>24&255,1,0,24,0,0,0,0,0,a&255,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];a=(4-3*c%4)%4;d=d.data;f=c<<2;for(var l=Hb.qh("Base64Encoder"),n=0;n<h.length;n++)l.Sb(h[n]);for(n=
0;n<k.length;n++)l.Sb(k[n]);do{h=f*(e-1);for(k=0;k<c;k++)n=k<<2,l.Sb(d[h+n+2]),l.Sb(d[h+n+1]),l.Sb(d[h+n]);for(h=0;h<a;h++)l.Sb(0)}while(--e);l.flush();switch(b){case "data-uri":b="data:image/bmp;base64,"+l.Jh().toString();break a;case "blob":b=l.Jh().toBlob("image/bmp");break a;default:throw Error(b+" encoding not supported with image/bmp");}}return b}c=c.toDataURL(a);switch(b){case "blob":b=c.substring(c.indexOf(":")+1,c.indexOf(";"));c=c.substr(c.indexOf(",")+1);a="";e=0;l={A:0,B:1,C:2,D:3,E:4,
F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(c=c.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");e<c.length;)h=l[c.charAt(e++)],k=l[c.charAt(e++)],d=l[c.charAt(e++)],f=l[c.charAt(e++)],h=h<<2|k>>4,k=(k&15)<<4|d>>2,n=(d&3)<<6|f,a+=String.fromCharCode(h),
64!==d&&(a+=String.fromCharCode(k)),64!==f&&(a+=String.fromCharCode(n));c=a;a=new Uint8Array(c.length);for(d=0;d<c.length;d++)a[d]=c.charCodeAt(d);return new Blob([a],{type:b});case "data-uri":return c;default:throw Error(b+" encoding not supported for "+a);}};var hd=v.create("BaseNode"),jd=function(){function c(a,b){this.id=a;this.aa=b;this.jb=0;this.parent=null;this.ba={};this.children=[];this.scope=null}c.prototype.type=function(){return"BaseNode"};c.prototype.Jo=function(){return this.type()};c.prototype.toString=function(){return this.type()+":"+this.id};c.prototype.TE=function(a,b){this.ia(a)!==b&&this.aa.ce([this.id],a,b)};c.prototype.Wi=function(a){this.scope||(this.scope=id(a,this));return this.scope};c.Pd=function(a,b){c.types[a]=b};c.create=
function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.Sa=function(){};c.prototype.Gh=function(a,b){b=ed(this.ba[a],b);b instanceof Array&&(b=b.slice(0));return b};c.prototype.hb=function(){var a={},b;for(b in this.ba)this.ba.hasOwnProperty(b)&&(a[b]=this.ia(b));return a};c.prototype.Qb=function(a){for(var b in a)this.setProperty(b,a[b])};c.prototype.Qh=function(a){return a in this.ba};c.prototype.tc=function(a){return this.Qh(a)||"$"===a[0]||"_"===a[0]};c.prototype.setProperty=
function(a,b){b=this.Gh(a,b);this.tc(a)?(hd("%s:%s set %s=%s",this.id,this.type(),a,"string"===typeof b?b.substr(0,100):b),void 0!==b?this.ba[a]=b:delete this.ba[a]):hd("Property '%s' not valid for %s",a,this.type());return b};c.prototype.ia=function(a){a=this.ba[a];a instanceof Array&&(a=a.slice(0));return a};c.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);return b};c.prototype.Lr=function(a,b){this.children.splice(b,0,a)};c.prototype.tb=function(a){return this.children[a]};
c.prototype.te=function(a){for(var b=0;b<this.children.length;b++)if(a===this.tb(b))return b;return-1};c.types={};return c}();var kd=v.create("WrappedNode");function ld(c,a){var b=0;return function(){return{next:function(){return b>=c.children.length?{done:!0}:{value:c.tb(b++).Wi(a)}}}}}
function id(c,a){var b={};b.ctx=c.ctx;b.id=a.id;b.type=a.Jo();"undefined"!==typeof Proxy?(b.children=new Proxy({},{get:function(b,e){ca();ha();if(e===Symbol.iterator)return ld(a,c);if("length"===e)return a.children.length;b=a.tb(e);return b instanceof jd?b.Wi(c):b}}),b.props=md(a.ba,"",function(b,e){a.TE(b,e);return!1})):(Object.defineProperty(b,"children",{get:function(){throw Error("Not supported in this browser");}}),Object.defineProperty(b,"props",{get:function(){throw Error("Not supported in this browser");
}}));Object.defineProperty(b,"parent",{configurable:!0,get:function(){return a.parent?a.parent.Wi(c):null},set:function(b){kd("Warning; replacing parent property");a.parent=b}});Tc(a)&&Object.defineProperty(b,"element",{configurable:!0,get:function(){return a.ea}});return b}
function md(c,a,b){function d(d){if("string"===typeof d)for(var e in c)if(e.startsWith(""+a+d+"."))return md(c,""+a+d+".",b);return null}void 0===a&&(a="");return new Proxy(c,{get:function(b,f){return"hasOwnProperty"===f?function(b){return a+b in c}:"string"===typeof f?(b=d(f))?b:c[a+f]:c[f]},has:function(b,f){return"string"===typeof f?(b=d(f))?b:a+f in c:b.hasOwnProperty(f)},set:function(d,f,h){"string"===typeof f?b(a+f,h)&&(c[a+f]=h):c[f]=h;return!0}})};var nd=function(){function c(a){this.Gb=a;this.Gm=[];this.xl=!0;this.log=v.create("cloudAddon");this.pg=a.ia("cloudRadius")}c.prototype.format=function(){var a=this.Gb.xe.fe()[0];this.log("Format cloud; %s points",a.length);this.Gm=this.XA(a,this.pg)};c.prototype.XA=function(a,b){var d=[],e=5/6*b*2,c,h=a[a.length-1];for(c=0;c<a.length;c++){var k=a[c];var l=k.x-h.x,n=k.y-h.y,r=Math.sqrt(l*l+n*n);l/=r;n/=r;var u=r/e+.5|0;1>u&&(u=1);u=r/u;for(var x=0;x+.1*u<r;x+=u)d.push({x:h.x+x*l,y:h.y+x*n,lb:0,end:0});
h=k}e=d[d.length-1];for(c=0;c<d.length;c++)a=d[c],h=a.x-e.x,l=a.y-e.y,k=.5*Math.sqrt(h*h+l*l)/b,-1>k&&(k=-1),1<k&&(k=1),h=Math.atan2(l,h),k=Math.acos(k),k=[h-k,Math.PI+h+k],e.end=k[0],a.lb=k[1],e=a;return d};c.prototype.ka=function(a){this.log("Drawing cloud with %s circles",this.Gm.length);var b=15*Math.PI/180,d=this.pg;a.beginPath();for(var e=0;e<this.Gm.length;e++){var c=this.Gm[e];a.arc(c.x,c.y,d,c.lb,c.end+b)}a.stroke()};return c}();var pd=function(c){function a(a,d){a=c.call(this,a,d)||this;a.rect=new K(0,0,1,1);a.jm=!1;a.xa=new K(0,0,1,1);a.hd=0;a.log=v.create("GraphicsNode");a.offsetX=0;a.offsetY=0;a.jb|=17;a.ba.matrix=new L;a.ba.layer="default";return a}__extends(a,c);a.prototype.Fu=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.ba[b]=a[b])};a.prototype.clip=function(){};a.prototype.Sa=function(){};a.prototype.Zf=function(){return!1!==this.ia("lockEditMode")};a.prototype.Fr=function(){return!1};a.prototype.bg=function(){return null};
a.prototype.sk=function(){};a.prototype.Fw=function(){return!1};a.prototype.bt=function(){return!1};a.prototype.Rg=function(){return"text"in this.ba};a.prototype.Gc=function(){var a=this.ia("layer");return a?""+a:"default"};a.prototype.Un=function(){return null!==this.parent&&null!==this.parent.parent&&"GroupNode"===this.parent.type()};a.prototype.type=function(){return"BaseNode"};a.prototype.Ge=function(a){return{matrix:a.multiply(this.Pa())}};a.prototype.Pa=function(){return this.ia("matrix")};
a.prototype.lc=function(){return this.Pa().inverse()};a.prototype.xG=function(a){this.setProperty("matrix",a)};a.prototype.Gh=function(a,d){if("shadow"===a&&("string"===typeof d||"boolean"===typeof d))return d;d=c.prototype.Gh.call(this,a,d);"matrix"===a&&"string"===typeof d?d=new L(d):"opacity"===a&&(d=parseFloat(d));return d};a.prototype.tc=function(a){switch(a){case "customData":case "tag":case "locked":case "lockSize":case "lockRotation":case "lockPosition":case "lockEditMode":case "lockText":case "rotationHandles":case "lockAspectRatio":case "zIndex":case "snap":case "opacity":case "shadow":case "type":return!0}return c.prototype.tc.call(this,
a)};a.prototype.Mk=function(){var a=this.xa.clone(),d=this.Pa(),e=d.Ar();d=d.multiply(new kc(e,a.x+a.width/2,a.y+a.height/2));a.transform(d);return a};a.prototype.jw=function(){return this.rect.clone()};a.prototype.jn=function(){var a=new zc(this.xa);a.transform(this.Pa());return a};a.prototype.ue=function(){return this.ia("zIndex")||0};a.prototype.transform=function(a){this.xG(a.multiply(this.Pa()))};a.prototype.format=function(){};a.prototype.Db=function(a,d,e){a=this.lc().apply(a,d);d=this.lc().ub(!1);
d=.5*(d.x+d.y);return this.hidden()||this.ia("locked")||!this.xa.Xc(a.x,a.y,e*d)?null:this};a.prototype.gh=function(a){this.jm=a};a.prototype.hidden=function(){return this.jm};a.prototype.Bj=function(){};a.prototype.qo=function(){};a.prototype.vo=function(){};a.prototype.ul=function(a){if(a.ul){var b={"zwibbler:id":""+this.id};if("tag"in this.ba){var e=this.ba.tag;"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:tag"]=e}for(var c in this.ba){e=this.ba[c];if("_"===c.substr(0,1))c=c.substr(1);
else if("tag"!==c)continue;"string"!==typeof e&&(e=JSON.stringify(e));b["zwibbler:"+c]=e}a.ul(b)}};a.prototype.tl=function(a){a.tl&&a.tl()};a.prototype.ka=function(a){a.save();this.ul(a);a.translate(this.offsetX,this.offsetY);var b=this.Pa();a.transform(b.m11,b.m21,b.m12,b.m22,b.Ha,b.Ia);"erase"===this.ba.strokeStyle?a.Zt?a.strokeStyle=a.Zt:(a.strokeStyle=q.Oa,a.globalCompositeOperation="destination-out"):a.strokeStyle=this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;
this.ba.shadow&&od(this.ba.shadow,a);"opacity"in this.ba&&(a.globalAlpha=this.ba.opacity);this.zg(a);this.tl(a);a.restore()};a.prototype.zv=function(a,d){var b=d?function(b){a.fillStyle=b;a.fill()}:function(b){a.strokeStyle=b;a.stroke()};var c=a.$t;c?(a.save(),a.globalCompositeOperation="destination-out",--a.lineWidth,b(q.Oa),a.globalCompositeOperation="source-over",a.lineWidth+=2,c(d),a.restore()):(a.globalCompositeOperation="destination-out",b(q.Oa),a.globalCompositeOperation="source-over")};a.prototype.zg=
function(){};a.prototype.resolve=function(){return!1};a.prototype.Lv=function(a,d,e,c){this.xk||(this.xk={});var b=this.xk[a];if(!b||b.cz!==c){b&&c===b.cz||(b={cz:c,value:c},this.xk[a]=b);a=/url\(([^\)]+)\)/.exec(c);var f;a&&(f=a[1]);var l=this;f&&(b.value="rgba(0, 0, 0, 0.2)",e.eg(this.id,f,function(a){l.log("Got image response.");b.value=d.createPattern(a,"repeat")||"magenta";e.Bf(l.id)}))}};a.prototype.hr=function(a){return this.xk&&(a=this.xk[a])?a.value:"magenta"};a.prototype.xf=function(){return{}};
a.prototype.pn=function(){return null};a.prototype.qn=function(){return null};a.prototype.$v=function(){return null};a.prototype.Bw=function(){return{}};a.prototype.Po=function(){};a.prototype.Br=function(){return[]};a.prototype.So=function(a,d){this.offsetX=a;this.offsetY=d};a.prototype.Ej=function(){};return a}(jd),qd=/ *(\d+)(px)? +(\d+)(px)? +(\d+)(px)? +(.+)/i;
function od(c,a){void 0===a&&(a={});a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0;a.shadowColor=q.he;if("string"===typeof c){if(c=qd.exec(c))a.shadowOffsetX=parseFloat(c[1]),a.shadowOffsetY=parseFloat(c[3]),a.shadowBlur=parseFloat(c[5]),a.shadowColor=c[7]}else c&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)")};var rd={textIndent:"0",fontStyle:null,fontWeight:"normal",fontSize:12,fontFamily:"Times New Roman",colour:"black",align:"left",background:"none",lineHeight:1,outlineColour:"oc",strikethrough:!1,underline:!1,verticalAlign:"top"},sd={align:"ta",background:"fb",colour:"fc",fontFamily:"ff",fontSize:"fh",fontStyle:"fs",fontWeight:"fw",lineHeight:"lh",outlineColour:"oc",strikethrough:"st",textIndent:"ti",underline:"fu",verticalAlign:"va"},td=function(){function c(a){this.sa=a;this.options={}}c.prototype.xH=
function(){var a=new c(this.sa),b;for(b in rd)rd.hasOwnProperty(b)&&(a.options[b]=this.get(b));return a};c.prototype.mH=function(){var a={},b;for(b in this.options)this.options.hasOwnProperty(b)&&(a[b]=this.options[b]);return a};c.prototype.apply=function(a){a.fillStyle=this.get("colour");a.font=this.br()};c.prototype.empty=function(){var a=0,b;for(b in this.options)this.options.hasOwnProperty(b)&&(a+=1);return 0===a};c.prototype.hn=function(a,b){a=c.hn(a,b);return a.empty()?this:a};c.prototype.Ff=
function(a){c.Ff(this.options,a)};c.prototype.set=function(a,b){this.options[a]=b};c.prototype.get=function(a){return a in this.options?this.options[a]:this.sa[a]};c.prototype.has=function(a){return a in this.options};c.prototype.Uh=function(a){for(var b in a.options){var d=this.get(b),e=a.get(b);d!==e&&this.set(b,e)}};c.prototype.clone=function(){var a=new c(this.sa);a.Uh(this);return a};c.prototype.br=function(){var a=this.get("fontStyle"),b=this.get("fontWeight"),d=this.get("fontSize"),e=this.get("fontFamily"),
c=[];a&&c.push(a);b&&c.push(b);c.push(d+"px");c.push(e);return c.join(" ")};c.prototype.xd=function(a){if(this===a)return!0;for(var b in this.options)if(!(b in a.options)||a.options[b]!==this.options[b])return!1;for(b in a.options)if(!(b in this.options))return!1;return!0};c.prototype.nk=function(a){var b=new c(this.sa),d;for(d in rd)rd.hasOwnProperty(d)&&a.get(d)!==this.get(d)&&(b.options[d]=this.get(d));return b};c.prototype.toString=function(){var a=[],b;for(b in this.options)a.push(b+"="+this.options[b]);
return a.join(",")};return c}();
(function(c){c.hn=function(a,b){void 0===b&&(b="");var d=new c(rd);switch(b){case "B":d.set("fontWeight","bold");break;case "I":d.set("fontStyle","italic");break;case "U":d.set("underline",!0)}for(var e in a)if(b=a[e],"textDecoration"===e)d.set("underline",0<=b.indexOf("underline"));else if(""!==b)switch(e){case "fontStyle":case "fontFamily":case "fontWeight":case "background":d.set(e,b);break;case "fontSize":d.set(e,parseFloat(b)||2);break;case "textAlign":d.set("align",b);break;case "color":d.set("colour",
b)}return d};c.Ff=function(a,b){for(var d in a){var e=a[d];switch(d){case "fontStyle":case "fontFamily":case "fontWeight":case "background":b[d]=e;break;case "fontSize":b[d]=e+"px";break;case "align":b.textAlign=e;break;case "colour":b.color=e;break;case "underline":b.textDecoration=e?"underline":""}}return b}})(td||(td={}));var ud=td;var vd=function(){function c(){this.vs=null;this.zo=[]}c.prototype.it=function(){};c.prototype.Kq=function(){this.zo.push("\n")};c.prototype.hz=function(a){this.vs=a=this.vs?a.nk(this.vs):a.xH();a=a.mH();for(var b in a)a.hasOwnProperty(b)&&this.zo.push("/"+sd[b]+a[b]+";")};c.prototype.iz=function(a){a=a.replace(/\//g,"//");this.zo.push(a)};c.prototype.toString=function(){return this.zo.join("")};return c}();
function wd(c,a){for(var b=0,d="",e="",f="",h=0;h<c.length;h++){var k=c.charAt(h);switch(b){case 0:"/"===k?b=1:d+=k;break;case 1:"/"===k?(d+=k,b=0):(--h,d.length&&(a("text",d.replace(/\/\//g,"/")),d=""),e="",b=2);break;case 2:e+=k;2===e.length&&(b=3,f="");break;case 3:";"===k?(a(e,f),b=0):f+=k}}d.length&&a("text",d.replace(/\/\//g,"/"))};var xd=v.create("InlineItem"),yd=function(){function c(a){this.style=a;this.index=0}c.prototype.count=function(){return 1};c.prototype.Va=function(a){xd("Asked to set %s",a);this.style=this.style.clone();this.style.Uh(a);xd("After merge: %s",this.style)};c.prototype.Pn=function(){};c.prototype.split=function(){return null};c.prototype.Bk=function(){return{width:0,height:0,Vk:0,HA:!0,io:!1}};c.prototype.zd=function(){return""};return c}();var zd=function(c){function a(a,d){a=c.call(this,a)||this;a.text=d;return a}__extends(a,c);a.prototype.count=function(){return this.text.length};a.prototype.split=function(b){if(0<b&&b<this.text.length){var d=this.text.substr(b);this.text=this.text.substr(0,b);return new a(this.style.clone(),d)}return null};a.prototype.Bk=function(a,d){d=this.text.charAt(d);return{width:a?a.measureText(d).width:0,height:this.style.get("fontSize"),Vk:0,HA:" "===d||"-"===d,io:"\n"===d}};a.prototype.zd=function(a,d){return this.text.substr(a,
d)};return a}(yd);function Ad(c,a){for(var b=-1,d,e;1<c-b;){d=c+b>>1;e=a(d);if(0==e)return d;0<e?b=d:c=d}return c};var Cd=function(){function c(){}c.wz=function(a){for(var b=0,d=0;d<a.length;){var e=c.up(a,d);b++;d+=e}return b};c.up=function(a,b){for(var d=0,e=!0,c=0;b<a.length;b++){var h=a.charCodeAt(b);if(0<d){h=(d<<10)+h+-56613888;d=0;var k=2}else if(55296>h||56319<h)k=1;else{d=h;continue}if(e)e=!1;else if(!(Bd(h)&2))break;c+=k}return c};c.eI=function(a){return 55296<=a&&56319>=a?1:56320<=a&&57343>=a?2:0};return c}(),Dd=[{start:9,end:13,type:1},{start:32,end:32,type:1},{start:48,end:57,type:32},{start:133,
end:133,type:1},{start:160,end:160,type:1},{start:5760,end:5760,type:1},{start:8192,end:8202,type:1},{start:8232,end:8233,type:1},{start:8239,end:8239,type:1},{start:8287,end:8287,type:1},{start:12288,end:12288,type:1},{start:12352,end:12447,type:8},{start:19968,end:40959,type:4},{start:4352,end:4447,type:64},{start:9001,end:9002,type:64},{start:11904,end:12350,type:64},{start:12352,end:42191,type:64},{start:44032,end:55203,type:64},{start:63744,end:64255,type:64},{start:65040,end:65049,type:64},
{start:65072,end:65135,type:64},{start:65280,end:65376,type:64},{start:65504,end:65510,type:64},{start:131072,end:196605,type:64},{start:196608,end:262141,type:64},{start:12288,end:12351,type:16},{start:65280,end:65519,type:16},{start:65072,end:65103,type:16},{start:688,end:767,type:130},{start:7424,end:7551,type:130},{start:7552,end:7615,type:130},{start:7616,end:7679,type:130},{start:8400,end:8447,type:130},{start:65056,end:65071,type:130},{start:127995,end:127999,type:2}];
Dd.sort(function(c,a){return c.start-a.start});for(var Ed=new Map,Fd=0;24>Fd;Fd++){var Gd=".\u3001\u3002:;,!?)]\uff5d\u3015\u3009\u300b\u300d\u300f\u3011\u3019\u3017\u301f'\"\uff60\u00bb".codePointAt(Fd);Ed.set(Gd,Ed.get(Gd)|128)}for(Fd=0;22>Fd;Fd++)Gd=' || "([\uff5b\u3014\u3008\u300a\u300c\u300e\u3010\u3018\u3016\u301d\'"\uff5f\u00ab"'.codePointAt(Fd),Ed.set(Gd,Ed.get(Gd)|256);
for(Fd=0;51>Fd;Fd++)Gd="\u30fd\u30fe\u30fc\u30a1\u30a3\u30a5\u30a7\u30a9\u30c3\u30e3\u30e5\u30e7\u30ee\u30f5\u30f6\u3041\u3043\u3045\u3047\u3049\u3063\u3083\u3085\u3087\u308e\u3095\u3096\u31f0\u31f1\u31f2\u31f3\u31f4\u31f5\u31f6\u31f7\u31f8\u31f9\u31fa\u31fb\u31fc\u31fd\u31fe\u31ff\u3005\u303b\u2010\u30a0\u2013\u301c\u00a0\u292f".codePointAt(Fd),Ed.set(Gd,Ed.get(Gd)|384);function Bd(c){for(var a=Ed.get(c)||0,b=0;b<Dd.length;b++){var d=Dd[b];c>=d.start&&c<=d.end&&(a|=d.type)}return a}
var Hd={12289:65041,12290:65042},Id=[0,166,168,168,170,173,175,176,178,187,191,214,216,246,248,745,748,2143,2208,4351,4608,5120,5760,6319,6400,7311,7360,8213,8215,8223,8226,8239,8242,8250,8253,8257,8259,8262,8266,8272,8274,8292,8294,8412,8417,8417,8421,8447,8450,8450,8458,8462,8464,8466,8469,8469,8472,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8500,8512,8516,8523,8523,8526,8526,8586,8587,8592,8733,8735,8755,8758,8959,8968,8971,8992,8995,9001,9002,9004,9084,9115,9149,9166,9166,9168,9168,9180,
9185,9251,9251,9472,9631,9754,9759,10088,10101,10132,11025,11056,11087,11098,11191,11244,11247,11264,11903,12296,12305,12308,12319,12336,12336,12448,12448,12540,12540,42192,43359,43392,44031,55296,57343,64256,65039,65056,65071,65097,65103,65112,65118,65123,65126,65136,65280,65288,65289,65293,65293,65306,65310,65339,65339,65341,65341,65343,65343,65371,65503,65507,65507,65512,65519,65529,65531,65534,66047,66176,66527,66560,66927,67072,67455,67584,67759,67808,67903,68E3,68255,68288,68527,68608,68687,
68736,68863,69216,69247,69632,70223,70272,70527,70656,70879,71168,71375,71424,71487,71840,71935,72384,72447,72704,72895,73728,75087,92160,92783,92880,93071,93952,94111,113664,113839,119296,119375,119808,120831,122880,122927,124928,125151,125184,125279,126464,126719,129024,129279,917504,917631,917760,917999];function Jd(c){var a=0;c in Hd?c=Hd[c]:Ad(Id.length/2,function(b){var d=Id[2*b+1];return c>=Id[2*b]&&c<=d?(a=Math.PI/2,0):c>d?1:-1});return{lB:c,rotate:a}};var Kd=v.create("TEXTSEQ"),Ld=function(){function c(a){this.style=a;this.children=[];this.length=this.Ai=0;this.og=null}c.yi=function(a){var b=new ud(rd),d=new c(b),e={},f;for(f in sd)sd.hasOwnProperty(f)&&(e[sd[f]]=f);wd(a,function(a,c){a in e?("fh"===a&&(c=parseFloat(c)),"null"===c&&(c=null),b.set(e[a],c)):"text"===a?d.append([new zd(b.clone(),c)]):Kd("Bad key: %s",a)});return d};c.vz=function(a,b){var d=new c(b);d.append([new zd(b.clone(),a)]);return d};c.prototype.save=function(a,b,d){var e=!1;
this.Ow(a,b,function(a,b,c){d.hz(a.style);a=a.zd(b,c);b=0;for(c=a.split("\n");b<c.length;b++){var f=c[b];if(""===f){if(e||d.it(),d.Kq(),e=!1,"\n"===a)break}else e||(d.it(),e=!0),d.iz(f)}});e&&d.Kq();return d};c.prototype.append=function(a){this.Pn(this.Ai,a)};c.prototype.Pn=function(a,b){for(var d=0;d<b.length;d++)for(var e=b[d],c=e.zd(0,e.count()),h=!0,k=0;k<c.length;k++){var l=0!==(Bd(c.charCodeAt(k))&64);if(0===k)h=l;else if(l!==h){(e=e.split(k))&&b.splice(d+1,0,e);break}}Kd("Insert %s item at index %s",
b.length,a);for(c=h=0;c<this.children.length;c++){e=this.children[c];d=e.count();if(h===a){Kd("Found proper position");break}else if(h+d>a){Kd("Splitting item from %s..(%s)..%s",e.index,a,e.index+d);this.pm(c,a-h);h=a;c+=1;break}h+=d}for(this.children.splice.apply(this.children,[c,0].concat(b));c<this.children.length;c++)e=this.children[c],d=e.count(),Kd("Bump item %s index %s->%s length=%s",c,e.index,h,d),e.index=h,h+=d,Kd("   item %s: %s/%s",c,e.index,e.count());this.Ai=h;this.length=this.children.length;
this.og=null};c.prototype.remove=function(a,b){var d=[];if(0===this.children.length)return d;this.pu(a);this.pu(a+b);for(var e=this.Si(a),c,h=e.item.index,k=e.index;k<this.children.length;k++){var l=this.children[k];c=l.count();h+c<=a+b?d.push(l):l.index=h-b;h+=c}this.children.splice(e.index,d.length);this.length-=d.length;this.Ai-=b;this.og=null;return d};c.prototype.count=function(){return this.Ai};c.prototype.Si=function(a){for(var b=0,d=0;d<this.children.length;d++)if(b+=this.children[d].count(),
b>a)return{index:d,item:this.children[d]};if(this.children.length)return{index:this.children.length-1,item:this.children[this.children.length-1]};throw Error("getItemAt() on empty sequence.");};c.prototype.pm=function(a,b){var d=this.children[a];if(b=d.split(b))b.index=d.index+d.count(),this.children.splice(a+1,0,b),this.length+=1,Kd("Split %s..%s..%s",d.index,b.index,b.index+b.count());return b};c.prototype.pu=function(a){var b=this.Si(a);b&&b.item.index<a&&this.pm(b.index,a-b.item.index)};c.prototype.Yi=
function(a){return 0===this.length?this.style:this.Si(a).item.style};c.prototype.ew=function(a,b){var d=[],e=0,c=0,h=null,k=0;if(0===b)return d.push({start:a,length:0,style:this.Yi(a)}),d;for(var l=0;l<this.children.length;l++){var n=this.children[l];var r=n.count();k+=r;if(k>a){null===h&&(h=n.style,e=n.index);var u=n.style.xd(h);u&&(c+=r);if(!u||k>=b)d.push({start:e,length:c,style:h}),e=n.index,c=0;if(k>=a+b)break}}return d};c.prototype.HG=function(a){for(var b=0;b<a.length;b++){var d=a[b];this.Va(d.style,
d.start,d.length)}};c.prototype.Va=function(a,b,d){var e=0,c=b+d;Kd("setStyle: %s:%s %s",b,d,a);for(d=0;d<this.children.length;d++){var h=this.children[d],k=h.count();e<b&&b<e+k?this.pm(d,b-e)?k=b-e:(h.Va(a),Kd("Case 1")):b<=e&&c<e+k&&c>e?(this.pm(d,c-e),k=c-e,h.Va(a),Kd("Case 2")):b<=e&&e+k<=c&&(h.Va(a),Kd("Case 3: fromChar=%s..%s count=%s..%s",b,c,e,e+k));e+=k}};c.prototype.TF=function(a,b,d){for(var e=b;;){b=this.Bk(null,a);if(d(b)){a+=1;break}else if(0===a)break;--a}for(;;){b=this.Bk(null,e);
if(d(b))break;else if(e>=this.Ai-1)break;e+=1}return{start:a,length:e-a}};c.prototype.CD=function(a,b){return this.TF(a,b,function(a){return a.io})};c.prototype.Bk=function(a,b){if(0===this.length)throw Error("error: expected to have child items");if(null===this.og||b<this.og.index||b>=this.og.index+this.og.count())this.og=this.Si(b).item;return this.og.Bk(a,b-this.og.index)};c.prototype.zd=function(a,b){var d="";this.Ow(a,b,function(a,b,c){d+=a.zd(b,c)});return d};c.prototype.Ow=function(a,b,d){var e=
a+b;if(0!==b){var c=this.Si(a);if(c)for(b=c.item,c=c.index;a<e;){var h=Math.min(b.count(),e-a);d(b,a-b.index,h);a+=h;c+=1;if(c===this.children.length)break;b=this.children[c]}}};return c}();var Md=v.create("TextFrame"),Nd=function(){function c(a,b,d,e,c){this.bc=b;this.gc=d;this.$a=e;this.Lb=c}c.prototype.toString=function(){return"Stripe("+this.$a+"x"+this.Lb+")"};return c}();function Od(c){for(var a=null,b=0;b<c.length;b++){var d=c[b];if(null===a||d.$a>a.$a)a=d}return a}
var Pd=function(){function c(a,b,d){this.width=a;this.re=d;this.az=0;this.Je=1===this.re.direction?a:b;this.bo=1===this.re.direction?b:a}c.prototype.Cn=function(a,b,d){return a+b>this.Je||d>this.bo?[]:[new Nd(0,0,a,this.bo,a+b)]};c.prototype.Nk=function(a,b){if(1===this.re.direction){var d=a;a=b}else d=b;1===this.re.direction&&(a=(this.az||this.width)-a);return new J(a,d)};c.prototype.Jw=function(){return!0};c.prototype.Cy=function(a){this.az=a};return c}(),Qd=function(){function c(a,b){this.fb=new zc(a);
this.fb.zF();switch(b.direction){case 0:this.inverse=new L;a=this.fb.Cm();this.cn=1;break;case 1:b=new kc(Math.PI/2,0,0);this.fb=this.fb.clone();this.fb.transform(b);a=this.fb.Cm();this.inverse=b.inverse();this.Yo=a.y;this.cn=1;this.Je=a.height;Md("    Bounds: %s",a);break;default:throw Error("Unknown direction");}this.Yo=a.y;this.Je=a.height;this.bo=a.width}c.prototype.Cn=function(a,b,d){if(a+b>this.Je)return[];for(;a<this.Je-b;a++){var e=this.Vz(a,a+b,d);if(0<e.length)return e}return[]};c.prototype.Vz=
function(a,b,d){var e=this.fb.kw(this.cn*a+this.Yo),c=this.fb.kw(this.cn*b+this.Yo);e=zc.oz([e,c]);c=[];for(var h=0;h+1<e.length;h+=2)e[h+1]-e[h]>=d&&c.push(new Nd(0,e[h],a,e[h+1]-e[h],b-a));return c};c.prototype.Nk=function(a,b){return this.inverse.apply(a,this.cn*b+this.Yo)};c.prototype.Jw=function(){if(4!==this.fb.na.length)return!1;var a=this.fb.na[0],b=this.fb.na[1],d=this.fb.na[2],e=this.fb.na[3];return a.y==b.y&&d.y===e.y&&a.x===e.x&&b.x===d.x};c.prototype.Cy=function(){};return c}();var Rd=v.create("LineBreak");function Sd(c,a,b,d){c.translate(a,b);c.rotate(d);c.translate(-a,-b)}function Td(c,a,b,d,e,f){c.font=e.attributes.br();f&2&&(c.strokeStyle=e.attributes.get("outlineColour"),c.strokeText(d,a,b));f&1&&(c.fillStyle=e.attributes.get("colour"),c.fillText(d,a,b))}function Ud(c,a,b,d,e,f){e.attributes.get("underline")&&f&1&&(c.strokeStyle=e.attributes.get("colour"),e.attributes.get("bold")?c.lineWidth=2:c.lineWidth=1,c.beginPath(),c.moveTo(a,b),c.lineTo(a+d,b),c.stroke())}
var Vd=function(){function c(a,b){this.ma=a;this.Oi=b}c.prototype.WB=function(a,b,d,e){var c=this.ma;c.textBaseline="alphabetic";c.save();if(!a.vertical&&a.oh)Td(c,b,d,e,a,this.Oi),Ud(c,b,d,a.length,a,this.Oi);else if(a.vertical&&!a.oh)Sd(c,b,d,Math.PI/2),Td(c,b,d,e,a,this.Oi),Ud(c,b,d,a.length,a,this.Oi);else if(!a.vertical&&!a.oh)Rd("Horizontal sideways text is not rendered");else if(a.vertical&&a.oh){var h=d;if(a.Gn&&a.Zi){h+=a.Zi;for(var k=0,l=0;l<e.length;l++){k++;var n=Jd(e.codePointAt(l));
n.rotate&&(c.save(),Sd(c,b+a.Gn[l]/2,h-a.Zi/2,n.rotate));Td(c,b,h,String.fromCodePoint(n.lB),a,this.Oi);h+=a.Zi;n.rotate&&c.restore()}Sd(c,b,d,Math.PI/2);Ud(c,b,d,a.Zi*k,a,this.Oi)}}c.restore()};c.prototype.NB=function(a,b,d,e,c){this.ma.save();e&&!c&&Sd(this.ma,a,b,Math.PI/2);d.ka(this.ma,a,b);this.ma.restore()};return c}();var Wd=function(c){function a(a,d,e){a=c.call(this,a)||this;a.sw=d;a.ez=e;return a}__extends(a,c);a.prototype.ka=function(a,d,e){a.fillStyle=this.style.get("colour");var b=this.style.get("fontSize")*this.sw;a.fillRect(d,e-b,this.ez*b-2,b)};a.prototype.Pc=function(){var a=this.style.get("fontSize")*this.sw;return{$a:this.ez*a,Lb:a}};return a}(yd);function Xd(c,a,b){if(0===c.length)return{ev:0,length:0};for(var d=0,e=2,f=0,h=0,k,l=c.codePointAt(0),n=Bd(c.codePointAt(0));f<c.length;){var r=Cd.up(c,f);k=b(c,0,f+r);if(k>a){0===f&&(d=f+r,h=k);break}var u=0;if(f+r<c.length){var x=c.codePointAt(f+r),w=Bd(x);u=10===l?-1:w&1?0:45===l?1:n&256||w&128||n&4&&w&8||n&32&&w&4?2:n&64||w&64?0:2;l=x;n=w}u<=e&&(e=u,d=f+r,h=k);f+=r}return{ev:d,length:h}};var Yd=v.create("FormatText"),ce=function(){function c(a,b,d){this.text=a;this.frame=b;this.re=d;this.lines=[];this.Pv=0}c.prototype.ka=function(a,b){a=new Vd(a,b);for(b=0;b<this.lines.length;b++)this.lines[b].ka(a,this.frame,b)};c.prototype.format=function(a){var b=this,d=this.text.Yi(0);this.lines.length=0;this.Mv(a);if(!("top"===d.get("verticalAlign")||1E9===this.frame.Je||this.yC()<this.text.count())){var e=this.frame.Je/2;if(this.frame.Jw()){d=this.tr();d=e-(d.gc+d.Lb/2);for(var c=0,h=this.lines;c<
h.length;c++)h[c].shift(0,d)}else Ad(this.frame.Je,function(d){b.Pv=d;b.lines.length=0;b.Mv(a);d=b.tr();return e-(d.gc+d.Lb/2)})}};c.prototype.Mv=function(a){for(var b=0,d=this.lines.length,e=this.Pv,c=e,h=0,k=null,l=null,n=null,r=0;;){if(1E3<r++){Yd("Broke out due to sanity check.");break}if(c>this.frame.Je)break;k||(k=this.text.Si(b).item);if(!l){e=k.style.get("lineHeight");h=k.style.get("fontSize");this.re.test&&(h=20);0<this.lines.length&&(h*=e);e=c;c=e+h;if(c>this.frame.Je)break;h=0;if(0===b||
"\n"===this.text.zd(b-1,1))l=this.Sz(a,k.style.get("textIndent")),h+=l;n=Od(this.frame.Cn(e,c-e,h));l=new Zd(0,0);l.rG(h)}if(!n)break;if(b>=this.text.count())break;var u=this.Lz(a,k,b,n.$a-h);if(u.$a<=n.$a-h){if(u.Lb>c-e){var x=e+u.Lb;if(x>this.frame.Je){c=x;n=null;continue}var w=Od(this.frame.Cn(e,x-e,0));if(!w||l.$a+u.$a>w.$a){this.lm(l,e,c,n.bc,n.$a);c=x;l=null;continue}l.bc=w.bc}}else{if(0<l.Id.length){this.lm(l,e,c,n.bc,n.$a);l=null;continue}if(w=Od(this.frame.Cn(e,u.Lb,u.$a))){n=w;e=n.gc;c=
n.gc+n.Lb;h=0;l=new Zd(0,0);continue}else break}b+=u.count;h+=u.$a;b>=k.index+k.count()&&(k=null);l.append(u.span);u.io&&(this.lm(l,e,c,n.bc,n.$a),l=null)}l&&n&&this.lm(l,e,c,n.bc,n.$a);this.frame.Cy(c);this.oA(d)};c.prototype.lm=function(a,b,d,e,c){this.lines.push(a);a.Lb=d-b;a.shift(e,b);a.ym=c;b=0;for(a=a.Id;b<a.length;b++)e=a[b],e.gc=d-e.Lb};c.prototype.oA=function(a){var b=this.frame.bo;if(1E9===b){for(var d=b=0,e=this.lines;d<e.length;d++){var c=e[d];c.$a>b&&(b=c.$a)}d=0;for(e=this.lines;d<
e.length;d++)c=e[d],c.ym=b}for(;a<this.lines.length;a++)if(c=this.lines[a],0!==c.Id.length)switch(this.text.Yi(c.Id[0].Ja).get("align")){case "center":c.shift((c.ym-c.$a)/2,0);break;case "right":c.shift(c.ym-c.$a,0)}};c.prototype.Lz=function(a,b,d,e){var c=this;if(b instanceof Wd){var h=b.Pc(),k=b.style.get("fontSize");h.Lb<k&&(h.Lb=k);return{span:new $d(d,b,h.$a,h.Lb,1===this.re.direction,!1),$a:h.$a,Lb:h.Lb,count:b.count()}}if(b instanceof zd){h=b.style.get("lineHeight");var l=b.style.get("fontSize");
k=l;this.re.test&&(k=20);0<this.lines.length&&(k*=h);a.font=b.style.br();var n=d-b.index,r=b.zd(n,b.count()-n);h=r.length;var u={vertical:1===this.re.direction,oh:1!==this.re.direction||0!==(Bd(r.charCodeAt(0))&64),Zi:k,Gn:[],length:0,get attributes(){return b.style}};r=Xd(r,e,function(b,d,e){if(1===c.re.direction&&u.oh)return e*l;for(;" "===b.charAt(d+e-1);)e--;return a.measureText(b.substr(d,e)).width});e=r.ev;var x=r.length;r=b.zd(n,e);if(1===this.re.direction&&u.oh){u.Zi=l;u.Gn=[];var w=x=0;for(n=
b.zd(n,e);w<e;){var y=Cd.up(n,w),z=a.measureText(n.substr(w,y)).width;u.Gn.push(z);z>x&&(x=z);w+=y}u.length=x;x=e*l}else u.length=x;n=e<h;0<r.length&&(n=n||"\n"===r.charAt(r.length-1));e<h&&" "===this.text.zd(d+e,1)&&(r+=" ",e++);return{span:new ae(d,r,u,x,k,k),$a:x,Lb:k,count:e,io:n}}throw Error("Don't know how to handle item of this type: "+b.constructor.name);};c.prototype.yC=function(){if(0===this.lines.length)return 0;for(var a=null,b=this.lines.length-1;0<=b;b--)if(this.lines[b].Id.length){a=
this.lines[b].Id[this.lines[b].Id.length-1];break}return a?a.Ja+a.count():0};c.prototype.tr=function(){if(0===this.lines.length)return new be(0,0,0,0);var a=this.lines[0],b=a.bc,d=a.bc+a.$a,e=a.gc;a=a.gc+a.Lb;for(var c=0,h=this.lines;c<h.length;c++){var k=h[c];k.bc<b&&(b=k.bc);k.bc+k.$a>d&&(d=k.bc+k.$a);k.gc<e&&(e=k.gc);k.gc+k.Lb>a&&(a=k.gc+k.Lb)}return new be(b,e,d-b,a-e)};c.prototype.kn=function(){var a=this.tr(),b=this.frame.Nk(a.bc,a.gc);a=this.frame.Nk(a.bc+a.$a,a.gc+a.Lb);return new K(b.x,b.y,
a.x-b.x,a.y-b.y)};c.prototype.Sz=function(a,b){var d=parseFloat(b)||0;return-1!==b.indexOf("em")?d*a.measureText("M").width:d};return c}(),be=function(){function c(a,b,d,e){this.bc=a;this.gc=b;this.$a=d;this.Lb=e}c.prototype.clear=function(){this.Lb=this.$a=this.gc=this.bc=0};c.prototype.shift=function(a,b){this.bc+=a;this.gc+=b};return c}(),Zd=function(c){function a(a,d){var b=c.call(this,0,0,0,0)||this;b.vI=a;b.index=d;b.Id=[];b.ym=0;return b}__extends(a,c);a.prototype.rG=function(a){this.$a=a};
a.prototype.clear=function(){this.Id.length=0;c.prototype.clear.call(this)};a.prototype.count=function(){for(var a=0,d=0;d<this.Id.length;d++)a+=this.Id[d].count();return a};a.prototype.append=function(a){this.Id.push(a);a.bc=this.$a;this.$a+=a.$a};a.prototype.ka=function(a,d,e){for(var b=0;b<this.Id.length;b++)this.Id[b].ka(a,d,e)};a.prototype.shift=function(a,d){c.prototype.shift.call(this,a,d);for(var b=0,f=this.Id;b<f.length;b++)f[b].shift(a,d)};return a}(be),de=function(c){function a(a,d,e){d=
c.call(this,0,0,d,e)||this;d.Ja=a;return d}__extends(a,c);a.prototype.count=function(){return 1};a.prototype.ka=function(){};a.prototype.zd=function(){return""};return a}(be),ae=function(c){function a(a,d,e,f,h,k){a=c.call(this,a,f,h)||this;a.text=d;a.qs=e;a.lineHeight=k;return a}__extends(a,c);a.prototype.count=function(){return this.text.length};a.prototype.ka=function(a,d){d=d.Nk(this.bc,this.gc+this.lineHeight);a.WB(this.qs,d.x,d.y,this.text)};a.prototype.zd=function(){return this.text};return a}(de),
$d=function(c){function a(a,d,e,f,h,k){a=c.call(this,a,e,f)||this;a.item=d;a.vertical=h;a.oh=k;return a}__extends(a,c);a.prototype.ka=function(a,d){d=d.Nk(this.bc,this.gc+this.Lb);a.NB(d.x,d.y,this.item,this.vertical,this.oh)};return a}(de);var ee=function(){function c(){this.text="";this.Kv="Arial";this.fontSize=10;this.lines=[];this.bz="top";this.lw="left";this.textIndent="0";this.Zd=this.bold=!1;this.textDecoration="";this.outline=null;this.Uu=0;this.lineHeight="100%";this.writingMode="";this.fill=q.Oa;this.stroke=q.he;this.Vf=null;this.log=v.create("TextBox");this.oi=null;this.rect=new K(0,0,0,this.fontSize)}c.prototype.El=function(a,b,d,e,c){this.Kv=a;this.fontSize=b;this.bold=d;this.Zd=e;this.textDecoration=c};c.prototype.pi=function(a,
b){this.fill=a;this.stroke=b};c.prototype.Qo=function(a){this.outline=a};c.prototype.MG=function(a){this.writingMode=a};c.prototype.bG=function(a){this.Uu=a};c.prototype.kd=function(a){this.text=a};c.prototype.Bl=function(a,b){switch(a){case "left":case "center":case "right":this.lw=a;break;case null:break;default:this.log("Unknown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.bz=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.wG=function(a){this.lineHeight=
a};c.prototype.oD=function(){var a=parseFloat(this.lineHeight);this.lineHeight.endsWith("%")&&(a/=100);return a};c.prototype.format=function(a,b,d){var e=new ud(rd);e.set("fontFamily",this.Kv);e.set("fontSize",this.fontSize);e.set("fontWeight",this.bold?"bold":"normal");e.set("fontStyle",this.Zd?"italic":"normal");e.set("align",this.lw);e.set("textIndent",this.textIndent);e.set("verticalAlign",this.bz);e.set("lineHeight",this.oD());e.set("colour",this.fill);e.set("outlineColour",this.stroke);0<=this.textDecoration.indexOf("underline")&&
e.set("underline",!0);0<=this.textDecoration.indexOf("line-through")&&e.set("line-through",!0);e=this.oi=Ld.vz(this.text,e);var c={direction:"vertical-rl"===this.writingMode?1:0};b=this.outline?new Qd(this.outline[0],c):new Pd(0===b?1E9:b,0===d?1E9:d,c);this.Vf=new ce(e,b,c);this.Vf.format(a);this.rect=this.Vf.kn()};c.prototype.kn=function(){return this.Vf?this.outline?K.Ee(this.outline[0]):this.Vf.kn():new K(0,0,0,0)};c.prototype.ka=function(a,b,d){this.fillText(a,b,d)};c.prototype.fillText=function(a,
b,d){if(this.Vf){var e=new ud(rd);"string"===typeof a.fillStyle&&e.set("colour",a.fillStyle);"string"===typeof a.strokeStyle&&e.set("outlineColour",a.strokeStyle);this.oi&&this.oi.Va(e,0,this.oi.count());a.translate(b,d);this.Vf.ka(a,1);a.translate(-b,-d)}};c.prototype.strokeText=function(a,b,d){if(this.Vf){if("string"===typeof a.strokeStyle){var e=new ud(rd);e.set("outlineColour",a.strokeStyle);this.oi&&this.oi.Va(e,0,this.oi.count())}a.translate(b,d);this.Vf.ka(a,2);a.translate(-b,-d)}};return c}();var fe=function(c){function a(b,d){b=c.call(this,b,d)||this;b.Ya=new ee;b.ku=!1;b.VD=0;b.border={lineWidth:0,td:q.Oa};b.width=0;b.height=0;b.FI=0;b.GI=0;b.log=v.create("TEXT",!0);b.path=null;b.Fu(a.Xt);b.ba.text="lorum ipsum dolor";return b}__extends(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.Mh=function(){return void 0!==this.ia("width")?2:this.ia("wrap")?1:0};a.prototype.Ge=function(a){var b=c.prototype.Ge.call(this,a);2===this.Mh()&&(a=a.ub(!1),this.log("Scale %s",a),1E-8>Math.abs(a.x-
a.y)&&(b.fontSize=this.ba.fontSize*a.x,b.padding=(this.ba.padding||0)*a.x));return b};a.prototype.tc=function(a){switch(a){case "scaleFont":case "padding":case "width":case "height":case "baseWidth":case "verticalAlign":case "lineHeight":return!0}return c.prototype.tc.call(this,a)};a.prototype.setProperty=function(a,d){switch(a){case "fillStyle":case "textFillStyle":this.ba.textFillStyle=d;this.ba.fillStyle=d;return;case "strokeStyle":case "textStrokeStyle":this.ba.strokeStyle=d;return;case "border-color":a=
this.rl(this.ia("border")||"");this.setProperty("border",a.lineWidth+"px "+d);return;case "border-width":a=this.rl(this.ia("border")||"");this.setProperty("border",d+"px "+a.td);return;case "underline":this.setProperty("textDecoration",d?"underline":"");return}c.prototype.setProperty.call(this,a,d)};a.prototype.hb=function(){var a=c.prototype.hb.call(this);a["border-color"]=this.ia("border-color");a["border-width"]=this.ia("border-width");return a};a.prototype.Qh=function(a){switch(a){case "border":case "textIndent":case "writingMode":return!0}return c.prototype.Qh.call(this,
a)};a.prototype.ia=function(a){switch(a){case "border-color":return this.rl(this.ia("border")||"").td;case "border-width":return this.rl(this.ia("border")||"").lineWidth;case "lockAspectRatioY":return 2===this.Mh()&&"vertical-rl"!==this.ia("writingMode");case "lockAspectRatioX":return 2===this.Mh()&&"vertical-rl"===this.ia("writingMode");case "underline":return 0<=(this.ia("textDecoration")||"").indexOf("underline")}return c.prototype.ia.call(this,a)};a.prototype.Qo=function(a){this.path=a};a.prototype.format=
function(a){var b=this.ba.matrix,e=b.apply(0,0),c=b.apply(1,0),h=e.ic(c);e=this.Mh();c=this.ba.text;0===e&&c.length&&10===c.charCodeAt(c.length-1)&&(c=c.substr(0,c.length-1));this.Ya.kd(c);this.Ya.Qo(this.path);b=b.ub(!1);this.Ya.El(this.ba.fontName,this.ba.fontSize,this.ba.bold,this.ba.italic,this.ba.textDecoration);this.Ya.wG(this.ba.lineHeight||"100%");this.Ya.MG(this.ba.writingMode||"");this.Ya.textIndent=this.ba.textIndent||"";this.path?this.Ya.Bl(this.ba.textAlign,this.ba.verticalAlign||"top"):
this.Ya.Bl(this.ba.textAlign,"top");e=this.ia("padding")||0;c=this.ia("lineWidth")+0;switch(this.Mh()){case 0:this.Ya.format(a,0,0);h=this.Ya.rect.width;a=this.Ya.rect.height;this.xa=new K(0,-(0+this.ia("fontSize")),h,a);break;case 1:var k=this.ba.baseWidth;void 0===k&&(this.Ya.format(a,0,0),k=Math.max(this.Ya.rect.width,10),500<k&&(k=500),this.ba.baseWidth=k,this.log("Formatting text for first time; baseWidth=%s",k));h=Math.ceil(h*k);this.Ya.format(a,h,0);a=this.Ya.rect.height;this.xa=new K(0,0,
k,a);break;case 2:k=this.ia("width")||0;h=this.ia("height")||0;"vertical-rl"!==this.ba.writingMode?(k-=2*e/b.x,this.Ya.format(a,k*b.x,0),h=h||this.Ya.rect.height/b.y):(h=k-2*e/b.y,this.Ya.format(a,0,h*b.y),k=this.Ya.rect.width/b.x);this.xa=new K(0,0,k,h);this.xa.x+=(e+c)/b.x;this.xa.y+=(e+c)/b.y;break;default:throw Error("TextNode: Bad Mode "+this.Mh());}this.xa.height+=.3*this.ba.fontSize/b.y;this.xa.dd(2*e/b.x,2*e/b.y);this.xa.dd(c/b.x,c/b.y);a=new zc(this.xa);a.transform(this.Pa());this.rect=a.Cm();
this.VD=this.rect.height;this.border=this.ba.border?this.rl(this.ba.border):{lineWidth:0,td:q.Oa}};a.prototype.rl=function(a){var b={lineWidth:0,td:q.Oa};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=q.Ak(a[e]))b.td=c.toString()}else b.lineWidth=c}return b};a.prototype.Pa=function(){return!1===this.ia("scaleFont")?c.prototype.Pa.call(this).hp():c.prototype.Pa.call(this)};a.prototype.ka=function(a){if(0!==this.ba.text.length&&!this.ku){a.save();this.ul(a);"opacity"in
this.ba&&(a.globalAlpha=this.ba.opacity);var b=this.ba.background;if(b||this.border.lineWidth)a.save(),this.Pa().rc(a),b&&(a.fillStyle=b,a.fillRect(this.xa.x,this.xa.y,this.xa.width,this.xa.height)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.td,a.lineWidth=this.border.lineWidth,a.rect(this.xa.x,this.xa.y,this.xa.width,this.xa.height),b=this.lc(),b.hp().multiply(b).rc(a),a.stroke()),a.restore();b=this.Mh();var e=this.ba.padding||0;0!==b?this.Pa().hp().rc(a):this.Pa().rc(a);a.strokeStyle=
this.ba.strokeStyle;a.fillStyle=this.ba.fillStyle;a.lineWidth=this.ba.lineWidth;var c=0,h=this.Pa().ub(!1);h=this.xa.height*h.y;if(!this.path)if(0===b&&!1!==this.ia("scaleFont"))c=-(0+this.ia("fontSize"));else switch(this.log("Available: %s rect: %s",h,this.Ya.rect),this.ba.verticalAlign){case "bottom":c+=h-this.Ya.rect.height;break;case "middle":c+=(h-this.Ya.rect.height)/2}2===b&&a.translate(e,e);this.ba.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");
0<this.ba.lineWidth&&this.Ya.strokeText(a,0,c);this.Ya.fillText(a,0,c);this.tl(a);a.restore()}};a.prototype.Ej=function(a){this.ku=a};a.prototype.Mk=function(){var a=c.prototype.Mk.call(this);if("vertical-rl"===this.ba.writingMode){var d=a.width;a.width=a.height;a.height=d}return a};a.Xt={textFillStyle:q.Oa,fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:q.Oa,wrap:!1,textAlign:"left",bold:!1,italic:!1,background:q.he,textDecoration:""};return a}(pd);pd.Pd("TextNode",fe);var ge=function(){function c(a,b){this.Ca=a;this.la=b;this.XG=!0;this.log=v.create("MoveSegment")}c.prototype.ka=function(a){a.moveTo(this.la.x,this.la.y)};c.prototype.kf=function(){return{x:1,y:0}};return c}(),he=function(){function c(a,b,d,e,c){this.Ca=a;this.la=b;this.Uo=e;this.qg=c;this.log=v.create("LineSegment");this.mi=0;this.kb=new J(0,0);this.Za=new J(0,0);this.length=0;this.from=new J(0,0);this.la=b;this.Ca=a;this.qg=c;this.Uo=e;d.next();this.Eo=d.next();this.Fo=d.next();this.moveTo=this.rg=
null;this.format()}c.prototype.format=function(){var a=gc(this.Ca.la.x,this.Ca.la.y,this.la.x,this.la.y);this.mi=this.length=a;var b=this.Ca.la.clone();this.Ca instanceof c&&this.qg&&(this.qg=Math.min(this.qg,a/2,this.Ca.length/2),a=hc(this.Ca.la.x,this.Ca.la.y,this.la.x,this.la.y),b.x+=a.x*this.qg,b.y+=a.y*this.qg,this.Ca.SG(this.qg),this.mi-=this.qg);this.from=b;null===this.rg&&(this.rg=this.la);a=this.mi/10*this.Uo;10<a&&(a=10);var d=b.x,e=b.y,f=this.la.x,h=this.la.y;d+=a;e+=a;this.kb=new J(d+
this.Eo*(f+a-d),e+this.Eo*(h+a-e));d=b.x-a;f=this.la.x-a;e=b.y-a;h=this.la.y-a;this.Za=new J(d+this.Fo*(f-d),e+this.Fo*(h-e))};c.prototype.SG=function(a){var b=hc(this.from.x,this.from.y,this.la.x,this.la.y),d=this.la.clone();d.x-=b.x*a;d.y-=b.y*a;this.rg=d;this.mi-=a;a=this.mi/10*this.Uo;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,h=d.y;b+=a;e+=a;this.kb=new J(b+this.Eo*(c+a-b),e+this.Eo*(h+a-e));b=this.from.x-a;c=d.x-a;e=this.from.y-a;h=d.y-a;this.Za=new J(b+this.Fo*(c-b),e+this.Fo*(h-e))};
c.prototype.Hl=function(a){this.Ca=a;this.format();this.Ca instanceof c&&(this.moveTo=this.Ca.rg)};c.prototype.ka=function(a){null!==this.rg&&(this.qg&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.Ca.la.x,this.Ca.la.y,this.from.x,this.from.y)),0===this.Uo?a.lineTo(this.rg.x,this.rg.y):a.bezierCurveTo(this.kb.x,this.kb.y,this.Za.x,this.Za.y,this.rg.x,this.rg.y))};c.prototype.kf=function(){for(var a=this.Za,b=gc(this.Za.x,this.Za.y,this.la.x,this.la.y),d=this.Ca;20>b&&
d instanceof c;)a=d.Za,d=d.Ca,b+=gc(a.x,a.y,this.la.x,this.la.y);return hc(a.x,a.y,this.la.x,this.la.y)};return c}(),ie=function(){function c(a,b,d){this.dt=d;this.la=b;this.Ca=a;this.dt=d;var e=gc(a.la.x,a.la.y,b.x,b.y);e||(e=1);var c=(b.x-a.la.x)/e,h=(b.y-a.la.y)/e;this.Za=new J(b.x-e*d*c,b.y-e*d*h);if((b=a.Za)&&a.Ca){var k=hc(a.Ca.la.x,a.Ca.la.y,a.la.x,a.la.y),l=gc(a.Ca.la.x,a.Ca.la.y,a.la.x,a.la.y);c=.5*(c+k.x);h=.5*(h+k.y);b.x=a.la.x-l*d*c;b.y=a.la.y-l*d*h}this.kb=new J(a.la.x+e*d*c,a.la.y+e*
d*h);this.length=e}c.prototype.Hl=function(a){this.Ca=a;var b=a.Za,d=(this.la.x-a.la.x)/this.length,e=(this.la.y-a.la.y)/this.length,c=this.dt;if(b&&a.Ca){var h=hc(a.Ca.la.x,a.Ca.la.y,a.la.x,a.la.y),k=gc(a.Ca.la.x,a.Ca.la.y,a.la.x,a.la.y);d=.5*(d+h.x);e=.5*(e+h.y);b.x=a.la.x-k*c*d;b.y=a.la.y-k*c*e}this.kb=new J(a.la.x+this.length*c*d,a.la.y+this.length*c*e)};c.prototype.ka=function(a){a.bezierCurveTo(this.kb.x,this.kb.y,this.Za.x,this.Za.y,this.la.x,this.la.y)};c.prototype.kf=function(){return 0<
this.dt?hc(this.Za.x,this.Za.y,this.la.x,this.la.y):hc(this.Ca.la.x,this.Ca.la.y,this.la.x,this.la.y)};return c}(),je=function(){function c(a,b,d){this.Ca=a;this.control=b;this.la=d}c.prototype.ka=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.la.x,this.la.y)};c.prototype.kf=function(){return hc(this.control.x,this.control.y,this.la.x,this.la.y)};return c}(),ke=function(){function c(a,b,d,e){this.Ca=a;this.control=b;this.la=d;this.pg=e}c.prototype.ka=function(a){a.arcTo(this.control.x,
this.control.y,this.la.x,this.la.y,this.pg)};c.prototype.kf=function(){return hc(0,0,1,0)};return c}(),le=function(){function c(a,b,d,e,c,h,k){this.Ca=a;this.me=b;this.la=d;this.pg=e;this.gt=c;this.cC=h;this.kB=k}c.prototype.ka=function(a){a.arc(this.me.x,this.me.y,this.pg,this.gt,this.cC,0!==this.kB)};c.prototype.kf=function(){return hc(0,0,1,0)};return c}(),me=function(){function c(a,b,d,e){this.kb=b;this.Za=d;this.kb=b;this.Za=d;this.la=e;this.Ca=a}c.prototype.ka=function(a){a.bezierCurveTo(this.kb.x,
this.kb.y,this.Za.x,this.Za.y,this.la.x,this.la.y)};c.prototype.kf=function(){return hc(this.Za.x,this.Za.y,this.la.x,this.la.y)};return c}(),ne=function(){function c(a,b,d,e){this.Ca=a;this.kb=b;this.Za=d;this.la=e}c.prototype.ka=function(a){if(this.Ca){var b=[];this.Ca.Za&&b.push(this.Ca.Za);this.kb&&b.push(this.kb);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.la.x,this.la.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,this.la.x,this.la.y)}};c.prototype.Hl=function(a){this.Ca=
a};c.prototype.kf=function(){return this.kb?hc(this.kb.x,this.kb.y,this.la.x,this.la.y):{x:1,y:0}};return c}(),oe=function(){function c(a,b,d,e,c){this.Ca=a;this.gk=b;this.la=d;this.log=v.create("SEGMENT");this.Ca=a;this.gk=b;c*=2;var f=2*e.next()-1;e.next();e=this.Ca.kf();if(!this.Ca.XG&&e){var k=gc(a.la.x,a.la.y,b.x,b.y);this.kb=new J(a.la.x+.5522847498*e.x*k,a.la.y+.5522847498*e.y*k)}else this.kb=new J(a.la.x+.5522847498*(b.x-a.la.x),a.la.y+.5522847498*(b.y-a.la.y));this.Za=new J(d.x-.5522847498*
(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*(1-f*c));this.la=d}c.prototype.Hl=function(a){this.Ca=a;var b=this.Ca.kf();if(b){var d=gc(a.la.x,a.la.y,this.gk.x,this.gk.y);this.kb=new J(a.la.x+.5522847498*b.x*d,a.la.y+.5522847498*b.y*d)}else this.kb=new J(a.la.x+.5522847498*(this.gk.x-this.Ca.la.x),a.la.y+.5522847498*(this.gk.y-this.Ca.la.y))};c.prototype.ka=function(a){a.bezierCurveTo(this.kb.x,this.kb.y,this.Za.x,this.Za.y,this.la.x,this.la.y)};c.prototype.kf=function(){return hc(this.Za.x,this.Za.y,
this.la.x,this.la.y)};return c}();var pe=function(){function c(a){this.al=this.$k=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.Rs=a;this.reset()}c.prototype.reset=function(){this.al=this.$k=this.Rs};c.prototype.next=function(){this.al=36969*(this.al&65535)+(this.al>>16);this.$k=18E3*(this.$k&65535)+(this.$k>>16);return((this.al<<16)+this.$k)/4294967295/2+.5};return c}();var qe=function(){function c(a){this.na=a;this.n=0;this.ac=new J(0,0)}c.prototype.next=function(a){if(0===this.na.length)return null;if(0===this.n)return this.ac=this.na[0].clone(),this.n+=1,this.ac.clone();for(;this.n<this.na.length;){var b=this.ac.ic(this.na[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.ac.x+=(this.na[this.n].x-this.ac.x)*a/b,this.ac.y+=(this.na[this.n].y-this.ac.y)*a/b,this.ac.clone()}return null};return c}(),re=function(){function c(a){this.Gb=a;this.xl=
!0;this.na=[];this.log=v.create("WaveAddon");this.pg=a.ia("waveRadius")}c.prototype.format=function(){var a=this.Gb.Fi(!1).mh(O.$l).fe();this.log("Format cloud; %s points",a[0].length);this.na=this.TH(a,this.pg)};c.prototype.TH=function(a,b){for(var d=[],e=0;e<a.length;e++){var c=a[e],h=new qe(c),k=1,l=[];if(!(2>c.length)){var n=0;for(var r=1;r<c.length;r++)n+=gc(c[r-1].x,c[r-1].y,c[r].x,c[r].y);b=n/Math.round(n/(2*b)+.5)/2;for(n=[];;){r=h.next(2*b);if(!r)break;n.push(r)}n.push(c[c.length-1]);h=n[0];
l.push(h);for(c=1;c<n.length;c++){r=n[c];var u=hc(h.x,h.y,r.x,r.y);var x=b,w=new J(u.y*k,-1*u.x*k);h=new J(h.x+(u.x+w.x)*x,h.y+(u.y+w.y)*x);l.push(h);l.push(r);k*=-1;h=r}for(c=2;c<l.length-1;c+=2)k=l[c-1],n=l[c+1],l[c].x=k.x+(n.x-k.x)/2,l[c].y=k.y+(n.y-k.y)/2}d.push(l)}return d};c.prototype.ka=function(a){a.beginPath();for(var b=0,d=this.na;b<d.length;b++){var e=d[b];a.moveTo(e[0].x,e[0].y);for(var c=1;c<e.length-1;c+=2)a.quadraticCurveTo(e[c].x,e[c].y,e[c+1].x,e[c+1].y)}};return c}();var se=function(){function c(a){this.path=a;this.xl=!0;this.Af=null;this.na=[]}c.prototype.format=function(){this.Af=this.path.Fi(!1).mh(O.$l);this.na=this.Af.fe()[0];var a=0,b=this.Af.Pu(),d=!1,e=this.path.ia("lineWidth");"circle"===this.path.ia("arrowStyle1")&&(a+=this.path.ia("arrowSize1")+e,d=!0);"circle"===this.path.ia("arrowStyle")&&(b-=this.path.ia("arrowSize")+e,d=!0);d&&(this.Af=this.Af.trim(a,b))};c.prototype.RB=function(a){this.Gq(a,"");this.Gq(a,"1")};c.prototype.Gq=function(a,b){var d=
this.path.ia("arrowSize"+b)||0,e=this.path.ia("doubleArrow");if(!(0===d||this.path.ia("closed")||"1"==b&&e)){var c=this.path.ia("arrowXOffset"+b);if(void 0===c||null===c)c=d;var h="circle"===this.path.ia("arrowStyle"+b),k=this.path.ia("lineWidth");d={Hf:c,If:d,YD:this.path.ia("arrowInnerOffset"+b)||0,na:this.na,reverse:"1"===b,style:this.path.ia("arrowStyle"+b),expand:h?-k:k};c=Math.max(0,this.path.ia("lineWidth")-2);d.Hf+=c;d.If+=c;Rc(a,d);""==b&&e&&(d.reverse=!0,Rc(a,d))}};c.prototype.ka=function(a){a.strokeStyle=
this.path.ia("strokeStyle");a.lineWidth=this.path.ia("lineWidth");a.beginPath();this.Af&&this.Af.ka(a);a.stroke();for(var b=0,d=["","1"];b<d.length;b++){var e=d[b],c=this.path.ia("arrowStyle"+e);c="solid"===c||"ball"===c;var h=this.path.ia("strokeStyle");a.beginPath();this.Gq(a,e);c?(a.fillStyle=h,a.fill()):(a.strokeStyle=h,a.lineWidth=this.path.ia("lineWidth"),a.stroke())}};return c}();var te;(function(c){function a(a){a=1664525*a+1013904223&4294967295;return function(){a=1664525*a+1013904223&4294967295;return a/4294967295+.5}}function b(a){return Math.floor(a*c.random())}c.random=Math.random;c.Rv=a;c.Rs=function(b){c.random=a(b)};c.SI=function(){c.random=Math.random};c.yI=b;c.QI=function(a){for(var d=[],c=0;c<a;c++)d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[b(63)]);return d.join("")}})(te||(te={}));var ue=te;var ve=function(c){function a(a,d){var b=c.call(this)||this;b.MF=a;b.Jj=new vc;b.x=0;b.y=0;b.ji=ue.Rv(d);return b}__extends(a,c);a.prototype.ka=function(a){c.prototype.ka.call(this,a);this.Jj.ka(a)};a.prototype.p=function(a,d){void 0===d&&(d=1);return a+(this.ji()-.5)*this.MF*d};a.prototype.moveTo=function(a,d){c.prototype.moveTo.call(this,this.p(a),this.p(d));this.Jj.moveTo(this.p(a),this.p(d));this.x=a;this.y=d};a.prototype.closePath=function(){c.prototype.closePath.call(this);this.Jj.closePath()};
a.prototype.lineTo=function(a,d){var b=this.x+.5*(a-this.x),f=this.y+.5*(d-this.y),h=this.x+.75*(a-this.x),k=this.y+.75*(d-this.y);c.prototype.bezierCurveTo.call(this,this.p(b),this.p(f),this.p(h),this.p(k),this.p(a),this.p(d));this.Jj.bezierCurveTo(this.p(b),this.p(f),this.p(h),this.p(k),this.p(a),this.p(d));this.x=a;this.y=d};a.prototype.quadraticCurveTo=function(a,d,e,f){c.prototype.quadraticCurveTo.call(this,this.p(a),this.p(d),this.p(e),this.p(f));this.Jj.quadraticCurveTo(this.p(a),this.p(d),
this.p(e),this.p(f));this.x=e;this.y=f};a.prototype.bezierCurveTo=function(a,d,e,f,h,k){c.prototype.bezierCurveTo.call(this,this.p(a),this.p(d),this.p(e),this.p(f),this.p(h),this.p(k));this.Jj.bezierCurveTo(this.p(a),this.p(d),this.p(e),this.p(f),this.p(h),this.p(k));this.x=h;this.y=k};a.prototype.OB=function(a){var b=new Nc(this.mh(1).fe(),new kc(Math.PI/4,0,0)),e=1/.3,c=e/4,h=0;for(b=b.hD(e);h<b.length;h++)e=b[h],a.moveTo(this.p(e.start.x,c),this.p(e.start.y,c)),a.lineTo(this.p(e.end.x,c),this.p(e.end.y,
c))};return a}(vc);var we=function(){function c(a){this.Gb=a;this.YB=this.xl=!0;this.outline=null;this.fill=new vc}c.prototype.format=function(){var a=this.Gb.ia("roughness")||0;this.outline=new ve(a,this.Gb.ia("seed")||0);this.Gb.Fi(!0).ka(this.outline);this.Gb.ia("lineWidth");this.Gb.ia("closed")&&(this.fill=new vc,this.outline.OB(this.fill))};c.prototype.ka=function(a){if(this.outline){var b=this.Gb.ia("lineWidth")||1;this.Gb.ia("closed")&&(a.beginPath(),a.lineWidth=1,a.strokeStyle=this.Gb.hr("fill"),this.fill.ka(a),
a.stroke());a.beginPath();a.setLineDash(this.Gb.hc);a.lineWidth=b;a.strokeStyle=this.Gb.ia("strokeStyle");this.outline.ka(a);a.stroke()}};return c}();var xe=function(){var c;return function(a){c||(c=document.createElement("a"));c.href=a;return c.href}}();function ye(c,a){return xe(c)===xe(a)}
var O=function(c){function a(b,d){b=c.call(this,b,d)||this;b.ib=[];b.Cc=[];b.et=[];b.Vy=!1;b.inverse=new L;b.origin=new J(0,0);b.hc=[];b.Af=new vc;b.xe=new vc;b.xI=!1;b.backgroundImage=null;b.lh=null;b.request=null;b.log=v.create("PATHNODE");b.log("New PathNode Created");b.Sc=new fe("",d);b.Sc.setProperty("text",b.ba.text||"");b.Fu(a.sa);b.ba.closed=!1;b.ba.commands=[];b.ba.seed=0;return b}__extends(a,c);a.prototype.moveTo=function(b,d){var e=this.ba.commands;e.push(a.rh);e.push(b);e.push(d)};a.prototype.type=
function(){return"PathNode"};a.prototype.Rg=function(){return!0};a.prototype.tc=function(a){switch(a){case "sides":case "rotation":case "radius":case "oddRadiusScaling":case "skewX":case "skewY":case "arrowInnerOffset":case "arrowSize1":case "arrowStyle1":case "arrowInnerOffset1":case "arrowXOffset1":return!0}return c.prototype.tc.call(this,a)};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);if(void 0!==d)switch(a){case "bold":case "fontName":case "fontSize":case "italic":case "lineHeight":case "text":case "textAlign":case "textIndent":case "textDecoration":case "underline":case "wrap":case "writingMode":this.ba[a]=
d;this.Sc.setProperty(a,d);break;case "textFillStyle":this.Sc.setProperty("fillStyle",d);this.ba[a]=d;break;case "textStrokeStyle":this.Sc.setProperty("strokeStyle",d);this.ba[a]=d;break;case "textLineWidth":this.Sc.setProperty("lineWidth",d);this.ba[a]=d;break;case "textBackground":this.Sc.setProperty("background",d);this.ba[a]=d;break;case "roughness":case "cloudRadius":case "waveRadius":case "doubleLine":case "doubleLineDashSide":case "spotHighlight":case "verticalAlign":this.ba[a]=d;break;case "backgroundImage":this.ba[a]=
d,this.backgroundImage=null}};a.prototype.Gh=function(a,d){switch(a){case "roughness":"string"===typeof d&&(d=parseFloat(d));break;case "fillStyle":case "strokeStyle":"string"!==typeof d&&(d=q.zp)}return c.prototype.Gh.call(this,a,d)};a.prototype.ia=function(a){switch(a){case "textAlign":return this.ba[a]||"center";case "verticalAlign":return this.ba[a]||"middle";case "textFillStyle":return this.ba[a]||q.Oa;case "bold":case "italic":case "underline":case "lineHeight":return this.Sc.ia(a)}return c.prototype.ia.call(this,
a)};a.prototype.hb=function(){var a=c.prototype.hb.call(this);a.text&&(a.textFillStyle=a.textFillStyle||q.Oa,a.textStrokeStyle=a.textStrokeStyle||q.Oa,a.textLineWidth=a.textLineWidth||0,a.textIndent=a.textIndent||"0");a.spotHighlight&&(delete a.fillStyle,delete a.strokeStyle,delete a.dashes,delete a.lineWidth,delete a.opacity);return a};a.prototype.pn=function(b){for(var d=0,e=this.ba.commands,c=b/3|0,h=0;h<c;h++)d+=a.rb[e[d]]+1;h=b%3*2+1;c=e[d+h];d=e[d+h+1];this.log("getEditHandle(%s) = (%s, %s)",
b,c,d);return this.Pa().apply(c,d)};a.prototype.xf=function(b,d,e){for(var c=0,h=this.ba.commands.concat(),k=b/3|0,l=-1,n=0;n<k;n++)l=c,c+=a.rb[h[c]]+1;n=this.inverse.apply(d,e);k=b%3*2+1;var r=n.x-h[c+k],u=n.y-h[c+k+1];h[c+k]=n.x;h[c+k+1]=n.y;h[c]===a.De&&1==k&&(h[c+5]+=r,h[c+6]+=u,h[c+7]===a.De&&(h[c+10]+=r,h[c+11]+=u));h[c]===a.De&&3==k&&h[l]===a.De&&(l=h[c-2]-h[c-6],n=h[c-1]-h[c-5],l=Math.sqrt(l*l+n*n),n=hc(h[c-6],h[c-5],h[c+3],h[c+4]),h[c-2]=h[c-6]-n.x*l,h[c-1]=h[c-5]-n.y*l);h[c]===a.De&&5==
k&&h[c+7]===a.De&&(l=h[c+10]-h[c+1],n=h[c+11]-h[c+2],l=Math.sqrt(l*l+n*n),n=hc(h[c+1],h[c+2],h[c+5],h[c+6]),h[c+10]=h[c+1]-n.x*l,h[c+11]=h[c+2]-n.y*l);if(0===b&&this.ba.closed){for(b=null;c<h.length;)k=a.rb[h[c]],2<=k&&(b=c),c+=k+1;b&&(c=b,n=this.inverse.apply(d,e),h[c+1]=n.x,h[c+2]=n.y)}return{commands:h}};a.prototype.CF=function(b){for(var d=this.ba.commands,e=0,c=0;c<b/3;c++)e+=a.rb[d[e]]+1;d.splice(e,a.rb[d[e]]+1)};a.prototype.DC=function(){return this.ia("arrowXOffset")||this.ia("arrowSize")};
a.prototype.mF=function(a){var b=this.ba.sides;if(!b||3>b)return a;a=new P;b=Mc(this.ba.sides,this.ba.radius||50,this.ba.rotation,this.ba.oddRadiusScaling||1,this.ba.skewX||0,this.ba.skewY||0);for(var e=0;e<b.length;e++){var c=b[e];0===e?a.moveTo(c.x,c.y):a.lineTo(c.x,c.y)}a.closePath();return a.Jc()};a.prototype.format=function(b,d){var e=this,c=null;this.ib.length=0;this.request=d;this.inverse=this.ba.matrix.inverse();var h=new J(0,0),k=this.mF(this.ba.commands),l=null,n=this.ba.matrix,r=new pe(this.ba.seed);
this.et.length=0;for(var u=null,x=null,w=0;w<k.length;){switch(k[w++]){case a.rh:h=n.apply(k[w++],k[w++]);x=new ge(l,h);this.ib.push(x);null===c&&(c=h);this.et.push(h);u=null;break;case a.Fe:l&&(h=n.apply(k[w++],k[w++]),this.ib.push(new he(l,h,r,this.ba.sloppiness,this.ba.roundRadius)),this.et.push(h));break;case a.th:if(l){h=n.apply(k[w++],k[w++]);var y=n.apply(k[w++],k[w++]);this.ib.push(new je(l,y,h))}break;case a.Yl:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);var z=k[w++];this.ib.push(new ke(l,
y,h,z))}break;case a.tp:if(l){h=n.apply(k[w++],k[w++]);y=n.apply(k[w++],k[w++]);z=k[w++];var A=k[w++],G=k[w++],I=k[w++];this.ib.push(new le(l,y,h,z,A,G,I))}break;case a.De:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.ib.push(new me(l,z,y,h)));break;case a.Bp:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),y=n.apply(k[w++],k[w++]),this.ib.push(new ne(l,z,y,h)));break;case a.vi:l&&(h=n.apply(k[w++],k[w++]),this.ib.push(new ie(l,h,this.ba.smoothness)));break;
case a.am:l&&(h=n.apply(k[w++],k[w++]),z=n.apply(k[w++],k[w++]),this.ib.push(new oe(l,z,h,r,this.ba.sloppiness)));break;case a.Kd:this.ba.closed=!0;u&&l&&u!==l&&u.Hl&&x&&(u.Hl(l),l.la=x.la);break;default:w++}l=this.ib[this.ib.length-1];null!==u||l instanceof ge||(u=l)}this.origin=c||new J(0,0);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;this.hc=Ac(this.ba.dashes||"",0,this.ba.lineWidth||0);c=this.hc.length?a.$l:a.mz;this.Af=this.Fi(!1);this.xe=this.Af.mh(c);
h=0+this.ia("shapeWidth");0<h&&(this.xe=this.hB(this.xe,h));this.rect=this.Fi(!0).mh(c).cq(c);h=this.rect.width-2*(this.ba.lineWidth/2+1);k=this.ba.lineWidth;l=this.xe.clone();l.transform(this.lc());this.xa=l.cq(c);this.rect.dd(k);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);""!==this.ba.text&&(this.Sc.setProperty("textAlign",this.ba.textAlign||"center"),this.Sc.setProperty("textIndent",this.ba.textIndent||
""),this.Sc.setProperty("verticalAlign",this.ba.verticalAlign||"middle"),this.Sc.Qo(this.xe.fe()),this.Sc.setProperty("baseWidth",h),this.Sc.format(b));this.Vy=0===q.Wf(this.ba.fillStyle).values[3]&&!this.backgroundImage&&!this.ba.spotHighlight;this.Lv("fill",b,d,this.ba.fillStyle);this.Cc.length=0;0<this.ba.cloudRadius?this.Cc.push(new nd(this)):0<this.ba.waveRadius?this.Cc.push(new re(this)):this.ba.doubleLine?this.Cc.push(new ze(this)):this.ba.roughness&&this.Cc.push(new we(this));(this.ba.arrowSize||
this.ba.arrowSize1)&&this.Cc.push(new se(this));for(w=0;w<this.Cc.length;w++)this.Cc[w].format(b);(b=this.ia("backgroundImage"))&&null===this.backgroundImage&&d.eg(this.id,b,function(a){e.backgroundImage=a;d.Bf(e.id)});b=/url\(([^\)]+)\)/.exec(this.ia("strokeStyle"));var C;b&&(C=b[1]);!C||null!==this.lh&&ye(this.lh.src,C)?!C&&this.lh&&(this.lh=null):d.eg(this.id,C,function(a){e.lh=a;d.Bf(e.id)})};a.prototype.Mk=function(){var a=c.prototype.Mk.call(this);a.dd(-(this.ia("lineWidth")||0));return a};
a.prototype.jw=function(){var a=this.rect.clone();a.dd(1);return a};a.prototype.wn=function(){return this.xe};a.prototype.close=function(){this.ba.commands.push(a.Kd)};a.prototype.yA=function(){var a=this.ib[this.ib.length-1];a&&8>=gc(a.la.x,a.la.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.hB=function(a,d){this.log("ConvertToRects: width=%s",d);var b=0;a=a.ga;for(var c=0,h=0,k,l,n=new vc;b<a.length;){this.log("cmd %s %s %s",a[b],a[b+1],a[b+2]);switch(a[b]){case vc.Wc:c=a[b+1];h=a[b+
2];break;case vc.Ld:k=a[b+1];l=a[b+2];this.log("(%s,%s-%s,%s)",c,h,k,l);if(0<gc(c,h,k,l)){var r=hc(c,h,k,l),u=r.y*d/2;r=-r.x*d/2;n.moveTo(c+u,h+r);n.lineTo(k+u,l+r);n.lineTo(k-u,l-r);n.lineTo(c-u,h-r);n.closePath()}c=k;h=l}b+=vc.Md[a[b]]}return n};a.prototype.clip=function(a){if(this.ba.closed){var b=new vc;this.log("Clipping to a path");for(var c=0;c<this.ib.length;c++)this.ib[c].ka(b);b.closePath();0>b.Ei()&&(b=b.KF());b.ka(a)}};a.prototype.ka=function(a){this.ba.spotHighlight?this.log("Not drawing node %s due to spothighlight",
this.id):c.prototype.ka.call(this,a)};a.prototype.zg=function(a){var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Ha,b.Ia);a.beginPath();a.lineCap="round";b=!0;var c=!1,f;for(f=0;f<this.Cc.length;f++)this.Cc[f].xl&&(b=!1),this.Cc[f].YB&&(c=!0,b=!1);this.lh&&(b=!1);if(b)for(f=0;f<this.ib.length;f++)this.ib[f].ka(a);for(f=0;f<this.Cc.length;f++)this.Cc[f].$E||this.Cc[f].ka(a);if(this.ba.closed){a.closePath();if(this.backgroundImage){a.fillStyle=a.createPattern(this.backgroundImage,
"no-repeat")||"magenta";f=Math.max(this.rect.width/this.backgroundImage.naturalWidth,this.rect.height/this.backgroundImage.naturalHeight);var h=this.rect.width-this.backgroundImage.naturalWidth*f,k=this.rect.height-this.backgroundImage.naturalHeight*f;a.translate(this.rect.x+h/2,this.rect.y+k/2);a.scale(f,f);a.fill();a.scale(1/f,1/f);a.translate(-this.rect.x-h/2,-this.rect.y-k/2)}else c||(a.fillStyle=this.hr("fill"),a.fill());a.shadowColor=q.he}b&&(this.hc.length&&0<this.ba.lineWidth?(a.beginPath(),
this.xe.Vm(a,this.hc),a.lineCap="butt"):0<0+this.ia("shapeWidth")&&(a.beginPath(),this.xe.ka(a)));if(this.lh)for(b=this.xe.fe(),c=this.lh,f=0;f<b.length;f++){k=b[f];if(2>k.length)break;h=0;k=Lc(k);var l=k.next();if(l.done)break;for(var n=l.value.pj,r=c.width;!l.done;){l=k.next(r);if(l.done)break;var u=l.value.pj,x=l.value.length,w=h%c.width;h+=x;r-=x;0>=r&&(r+=c.width);var y=Math.atan2(u.y-n.y,u.x-n.x);a.save();a.translate(n.x,n.y);a.rotate(y);a.translate(0,-c.height/2);a.drawImage(c,w,0,x,c.height,
0,0,x,c.height);a.restore();n=u}}else 0<this.ba.lineWidth&&!c&&a.stroke();for(f=0;f<this.Cc.length;f++)this.Cc[f].$E&&this.Cc[f].ka(a);""!==this.ba.text&&this.Sc.ka(a);a.restore()};a.prototype.Db=function(a,d,c,f){if(this.hidden()||this.ia("locked"))return null;var b=this.request&&this.request.Zb("selectTransparent");c=Math.max(12/f+this.ba.shapeWidth/2+this.ba.lineWidth/2,c);if(a>=this.rect.x-c&&a<this.rect.x+c+this.rect.width&&d>=this.rect.y-c&&d<this.rect.y+c+this.rect.height)if(!this.ba.closed||
this.Vy&&!b){if(this.xe.Kx(a,d,c)||""!==this.ba.text&&this.Sc.Db(a,d,c,f))return this}else if(this.xe.lF(a,d,c))return this;return null};a.prototype.Fi=function(a){var b=new vc,c;for(c=0;c<this.ib.length;c++)this.ib[c].ka(b);(0<this.ba.arrowSize||0<this.ba.arrowSize1)&&a&&(new se(this)).RB(b);this.ba.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var c=this.ba.commands;c.push(a.Fe);c.push(b);c.push(d)};a.prototype.jk=function(b,d){var c=this.ba.commands;c.push(a.vi);c.push(b);c.push(d)};
a.prototype.Zf=function(){return!1!==this.ba.editable&&!0!==this.ba.lockEditMode&&!this.ba.sides};a.prototype.bt=function(){var b=this.ba.commands;return 6===b.length&&(b[3]===a.Fe||b[3]===a.vi)};a.prototype.bg=function(a,d,c){if(a>=this.origin.x-c&&a<this.origin.x+c&&d>=this.origin.y-c&&d<this.origin.y+c)return 0;for(var b=0;b<this.ib.length;b++){var e=this.ib[b];if(!(e instanceof he||e instanceof ie))if(e.control){if(a>=e.control.x-c&&a<e.control.x+c&&d>=e.control.y-c&&d<e.control.y+c)return 3*
b+1}else if(e.kb){if(a>=e.kb.x-c&&a<e.kb.x+c&&d>=e.kb.y-c&&d<e.kb.y+c)return 3*b+1;if(e.Za&&a>=e.Za.x-c&&a<e.Za.x+c&&d>=e.Za.y-c&&d<e.Za.y+c)return 3*b+2}}for(b=0;b<this.ib.length;b++)if(a>=this.ib[b].la.x-c&&a<this.ib[b].la.x+c&&d>=this.ib[b].la.y-c&&d<this.ib[b].la.y+c)return 3*b;return null};a.prototype.qn=function(b){var d=this.ba.commands;b/=3;var c=0,f=!1,h=0,k;for(k=0;k<d.length;){var l=d[k];if(l===a.Kd){f=!0;break}h+=1;k+=a.rb[d[k]]+1}0===b&&f&&(b=h-1);for(k=0;k<d.length;c++){f=null;switch(d[k]){case a.rh:f=
"move_to";break;case a.Fe:f="line_to";break;case a.th:f="quadratic_to"}if(b===c)return f;k+=a.rb[d[k]]+1}return null};a.Hz=function(b,d,c){if("number"!==typeof d)return null;d/=3;var e=0,h=[],k=new J(0,0),l=!1,n=0,r;for(r=0;r<b.length;){var u=b[r];if(u===a.Kd){l=!0;break}n+=1;r+=a.rb[b[r]]+1}0===d&&l&&(d=n-1);for(r=0;r<b.length;e++){u=b[r];l=!1;d===e&&(u===a.th&&"line_to"===c?(h.push(a.Fe,b[r+1],b[r+2]),l=!0):u===a.Fe&&"quadratic_to"===c&&(h.push(a.th,b[r+1],b[r+2],(k.x+b[r+1])/2,(k.y+b[r+2])/2),
l=!0));k=new J(b[r+1],b[r+2]);if(!l)for(u=0;u<1+a.rb[b[r]];u++)h.push(b[r+u]);r+=a.rb[b[r]]+1}return h};a.prototype.Fw=function(){return!0};a.prototype.sk=function(a,d,c){function b(b,d,c){a.beginPath();a.rect(b-e,d-e,2*e,2*e);a.fillStyle=c?"#0050B7":"#FFFFFFC0";a.fill();a.stroke()}a.save();a.lineWidth=1*d;a.lineWidth=2;a.shadowBlur=3*d;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="rgba(0,0,0,0.2)";a.strokeStyle="#ccc";a.globalCompositeOperation="difference";a.strokeStyle="#fff";var e=6*d;b(this.origin.x,
this.origin.y,0===c);for(d=1;d<this.ib.length;d++){var k=this.ib[d];a.beginPath();if(k.control)a.arc(k.control.x,k.control.y,e,0,2*Math.PI),a.arc(k.control.x,k.control.y,2*e,0,2*Math.PI),c===3*d+1?a.fill():a.stroke();else if(k instanceof me||k instanceof ne){var l=k.kb;var n=k.Za;var r=k.Ca.la;l&&(a.moveTo(r.x,r.y),a.lineTo(l.x,l.y),a.moveTo(l.x+e,l.y),a.arc(l.x,l.y,e,0,2*Math.PI),c===3*d+1?a.fill():a.stroke());a.beginPath();a.moveTo(k.la.x,k.la.y);a.lineTo(n.x,n.y);a.moveTo(n.x+e,n.y);a.arc(n.x,
n.y,e,0,2*Math.PI);c===3*d+2?a.fill():a.stroke()}b(this.ib[d].la.x,this.ib[d].la.y,c===3*d)}a.restore()};a.prototype.$v=function(a,d,c){var b=this.Pa(),e=b.inverse().apply(a,d);var k=this.ba.commands;var l=e.x;e=e.y;for(var n=0,r=0,u=0,x=0,w=0,y=0,z=-1,A=new J(l,e);n<k.length;){var G=k[n];switch(G){case O.rh:case O.th:case O.Yl:case O.De:case O.vi:case O.am:case O.Bp:r=k[n+1];u=k[n+2];break;case O.Fe:var I=k[n+1],C=k[n+2],M=I-r,H=C-u,V=((l-r)*M+(e-u)*H)/(M*M+H*H);1<V?V=1:0>V&&(V=0);r=new J(r+V*M,
u+V*H);u=r.ic(A);if(u<x||-1===z)x=u,w=r.x,y=r.y,z=n;r=I;u=C}n+=O.rb[G]+1}k=-1===z?null:{x:w,y:y,index:z};if(!k)return null;b=b.apply(k.x,k.y);return gc(b.x,b.y,a,d)<=c?new Ae(k.x,k.y,k.index):null};a.prototype.Bw=function(b){var d=this.ba.commands.slice(0);d.splice(b.index,0,a.Fe,b.x,b.y);return{commands:d}};a.prototype.Ej=function(a){this.Sc.Ej(a)};a.pz=function(a){var b=new P,c=0;for(a=a.ga;c<a.length;){switch(a[c]){case vc.Wc:b.moveTo(a[c+1],a[c+2]);break;case vc.Ld:b.lineTo(a[c+1],a[c+2]);break;
case vc.vg:b.bezierCurveTo(a[c+1],a[c+2],a[c+3],a[c+4],a[c+5],a[c+6]);break;case vc.xg:b.quadraticCurveTo(a[c+1],a[c+2],a[c+3],a[c+4]);break;case vc.Kd:b.close()}c+=vc.Md[a[c]]}return b.Jc()};a.sa={strokeStyle:q.Oa,fillStyle:q.Od,fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1,roughness:0};a.mz=8;a.$l=2;a.rh=0;a.Fe=1;a.th=2;a.Yl=3;a.De=4;a.vi=
5;a.am=6;a.Kd=7;a.Bp=8;a.tp=9;a.fI=.5522847498;a.rb=[];return a}(pd);O.rb[O.rh]=2;O.rb[O.Fe]=2;O.rb[O.th]=4;O.rb[O.Yl]=5;O.rb[O.De]=6;O.rb[O.vi]=2;O.rb[O.am]=4;O.rb[O.Kd]=0;O.rb[O.Bp]=6;O.rb[O.tp]=8;
var P=function(){function c(a){void 0===a&&(a=[]);this.ga=a}c.prototype.beginPath=function(){};c.prototype.Dg=function(a,b,d){for(var c=0,f=0;f<a;f++)c+=O.rb[this.ga[c]]+1;this.ga[c+1]=b;this.ga[c+2]=d};c.prototype.moveTo=function(a,b){this.ga.push(O.rh);this.ga.push(a);this.ga.push(b)};c.prototype.lineTo=function(a,b){this.ga.push(O.Fe);this.ga.push(a);this.ga.push(b)};c.prototype.jk=function(a,b){this.ga.push(O.vi);this.ga.push(a);this.ga.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,c){this.ga.push(O.th);
this.ga.push(d);this.ga.push(c);this.ga.push(a);this.ga.push(b)};c.prototype.Bh=function(a,b,d,c){this.ga.push(O.am);this.ga.push(d);this.ga.push(c);this.ga.push(a);this.ga.push(b)};c.prototype.bezierCurveTo=function(a,b,d,c,f,h){this.ga.push(O.De);this.ga.push(f);this.ga.push(h);this.ga.push(a);this.ga.push(b);this.ga.push(d);this.ga.push(c)};c.prototype.arc=function(a,b,d,c,f,h){void 0===h&&(h=!0);var e=(new kc(-f,a,b)).apply(a+d,b);this.ga.push(O.tp);this.ga.push(e.x);this.ga.push(e.y);this.ga.push(a);
this.ga.push(b);this.ga.push(d);this.ga.push(c);this.ga.push(f);this.ga.push(h?1:0)};c.prototype.arcTo=function(a,b,d,c,f){this.ga.push(O.Yl);this.ga.push(d);this.ga.push(c);this.ga.push(a);this.ga.push(b);this.ga.push(f)};c.prototype.Uv=function(){for(var a=[],b=0;b<this.ga.length;){for(var d=this.ga[b],c=0;c<O.rb[d];c+=2)a.push(new J(this.ga[b+1+c],this.ga[b+1+c+1]));b+=O.rb[d]+1}a=K.Ee(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.wH=function(a,b){for(var d=0;d<this.ga.length;){for(var c=
this.ga[d],f=0;f<O.rb[c];f+=2)this.ga[d+1+f]+=a,this.ga[d+2+f]+=b;d+=O.rb[c]+1}};c.prototype.translate=function(){throw Error("Not implemented: translate");};c.prototype.scale=function(){throw Error("Not implemented: scale");};c.prototype.rotate=function(){throw Error("Not implemented: rotate");};c.prototype.closePath=function(){this.ga.push(O.Kd)};c.prototype.close=function(){this.closePath()};c.prototype.Jc=function(){return this.ga};return c}();P.prototype.change=P.prototype.Dg;
P.prototype.moveTo=P.prototype.moveTo;P.prototype.lineTo=P.prototype.lineTo;P.prototype.curveTo=P.prototype.jk;P.prototype.quadraticCurveTo=P.prototype.quadraticCurveTo;P.prototype.cornerTo=P.prototype.Bh;P.prototype.bezierCurveTo=P.prototype.bezierCurveTo;P.prototype.arc=P.prototype.arc;P.prototype.arcTo=P.prototype.arcTo;P.prototype.getBoundingBox=P.prototype.Uv;P.prototype.translateAll=P.prototype.wH;P.prototype.closePath=P.prototype.closePath;P.prototype.close=P.prototype.close;
P.prototype.toArray=P.prototype.Jc;function Be(){var c=new J(0,0),a=new P;a.moveTo(c.x,c.y-50);a.Bh(c.x+50,c.y-50,c.x+50,c.y);a.Bh(c.x+50,c.y+50,c.x,c.y+50);a.Bh(c.x-50,c.y+50,c.x-50,c.y);a.Bh(c.x-50,c.y-50,c.x,c.y-50);a.closePath();return a.Jc()}pd.Pd("PathNode",O);var Ae=function(){function c(a,b,d){this.x=a;this.y=b;this.index=d}c.prototype.getCursor=function(){return"cell"};return c}();P.prototype.beginPath=P.prototype.beginPath;P.prototype.change=P.prototype.Dg;P.prototype.moveTo=P.prototype.moveTo;
P.prototype.lineTo=P.prototype.lineTo;P.prototype.curveTo=P.prototype.jk;P.prototype.quadraticTo=P.prototype.JI;P.prototype.cornerTo=P.prototype.Bh;P.prototype.bezierTo=P.prototype.oI;P.prototype.arc=P.prototype.arc;P.prototype.arcTo=P.prototype.arcTo;P.prototype.getBoundingBox=P.prototype.Uv;P.prototype.translate=P.prototype.translate;P.prototype.closePath=P.prototype.closePath;P.prototype.close=P.prototype.close;P.prototype.toArray=P.prototype.Jc;var ze=function(){function c(a){this.Gb=a;this.pg=0;this.xl=!0;this.Jn=!1;this.path=new vc;this.Bo=new vc;this.log=v.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.Gb.ia("doubleLine"));var a=this.Gb.Fi(!1).mh(O.$l),b=this.Gb.DC();if(0<b){var d=a.Pu();d>b&&(a=a.NA(d-b))}a=a.fe();b=this.Gb.ia("doubleLine");this.path=new vc;this.Bo=new vc;d=this.Gb.ia("doubleLineDashSide");this.Jn=!1;"outer"===d?(Hc(this.path,a,b,!0,!1),Hc(this.Bo,a,b,!1,!0),
this.Jn=!0):"inner"===d?(Hc(this.path,a,b,!1,!0),Hc(this.Bo,a,b,!0,!1),this.Jn=!0):Hc(this.path,a,b,!0,!0)};c.prototype.ka=function(a){a.beginPath();this.Gb.hc.length&&this.Jn?(this.Bo.Vm(a,this.Gb.hc),this.path.ka(a)):this.Gb.hc.length?this.path.Vm(a,this.Gb.hc):this.path.ka(a)};return c}();var Ce=[],De=0;
function Ee(c,a){function b(){}function d(){var a=k.offsetWidth,b=k.offsetHeight,d=B.Fn();B(k).Aj({left:d.left+d.width/2-a/2,top:d.top+d.height/2-b/2})}function e(a){a.target instanceof Element&&(k===a.target||k.contains(a.target))||0===Ce.length||Ce[Ce.length-1]!==n||A.hide()}function f(a){Fe(a.target)||y&&"outside"!==y&&"none"!==y&&setTimeout(function(){A.hide()},0)}function h(){G&&clearTimeout(G);G=setTimeout(function(){G=0;b()},1)}void 0===a&&(a={});var k=B.Fc(c);if(!k)throw Error("Zwibbler.Dialog: Bad element passed in: "+c);
c=a.overlay||"transparent";var l=null===k.parentNode,n=De++;"static"===B(k).pf("position")&&(k.style.position="absolute");var r=B(k).pf("display");"none"===r&&(r="block");k.style.display="none";var u=new bb(c);u.insertBefore=k;var x=a.showNear||null,w=a.showHow||"",y=!1,z=!1,A={hide:function(){u.ag();k.style.display="none";if(A.onhide)A.onhide();window.removeEventListener("resize",d);for(var a=0;a<Ce.length;a++)n===Ce[a]&&Ce.splice(a,1)},isShown:function(){return"none"!==B(k).pf("display")&&null!==
k.parentElement},show:function(a,c,f){void 0===f&&(f=!1);var h=0,l=0,z="",C="",M;k.style.display=r;k.style.visibility="hidden";b=function(b){"number"===typeof a&&"number"===typeof c?(h=a,l=c,M=!0):(z=a||x,C=c||w,M=!1);var e=B.Yv()+1;k.style.zIndex=e.toString();u.zIndex=e;k.parentNode||(document.fullscreenElement?document.fullscreenElement.appendChild(k):document.body.appendChild(k));if(M)k.style.position="absolute",setTimeout(function(){var a=k.offsetWidth,b=k.offsetHeight,d=B.Fn(),c={left:h,top:l};
c.left=Math.min(c.left,d.left+d.width-a-2);c.top=Math.min(c.top,d.top+d.height-b-3);B(k).Aj(c);k.style.visibility="visible";if(A.onshow)A.onshow()},0);else if(z&&C)if(b=B.Fc(z)){var f=B(b).wb();setTimeout(function(){k.style.visibility="visible";var a=k,b=C,d={left:f.left,top:f.top};a.style.left="0";a.style.top="0";a.style.position="absolute";var c=b.toLowerCase().split(" ");2!==c.length&&(c=["tl","tl"]);0<=c[0].indexOf("b")&&(d.top+=f.height);0<=c[0].indexOf("r")&&(d.left+=f.width);0<=c[0].indexOf("m")&&
(d.top+=f.height/2);0<=c[0].indexOf("c")&&(d.left+=f.width/2);b=B(a).Ti();0<=c[1].indexOf("b")&&(d.top-=a.offsetHeight+b.top+b.bottom);0<=c[1].indexOf("r")&&(d.left-=a.offsetWidth+b.left+b.right);0<=c[1].indexOf("c")&&(d.left-=(a.offsetWidth+b.left+b.right)/2);0<=c[1].indexOf("m")&&(d.top-=(a.offsetHeight+b.left+b.right)/2);d.left+=b.left;d.top+=b.top;c=B.Fn();var e=a.offsetHeight+b.top+b.bottom;d.left=Math.min(d.left,c.left+c.width-(a.offsetWidth+b.left+b.right));d.top=Math.min(d.top,c.top+c.height-
e);d.left=Math.max(d.left,0);d.top=Math.max(d.top,0);B(a).Aj(d);if(A.onshow)A.onshow()},0)}else{if(A.onshow)A.onshow()}else b?(window.addEventListener("resize",d),k.style.position="absolute",setTimeout(function(){k.style.visibility="visible";d();if(A.onshow)A.onshow()},0)):d()};b(!0);var ea=k.querySelector("[z-focus]");ea&&setTimeout(function(){ea.focus()},0);y=f;"none"!==y&&Ce.push(n);"outside"===y||"inside"===y?document.body.addEventListener("pointerdown",e,!0):"none"!==y&&u.show(function(){A.hide()})},
destroy:function(){z||(z=!0,A.isShown()&&A.hide(),u.ag(),window.removeEventListener("resize",d),k.removeEventListener("click",f),k.removeEventListener("load",h,!0),document.body.removeEventListener("pointerdown",e,!0),l&&B(k).remove())},onshow:a.onshow||function(){},onhide:a.onhide||function(){}};k.addEventListener("click",f);var G=0;k.addEventListener("load",h,!0);return A}
function Fe(c){return c instanceof HTMLElement&&(!(c instanceof HTMLElement&&"BUTTON"===c.tagName)&&B.dg(c)||c.matches("[z-no-dismiss], [z-no-dismiss] *"))};var Ge=v.create("FitCurve");
function He(c,a){function b(a){I.bezierCurveTo(a[1].x,a[1].y,a[2].x,a[2].y,a[3].x,a[3].y);Ge("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",a[0].x,a[0].y,a[1].x,a[1].y,a[2].x,a[2].y,a[3].x,a[3].y)}function d(a,b){return a.x*b.x+a.y*b.y}function e(a){var b=1-a;return 3*a*b*b}function f(a){return 3*a*a*(1-a)}function h(a,b){var d=a.x-b.x;a=a.y-b.y;return Math.sqrt(d*d+a*a)}function k(a){return a.x*a.x+a.y*a.y}function l(a,b){var d=Math.sqrt(k(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function n(a,b,d){void 0===
d&&Ge("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function r(a,b){return{x:a.x+b.x,y:a.y+b.y}}function u(a,b){return{x:a.x*b,y:a.y*b}}function x(a,b){return{x:a.x-b.x,y:a.y-b.y}}function w(a,b,c,k,w,y){var z,A=[],C=[[],[]],G=[];var M=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var I=c-b+1;for(z=0;z<I;z++){var H={x:w.x,y:w.y};var V={x:y.x,y:y.y};l(H,e(k[z]));l(V,f(k[z]));A[z]=[H,V]}C[0][0]=0;C[0][1]=0;C[1][0]=0;C[1][1]=0;G[0]=0;for(z=G[1]=0;z<I;z++)C[0][0]+=d(A[z][0],A[z][0]),C[0][1]+=d(A[z][0],A[z][1]),
C[1][0]=C[0][1],C[1][1]+=d(A[z][1],A[z][1]),H=1-k[z],V=k[z],H=x(a[b+z],r(u(a[b],H*H*H),r(u(a[b],e(k[z])),r(u(a[c],f(k[z])),u(a[c],V*V*V))))),G[0]+=d(A[z][0],H),G[1]+=d(A[z][1],H);k=C[0][0]*C[1][1]-C[1][0]*C[0][1];z=C[0][0]*G[1]-C[0][1]*G[0];G=G[0]*C[1][1]-G[1]*C[0][1];0===k&&(k=C[0][0]*C[1][1]*1E-11);C=G/k;G=z/k;if(0>C||0>G)return C=h(a[c],a[b])/3,M[0]=a[b],M[3]=a[c],n(M[0],l(w,C),M[1]),n(M[3],l(y,C),M[2]),M;M[0]=a[b];M[3]=a[c];n(M[0],l(w,C),M[1]);n(M[3],l(y,G),M[2]);return M}function y(a,b,d){var c;
var e=[];for(c=0;c<=a;c++)e[c]={x:b[c].x,y:b[c].y};for(c=1;c<=a;c++)for(b=0;b<=a-c;b++)e[b].x=(1-d)*e[b].x+d*e[b+1].x,e[b].y=(1-d)*e[b].y+d*e[b+1].y;return e[0]}function z(a){var b=Math.sqrt(Math.sqrt(k(a)));0!==b&&(a.x/=b,a.y/=b);return a}function A(a,b,d,c,e){var f,h=(d-b+1)/2;var l=0;for(f=b+1;f<d;f++){var n=y(3,c,e[f-b]);n=x(n,a[f]);n=k(n);n>=l&&(l=n,h=f)}return{ex:l,My:h}}function G(d,c,e,f,k,u){var r;var ea=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var C=u*u;if(2===e-c+1)u=h(d[e],d[c])/3,ea[0]=
d[c],ea[3]=d[e],n(ea[0],l(f,u),ea[1]),n(ea[3],l(k,u),ea[2]),b(ea);else{var I=[0];for(r=c+1;r<=e;r++)I[r-c]=I[r-c-1]+h(d[r],d[r-1]);for(r=c+1;r<=e;r++)I[r-c]/=I[e-c];var M=I;ea=w(d,c,e,M,f,k);r=A(d,c,e,ea,M);I=r.ex;r=r.My;if(I<u)b(ea);else{if(I<C||a)for(C=0;4>C;C++){r=d;I=c;var H=e;var V=ea;var ya=[];for(ea=I;ea<=H;ea++){var xa=ya,ri=ea-I,da,Nb=V,nc=r[ea],oc=M[ea-I],ib=[];var tb=[];var pc=y(3,Nb,oc);for(da=0;2>=da;da++)ib[da]={x:0,y:0},ib[da].x=3*(Nb[da+1].x-Nb[da].x),ib[da].y=3*(Nb[da+1].y-Nb[da].y);
for(da=0;1>=da;da++)tb[da]={x:0,y:0},tb[da].x=2*(ib[da+1].x-ib[da].x),tb[da].y=2*(ib[da+1].y-ib[da].y);da=y(2,ib,oc);tb=y(1,tb,oc);xa[ri]=oc-((pc.x-nc.x)*da.x+(pc.y-nc.y)*da.y)/(da.x*da.x+da.y*da.y+(pc.x-nc.x)*tb.x+(pc.y-nc.y)*tb.y)}H=ya;ea=w(d,c,e,H,f,k);r=A(d,c,e,ea,H);I=r.ex;r=r.My;if(I<u||a){b(ea);return}M=H}H={x:0,y:0};C=x(d[r-1],d[r]);I=x(d[r],d[r+1]);H.x=(C.x+I.x)/2;H.y=(C.y+I.y)/2;C=H=z(H);G(d,c,r,f,C,u);C.x=-C.x;C.y=-C.y;G(d,r,e,C,k,u)}}}void 0===a&&(a=!1);var I=new vc;I.moveTo(c[0].x,c[0].y);
(function(a,b,d){var c=x(a[1],a[0]);c=z(c);var e=b-1;e=x(a[e-1],a[e]);e=z(e);G(a,0,b-1,c,e,d)})(c,c.length,25);return I};function Ie(c,a,b,d,e,f,h,k){var l=!1;c.save();switch(b){case 0:case 3:var n=a.height;var r=a.width;break;default:n=a.width,r=a.height}switch(b){case 2:l=!0}c.translate(a.x,a.y);c.fillStyle=h;c.fillRect(0,0,a.width,a.height);c.lineWidth=1;c.fillStyle=k;c.strokeStyle=k;c.font="10px sans-serif";a=Math.ceil(50/e);b=f/e;f=h=Math.ceil(b/a)*a;c.beginPath();if(l)for(b=(h-b)*e;b<r;)c.moveTo(0,b),c.lineTo(n,b),l=f.toString()+d,c.fillText(l,0,b+1+10),f+=a,b+=e*a;else for(b=(h-b)*e;b<r;)c.moveTo(b,n),c.lineTo(b,
0),l=f.toString()+d,c.fillText(l,b+1,10),f+=a,b+=e*a;c.stroke();c.restore()};function Je(c){switch(c){case 33:return"n-resize";case 34:return"e-resize";case 36:return"s-resize";case 40:return"w-resize";case 25:return"nw-resize";case 19:return"ne-resize";case 28:return"sw-resize";case 22:return"se-resize";case 1:case 4:case 8:case 2:case 64:return"move"}return"default"}function Ke(c,a,b){return{id:c,mb:2,x:a.x+a.width,Uc:a.y,Vc:a.y+a.height,order:b}}function Le(c,a,b){return{id:c,mb:4,x:a.y+a.height,Uc:a.x,Vc:a.x+a.width,order:b}}
var Me=function(){function c(){this.Rh=[];this.Qj=[];this.zs=[];this.order=0}c.prototype.clear=function(){this.Rh.length=0;this.Qj.length=0;this.order=this.zs.length=0};c.prototype.zu=function(a,b){this.zs.push({id:b,rect:a,order:this.order++});this.Rh.push({id:b,mb:1,x:a.y,Uc:a.x,Vc:a.x+a.width,order:this.order});this.Rh.push(Le(b,a,this.order));this.Qj.push({id:b,mb:8,x:a.x,Uc:a.y,Vc:a.y+a.height,order:this.order});this.Qj.push(Ke(b,a,this.order));this.order++};c.prototype.YG=function(a,b){var d=
8;void 0===d&&(d=10);var c=this.Bm(this.Qj,{id:b,mb:8,x:a.x,Uc:a.y,Vc:a.y+a.height,order:0},Number.MAX_VALUE);c=this.Bm(this.Qj,Ke(b,a,0),c);var f=this.Bm(this.Rh,{id:b,mb:1,x:a.y,Uc:a.x,Vc:a.x+a.width,order:0},Number.MAX_VALUE);f=this.Bm(this.Rh,Le(b,a,0),f);return{x:Math.abs(c)<d?c:0,y:Math.abs(f)<d?f:0}};c.prototype.ur=function(a,b){var d=10;void 0===d&&(d=10);var c=[];this.Sy(c,this.Qj,a,b,d);this.Sy(c,this.Rh,b,a,d);d=0;for(var f=this.zs;d<f.length;d++){var h=f[d];h.rect.Xc(a,b)&&c.push({mb:64,
id:h.id,order:h.order})}c.sort(function(a,b){return b.order-a.order});return c};c.prototype.Sy=function(a,b,d,c,f){for(var e=f*f,k=0;k<b.length;k++){var l=b[k],n=Math.abs(d-l.x),r=Number.MAX_VALUE,u=0;if(!(n>f||c<l.Uc-f||c>l.Vc+f)){if(c>l.Uc+f&&c<l.Vc-f){var x=n*n;x<r&&(r=x,u=l.mb)}x=.5*(l.Uc+l.Vc);x=n*n+(c-x)*(c-x);x<e&&(r=x,u=l.mb|32);b===this.Rh&&(x=n*n+(c-l.Uc)*(c-l.Uc),x<r&&(r=x,u=l.mb|24),x=n*n+(c-l.Vc)*(c-l.Vc),x<r&&(r=x,u=l.mb|18));r<e&&a.push({id:l.id,mb:u,order:l.order})}}};c.prototype.Bm=
function(a,b,d){for(var c=0;c<a.length;c++){var f=a[c],h=f.x-b.x;Math.abs(h)>Math.abs(d)||b.id===f.id||50>(b.Vc<f.Uc?f.Uc-b.Vc:b.Uc>f.Vc?b.Uc-f.Vc:0)&&(d=h)}return d};return c}();var Ne=function(){function c(a,b){void 0===b&&(b="repeat");this.Ma=a;this.repeat=b}c.prototype.loaded=function(){return this.Ma instanceof HTMLImageElement?this.Ma.complete:!0};c.prototype.setTransform=function(){};return c}(),Oe=function(){function c(a,b,d,c){this.cH=[];this.from=new J(a,b);this.la=new J(d,c)}c.prototype.addColorStop=function(a,b){this.cH.push({offset:a,td:b})};return c}(),Qe=function(){function c(){this.stack=[];this.qa=new L;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.lineDashOffset=0;this.miterLimit=10;this.strokeStyle=this.fillStyle=q.Oa;this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)";this.hc=[]}c.prototype.save=function(){this.stack.push({qa:this.qa.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,lineDashOffset:this.lineDashOffset,miterLimit:this.miterLimit,
strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,zh:this.Ip(),hc:this.hc})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.qa=a.qa,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.lineDashOffset=
a.lineDashOffset,this.miterLimit=a.miterLimit,this.qa=a.qa,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor,this.Kp(a.zh),this.hc=a.hc)};c.prototype.drawImage=function(a,b,d,c,f,h,k,l,n){var e=a.width,u=a.height;a instanceof HTMLImageElement&&(e=a.naturalWidth,u=a.naturalHeight);
var x=0,w=0,y=e,z=u;void 0!==c&&void 0!==f&&void 0!==h&&void 0!==k&&void 0!==l&&void 0!==n?(x=b,w=d,y=c,z=f,b=h,d=k,e=l,u=n):void 0!==c&&void 0!==f&&(e=c,u=f);this.Fp(a,x,w,y,z,b,d,e,u)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,b,d,c,f,h){uc(this,a,b,d,c,f,h)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,c){var e=this.fm();this.rect(a,b,d,c);this.stroke();this.nm(e)};c.prototype.setTransform=function(a,b,d,c,f,h){this.qa=
new L(a,d,b,c,f,h)};c.prototype.Qg=function(){return this.qa.iH()};c.prototype.transform=function(a,b,d,c,f,h){a=new L(a,d,b,c,f,h);this.qa=this.qa.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};c.prototype.scale=function(a,b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,c){this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+c);this.lineTo(a,b+c);this.lineTo(a,
b);this.closePath()};c.prototype.fillRect=function(a,b,d,c){var e=this.fm();this.rect(a,b,d,c);this.fill();this.nm(e)};c.prototype.mm=function(a){return Pe(a)};c.prototype.createPattern=function(a,b){return new Ne(a,b)};c.prototype.createLinearGradient=function(a,b,d,c){return new Oe(a,b,d,c)};c.prototype.setLineDash=function(a){a.length&1&&(a=a.concat(a));this.hc=a};return c}(),Re=function(){function c(a){this.fontFamily="";this.fontSize=10;this.lineHeight=this.fontVariant=this.fontWeight=this.fontStyle=
"normal";a=Pe(a);this.fontFamily=a.fontFamily||"Arial";this.fontSize=parseFloat(a.fontSize);this.fontStyle=a.fontStyle;this.fontWeight=a.fontWeight;this.fontVariant=a.fontVariant;this.lineHeight=a.lineHeight}c.prototype.Hw=function(){return"italic"===this.fontStyle};c.prototype.Ew=function(){var a=parseFloat(this.fontWeight);return a&&700<=a?!0:"bold"===this.fontWeight};c.prototype.toString=function(){var a=this.fontSize+'px "'+this.fontFamily+'"';this.Ew()&&(a="bold "+a);this.Hw()&&(a="italic "+
a);return a};return c}();
function Pe(c){var a=null,b="10",d="normal",e="normal",f="normal",h="normal",k=!1;c=c.split(/\s+/);a:for(;;){var l=c.shift();if(!l)break;switch(l){case "normal":break;case "italic":case "oblique":d=l;break;case "small-caps":f=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":e=l;break;default:if(k){a=l;c.length&&(a+=" "+c.join(" "));2<a.length&&('"'===a.charAt(0)||"'"===a.charAt(0))&&(a=a.substr(1,a.length-
2));break a}else l=l.split("/"),b=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:d,fontVariant:f,fontWeight:e,fontSize:b,lineHeight:h,fontFamily:a}}
var Se=function(c){function a(a){var b=c.call(this)||this;b.ma=a;return b}__extends(a,c);a.prototype.beginPath=function(){this.ma.beginPath()};a.prototype.closePath=function(){this.ma.closePath()};a.prototype.fm=function(){this.ma.beginPath();return{}};a.prototype.nm=function(){};a.prototype.moveTo=function(a,d){a=this.qa.apply(a,d);this.ma.moveTo(a.x,a.y)};a.prototype.lineTo=function(a,d){a=this.qa.apply(a,d);this.ma.lineTo(a.x,a.y)};a.prototype.quadraticCurveTo=function(a,d,c,f){a=this.qa.apply(a,
d);c=this.qa.apply(c,f);this.ma.quadraticCurveTo(a.x,a.y,c.x,c.y)};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){a=this.qa.apply(a,d);c=this.qa.apply(c,f);h=this.qa.apply(h,k);this.ma.bezierCurveTo(a.x,a.y,c.x,c.y,h.x,h.y)};a.prototype.Fp=function(){};a.prototype.Ip=function(){return{}};a.prototype.Kp=function(){};a.prototype.clip=function(){};a.prototype.fill=function(){};a.prototype.fillText=function(){};a.prototype.measureText=function(a){return{width:10*a.length}};a.prototype.stroke=function(){};
a.prototype.strokeText=function(){};return a}(Qe);var Te=v.create("SvgFile"),af=function(){function c(){this.rect=new K(0,0,0,0);this.Tc=new K(0,0,0,0);this.Ou={};this.src="";this.ready=!1;this.qc=[];this.Bx=0;this.closed=!1}c.prototype.ql=function(a){return __awaiter(this,void 0,void 0,function(){var b,d=this;return __generator(this,function(c){switch(c.label){case 0:if(a===this.src&&this.ready)return[2];this.src=a;this.ready=!1;return[4,Xa({url:a,responseType:"document"})];case 1:b=c.sent();if(this.src!==a)throw Error("Aborted due to URL change");
Ue(b.responseXML.documentElement,function(a){return d.iF(a)});this.Bx=this.qc.length;this.ready=!0;return[2]}})})};c.prototype.Va=function(a){var b;this.qc.length=this.Bx;(b=this.qc).push.apply(b,Ve(a))};c.prototype.iF=function(a){if(a instanceof Element){switch(a.tagName.toUpperCase()){case "SVG":if(this.md)break;this.md=a;var b=a.getAttribute("viewBox"),d=!1;var c=!1;if(b){d=We(b);if(4!==d.length)throw Error("Invalid viewBox");this.Tc.x=d[0];this.Tc.y=d[1];this.Tc.width=d[2];this.Tc.height=d[3];
d=!0}b=Xe(a.getAttribute("width")||"");var f=Xe(a.getAttribute("height")||"");isNaN(b)||isNaN(f)||(this.rect.x=0,this.rect.y=0,this.rect.width=b,this.rect.height=f,c=!0);d&&!c?(this.rect.width=this.Tc.width,this.rect.height=this.Tc.height):!d&&c?(this.Tc.width=this.rect.width,this.Tc.height=this.rect.height):d||c||console.warn("Could not get dimensions of the SVG file. Add a viewBox attribute.");break;case "STYLE":(c=this.qc).push.apply(c,Ve(a.textContent));break;case "PATH":c=a.getAttribute("d")||
"";this.closed=this.closed||0<=c.indexOf("z")||0<=c.indexOf("Z");break;case "ELLIPSE":case "CIRCLE":case "RECT":this.closed=!0}(c=a.getAttribute("id"))&&(this.Ou[c]=a);return!0}};c.prototype.ka=function(a,b,d,c){function e(a,b){void 0===b&&(b={});var d=k.EC(a,b);switch(a.tagName.toUpperCase()){case "SVG":l.save();if(a!==k.md){b=parseFloat(a.getAttribute("x")||"0")||0;var c=parseFloat(a.getAttribute("y")||"0")||0,f=We(d.viewBox||"");b-=f[0]||0;c-=f[1]||0;l.translate(b,c);l.Zp();l.beginPath();l.rect(f[0]||
0,f[1]||0,f[2]||1,f[3]||1,0,0);l.clip()}for(b=a.firstElementChild;null!==b;b=b.nextElementSibling)e(b);l.restore();break;case "G":l.save();l.Va(d);for(b=a.firstElementChild;null!==b;b=b.nextElementSibling)e(b);l.restore();break;case "PATH":h(d,function(){d.d&&Ec(l,d.d)});break;case "CIRCLE":h(d,function(){var b=Ye(a,"cx cy r");l.arc(b.cx,b.cy,b.r,0,2*Math.PI,!1)});break;case "ELLIPSE":h(d,function(){var b=Ye(a,"cx cy rx ry");l.ellipse(b.cx,b.cy,b.rx,b.ry)});break;case "LINE":h(d,function(){var b=
Ye(a,"x1 y1 x2 y2");l.moveTo(b.x1,b.y1);l.lineTo(b.x2,b.y2)});break;case "RECT":h(d,function(){var b=Ye(a,"x y width height rx ry");a.hasAttribute("ry")?a.hasAttribute("rx")||(b.rx=b.ry):b.ry=b.rx;l.rect(b.x,b.y,b.width,b.height,b.rx,b.ry)});break;case "TEXT":h(d,function(){var b=Ye(a,"x y");l.text(a.textContent||"",b.x||0,b.y||0)});break;case "USE":(b=a.getAttribute("xlink:href")||a.getAttribute("href"))&&"#"===b[0]&&((c=k.Ou[b.substr(1)])?(l.save(),e(c,d),l.restore()):Ze("SVG file <use> references "+
b+" which is not found"));break;case "DEFS":break;default:Ze("Unsupported SVG element: "+a.tagName)}}function h(a,b){l.save();d||l.beginPath();l.Va(a);l.Zp();b();d||(l.fill(),l.stroke());l.restore()}var k=this;void 0===b&&(b=null);void 0===d&&(d=!1);void 0===c&&(c=new L);a.save();c=c.multiply(new lc(this.rect.width/this.Tc.width,this.rect.height/this.Tc.height));c=c.multiply(new jc(-this.Tc.x,-this.Tc.y));var l=new $e(a);l.Va({stroke:"none",fill:q.Oa,"stroke-width":"1","stroke-linejoin":"miter","stroke-miterlimit":"4",
transform:c.Ff()});l.Zp();l.beginPath();l.rect(this.Tc.x,this.Tc.y,this.Tc.width,this.Tc.height,0,0);l.clip();b&&l.Va(b);e(this.md);a.restore()};c.prototype.EC=function(a,b){var d={},c;for(c in b)d[c]=b[c];if(b=a.getAttribute("class"))for(var f=0,h=this.qc;f<h.length;f++)for(var k=h[f],l=0,n=k.XF.split(",");l<n.length;l++)if("."+b===n[l])for(c in k.Mu)d[c]=k.Mu[c];for(c=0;c<a.attributes.length;c++)d[a.attributes[c].name]=a.attributes[c].value;return d};return c}();
function bf(c){for(var a=new cf(c),b=new L,d=!0;;){if(a.match("translate")){var e={value:0},f={value:0},h=!1;a.match("(")&&a.ed(e)||(h=!0);h||!a.match(",")&&1;!h&&a.ed(f);if(h||!a.match(")"))throw Error("Can't parse "+c);b=b.multiply(new jc(e.value,f.value))}else if(a.match("rotate")){d={value:0};e={value:0};f={value:0};h=!1;a.match("(")&&a.ed(d)||(h=!0);h||(a.match(","),!1)||a.ed(e)&&(a.match(","),1)&&a.ed(f);if(h||!a.match(")"))throw Error("Can't parse "+c);b=b.multiply(new kc(-d.value/180*Math.PI,
e.value,f.value))}else if(a.match("matrix")){d={value:0};h={value:0};var k={value:0},l={value:0};e={value:0};f={value:0};if(!(a.match("(")&&a.ed(d)&&(a.match(","),1)&&a.ed(h)&&(a.match(","),1)&&a.ed(k)&&(a.match(","),1)&&a.ed(l)&&(a.match(","),1)&&a.ed(e)&&(a.match(","),1)&&a.ed(f)&&a.match(")")))throw Error("Can't parse "+c);b=b.multiply(new L(d.value,k.value,h.value,l.value,e.value,f.value))}else if(a.match("scale")){e={value:1};f={value:1};if(!a.match("(")||!a.ed(e))throw Error("Can't parse "+
c);a.match(",");a.ed(f)||(f.value=e.value);if(!a.match(")"))throw Error("Can't parse "+c+" at "+a.ay());b=b.multiply(new lc(e.value,f.value))}else if(a.match("skewX")){d={value:0};if(!a.match("(")||!a.ed(d)||!a.match(")"))throw Error("Can't parse "+c);b=b.multiply(new L(1,Math.tan(d.value/180*Math.PI),0,1,0,0))}else if(a.match("skewY")){d={value:0};if(!a.match("(")||!a.ed(d)||!a.match(")"))throw Error("Can't parse "+c);b=b.multiply(new L(1,0,Math.tan(d.value/180*Math.PI),1,0,0))}else{if(d)throw Error("Can't parse transform: "+
c+" at "+a.ay());break}d=!1}return b}function Xe(c){var a=1;switch(c.substr(c.length-2).toLowerCase()){case "mm":a=96/25.4;break;case "cm":a=96/2.54;break;case "in":a=96;break;case "pt":a=96/72;break;case "ex":a=8}return parseFloat(c)*a}function We(c){var a=[];c=c.replace(","," ");var b=0;for(c=c.split(" ");b<c.length;b++){var d=Xe(c[b]);isNaN(d)||a.push(d)}return a}function Ue(c,a){for(c=[c];c.length;){var b=c.pop();if(a(b))for(b=b.firstChild;null!==b;b=b.nextSibling)c.push(b)}}
function Ye(c,a){var b={},d=0;for(a=a.split(" ");d<a.length;d++){var e=a[d];b[e]=parseFloat(c.getAttribute(e)||"")||0}return b}function Ve(c){var a=[];for(c=new cf(c);;){for(var b={},d={value:""},e=c,f=d,h="";e.match(".");){h+=".";var k={value:""};if(!e.bx(k))break;h+=k.value;if(!e.match(","))break;h+=","}f.value=h;if(0<h.length&&c.match("{"))df(c,b),c.match("}"),a.push({XF:d.value,Mu:b});else break}return a}
function df(c,a){for(;;){var b={value:""},d={value:""},e=c.Ja;if(c.bx(b)&&c.match(":")&&c.wE(d))c.match(";"),a[b.value]=d.value;else{c.Ja=e;break}}}
var cf=function(){function c(a,b){void 0===b&&(b=0);this.input=a;this.Ja=b}c.prototype.ay=function(){return this.input.substr(this.Ja)};c.prototype.match=function(a){this.co();return this.Ja+a.length<=this.input.length&&this.input.substr(this.Ja,a.length)==a?(this.Ja+=a.length,!0):!1};c.prototype.co=function(){for(;this.Ja<this.input.length;this.Ja++){var a=this.input[this.Ja];if(" "!==a&&"\n"!==a&&"\r"!==a&&"\t"!==a)break}};c.prototype.ed=function(a){this.co();for(var b=this.Ja;this.Ja<this.input.length;this.Ja++){var d=
this.input[this.Ja];if(!("0"<=d&&"9">=d||"-"==d||"+"==d||"."==d||"e"==d||"E"==d))break}if(b==this.Ja)return!1;d=parseFloat(this.input.substr(b,this.Ja-b));if(isNaN(d))return this.Ja=b,!1;a.value=d;return!0};c.prototype.bx=function(a){this.co();for(var b=this.Ja;this.Ja<this.input.length;this.Ja++){var d=this.input[this.Ja];if(!("a"<=d&&"z">=d||"A"<=d&&"Z">=d||"-"==d||this.Ja>b&&"0"<=d&&"9">=d))break}return this.Ja>b?(a.value=this.input.substr(b,this.Ja-b),!0):!1};c.prototype.wE=function(a){this.co();
for(var b=this.Ja;this.Ja<this.input.length&&";"!==this.input[this.Ja];this.Ja++);a.value=this.input.substr(b,this.Ja-b).trim();return!0};return c}(),ef={};function Ze(c){c in ef||(ef[c]=!0,console.warn(c))}
var ff=function(){function c(a,b,d){void 0===a&&(a="normal");void 0===b&&(b="sans-serif");void 0===d&&(d="10px");this.weight=a;this.family=b;this.size=d}c.prototype.clone=function(){return new c(this.weight,this.family,this.size)};c.prototype.toString=function(){return this.weight+" "+this.size+" "+this.family};return c}(),$e=function(){function c(a){this.ma=a;this.gv=q.Oa;this.ab={$o:1,dn:1,en:"nonzero",opacity:1,qa:new L,font:new ff,np:"none"};this.jt=[];"string"===typeof a.fillStyle&&(this.gv=
a.fillStyle)}c.prototype.save=function(){this.jt.push(this.ab);this.ab={$o:this.ab.$o,dn:this.ab.dn,en:this.ab.en,opacity:this.ab.opacity,qa:this.ab.qa.clone(),font:this.ab.font.clone(),np:this.ab.np};this.ma.save()};c.prototype.clip=function(){this.ma.clip()};c.prototype.restore=function(){this.jt.length&&(this.ab=this.jt.pop());this.ma.restore()};c.prototype.translate=function(a,b){this.ab.qa=this.ab.qa.multiply(new jc(a,b))};c.prototype.scale=function(a,b){this.ab.qa=this.ab.qa.multiply(new lc(a,
b))};c.prototype.rotate=function(a){this.ab.qa=this.ab.qa.multiply(new kc(a,0,0))};c.prototype.beginPath=function(){this.ma.beginPath()};c.prototype.closePath=function(){this.ma.closePath()};c.prototype.bezierCurveTo=function(a,b,d,c,f,h){this.ma.bezierCurveTo(a,b,d,c,f,h)};c.prototype.quadraticCurveTo=function(a,b,d,c){this.ma.quadraticCurveTo(a,b,d,c)};c.prototype.arc=function(a,b,d,c,f,h){this.ma.arc(a,b,d,c,f,h)};c.prototype.Va=function(a){for(var b in a)this.set(b,a[b])};c.prototype.set=function(a,
b){function d(){switch(b){case "none":return"transparent";case "currentColor":return c.gv}return b}var c=this,f=!1;switch(a){case "stroke-width":this.ma.lineWidth=parseFloat(b);break;case "fill":this.ma.fillStyle=d();break;case "stroke":this.ma.strokeStyle=d();break;case "stroke-opacity":this.ab.$o=parseFloat(b);break;case "fill-opacity":this.ab.dn=parseFloat(b);break;case "opacity":this.ab.opacity=parseFloat(b);break;case "stroke-linejoin":this.ma.lineJoin=b;break;case "stroke-miterlimit":this.ma.miterLimit=
parseFloat(b);break;case "stroke-linecap":this.ma.lineCap=b;break;case "vector-effect":"non-scaling-stroke"===b?this.ab.np=b:Ze("Unsupported SVG style: "+a+"="+b);break;case "style":f=new cf(b);var h={};df(f,h);this.Va(h);f=!1;break;case "transform":f=bf(b);console.log("Transform  by ",f.toString());this.ab.qa=this.ab.qa.multiply(f);f=!1;break;case "fill-rule":this.ab.en=b;break;case "font-family":this.ab.font.family=b;break;case "font-size":/[^0-9]$/.exec(b)||(b+="px");this.ab.font.size=b;break;
case "font-weight":this.ab.font.weight=b;break;case "id":case "d":case "cx":case "cy":case "r":case "rx":case "ry":case "x":case "y":case "x1":case "y1":case "x2":case "y2":case "width":case "height":case "class":case "href":f=!1;break;default:-1===a.indexOf(":")&&0!==a.indexOf("data-")&&Ze("Unsupported SVG style: "+a+"="+b),f=!1}f&&Te("Apply %s=%s",a,b)};c.prototype.Zp=function(){this.ab.qa.rc(this.ma);this.ab.qa=new L};c.prototype.fill=function(){var a=this.ma.globalAlpha;this.ma.globalAlpha=this.ma.globalAlpha*
this.ab.opacity*this.ab.dn;this.ma.fill(this.ab.en);this.ma.globalAlpha=a};c.prototype.stroke=function(){var a=this.ma.globalAlpha;this.ma.globalAlpha=this.ma.globalAlpha*this.ab.opacity*this.ab.$o;"non-scaling-stroke"===this.ab.np?(this.ma.save(),this.ma.setTransform(1,0,0,1,0,0),this.ma.stroke(),this.ma.restore()):this.ma.stroke();this.ma.globalAlpha=a};c.prototype.moveTo=function(a,b){this.ma.moveTo(a,b)};c.prototype.lineTo=function(a,b){this.ma.lineTo(a,b)};c.prototype.rect=function(a,b,d,c,f,
h){wc(this.ma,a,b,d,c,f,h)};c.prototype.text=function(a,b,d){this.ma.font=this.ab.font.toString();this.ma.textBaseline="alphabetic";"transparent"!==this.ma.fillStyle&&this.ma.fillText(a,b,d);"transparent"!==this.ma.strokeStyle&&this.ma.strokeText(a,b,d)};c.prototype.ellipse=function(a,b,d,c){var e=2*d,h=2*c;a-=d;b-=c;c=e/2*.5522848;d=h/2*.5522848;var k=a+e,l=b+h;e=a+e/2;h=b+h/2;this.ma.moveTo(a,h);this.ma.bezierCurveTo(a,h-d,e-c,b,e,b);this.ma.bezierCurveTo(e+c,b,k,h-d,k,h);this.ma.bezierCurveTo(k,
h+d,e+c,l,e,l);this.ma.bezierCurveTo(e-c,l,a,h+d,a,h)};return c}();var gf=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;0>this.width&&(this.x+=this.width,this.width*=-1);0>this.height&&(this.y+=this.height,this.height*=-1)}c.prototype.toString=function(){return(new K(this.x,this.y,this.width,this.height)).toString()};return c}();function hf(c){return c instanceof L?{m11:c.m11,m12:c.m21,m21:c.m12,m22:c.m22,dx:c.Ha,dy:c.Ia}:c}function jf(c){return c?c instanceof L?c:new L(c.m11||1,c.m21||0,c.m12||0,c.m22||1,c.dx||0,c.dy||0):new L}
function kf(c){return{x:c.x,y:c.y}}
(function(){function c(a,b,d,c,f,h){void 0===a&&(a=1);void 0===b&&(b=0);void 0===d&&(d=0);void 0===c&&(c=1);void 0===f&&(f=0);void 0===h&&(h=0);this.m11=a;this.m12=b;this.m21=d;this.m22=c;this.dx=f;this.dy=h}c.prototype.toString=function(){return(new L(this.m11,this.m21,this.m12,this.m22,this.dx,this.dy)).toString()};c.prototype.multiply=function(a){return new c(this.m11*a.m11+this.m12*a.m21,this.m11*a.m12+this.m12*a.m22,this.m21*a.m11+this.m22*a.m21,this.m21*a.m12+this.m22*a.m22,this.dx*a.m11+this.dy*
a.m21+a.dx,this.dx*a.m12+this.dy*a.m22+a.dy)};c.prototype.translate=function(a,b){return(new c(1,0,0,1,a,b)).multiply(this)};return c})();
var lf=function(){function c(a){var b=this;this.Uz=a;this.onload=function(){};this.file=new af;this.file.ql(a).then(function(){b.onload()})}Object.defineProperty(c.prototype,"complete",{get:function(){return this.file.ready},enumerable:!1,configurable:!0});Object.defineProperty(c.prototype,"src",{get:function(){return this.Uz},enumerable:!1,configurable:!0});c.prototype.getRect=function(){var a=this.file.rect;return new gf(a.x,a.y,a.width,a.height)};c.prototype.draw=function(a){this.file.ready&&this.file.ka(a)};
return c}();var mf="ontouchstart"in window,nf="onpointerdown"in window,of={touchstart:"down",touchmove:"move",touchend:"up",touchcancel:"up",pointerdown:"down",pointermove:"move",pointerup:"up",pointercancel:"up",mousedown:"down",mousemove:"move",mouseup:"up",wheel:"wheel"},pf=[],rf=function(c){function a(a,d,e,f,h,k,l,n,r,u,x,w,y,z,A,G,I,C,M,H,V){void 0===H&&(H=pf);void 0===V&&(V=0);k=c.call(this,a,d,e,k,n,r,u)||this;k.type=a;k.pageX=d;k.pageY=e;k.Jb=f;k.Kb=h;k.startTime=l;k.pointerId=x;k.data=w;k.index=y;k.uu=
z;k.buttons=A;k.ctrlKey=G;k.shiftKey=I;k.altKey=C;k.metaKey=M;k.na=H;k.angle=V;k.scale=0;k.rotation=0;return k}__extends(a,c);a.prototype.clone=function(){return new a(this.type,this.pageX,this.pageY,this.Jb,this.Kb,this.timestamp,this.startTime,this.target,this.Hj,this.qb,this.pointerId,this.data,this.index,this.uu,this.buttons,this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,this.na,this.angle)};a.prototype.xn=function(){return this.offset({x:this.pageX,y:this.pageY},void 0)};a.prototype.PD=
function(){return{x:this.pageX-this.Jb,y:this.pageY-this.Kb}};a.prototype.er=function(){return this.timestamp-this.startTime};a.prototype.nn=function(){return gc(this.pageX,this.pageY,this.Jb,this.Kb)};a.prototype.toString=function(){var a=c.prototype.toString.call(this)+(" "+this.er()+"ms "+Math.round(this.nn())+"px");0!=this.scale&&(a+=" scale="+Math.round(100*(this.scale||0))/100,a+=" "+Math.round(this.rotation||0)+"deg");return a};a.prototype.setData=function(a,d){this.data[a]=d};a.prototype.getData=
function(a){return this.data[a]};a.prototype.SC=function(){var a={x:0,y:0,z:0};if("wheel"===this.qb.type){var d=this.qb;a.x=d.deltaX;a.y=d.deltaY;a.z=d.deltaZ}return a};a.prototype.Vb=function(){return qf(this.qb)};a.prototype.setCapture=function(){this.target instanceof HTMLElement&&this.qb instanceof PointerEvent&&-1!==this.pointerId&&this.target.setPointerCapture(this.pointerId)};return a}(function(){function c(a,b,d,c,f,h,k){this.type=a;this.pageX=b;this.pageY=d;this.timestamp=c;this.target=f;
this.Hj=h;this.qb=k}c.prototype.toString=function(){return"["+this.type+" ("+this.qb.type+")] ("+this.pageX+","+this.pageY+")"};c.prototype.offset=function(a,b){b=B(b).wb();return{x:a.x-b.left,y:a.y-b.top}};c.prototype.stopPropagation=function(){this.qb.stopPropagation()};c.prototype.preventDefault=function(){this.qb.preventDefault()};return c}());
function qf(c){switch(c.type){case "touchstart":case "touchend":case "touchmove":case "touchcancel":return!0;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":return"touch"===c.pointerType}return!1}
function sf(c,a){var b=(new Date).getTime();return new rf("down",a.pageX||0,a.pageY||0,a.Jb||0,a.Kb||0,a.timestamp||b,a.startTime||b,a.target||null,a.Hj||null,c,a.pointerId||0,a.data||null,a.index||0,a.uu||0,a.buttons||0,a.ctrlKey||!1,a.shiftKey||!1,a.altKey||!1,a.metaKey||!1,a.na||[],a.angle||0)}
var tf=v.create("TouchListener"),Af=function(c){function a(b,d){function e(b){try{f.handleEvent(b)}catch(l){if(l instanceof Error&&a.Mq)a.jo=l;else throw l;}}void 0===d&&(d={});var f=c.call(this)||this;f.ea=b;f.options=d;f.tf=[];f.Dh=[];f.active=[];f.qw={};f.xw=0;f.hl=!0;var h=d.Zy?document:b;nf&&!1!==d.Du?(f.Ua(b,"pointerdown",e),f.Ua(h,"pointermove",e),f.Ua(h,"pointerup",e),f.Ua(h,"pointercancel",e)):mf&&(f.Ua(b,"touchstart",e),f.Ua(h,"touchmove",e),f.Ua(h,"touchend",e),f.Ua(h,"touchcancel",e));
if(mf||!nf||!1===d.Du)f.Ua(b,"mousedown",e),f.Ua(h,"mousemove",e),f.Ua(h,"mouseup",e);f.Ua(b,"wheel",e);return f}__extends(a,c);a.sz=function(b,d){a.Mq=!0;a.jo=null;b=b.dispatchEvent(d);a.Mq=!1;if(d=a.jo)throw a.jo=null,d;return b};a.prototype.Ua=function(a,d,c){this.tf.push({element:a,event:d,fn:c});"touchmove"===d?a.addEventListener(d,c,{passive:!1,capture:!0===this.options.jp}):a.addEventListener(d,c,{capture:!!this.options.jp,passive:!1})};a.prototype.pa=function(a,d){for(var b=0,f=a.split(" ");b<
f.length;b++){var h=f[b],k="";switch(h){case "gesturestart":case "gesturechange":case "gestureend":k="gesture";break;case "tap":case "doubletap":k="tap";break;case "swipe":k="swipe";break;case "hold":k="hold";break;case "drag":k="drag"}if(""!==k&&!this.qw[k]){switch(k){case "gesture":this.Dh.push(new uf(this));break;case "tap":this.Dh.push(new vf(this));break;case "swipe":this.Dh.push(new wf(this));break;case "hold":this.Dh.push(new xf(this));break;case "drag":this.Dh.push(new yf(this))}this.qw[k]=
!0;tf("Created new detector "+k+" to handle "+h)}}c.prototype.pa.call(this,a,d)};a.prototype.ua=function(a,d){c.prototype.Nb.call(this,a,d)};a.prototype.Sa=function(){for(var a=0,d=this.tf;a<d.length;a++){var c=d[a];c.element.removeEventListener(c.event,c.fn,!0===this.options.jp)}a=0;for(d=this.Dh;a<d.length;a++)c=d[a],c.Sa&&c.Sa();this.tf.length=0;this.Dh.length=0;this.active.length=0;this.sb={}};a.prototype.handleEvent=function(a){var b=of[a.type],c=(new Date).getTime();switch(a.type){case "touchstart":case "touchend":case "touchmove":case "touchcancel":this.xw=
c+800;for(var f=this.active.length-1;0<=f;f--){for(var h=this.active[f],k=!1,l=0;l<a.touches.length&&!k;l++)k=a.touches[l].identifier===h.id;k||(tf("Touch "+h.id+" no longer exists; manufacture fake 'up' event."),this.$i(a,"up",h.id,h.Sf,h.Tf,c))}for(l=0;l<a.changedTouches.length;l++)f=a.changedTouches[l],this.$i(a,b,f.identifier,f.pageX,f.pageY,c);break;case "pointerdown":case "pointerup":case "pointermove":case "pointercancel":l=zf(a);"pointermove"===a.type&&a.buttons&&!this.Fv(a.pointerId)&&(tf("Manufactured pointerdown"),
this.$i(a,"down",a.pointerId,l.pageX,l.pageY,c));this.$i(a,b,a.pointerId,l.pageX,l.pageY,c);if("pointercancel"===a.type)for(l=this.active.length-1;0<=l;l--)this.$i(a,b,this.active[l].id,a.pageX,a.pageY,c);break;case "mousedown":case "mousemove":case "mouseup":if(c<this.xw)break;case "wheel":l=zf(a),this.$i(a,b,0,l.pageX,l.pageY,c)}};a.prototype.$i=function(a,d,c,f,h,k){var b=null;switch(d){case "down":b=this.lA(c,f,h,k,a.buttons,a.target);d=new rf("down",f,h,f,h,k,k,a.target,a.target,a,c,b.data,b.index,
this.active.length,a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;case "move":b=this.Fv(c);d=new rf("move",f,h,b?b.Jb:f,b?b.Kb:h,k,b?b.Rb:k,a.target,b?b.Hj:null,a,c,b?b.data:{},b?b.index:-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;case "up":b=this.DF(c);d=new rf("up",f,h,b?b.Jb:f,b?b.Kb:h,k,b?b.Rb:k,a.target,b?b.Hj:null,a,c,b?b.data:{},b?b.index:-1,this.active.length,b?b.buttons:a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;case "wheel":d=new rf(d,
f,h,f,h,k,k,a.target,a.target,a,c,{},-1,this.active.length,a.buttons,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey);break;default:return}null!==b&&(b.Sf=f,b.Tf=h);(b||this.ea.contains(a.target))&&this.ua(d.type,d)};a.prototype.Fv=function(a){for(var b=0,c=this.active;b<c.length;b++){var f=c[b];if(f.id===a)return f}return null};a.prototype.lA=function(a,d,c,f,h,k){for(var b=0;b<this.active.length;b++){var e=this.active[b];if(e.id===a)return e.Jb=e.Sf=d,e.Kb=e.Tf=c,e.Rb=f,e.na=[new J(d,c)],e}this.active.push({index:this.active.length,
id:a,Rb:f,Jb:d,Kb:c,Sf:d,Tf:c,na:[new J(d,c)],data:{},buttons:h,Hj:k});return this.active[this.active.length-1]};a.prototype.DF=function(a){for(var b=0;b<this.active.length;b++)if(this.active[b].id===a)return a=this.active[b],this.active.splice(b,1),a;return null};a.Mq=!1;a.jo=null;return a}(rb);
function zf(c){if(c.pageX===c.clientX&&c.pageY===c.clientY){var a=document.documentElement.scrollLeft+document.body.scrollLeft,b=document.documentElement.scrollTop+document.body.scrollTop;if(a||b)return{pageX:c.clientX+a,pageY:c.clientY+b}}return c}
function vf(c){var a=[];c.pa("up",function(b){if(200>b.er()&&20>b.nn()){var d=b.clone();d.type="tap";c.ua("tap",d);a:{for(d=0;d<a.length;d++){var e=a[d];if(300>b.timestamp-e.Rb&&20>gc(b.pageX,b.pageY,e.x,e.y)){e.x=b.pageX;e.y=b.pageY;e.Rb=b.timestamp;d=!0;break a}}4===a.length&&a.splice(0,1);a.push({x:b.pageX,y:b.pageY,id:b.pointerId,Rb:b.timestamp});d=!1}d&&(d=b.clone(),d.type="doubletap",c.ua("doubletap",d))}})}
function yf(c){var a=-1,b=-1;c.pa("down",function(a){a.setData("target",a.qb.target)});c.pa("move",function(d){(a!==d.Jb||b!==d.Kb)&&8<d.nn()&&0!==d.buttons&&(a=d.Jb,b=d.Kb,d=d.clone(),d.type="drag",c.ua("drag",d))})}
function uf(c){function a(){for(var a=0,b=0,d=0;d<e.length;d++)tf("Active touch: id:%s %s,%s",e[d].id,e[d].Sf,e[d].Tf),a+=e[d].Sf,b+=e[d].Tf;return{x:a/e.length,y:b/e.length}}function b(a,b){for(var d=0,c=0;c<e.length;c++){var f=e[c];d+=Math.sqrt((f.Sf-a)*(f.Sf-a)+(f.Tf-b)*(f.Tf-b))}return d/e.length}function d(a,b,d,e,f){a=a.clone();a.type=b;a.pageX=d.x;a.pageY=d.y;a.scale=e;a.rotation=f;c.ua(a.type,a)}var e=[],f=!1,h=0,k=1,l=1,n={x:0,y:0},r=c.options.Jy,u=null;c.pa("down move up",function(x){if(x.Vb()||
c.options.Jy)switch(r&&!x.ctrlKey&&(u=null),e=c.active,u&&(e=[u].concat(e)),x.type){case "down":2<=e.length&&!f?(f=!0,n=a(),l=b(n.x,n.y),k=1,h=0,d(x,"gesturestart",n,k,h)):x.ctrlKey&&!u&&(u={index:0,id:-1,Rb:x.timestamp,Jb:x.pageX,Kb:x.pageY,Sf:x.pageX,Tf:x.pageY,na:[new J(x.pageX,x.pageY)],data:{},buttons:1,Hj:x.qb.target});break;case "move":if(2<=e.length&&f){n=a();k=b(n.x,n.y)/l;for(var w=n.x,y=n.y,z=0,A=0;A<e.length;A++){var G=Math.atan2(e[A].Tf-y,e[A].Sf-w)-Math.atan2(e[A].Kb-y,e[A].Jb-w);G>
Math.PI?G-=2*Math.PI:G<=-Math.PI&&(G+=2*Math.PI);z+=G}h=z/e.length/Math.PI*180;d(x,"gesturechange",n,k,h)}break;case "up":f&&2>e.length&&(f=!1,d(x,"gestureend",n,k,h))}})}function wf(c){c.pa("up",function(a){var b=a.na;if(!(200>a.nn()||1E3<a.er()||2>b.length)){for(var d=b[0],e=b[b.length-1],f=1;f<b.length-1;f++)if(40<b[f].qv(d,e))return!1;b=Math.atan2(e.y-d.y,e.x-d.x);tf("Swipe angle %s",b/Math.PI*180);a=a.clone();a.type="swipe";a.angle=b;c.ua("swipe",a)}})}
function Bf(c){this.pj=c;this.time=(new Date).getTime();this.timeout=0}
var xf=function(){function c(a){function b(a){var b=d.ah[a];b&&(tf("Remove pointer %s",a),clearTimeout(b.timeout),delete d.ah[a])}var d=this;this.ah={};a.pa("down",function(c){b(c.pointerId);d.ah[c.pointerId]=new Bf(new J(c.pageX,c.pageY));d.ah[c.pointerId].timeout=setTimeout(function(){var b=c.clone();b.type="hold";b.timestamp=(new Date).getTime();a.ua("hold",b)},1E3)});a.pa("move",function(a){var c=a.pointerId;if(c in d.ah){var e=d.ah[c];20<(new J(a.pageX,a.pageY)).ic(e.pj)&&b(c)}});a.pa("up",function(a){b(a.pointerId)})}
c.prototype.Sa=function(){for(var a in this.ah)clearTimeout(this.ah[a].timeout)};return c}();function Cf(c,a,b,d){c.fillStyle=q.Od;c.fillRect(a,b,d,d);c.beginPath();c.strokeStyle=q.Oa;c.moveTo(a,b);c.lineTo(a+d,b+d);c.moveTo(a+d,b);c.lineTo(a,b+d);c.stroke()}function Df(c,a,b,d){for(var e,f=0;f<d;f+=5){e=0===f/5%2;for(var h=0;h<d;h+=5)c.fillStyle=e?q.Oa:q.Od,e=!e,c.fillRect(a+h,b+f,5,5)}e=c.createLinearGradient(a+d,b+d,a,b);e.addColorStop(0,"rgba(255, 255, 255, 1.0)");e.addColorStop(1,"rgba(255, 255, 255, 0.0)");c.fillStyle=e;c.fillRect(a,b,d,d)}
function Ef(c){for(var a=[],b=[],d=[],e=0,f=0;360>f;f++){var h=new q(q.xi,[f,1,1,1]);a.push(h);0<f&&(h=a[f-1].FB(h),b.push(h),e+=h)}e/=c;f=0;d.push(a[0]);for(h=1;h<a.length;h++){var k=b[h-1];f+k>=e&&(f-=e,d.push(a[h]));f+=k}d.length=c;return d}
function Ff(c,a,b){function d(a,d){if(a.target instanceof HTMLElement){var c=a.target.getAttribute("zwibbler-color")||"";if("opacity-50"===c)b.onOpacity(.5,!d);else if(c)b.onColour(c,!d);a.preventDefault()}}function e(a,b,d){return B("div",{"zwibbler-color":d,tabindex:"0"}).Va({width:b+"px",height:b+"px",display:"inline-block"}).ke(a)}function f(a,b,d){var c=document.createElement("canvas");c.width=a;c.height=a;b(c.getContext("2d"),0,0,a);a=e(h,a,d);a.ea.style.backgroundImage="url("+c.toDataURL()+
")";a.ea.style.backgroundPosition="center";return a}void 0===b&&(b={});var h=B.Fc(c),k=b.columns||16;c=b.rows||k;var l=!1!==b.includeNone;var n=!1!==b.includePartial;if(h){var r=new Af(h,{Zy:!1});h.addEventListener("contextmenu",function(a){a.preventDefault()});r.pa("tap hold",function(a){d(a.qb,"hold"===a.type||1<a.buttons)});h.addEventListener("keydown",function(a){13===a.keyCode&&(d(a,!1),this.click())});r=0;l&&(f(a,Cf,"transparent"),r++);n&&(f(a,Df,"opacity-50"),r++);for(l=0;1>=l;l+=1/(k-r-1))n=
(new q(q.xi,[0,0,Math.pow(l,1/2.2),1])).toString(),e(h,a,n).Va({backgroundColor:n});k=Ef(k);for(l=1;l>1/(c-1);l-=1/c)for(r=0,n=k;r<n.length;r++){var u=n[r];u.values[1]=1;u.values[2]=Math.pow(l,1/2.2);e(h,a,u.toString()).Va({backgroundColor:u})}}}
(function(){function c(a,b){var d=this;this.Co=null;var c=document.createElement("div");c.style.width="320px";c.style.lineHeight="0";c.style.position="absolute";b.appendChild(c);Ff(c,20,{onColour:function(a,b){d.Co&&d.Co.resolve({type:"colour",value:a,fill:b})}});this.Aq=Ee(c);a.add(function(){d.Aq&&d.Aq.destroy()})}c.prototype.show=function(a,b){this.Co=new ac;this.Aq.show(a,b,!0);return this.Co};return c})();var Gf=function(){function c(a){this.view=a;this.start=new J(0,0);this.Nl=new J(0,0);this.active=!1;this.Ij=1;this.rect=null;this.log=v.create("PanZoomMixin");this.Ij=a.scale}c.prototype.Yd=function(){return this.active};c.prototype.yb=function(a){this.log("onGesture(%s)",a.type);if(!this.view.fa.get("allowZoom")||!this.view.fa.get("allowScroll"))return!1;if("gesturestart"===a.type)this.start=new J(a.pageX,a.pageY),this.Nl=this.view.Ed(a.pageX,a.pageY),this.rect=this.view.$b(),this.Ij=this.view.scale,
this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.sj(a.scale*this.Ij)/this.Ij;a=new lc(1/a,1/a,this.Nl.x,this.Nl.y);a=(new jc(-b/this.Ij,-d/this.Ij)).multiply(a);b=this.rect.clone();b.transform(a);this.view.Gd(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}(),Hf=function(){function c(a){var b=this;this.view=a;this.state=0;this.log=v.create("MiddleButtonPan");this.start=new J(0,0);this.Nl=new J(0,0);this.rect=
new K(0,0,0,0);this.buttons=4;this.lo="";this.view.fa.pa("rightButtonPans",function(a){b.buttons=a?b.buttons|2:b.buttons&-3})}c.prototype.Yd=function(){return 0!==this.state};c.prototype.Dd=function(a,b){switch(a){case "start-pan":0===this.state&&(this.log("Start panning due to key combo"),this.Dj(1),b.preventDefault());break;case "end-pan":this.Dj(0)}};c.prototype.Dj=function(a){this.state=a;switch(a){case 0:this.view.zb(this.lo);break;case 1:case 3:case 2:this.view.zb("grabbing")}};c.prototype.handleEvent=
function(a){if(!this.view.fa.get("allowScroll"))return!1;var b=!1;if(1===this.state||0===this.state&&"down"===a.type&&a.buttons&this.buttons)this.start=new J(a.pageX,a.pageY),this.Nl=this.view.Ed(a.pageX,a.pageY),this.rect=this.view.$b(),1==this.state?this.Dj(3):(this.Dj(2),a.setCapture()),b=!0;else{if(2===this.state&&0===(a.buttons&this.buttons))return this.Dj(0),!1;if(3===this.state||2==this.state)if("move"===a.type||"down"===a.type||"up"===a.type){b=new jc(-((a.pageX-this.start.x)/this.view.scale),
-((a.pageY-this.start.y)/this.view.scale));var d=this.rect.clone();d.transform(b);this.view.Gd(d);b=!0;"up"===a.type&&this.Dj(0)}}return b};return c}();var If=function(){function c(a,b){this.view=a;this.methods=b;this.log=v.create("CustomToolBehaviour");this.Rc=new Gf(a)}c.prototype.Vd=function(){this.log("Entering CustomToolBehaviour");var a=this.view.fs;this.methods.enter&&this.methods.enter();this.view.fs===a&&this.view.zb("default")};c.prototype.Qc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.to=function(a,b,d){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,d.qb):!1};
c.prototype.Eb=function(a,b,d){return this.methods.onMouseDown?this.methods.onMouseDown(a,b,d.qb):!1};c.prototype.Fb=function(a,b,d){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,d.qb):!1};c.prototype.oc=function(a,b,d){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,d.qb):!1};c.prototype.uo=function(a,b,d){if(this.methods.onMouseDrag){var c=this.view.Ed(d.Jb,d.Kb,!0);return this.methods.onMouseDrag(a,b,d.qb,c.x,c.y)}return!1};c.prototype.ls=function(a,b,d){return this.methods.onMouseLeave?
this.methods.onMouseLeave(a,b,d):!1};c.prototype.ks=function(a,b,d){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,d.qb):!1};c.prototype.so=function(a,b,d){return this.methods.onContextMenu?this.methods.onContextMenu(a,b,d):!1};c.prototype.js=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.Wg=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,b):!1};c.prototype.de=function(a,b){this.methods.setToolProperty&&this.methods.setToolProperty(a,
b)};c.prototype.Pg=function(){return this.methods.getToolProperties?this.methods.getToolProperties():{}};c.prototype.Oh=function(){return this.methods.getToolNodeTypes?this.methods.getToolNodeTypes():[]};c.prototype.Dd=function(a,b){this.log("keyboard: %s",a);if(!this.methods.onKeyCommand||!1===this.methods.onKeyCommand(a,b))return"cancel"===a&&(this.log("ESC pressed. Abort and go back to toolbar."),this.view.Hb(),this.view.$c.ua("goto-toolbar")),!1};c.prototype.pl=function(a){this.methods.onRedraw&&
(a.save(),this.methods.onRedraw(a),a.restore())};c.prototype.yb=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.Rc.yb(a)};c.prototype.ol=function(a,b,d,c){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,-10.6*d.y,c):!1};c.prototype.ad=function(){return this.methods.getToolName?this.methods.getToolName():"custom"};return c}();var Jf=function(){function c(a,b,d,c,f){this.view=a;this.ii=b;this.Ia=this.Ha=0;this.Dc=!1;this.UF=ad("#0050B7",.2);this.log=v.create("SELECT");this.vx(d,c,f)}c.prototype.yb=function(a){this.log("Gesture detected; aborting select box.");this.view.Xa(this.ii);return this.ii.yb?this.ii.yb(a):!1};c.prototype.Qc=function(){this.view.Hm("select")};c.prototype.cancel=function(){this.log("Cancel select box.");this.view.Xa(this.ii)};c.prototype.Eb=function(a,b,d){return this.vx(a,b,d)};c.prototype.vx=function(a,
b,d){this.Ha=a;this.Ia=b;this.Dc=!0;d.setCapture();return!0};c.prototype.Fb=function(a,b){if(this.Dc){var d=this;this.view.scrollIntoView(a,b);this.view.qj("select",function(c){c.save();c.strokeStyle="#0050B7";c.lineWidth=2/d.view.scale;c.fillStyle=d.UF;var e=new K(d.Ha+.5,d.Ia+.5,a-d.Ha,b-d.Ia);c.fillRect(e.x,e.y,e.width,e.height);c.strokeRect(e.x,e.y,e.width,e.height);c.restore()});return!0}return!1};c.prototype.oc=function(a,b){this.Dc=!1;this.view.pb();this.view.VF(new K(this.Ha,this.Ia,a-this.Ha,
b-this.Ia));this.view.xc();this.view.ra.ua("selected-region",new gf(this.Ha,this.Ia,a-this.Ha,b-this.Ia));this.view.Xa(this.ii);return!0};c.prototype.ad=function(){return"pick"};return c}();var Kf={type:"translate",position:new J(0,0),offset:new J(0,0),Sh:""},Lf={type:"rotate",position:new J(0,0),offset:new J(0,0),Sh:""},Mf={type:"translate",position:new J(0,0),offset:new J(0,0),Sh:""},Nf=function(){function c(a,b,d){this.ld=a;this.qa=b;this.xa=d}c.prototype.Tu=function(){return!0};c.prototype.toString=function(){return"SelectionHandle"};c.prototype.Dn=function(a,b){void 0===a&&(a=this.qa);void 0===b&&(b=1);a=a.ub(!1);if(0===a.x||0===a.y)a.x=1,a.y=1;return new J(this.xa.x+this.xa.width*
this.ld.position.x+this.ld.offset.x/a.x/b,this.xa.y+this.xa.height*this.ld.position.y+this.ld.offset.y/a.y/b)};c.prototype.xn=function(){var a=this.Dn();return this.qa.apply(a.x,a.y)};c.prototype.ka=function(a,b,d,c,f){a.save();f*=d;c=c.multiply(this.qa);var e=c.ub(!0);if(0===e.x||0===e.y)e.x=1,e.y=1;e.x=1/e.x/d;e.y=1/e.y/d;d=this.Dn(c,d);c=c.multiply(new lc(e.x,e.y,d.x,d.y));c.rc(a);(b=b.get(this.ld.Sh))?(f=b.width,c=b.height,a.drawImage(b,d.x-f/2,d.y-c/2,f,c)):this.Dq(a,d,f);a.restore()};c.prototype.Dq=
function(a,b){a.strokeStyle="red";a.lineWidth=1;a.strokeRect(b.x-10,b.y-10,20,20)};c.prototype.Db=function(a,b,d,c,f){a=a.get(this.ld.Sh);f=this.Dn(this.qa,f);b=this.qa.inverse().apply(b,d);d=this.qa.ub(!1);a?(c=a.height,a=a.width/2/d.x,c=c/2/d.y):(a=c/d.x,c/=d.y);return(new K(f.x-a,f.y-c,2*a,2*c)).Xc(b.x,b.y,0)};c.prototype.Lh=function(){return"default"};c.prototype.click=function(){return null};return c}();function Of(c,a){c-=a;return 0>=c||1E-8>Math.abs(c)}
function Pf(c,a){c-=a;return 0<=c||1E-8>Math.abs(c)}
var Qf=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||this;a.origin=f;return a}__extends(a,c);a.prototype.toString=function(){return"ScalingSelectionHandle"};a.prototype.Qg=function(a,d){var b=this.qa.inverse();a=this.JA(a,b,d);return this.qa.multiply((new lc(a.x,a.y,this.origin.x,this.origin.y)).multiply(b))};a.prototype.JA=function(a,d,c){void 0===d&&(d=this.qa.inverse());var b=1,e=1,k=this.xn(),l=this.Dn();a=d.apply(k.x+a.x,k.y+a.y);l=new J(l.x-this.origin.x,l.y-this.origin.y);a=new J(a.x-
this.origin.x,a.y-this.origin.y);a=(a.x*l.x+a.y*l.y)/(l.x*l.x+l.y*l.y);a=ic(a);1E-8>Math.abs(l.x)||1E-8>Math.abs(l.y)?1E-8>Math.abs(l.x)?e=a:b=a:e=b=a;c&&(a=this.qa.multiply(new lc(b,e,this.origin.x,this.origin.y)),l=this.qa.ub(!0),d=a.ub(!0),a=Math.round(this.xa.width*d.x/c)*c,c*=Math.round(this.xa.height*d.y/c),1!==b&&0!==a&&(b=a/this.xa.width/l.x),1!==e&&0!==c&&(e=c/this.xa.height/l.y));return{x:b,y:e}};a.prototype.Dq=function(a,d,c){a.beginPath();var b=6;c&&9*b>c&&(b=c/9);a.strokeStyle=q.Oa;a.lineWidth=
1;a.shadowBlur=3;a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowColor="rgba(0,0,0,0.2)";a.strokeStyle="#ccc";a.arc(d.x,d.y,b,0,2*Math.PI);a.fillStyle=q.Od;a.fill();a.stroke();a.shadowColor=q.he};a.prototype.Lh=function(){return.5===this.ld.position.x?"ns-resize":.5===this.ld.position.y?"ew-resize":this.ld.position.x!==this.ld.position.y?"nesw-resize":this.ld.position.x===this.ld.position.y?"nwse-resize":c.prototype.Lh.call(this)};return a}(Nf),Rf=function(c){function a(a,d,e,f){a=c.call(this,a,d,e)||
this;d=a.xn();a.origin=a.qa.apply(f.x,f.y);a.gt=Math.atan2(d.y-a.origin.y,d.x-a.origin.x);return a}__extends(a,c);a.prototype.toString=function(){return"RotationSelectionHandle"};a.prototype.Qg=function(a,d){var b=this.xn();a=Math.atan2(b.y+a.y-this.origin.y,b.x+a.x-this.origin.x)-this.gt;d&&(d=Math.PI/16,a=Math.floor(a/d)*d);return new kc(-a,this.origin.x,this.origin.y)};a.prototype.click=function(){return new kc(-Math.PI/2,this.origin.x,this.origin.y)};a.prototype.Dq=function(a,d){a.beginPath();
a.strokeStyle="#0050B7";a.lineWidth=3;a.moveTo(d.x,d.y-6);a.arc(d.x,d.y,6,1.5*Math.PI,0,!0);a.moveTo(d.x-6-2,d.y-6);a.lineTo(d.x-1,d.y-6);a.lineTo(d.x-1,d.y);a.stroke()};a.prototype.Lh=function(){return"crosshair"};return a}(Nf),Sf=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.toString=function(){return"TranslationSelectionHandle"};a.prototype.Qg=function(a){return new jc(a.x,a.y)};a.prototype.Lh=function(){return"move"};return a}(Nf),Tf=function(c){function a(){return c.call(this,
Mf,new L,new K(0,0,0,0))||this}__extends(a,c);a.prototype.Qg=function(){return new L};return a}(Nf),Uf=function(c){function a(a,d,e){return c.call(this,a,d,e)||this}__extends(a,c);a.prototype.Tu=function(){return!1};a.prototype.click=function(a){this.ld.Yu&&this.ld.Yu(a.pageX,a.pageY);return null};a.prototype.Qg=function(){return new L};return a}(Nf);
function Vf(c,a,b){var d=void 0,e=new J(0,0),f=b.ub(!0);e.x=a.x+a.width*c.position.x+c.offset.x/f.x;e.y=a.y+a.height*c.position.y+c.offset.y/f.y;switch(c.type){case "translate":return new Sf(c,b,a);case "scale":return d||(d=new J(a.right()-c.position.x*a.width,a.bottom()-c.position.y*a.height)),new Qf(c,b,a,d);case "rotate":return d||(d=a.me()),new Rf(c,b,a,d);case "click":return new Uf(c,b,a)}};function Wf(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Xf=function(){function c(a,b,d,c,f,h){this.view=a;this.handle=b;this.nH=d;this.Ib=0;this.my=new K(0,0,0,0);this.Ga=[];this.Sk=[];this.yf=[];this.Tg=[];this.zc=new J(0,0);this.duplicate=this.nw=!1;this.log=v.create("TransformSelectionBehaviour");this.Ln=!1;this.Eb(c,f,h)}c.prototype.yb=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;if(!0===this.view.fa.get("allowSelectBox"))return this.log("Gestures disabled because allowSelectBox is true"),this.view.Hb(),
this.view.ta.yb&&this.view.ta.yb(a),!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.Ln=!0;var b=this.view.Ed(a.pageX,a.pageY,!0),d=b.x;b=b.y;"gesturestart"===a.type&&(this.zc.x=d,this.zc.y=b);var c=d-this.zc.x,f=b-this.zc.y,h=a.scale,k=a.rotation;this.view.Mo||(h=1);this.view.Al||(k=0);this.view.xj||(f=c=0);k=-k/180*Math.PI;if(0<this.view.fa.get("snap")){var l=Math.PI/16;k=Math.floor(k/l)*l}h=new lc(h,h,this.zc.x,this.zc.y);k=new kc(k,this.zc.x,this.zc.y);c=(new jc(c,f)).multiply(h).multiply(k);
this.Ox(c);"gestureend"===a.type&&this.Ea(c,d,b);return!0};c.prototype.rD=function(a){var b={transformType:this.duplicate?"copy":this.handle.ld.type,nodes:a};this.view.ra.Nb("start-transform",b);a=[];var d=new Set,c=0;for(b=b.nodes;c<b.length;c++){var f=b[c];!d.has(f)&&this.view.aa.Xn(f)&&a.push(f)}return a};c.prototype.Eb=function(a,b,d){var c=this;if(this.Ln)return!0;this.duplicate=this.view.fa.Kn(d,this.view.fa.get("keyDragDuplicate"));this.view.zb(this.handle.Lh());this.view.Df(!0);this.Ga.length=
0;this.Sk=this.rD(this.view.Xd(!0));if(0===this.Sk.length)return this.Nq(),!0;if(this.duplicate)this.view.aa.transaction(function(){for(var a=0,b=c.view.aa.duplicate(c.Sk,new L);a<b.length;a++){var d=c.view.aa.za(b[a],!1);d&&N(d)&&c.Ga.push(d)}},!0);else for(var f=0,h=this.Sk;f<h.length;f++){var k=this.view.aa.za(h[f]);k&&N(k)&&this.Ga.push(k)}d.setCapture();this.kC(this.Ga);this.zc=this.Fj(a,b,d);this.log("onMouseDown(%s,%s)",this.zc.x,this.zc.y);this.my=new K(this.view.Xe.x,this.view.Xe.y,this.view.Xe.width,
this.view.Xe.height);return!0};c.prototype.kC=function(a){this.yf=[];for(var b=new L,d=0;d<a.length;d++)this.yf.push(a[d].Ge(b)),this.Tg.push(this.yf[d]),this.Ib=this.Ib||a[d].ia("snap")||0,Uc(a[d])&&(this.nw=!0)};c.prototype.Fj=function(a,b,d){return this.view.Ib(new J(a,b),this.Ib||d)};c.prototype.Fb=function(a,b,d){if(this.Ln)return!0;a=this.Fj(a,b,d);d=this.handle.Qg(new J(a.x-this.zc.x,a.y-this.zc.y),this.view.Nh(d));this.Mx(d);this.Ox(d);return!0};c.prototype.Ox=function(a){for(var b=0;b<this.Ga.length;b++)this.Ga[b].Qb(this.yf[b]),
this.Tg[b]=this.Ga[b].Ge(a),this.Ga[b].Qb(this.Tg[b]);this.view.aa.Nv(this.view.ma,this.view.request,this.Ga);this.view.fp(a);this.nw&&this.view.aa.Km();this.view.ka()};c.prototype.Ea=function(a,b,d){for(var c=this,f=0;f<this.Ga.length;f++)this.Ga[f].Qb(this.yf[f]);f=!1;if(a.Mw()){b={docX:b,docY:d,nodes:[]};d=0;for(f=this.Ga;d<f.length;d++){var h=f[d];b.nodes.push({id:h.id,rect:new gf(h.rect.x,h.rect.y,h.rect.width,h.rect.height),shift:{x:a.Ha,y:a.Ia}})}f=!1===this.view.ra.Nb("drop-shape",b)}f||(this.duplicate&&
this.view.aa.transaction(function(){for(var a=[],b=0,d=c.Ga;b<d.length;b++)a.push(d[b].id);c.view.aa.wc(a)},!0),this.view.aa.transaction(function(){if(c.duplicate)c.view.aa.duplicate(c.Sk,a);else for(var b=0;b<c.Ga.length;b++)c.view.aa.Ab([c.Ga[b].id],c.Tg[b])}));this.Nq()};c.prototype.oc=function(a,b,d){var c=this;if(this.Ln)return!0;var f=a,h=b,k=this.Fj(a,b,d);a=k.x;b=k.y;this.log("onMouseUp(%s,%s)",a,b);var l=!1;if(k.xd(this.zc))if(this.nH){if(this.duplicate){var n=[];a=0;for(b=this.Ga;a<b.length;a++)n.push(b[a].id);
this.view.aa.transaction(function(){c.view.aa.wc(n)},!0)}(f=this.view.aa.Db(f,h,this.view.Hc(d.Vb()),this.view.scale,this.view.Ub).node)&&f.Zf()?(this.log("Didn't move, and has edit mode. Selecting node %s",f.id),this.view.pb(),this.view.fh(f)):l=!0}else this.log("Didn't move, but toggleEditNode=false"),l=!0;else return this.log("Moved by %s,%s",a-this.zc.x,b-this.zc.y),d=this.handle.Qg(new J(k.x-this.zc.x,k.y-this.zc.y),this.view.Nh(d)),this.Mx(d),this.Ea(d,a,b),!0;if(l){var r=this.handle.click(d);
this.log("handle.click returned %s",r);r&&this.view.aa.transaction(function(){c.view.aa.nh(Wf(c.Ga),r)})}this.Nq();return!0};c.prototype.Mx=function(a){var b=this.view.fa.get("confine");switch(b){case "page":case "view":var d=this.my.clone();b="view"===b?this.view.$b():this.view.nf();d.transform(a);d=d.mq(b);a.Ha+=d.x;a.Ia+=d.y}};c.prototype.Nq=function(){this.view.fp(new L);this.view.xh();this.view.update(!0);this.view.Hb()};c.prototype.Qc=function(){this.view.zb("default");this.view.Df(!1)};c.prototype.ad=
function(){return"pick"};return c}();var $f=function(){function c(a,b,d){this.view=a;this.ba=b;this.cf=d;this.Ym=!1;this.ya=this.Lg=this.ja=null;this.fillStyle=q.Oa;this.ap=!1;this.Aa=new jb;this.sf=!1;this.ml=null;this.po="none";this.ns=0;this.Lc=1;this.nt="normal";this.log=v.create("Text");this.multiline=a.fa.get("multilineText");this.Yb=document.createElement("div");a.fa.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.nt="top")}c.prototype.Vd=function(){this.log("Entering text mode");this.view.zb("text");
this.view.pb(!0)};c.prototype.Qc=function(){this.Ym&&this.ik();this.view.zb("default");this.log("Leaving text mode");this.ja&&this.ja.parentNode&&this.ja.parentNode.removeChild(this.ja);this.ja=null;this.Yb.parentNode&&this.Yb.parentNode.removeChild(this.Yb);this.Aa.Sa()};c.prototype.Eb=function(a,b,d){this.log("onMouseDown(%s)",d.type);if(this.Ym){if(d.target===this.ja)return this.log("Ignore click -- its in our own edit box."),this.view.Wm=!0,!1;this.log("Editing somewhere else on mousedown; submit that first.");
this.ik();this.cf&&this.view.Hb()}else{var c=this.view.aa.Db(a,b,this.view.Hc(d.Vb()),this.view.scale,this.view.Ub).node;this.ht(c,a,b,d)}this.log("Eating click");return this.view.Wm=!0};c.prototype.iC=function(){if(this.Yb&&this.ja){this.Yb.style.fontSize=this.ja.style.fontSize;this.Yb.style.fontFamily=this.ja.style.fontFamily;this.Yb.style.fontWeight=this.ja.style.fontWeight;this.Yb.style.fontStyle=this.ja.style.fontStyle;this.Yb.style.whiteSpace="break-spaces";this.Yb.style.position="absolute";
this.Yb.style.visibility="hidden";this.Yb.style.backgroundColor="rgba(0,0,0,0.2)";this.Yb.style.lineHeight=this.ja.style.lineHeight;document.body.appendChild(this.Yb);this.Yb.style.left="0";for(this.Yb.style.top="0";this.Yb.firstChild;)this.Yb.removeChild(this.Yb.firstChild);this.Yb.appendChild(document.createTextNode(this.ja.value));var a=Math.ceil(this.Yb.clientWidth),b=this.ja.offsetWidth-this.ja.clientWidth;if(this.ja.clientWidth<a+4){a>500*this.Lc&&(a=500*this.Lc);var d=B(this.view.canvas.parentElement).wb(),
c=B(this.ja).wb();c.left+c.width+4+b<d.left+d.width?this.ja.style.width=a+4+b+"px":this.log("Suppress edit box expansion")}this.ja.clientHeight<this.ja.scrollHeight+4&&this.ja.offsetHeight<this.ja.scrollHeight&&(this.log("Increase to scrollHeight of %s",this.ja.scrollHeight),this.ja.style.height=""+this.ja.scrollHeight+"px")}};c.prototype.ys=function(){if(this.ja){var a=this.va("verticalAlign");if(this.ya&&this.sf){var b=B(this.view.canvas.parentElement).wb(),d=B(this.ja).wb();a=a||"middle";var c=
this.view.Jg(this.ya.rect.x,this.ya.rect.y),f=this.view.Jg(this.ya.rect.x+this.ya.rect.width,this.ya.rect.y+this.ya.rect.height);switch(a){case "top":d.top=c.y;break;case "bottom":d.top=f.y-this.ja.offsetHeight;break;default:d.top=c.y+(f.y-c.y)/2-this.ja.offsetHeight/2,d.top-=(1-.7)*this.va("fontSize")/2}this.ja.style.top=d.top-b.top+"px"}}};c.prototype.ht=function(a,b,d,c){function e(){null===H.ya?H.iC():k.ja&&k.ja.clientHeight<k.ja.scrollHeight+4&&k.ja.offsetHeight<k.ja.scrollHeight&&(k.log("Increase to scrollHeight of %s",
k.ja.scrollHeight),k.ja.style.height=""+k.ja.scrollHeight+"px",k.ys())}function h(){H.ja&&(H.ja.clientHeight<H.ja.scrollHeight&&(H.log("Increase to scrollHeight of %s",H.ja.scrollHeight),H.ja.style.height=""+H.ja.scrollHeight+"px"),H.ja.style.width=""+H.ja.scrollWidth+"px",k.ys(),k.ns=H.ja.offsetWidth);V=null}var k=this,l=0,n=0,r=0,u=0,x=0,w=0,y=0;this.ap=!1;this.sf=!!a&&("PathNode"===a.type()||"SvgNode"===a.type());var z=!this.sf;u=a&&Yf(this.view,a);a&&"TextNode"===a.type()||this.sf&&a&&u||!this.sf&&
a&&a.Rg()&&u?this.ya=a:this.ya=null;u=this.va("fontSize")*this.view.scale;this.ml=null;var A=this.view.fa.get("minAutoZoomTextSize");var G=this.view.fa.get("autoZoomTextSize")||A||15;if(u<A){A=u/G;u=this.view.$b();this.ml=u.clone();this.po=this.view.Ce;G=b-10;var I=d-10;var C=this.va("textAlign")||"left";var M=this.va("verticalAlign")||"top";if(r=B.GD().width===window.innerWidth&&(640>window.innerWidth||640>window.innerHeight))u.height*=.5;if(a){switch(C){case "center":G=a.rect.x+a.rect.width/2;break;
case "right":G=a.rect.x+a.rect.width;break;default:G=a.rect.x-10}switch(M){case "middle":I=a.rect.y+a.rect.height/2;break;case "bottom":I=a.rect.y+a.rect.height;break;default:I=a.rect.y-10}}r?(u.x=G,u.y=I,u.width*=A,u.height*=A):u.transform(new lc(A,A,G,I));this.view.Gd(u);this.view.Rj=null}this.Lc=this.view.scale;this.ya&&a?(this.view.bf(a),this.view.xh(),u=a.Mk(),"top"!==this.nt&&"TextNode"===a.type()?this.ya.gh(!0):this.ya.Ej(!0),this.view.ka(),this.Lg=new J(u.x,u.y),(l=a.ia("font"))?(l=Pe(l),
c=l.fontFamily||"arial",G=parseFloat(l.fontSize)||10,I="bold"===l.fontWeight,C="italic"===l.fontStyle):(c=a.ia("fontName"),G=a.ia("fontSize"),I=a.ia("bold"),C=a.ia("italic")),"TextNode"!==a.type()||a.ia("wrap")||(G*=a.Pa().ub(!1).y),"TextNode"===a.type()&&(n=u.height),M=a.ia("underline")?"underline":"",l=u.width*this.Lc,l=Math.max(l,50),this.sf||(l+=7),this.fillStyle=a.Rg()?a.ia("textFillStyle")||this.va("textFillStyle"):this.view.sa.textFillStyle,A=a.Pa().ub(!1),r=a.ia("padding")||0,u=r*=this.Lc,
r*=A.x,u*=A.y,this.sf||(w+=1*this.Lc,y-=1*this.Lc),n+=2,x=.15*G*A.y,this.log("NodeWidth=%s scale=%s/%s padding=%s/%s, paddingShift=%s editWidth=%s",a.rect.width,A.x,A.y,r,u,x,l)):(c&&!c.Vb()&&(d-=2*this.view.scale),G=this.va("fontSize"),c=this.va("fontName"),d-=.7*G,this.Lg=new J(b,d),I=this.va("bold"),C=this.va("italic"),M=this.va("underline")?"underline":"",this.fillStyle=this.ba.fillStyle||this.va("textFillStyle")||this.va("fillStyle"),r=this.va("padding")||0,u=r*=this.Lc,(n=this.va("width")||
0)&&(l=n*this.Lc+r),n=2*G*this.Lc,this.va("wrap")&&(d-=G),y+=3*this.Lc,this.view.pb());var H=this;this.ja=document.createElement("textarea");this.ja.setAttribute("maxlength","400");this.ja.setAttribute("rows","1");this.ja.style.width=l?""+l+"px":"auto";a=this.view.Jg(this.Lg.x,this.Lg.y);this.ja.classList.add("zwibbler-text-area");this.ja.style.minWidth="0";this.ja.style.maxWidth="none";this.ja.style.position="absolute";this.ja.style.fontFamily=c;this.ja.style.fontSize=""+G*this.Lc+"px";this.ja.style.lineHeight=
this.va("lineHeight");this.ja.style.overflow="hidden";this.ja.style.fontWeight=I?"bold":"normal";this.ja.style.fontStyle=C?"italic":"normal";this.ja.style.paddingTop=u+x+"px";this.ja.style.paddingBottom=u-x+"px";this.ja.style.paddingLeft=r+"px";this.ja.style.paddingRight=r+"px";this.ja.style.border=this.sf?"0px solid transparent":"1px dashed #888";this.ja.style.outline="none";this.ja.style.color=this.fillStyle;this.ja.style.webkitTextStrokeColor=this.va("textStrokeStyle");this.ja.style.webkitTextStrokeWidth=
this.va("textLineWidth")+"px";this.ja.style.boxSizing="border-box";this.ja.style.backgroundColor=this.va("background");this.sf&&(this.ja.style.backgroundColor="transparent");this.ja.style.textDecoration=M||"none";this.ja.style.textAlign=this.va("textAlign");this.ja.style.textIndent=this.va("textIndent");this.ja.style.zIndex=""+(this.view.ue()+1);this.ja.style.resize=z?"both":"none";n&&(this.log("Set editbox height initially to "+n+"px"),this.ja.style.height=n+"px");n=this.ja.clientHeight;this.log("Using z-index %s",
this.ja.style.zIndex);q.Wf(this.fillStyle).toString()===q.Od&&(this.ja.style.backgroundColor="#808080");z=this.view.canvas.parentElement;x=B(z).wb();A=l=0;"top"===this.nt?(A=B(this.view.canvas.first).wb(),c=this.view.canvas.width,l=this.ja.clientWidth,l=A.left+c/2-l/2,A=A.top):(l=Math.round(a.x),A=Math.round(a.y));l+=w;A=A-u/2+y;this.ja.style.WebkitTransitionDuration="0";this.ja.style.MozTransitionDuration="0";this.ja.style.msTransitionDuration="0";this.ja.style.OTransitionDuration="0";this.ja.style.transitionDuration=
"0";Zf(this.ja);this.ja.style.left=l-x.left+"px";this.ja.style.top=A-x.top+"px";z.appendChild(this.ja);this.ns=this.ja.offsetWidth;"center"===this.va("textAlign")&&(null===this.ya?(w=this.ja.offsetWidth/2,this.ja.style.left=a.x-w-x.left+"px",b-=w/this.Lc):this.sf||(w=this.ja.offsetWidth/2-this.ya.rect.width/2*this.Lc,this.ja.style.left=l-w-x.left+"px",this.ja.style.top=A+u/2-x.top+"px"));this.Ym=!0;this.Lg=new J(b,d+n);this.ja.clientWidth<z.clientWidth&&bd(this.ja,z);this.ya&&(this.ja.value=this.ya.ia("text"));
var V=null;H.ja&&H.log("editBox scollheight is %s",H.ja.scrollHeight);V=setTimeout(h,0);this.Aa.addEventListener(this.ja,"keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&H.multiline||13===a.keyCode&&a.shiftKey?(H.log("Enter pressed. create text."),H.ik(),H.view.Ta.Wb&&H.view.UG(a),H.cf&&H.view.Hb()):27===a.keyCode?(H.log("ESC pressed; cancel."),H.cancel(),H.view.Hb(),H.view.$c.ua("goto-toolbar")):13===a.keyCode&&(V||(V=setTimeout(h,0))))});this.Aa.addEventListener(this.ja,"input",e);this.Aa.addEventListener(this.ja,
"propertychange",e);this.view.fa.get("leaveTextToolOnBlur")&&(this.Aa.addEventListener(this.ja,"focus",function(){H.log("Text focus received.")}),this.Aa.addEventListener(this.ja,"blur",function(){H.ja&&!H.ja.Fs&&(H.log("Text blur received -- removing=%s",!0===H.ja.Fs),H.ja.Fs=!0,H.ik())}));setTimeout(function(){H.ja&&H.ja.focus()},200);this.ja.focus();this.view.ra.ua("edit-text-shown",H.ja);this.view.ra.digest()};c.prototype.bH=function(a){var b="";a?b=this.ik():this.cancel();return b};c.prototype.cancel=
function(){this.ja&&(this.ja.Fs=!0,this.ja.parentNode&&this.ja.parentNode.removeChild(this.ja),this.view.ra.ua("edit-text-hidden"),this.view.Ta.Wb&&this.view.$c.ua("goto-canvas"));this.ja=null;this.Ym=!1;this.ya&&(this.ya.Ej(!1),this.ya.gh(!1),this.view.ka());this.view.Lw(this.po)?this.view.Ae(this.po):this.ml&&this.view.Gd(this.ml);this.ml=null;this.po="none"};c.prototype.va=function(a){if("underline"===a)return"underline"===this.va("textDecoration");if(a in this.ba)return this.ba[a];if(this.ya){var b=
this.ya.ia(a);if(void 0!==b)return b}switch(a){case "background":return this.view.fa.get("defaultTextBackground");case "wrap":return this.view.fa.get("multilineText");case "lineWidth":return this.view.sa.textLineWidth;case "writingMode":return this.view.fa.get("defaultWritingMode");case "textIndent":return"0"}return this.view.sa[a]};c.prototype.Pg=function(){return{textFillStyle:this.va("textFillStyle"),fillStyle:this.va("textFillStyle"),textStrokeStyle:this.va("textStrokeStyle"),bold:this.va("bold"),
italic:this.va("italic"),textDecoration:this.va("textDecoration"),strokeStyle:this.va("strokeStyle"),lineWidth:this.va("lineWidth"),fontName:this.va("fontName"),fontSize:this.va("fontSize"),textAlign:this.va("textAlign"),textIndent:this.va("textIndent"),"border-width":this.va("border-width")||0,"border-color":this.va("border-color")||q.Oa,background:this.va("background")||"transparent",underline:this.va("underline")||!1,opacity:this.va("opacity")||1,lineHeight:this.va("lineHeight")||"100%",writingMode:this.va("writingMode")}};
c.prototype.ik=function(){var a=this,b="";if(!this.ja)return b;var d=this.ja.value,c=this.ja.offsetWidth,f=5<Math.abs(c-this.ns),h=this.Lc;this.cancel();if(this.ya&&this.ya.ia("text")===d&&!this.ap&&!f)return this.log("Text was not changed."),this.ya.id;if(null===this.ya&&""===d)return this.log("No text entered."),b;if(this.ya){this.log("Update text in node %s",this.ya.id);var k={text:d,textFillStyle:this.fillStyle,textStrokeStyle:this.va("textStrokeStyle"),textAlign:this.va("textAlign"),textIndent:this.va("textIndent"),
textDecoration:this.va("textDecoration"),fontSize:this.va("fontSize"),lineHeight:this.va("lineHeight"),writingMode:this.va("writingMode")};for(l in this.ba)k[l]=this.ba[l];f&&(k.width=c/h);this.view.aa.transaction(function(){a.view.aa.Ab([a.ya.id],k)});b=this.ya.id}else if(this.Lg){this.log("Create new text node.");var l=f=0;var n=this.va("fontSize");f=n;if("center"===this.va("textAlign")&&0===(this.va("width")||0)+(this.va("padding")||0)){var r=this.MD(d)*h;l=Math.max(0,(c-r)/2);this.log("tw="+r+
" ew="+c+" Offset text by "+l+" to center.")}var u=new jc(this.Lg.x+l,this.Lg.y+f),x={};this.view.fa.get("multilineText")&&(x.width=c/h);this.view.aa.transaction(function(){b=a.view.aa.createNode("TextNode",dd({text:d,background:a.va("background"),fontSize:n,fontName:a.va("fontName"),bold:a.va("bold"),italic:a.va("italic"),lineHeight:a.va("lineHeight"),textAlign:a.va("textAlign"),textIndent:a.va("textIndent"),textFillStyle:a.va("textFillStyle"),textDecoration:a.va("textDecoration"),strokeStyle:a.va("textStrokeStyle"),
lineWidth:a.va("textLineWidth"),layer:a.ba.layer||a.view.Ud,writingMode:a.va("writingMode"),wrap:a.view.fa.get("multilineText")},a.ba,x));a.view.aa.nh([b],u)})}return b};c.prototype.MD=function(a){var b=new ee;b.El(this.va("fontName"),this.va("fontSize"),this.va("bold"),this.va("italic"),"none");b.kd(a);a=document.createElement("canvas").getContext("2d");b.format(a,0,0);return b.rect.width};c.prototype.Fb=function(){return!1};c.prototype.Dd=function(a){this.log("keyboard: %s",a);"cancel"===a&&null===
this.ja&&(this.view.Hb(),this.view.$c.ua("goto-toolbar"))};c.prototype.Wg=function(a,b){this.view.at(a,b)};c.prototype.kg=function(a,b){"defaultBold"===a?(a="bold",this.ja&&(this.ja.style.fontWeight=b?"bold":"normal")):"defaultItalic"===a?(a="italic",this.ja&&(this.ja.style.fontStyle=b?"italic":"normal")):"defaultTextBackground"===a?(a="background",this.ja&&(this.ja.style.backgroundColor=b)):"defaultFont"===a?(a="fontName",this.ja&&(this.ja.style.fontFamily=b)):"defaultFontSize"===a?(a="fontSize",
this.ja&&(this.ja.style.fontSize=b*this.Lc+"px")):"defaultTextFillStyle"===a?(a="textFillStyle",this.ja&&(this.ja.style.color=b)):"defaultTextDecoration"===a?(a="textDecoration",this.ja&&(this.ja.style.textDecoration=b)):"defaultTextAlign"===a&&(a="textAlign",this.ja&&(this.ja.style.textAlign=b));this.log("Update %s=%s",a,b);this.ap=!0;this.ba[a]=b};c.prototype.ad=function(){return"text"};c.prototype.de=function(a,b){b=ed(this.ba[a]||fe.Xt[a],b);if("underline"===a)this.de("textDecoration",b?"underline":
"none");else{this.ba[a]=b;this.ap=!0;switch(a){case "textFillStyle":case "fillStyle":this.ba.textFillStyle=b;this.view.sa.textFillStyle=b;break;case "strokeStyle":this.view.sa.textStrokeStyle=b;break;case "lineWidth":this.view.sa.textLineWidth=b}if(this.ja){var d=!1;switch(a){case "textFillStyle":case "fillStyle":this.ja.style.color=b;break;case "textStrokeStyle":case "strokeStyle":this.ja.style.webkitTextStrokeColor=b;break;case "lineWidth":this.ja.style.webkitTextStrokeWidth=b+"px";break;case "fontSize":this.ja.style.fontSize=
b*this.Lc+"px";d=!0;break;case "fontName":this.ja.style.fontFamily=b;d=!0;break;case "bold":this.ja.style.fontWeight=b?"bold":"normal";break;case "italic":this.ja.style.fontStyle=b?"italic":"normal";break;case "textDecoration":this.ja.style.textDecoration=b;break;case "textAlign":case "textIndent":case "background":case "border":this.ja.style[a]=b;break;case "border-width":this.ja.style.borderWidth=b;break;case "border-color":this.ja.style.borderColor=b;break;case "verticalAlign":this.ys();break;
case "lineHeight":this.ja.style.lineHeight=b,d=!0}d&&this.ja.dispatchEvent(new Event("propertychange"))}}};c.prototype.Oh=function(){return["TextNode"]};return c}();function Zf(c){c.addEventListener("input",function(){var a=c.value,b=a.replace(/[\u2018\u2019\u201C\u201D]/g,function(a){return"''\"\"".substr("\u2018\u2019\u201c\u201d".indexOf(a),1)});if(a!==b){a=c.selectionStart;var d=c.selectionEnd;c.value=b;c.selectionStart=a;c.selectionEnd=d}})}
function Yf(c,a){a=a.ia("lockText");return!0===a||!1===a?!a:c.fa.get("allowTextInShape")};var ag=function(c){function a(){var a=c.call(this)||this;a.li=[];a.Xh=0;a.canvas=null;a.fa=null;a.log=v.create("FORMAT",!0);return a}__extends(a,c);a.prototype.Rn=function(){return 0<this.Xh};a.prototype.Ev=function(a,d){for(var b=0;b<this.li.length;b++){var c=this.li[b];if(c.url===d&&c.Ug===a)return b}return-1};a.prototype.zw=function(){0===this.Xh&&this.ua("started");this.Xh+=1};a.prototype.eg=function(a,d,c,f){var b=this;void 0===f&&(f=null);var e=this.Ev(a,d);-1===e?(e=this.li.length,this.li.push({Ug:a,
url:d,Ru:c,EI:!1}),this.zw(),ob.load(d,function(c){--b.Xh;e=b.Ev(a,d);if(!(0>e)){var h=b.li[e];b.li.splice(e,1);try{c?(b.log("Image request completed for item %s url %s",a,d.substr(0,64)),h.Ru(c,d)):(b.log("Image request failed for url %s",d),f&&f(d))}catch(r){console.log(r)}b.check()}})):this.li[e].Ru=c};a.prototype.check=function(){this.Rn()||this.ua("done")};a.prototype.oE=function(a,d){var b=this;this.zw();var c=new af;c.ql(a).then(function(){c.ready&&d(c);b.Xh--;b.check()},function(d){b.Xh--;
console.warn("Error loading %s: ",a,d);b.check()})};a.prototype.fB=function(a,d){this.ua("convert-dom-request",a,d)};a.prototype.Bf=function(a){this.ua("reformat",a)};a.prototype.Ne=function(){if(null===this.canvas)return new K(0,0,0,0);var a=B(this.canvas).wb();return new K(a.left,a.top,this.canvas.width,this.canvas.height)};a.prototype.Zb=function(a){return this.fa?this.fa.get(a):null};return a}(rb);var bg=function(){function c(a,b){this.df=a;this.key=b}c.prototype.toString=function(){return"LValue("+this.key+")"};return c}(),cg=function(){function c(a,b,d){this.id=a;this.$n=b;d&&(this.ig=d)}c.prototype.ig=function(){return this};c.prototype.Uw=function(a){return a};c.prototype.toString=function(){return"Token(id='"+this.id+"', lbp="+this.$n+")"};return c}(),dg=function(){function c(a,b){return a[b]}function a(a,b,d){a[b]=d}function b(a){if(a instanceof bg){if(a.df===z)return A(z,a.key);if(a.df)return a.df[a.key]}else return a}
function d(a,b){void 0===b&&(b=0);var d=I[a];d?d.$n=Math.max(d.$n,b):d=I[a]=new cg(a,b);return d}function e(a,b){a=d(a);a.ig=function(){return b};return a}function f(a){return new cg("(literal)",0,function(){return a})}function h(a){var b=new cg("(name)",0,function(){return new bg(z,a)});b.toString=function(){return"Token(name: "+a+")"};return b}function k(a,d,c){l(a,d,function(a){return c(b(a),b(y(d-1)))})}function l(a,b,c){d(a,b).Uw=c}function n(a,c,e){d(a,c).ig=function(){return e(b(y(c)))}}function r(a,
b,c){d(a,b).ig=c}function u(a){return" "===a||"\t"===a||"\n"===a||"\r"===a}function x(){return xa<ya.length?ya[xa++]:I["(end)"]}function w(a){if(a&&Z.id!==a)throw Error("Error: expected "+a+" but got "+Z.id);return Z=x()}function y(a){var b=Z;Z=x();for(var d=b.ig();a<Z.$n;)b=Z,Z=x(),d=b.Uw(d);return d}var z={},A=c,G=a,I={},C=0,M,H;e("true",!0);e("false",!1);e("null",null);e("undefined",void 0);d("(end)");(function(a,d,c){l(a,d,function(a){return c(b(a),b(y(d)))})})(",",M=++C,function(a,b){return b});
l("=",H=++C,function(a){var d=y(H);if(!(a instanceof bg))throw Error("Error: lhs of = must be assignable");d=b(d);if(a.df===z)G(z,a.key,d);else if(a.df instanceof Object)a.df[a.key]=d;else throw Error(a.df+"["+a.key+"] cannot be assigned to.");return d});k("&&",++C,function(a,b){return a&&b});k("||",++C,function(a,b){return a||b});k("|",++C,function(a,b){return a|b});k("^",++C,function(a,b){return a^b});k("&",++C,function(a,b){return a&b});k("===",++C,function(a,b){return a===b});k("!==",C,function(a,
b){return a!==b});k("==",C,function(a,b){return a==b});k("!=",C,function(a,b){return a!=b});k(">",++C,function(a,b){return a>b});k(">=",C,function(a,b){return a>=b});k("<",C,function(a,b){return a<b});k("<=",C,function(a,b){return a<=b});k("in",C,function(a,b){return a in b});k("<<",++C,function(a,b){return a<<b});k(">>",C,function(a,b){return a>>b});k(">>>",C,function(a,b){return a>>>b});k("+",++C,function(a,b){return a+b});k("-",C,function(a,b){return a-b});k("*",++C,function(a,b){return a*b});
k("/",C,function(a,b){return a/b});k("%",C,function(a,b){return a%b});n("!",++C,function(a){return!a});n("~",C,function(a){return~a});n("+",C,function(a){return+a});n("-",C,function(a){return-a});n("typeof",C,function(a){return typeof a});l(".",++C,function(a){var d=Z;if("(name)"!==d.id)throw Error("Error: '.' expects a name, not "+Z.id);if(a instanceof bg)a.df=b(a),a.key=d.ig().key;else if(a instanceof Object||"string"===typeof a||"number"===typeof a)a=new bg(b(a),d.ig().key);else throw Error("Error: '.' must be preceded by object");
w();return a});r("(",++C,function(){var a=y(0);w(")");return a});d(")");l("(",++C,function(a){var d=[];if(")"!==Z.id)for(;;){d.push(b(y(M+1)));if(","!==Z.id)break;w(",")}w(")");var c=null;a instanceof bg&&(c=a.df);a=b(a);if("function"!==typeof a)throw Error("Tried to call a non-function; type was "+typeof a);return a.apply(c,d)});d(",");l("[",C,function(a){var d=y(0);if(!(a instanceof bg))throw Error("Error: '[]' must be preceded by lvalue");w("]");a.df=b(a);a.key=b(d);return a});d("]");r("{",++C,
function(){for(var a={};"}"!==Z.id;){if("(literal)"===Z.id)var d=Z.ig();else if("(name)"===Z.id)d=Z.ig().key;else throw Error("Bad {}; expecting name or string constant");w();w(":");a[d]=b(y(M+1));if(","!==Z.id)break;Z=w(",")}w("}");return a});r("[",C,function(){for(var a=[];"]"!==Z.id;){a.push(b(y(M+1)));if(","!==Z.id)break;Z=w(",")}w("]");return a});d(",");d(":");d("}");var V=/(\d+(\.\d+)?)|(===|!==|==|!=|\+=|-=|&&|\|\||<=|>=|<<|>>>|>>|&&|\|\||[{}\(\)\[\]\+\-\.\*\/=!,\?&\|:%~<>])|([a-zA-Z\$_][\$_a-zA-Z0-9]*)|("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g,
ya=[],xa=0,Z;return{parse:function(a){for(var b=[],d=0;d<a.length;){for(;u(a.charAt(d));)d++;V.lastIndex=d;var c=V.exec(a);if(c&&c.index===d)if(d+=c[0].length,c[1])b.push(f(parseFloat(c[1])));else if(c[3]&&c[3]in I)b.push(I[c[3]]);else if(c[4])switch(c[4]){case "true":case "false":case "null":case "in":case "typeof":case "undefined":b.push(I[c[4]]);break;default:b.push(h(c[4]))}else{if(c[5]){c=c[5].substr(1,c[5].length-2);for(var e="",k=!1,l=0;l<c.length;l++){var n=c[l];if(k){switch(n){case "n":n=
"\n";break;case "r":n="\r";break;case "t":n="\t"}e+=n;k=!1}else"\\"===n?k=!0:e+=n}b.push(f(e))}}else throw Error("Parse error: Expected stuff in "+a+" near: "+a.substr(d));}b.push(I["(end)"]);return b},evaluate:function(d,e,f,h){xa=0;ya=e;z=d;A=f||function(a,b){return a[b]};G=h||function(a,b,d){a[b]=d};Z=x();d=b(y(0));z={};A=c;G=a;return d}}}(),eg=dg.parse,fg=dg.evaluate;function gg(c,a,b){try{return fg(c,eg(a),b)}catch(d){console.log("When evaluating: %s on scope ",a,c),console.log(d)}}
function hg(c,a){if(c===a)return!0;if(!(c instanceof Object&&a instanceof Object)||c.constructor!==a.constructor)return!1;for(var b in c)if(c.hasOwnProperty(b)&&(!a.hasOwnProperty(b)||c[b]!==a[b]&&("object"!==typeof c[b]||!hg(c[b],a[b]))))return!1;for(b in a)if(a.hasOwnProperty(b)&&!c.hasOwnProperty(b))return!1;return!0}
var ig=function(){function c(){this.ug={};this.Go=!1;this.Vp=[];this.be=0}c.prototype.Bc=function(a,b,d){a={scope:a,parsed:eg(b),px:void 0,lx:d};b in this.ug?this.ug[b].push(a):this.ug[b]=[a];this.check()};c.prototype.AH=function(a,b){if(a in this.ug){for(var d=this.ug[a],c=0;c<d.length;c++)if(d[c].lx===b){d.splice(c,1);break}0===d.length&&delete this.ug[a]}};c.prototype.check=function(a){var b=this;this.Go=!0;a&&this.Vp.push(a);0===this.be&&(this.be=window.requestAnimationFrame(function(){for(var a=
0;10>a&&b.Go;a++){b.Go=!1;for(var c in b.ug)for(var f=null,h=void 0,k=0;k<b.ug[c].length;k++){var l=b.ug[c][k];try{l.scope!==f&&(h=fg(l.scope,l.parsed),f=l.scope),hg(l.px,h)||(l.px=h,l.lx(h),b.Go=!0)}catch(n){console.log("Error when evaluating %s: ",c,n),console.log("Context was: %o",l.scope)}}h=b.Vp;b.Vp=[];for(f=0;f<h.length;f++)(0,h[f])()}b.be=0}))};return c}();var jg=v.create("Zeact"),lg=function(){function c(a,b,d,c,f){this.Xl=a;this.scope=b;this.element=d;this.name=c;this.value=f}c.prototype.emit=function(a,b){this.Xl.ua(this.element,a,b)};c.prototype.listen=function(a,b,d){if(b instanceof EventTarget&&d)this.Xl.Ua(this.element,a,d,b);else if("function"===typeof b)this.Xl.Ua(this.element,a,b);else throw Error("listen: invalid arguments.");};c.prototype.watch=function(a,b){this.Xl.Bc(this.scope,this.element,a,b)};c.prototype.eval=function(a){return kg.bn(this.scope,
a,this.element)};c.prototype.destructor=function(a){this.Xl.Aa(this.element,a)};return c}(),mg=function(){function c(){this.Lt=new ig;this.pk={};this.Ie={};this.qc=new Ya;this.all=new Set;this.Cz=1}c.prototype.vm=function(a){return a};c.prototype.Sa=function(){this.qc.Sa()};c.prototype.Mb=function(a,b,d){void 0===d&&(d=2);this.pk[a]={name:a,link:b,Ny:d}};c.prototype.fk=function(a,b){this.Ie[a.toUpperCase()]=b;"string"===typeof b.template&&(b.template=b.template.trim())};c.prototype.Ze=function(a,
b){var d=this;this.Mb(a,function(a,c,h,k){d.To(a,function(){d.Bc(a,c,k,function(d){b(c,d,a)})})})};c.prototype.Bc=function(a,b,d,c){var e=this;this.Lt.Bc(a,d,c);this.Aa(b,function(){e.Lt.AH(d,c)})};c.prototype.To=function(a,b){a.hasOwnProperty("$issettled")?(b(),this.digest()):a.hasOwnProperty("$settledWaiters")?a.$settledWaiters.push(b):a.$settledWaiters=[b]};c.prototype.vE=function(a){if(!a.hasOwnProperty("$issettled")&&(a.$issettled=!0,a.$settledWaiters)){for(var b=a.$settledWaiters.length-1;0<=
b;b--)try{a.$settledWaiters[b]()}catch(d){console.error("Error executing scope.$settledWaiters["+b+"]: ",d),console.log("Type was: ",typeof a.$settledWaiters[b]),console.log("Scope was: ",a)}delete a.$settledWaiters;this.digest()}};c.prototype.Ua=function(a,b,d,c){void 0===c&&(c=a);c.addEventListener(b,d);this.Aa(a,function(){c.removeEventListener(b,d)});a===c&&(a.zwibblerListeners||(a.zwibblerListeners={}),a.zwibblerListeners[b]||(a.zwibblerListeners[b]=[]),a.zwibblerListeners[b].push(d))};c.prototype.ua=
function(a,b,d){var c=this;setTimeout(function(){c.Nb(a,b,d)},0)};c.prototype.Nb=function(a,b,d){if(a.zwibblerListeners&&b in a.zwibblerListeners)for(var c=0,f=a.zwibblerListeners[b];c<f.length;c++){var h=f[c];try{h.call(a,d)}catch(k){console.log("Error while handling event "+b+": ",k)}}};c.prototype.Aa=function(a,b){a.zwibblerWatchers?a.zwibblerWatchers.push(b):(this.all.add(a),a.zwibblerWatchers=[b])};c.prototype.detach=function(a){for(var b=a.firstChild;b;){var d=b.nextSibling;this.detach(b);b=
d}this.all.delete(a);if(a.zwibblerWatchers){b=0;for(d=a.zwibblerWatchers;b<d.length;b++){var c=d[b];try{c()}catch(f){console.log("Error detaching ",a,f)}}delete a.zwibblerWatchers}a.zwibblerListeners&&delete a.zwibblerListeners;a.Jz&&delete a.Jz;a.dm&&delete a.dm;delete a.af;delete a.Jf};c.prototype.digest=function(a){this.Lt.check(a)};c.prototype.oC=function(a,b){if(a=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase()))if(a=a[1],a in this.pk&&this.pk[a].Ny===b)return this.pk[a];return null};c.prototype.dE=
function(a){return(a=/^z-([a-z0-9@\-]+)/.exec(a.toLowerCase()))&&this.pk[a[1]]};c.prototype.Gu=function(a,b,d,c){void 0===c&&(c=b);for(var e=b.parentNode,h=[],k=0;k<c.attributes.length;k++)h.push({name:c.attributes[k].name,value:c.attributes[k].value});for(k=0;k<h.length&&b.parentNode===e;k++){c=h[k].name;var l=h[k].value,n=this.oC(c,d);if(n&&n.Ny===d&&(c=n.link(a,b,c,l))&&c!==b)return{ea:c,Gs:!0}}return{ea:b,Gs:b.parentNode!==e}};c.prototype.hk=function(a,b,d,c){b=document.createElement(b);for(var e in d)b.setAttribute(e,
d[e]);c&&(b.sp=c);a=this.rd(a,b);delete b.sp;return a};c.prototype.rA=function(a,b){var d=this,c=b.getAttribute("z-use-component")||b.tagName,f=this.Ie[c.toUpperCase()];if(!f)return null;jg("Attaching component %s",c);var h=f.template;if(h instanceof HTMLElement)var k=h.cloneNode(!0);else if("string"===typeof h)if("<"===h[0]){jg("Using elementsFromString to instantiate component");var l=B.Zm(h);if(0===l.length)throw Error("Component "+c+": Could not interpret as HTML: "+h);if(1<l.length)throw Error("Component "+
c+": Should render as a single element, but got "+l.length);k=l[0]}else{jg("Using querySelector to instantiate component");k=document.querySelector(h);if(null===k)throw Error("Component "+c+': querySelector("'+h+'") returned null');k=k.cloneNode(!0)}else throw Error("Component "+c+": Could not interpret template "+h);k.hasAttribute("z-if")&&console.warn("Zwibbler component "+c+" has z-if directive on main element; please outside of component.");h=null!==b.parentNode;null!==b.parentNode&&b.parentNode.replaceChild(k,
b);this.Aa(k,function(){k.parentNode&&k.parentNode.replaceChild(b,k);d.detach(b)});var n=this,r={$emit:function(a,b){n.ua(k,a,b)},$emitNow:function(a,b){n.Nb(k,a,b)},$listen:function(a,b){var d=this;n.Ua(k,a,function(a){b.call(d,a);n.digest()})},$destructor:function(a){n.Aa(k,a)},$watch:function(a,b){n.Bc(r,k,a,b)}};if(b.sp){l=b.sp;for(var u in r)l[u]=r[u];r=l}this.vm(r);Object.defineProperty(r,"$element",{configurable:!0,get:function(){return k}});Object.defineProperty(r,"$parent",{configurable:!0,
get:function(){return a}});u=f.properties;var x={"z-use-component":!0};u&&u.forEach(function(c){x[c]=1;var e=b.getAttribute(c);e&&d.To(a,function(){jg("Bind prop %s to %s",c,e);r[c]=gg(a,e);d.Bc(a,k,e,function(a){r[c]=a})})});k.zz=1;k.Jf=r;(u=k.querySelector("slot"))||(u=k);for(l=b.firstChild;l;){var w=l.nextSibling;u.appendChild(l);l.af=l.af||a;l=w}f.style&&this.qc.Ir(f.style);for(u=0;u<b.attributes.length;u++)if(w=b.attributes[u].name,l=b.attributes[u].value,!x[w]&&!this.dE(w))if("class"===w)for(w=
0,l=l.split(" ");w<l.length;w++)k.classList.add(l[w]);else{if("style"===w){var y=k.getAttribute("style");y&&(l=y+";"+l)}try{k.setAttribute(w,l)}catch(z){console.warn("When attaching component %s, setting HTML attribute %s=%s resulting in error: ",c,w,l,z)}}jg("apply directives from parent");for(c=1;2>=c;c++)if(u=this.Gu(a,k,c,b),h&&u.Gs)return{scope:r,node:u.ea};jg("apply directives from child");jg("done applying");if(f.controller)try{f.controller(r,new lg(this,r,k,"","")),this.digest()}catch(z){console.log(z),
console.log("When running controller for %s",b.tagName)}return this.rd(r,k)};c.prototype.rd=function(a,b){var d=this;b=this.cu(b.af||a,b);this.digest(function(){d.vE(a)});return b};c.prototype.cu=function(a,b){if(1===b.nodeType){if(b.dm)return{node:b,scope:a};b.dm=this.Cz++;b.af=a;for(var d=0;2>=d;d++){var c=this.Gu(a,b,d);if(c.Gs)return{node:c.ea,scope:a};if(0===d&&(c=this.rA(a,b)))return c}for(d=b.firstChild;d;)c=d.nextSibling,d.zz||this.cu(d.af||a,d),d=c}return{node:b,scope:a}};return c}(),kg;
(function(c){function a(a,b,d){var c=b.type?b.type.toLowerCase():"",e=d;if("zwibblerValue"in b)var f="zwibblerValue";else f="value",e=""+e;if("radio"===c)b.checked=b[f]===e;else if("checkbox"===c)b.checked=!!d;else{if("SELECT"===b.tagName){c=0;for(var h=b.querySelectorAll("option");c<h.length;c++){var u=h[c],x=u.getAttribute("z-value");if(x){if(gg(u.af?u.af:a,x)===d){u.selected=!0;return}}else if(x=u.getAttribute("value")||u.textContent||u.outerHTML,x===e){u.selected=!0;return}}}else b.Jf&&(b.Jf.value=
d);b[f]=e}}function b(a,b){var d=b.type?b.type.toLowerCase():"";if("checkbox"===d)return"zwibblerValue"in b?b.zwibblerValue:b.checked;if("radio"===d)(a=b.getAttribute("name"))&&(a=document.querySelector('input[name="'+a+'"]:checked'))&&(b=a);else if("SELECT"===b.tagName){d=0;for(var c=b.querySelectorAll("option");d<c.length;d++){var e=c[d];if(e.selected){var f=e.getAttribute("z-value");if(f)return gg(e.af?e.af:a,f)}}}else if(b.Jf)return b.Jf.value;return"zwibblerValue"in b?b.zwibblerValue:b.value}
function d(a,b,d,c,l){d&&(a["this"]=d);a.$event=c;return gg(a,b,l)}c.ty=a;c.YC=b;c.bn=d;c.qh=function(c){function e(a,b){var d=a.indexOf(b);return-1===d?"":a.substr(d+b.length+1)}var h=new mg;c&&(h.vm=c);h.Mb("init",function(a,b,c,e){d(a,e,b)});h.Ze("text",function(a,b){a.textContent=b});h.Ze("json",function(a,b){a.textContent=JSON.stringify(b)});h.Ze("html",function(a,b){a.innerHTML=b});h.Mb("model",function(d,c,e,f){function k(){n?jg("Ignoring initial element->model change on %s[%s]",c.tagName,
f):(l=b(d,c),jg("input -> model: New value for %s: %s",f,l),d.anjnwjewaq=l,gg(d,f+"=anjnwjewaq"),delete d.anjnwjewaq,h.digest())}var l=null,n=!1;"checkbox"===c.type||"radio"===c.type||"number"===c.type||"text"===c.type||"TEXTAREA"===c.tagName?h.Ua(c,"change",k):c.Jf?(n=!0,h.Bc(c.Jf,c,"value",k)):h.Ua(c,"input",k);h.To(d,function(){var b=c.getAttribute("z-value");b&&(h.Bc(d,c,b,function(e){jg("z-value for %s[%s] is %s",c.tagName,b,e);c.zwibblerValue=e;n=!1;a(d,c,l)}),h.Aa(c,function(){delete c.zwibblerValue}));
h.Bc(d,c,f,function(b){jg("model(%s) -> %s[%s] : new value is %s",f,c.tagName,c.type,b);l=b;n=!1;a(d,c,b)})});"SELECT"===c.tagName&&h.Ua(c,"options-changed",function(){setTimeout(function(){jg("model(%s) -> %s[%s] due to <OPTION> creation",f,c.tagName,c.type);n=!1;a(d,c,l)},1)})});h.Mb("on",function(a,b,c,f){var k=e(c,"on");""!==k&&h.Ua(b,k,function(c){jg("Got %s, execute %s",k,f);var e=d(a,f,b,c);h.digest();c&&c.preventDefault&&!1===e&&c.preventDefault()})});var k={disabled:1,readonly:1};h.Mb("bind",
function(a,b,d,c){var f=e(d,"bind").toLowerCase();""!==f&&h.Bc(a,b,c,function(a){f in k?a?b.setAttribute(f,"TRUE"):b.removeAttribute(f):b.setAttribute(f,a);"value"===f&&"SELECT"===b.tagName&&(b.value=a)})},1);h.Mb("for",function(a,b,d,c){d=c.indexOf(" in ");if(-1!==d){var e=c.substr(0,d),f=c.substr(d+4),k=[];jg("z-for '%s' in '%s'",e,f);var l=b.parentNode,n=b.nextSibling;b.parentNode.removeChild(b);var u=[];h.Bc(a,l,f,function(d){if("number"===typeof d){for(var c=[],r=0;r<d;r++)c.push(r);d=c}if("object"===
typeof d&&null!==d&&"length"in d){for(r=c=0;r<Math.min(u.length,d.length);r++)if(hg(u[r],d[r]))c+=1;else break;u=d.concat();for(r=2*c;r<k.length;r++){var x=k[r];x.parentNode&&x.parentNode.removeChild(x);h.detach(x)}k.length=2*c;for(r=c;r<d.length;r++)c=document.createComment("z-for "+f+"["+r+"] = "+d[r]),l.insertBefore(c,n),k.push(c),c=Object.create(a),Object.defineProperty(c,"$parent",{configurable:!0,get:function(){return a}}),c.$index=r,c[e]=d[r],x=b.cloneNode(!0),x.removeAttribute("z-for"),l.insertBefore(x,
n),c=h.rd(c,x).node,k.push(c);"OPTION"===b.tagName&&l.dispatchEvent(new CustomEvent("options-changed",{bubbles:!0}))}});h.Aa(l,function(){for(var a=0;a<k.length;a++){var d=k[a];d.parentNode&&d.parentNode.removeChild(d);h.detach(d)}k.length=0;l.insertBefore(b,n);h.detach(b)})}},0);h.Mb("if",function(a,b,d,c){var e=document.createComment(d+" "+c),f=b.parentElement,k=null,l=null;f.replaceChild(e,b);h.Bc(a,f,c,function(c){c&&!k?(k=b.cloneNode(!0),k.removeAttribute(d),e.parentNode&&e.parentNode.replaceChild(k,
e),c=h.rd(a,k),l=k,k=c.node):!c&&k&&(h.detach(k),l&&l!==k&&h.detach(l),k.parentNode&&k.parentNode.replaceChild(e,k),l&&l.parentNode&&l.parentNode.replaceChild(e,l),l=k=null)});h.Aa(f,function(){k?(h.detach(k),l&&l!==k&&h.detach(l),k.parentNode&&k.parentNode.replaceChild(b,k),l&&l.parentNode&&l.parentNode.replaceChild(b,l)):e.parentNode&&e.parentNode.replaceChild(b,e);h.detach(b)})},0);h.Ze("class",function(a,b){for(var d in b)B(a).rt(d,b[d])});h.Ze("style",function(a,b){for(var d in b)a.style[d]=
b[d]});h.Ze("selected",function(a,b){B(a).rt("selected",b)});h.Ze("disabled",function(a,b){b?a.setAttribute("disabled","true"):a.removeAttribute("disabled")});h.Ze("enabled",function(a,b){b?a.removeAttribute("disabled"):a.setAttribute("disabled","true")});h.Ze("hide",function(a,b){a.style.display=b?"none":""});h.Ze("checked",function(a,b){a.checked=b?!0:!1});h.Mb("ref",function(a,b,d,c){a[c]=b;h.Aa(b,function(){a[c]===b&&delete a[c]})});h.Mb("destroy",function(a,b,c,e){h.Aa(b,function(){"function"===
typeof d(a,e,b)&&console.warn("z-destroy result was a function. Did you mean to call it with %s()?",e)})});return h}})(kg||(kg={}));var ng=kg;var og=v.create("SpliceText"),pg=function(c){function a(a,d,e,f,h){var b=c.call(this)||this;b.kc=a;b.text=d;b.start=e;b.length=f;b.style=h;b.jg=[];return b}__extends(a,c);a.prototype.Uh=function(b){if(!(b instanceof a))return!1;og("?merge(%s,%s,%s) and (%s,%s,%s)",this.start,this.length,this.text.substr(0,5),b.start,b.length,b.text.substr(0,5));return 0===this.length&&0===b.length&&this.start+this.text.length===b.start&&(null===this.style&&null===b.style||null!=this.style&&null!==b.style&&this.style.xd(b.style))?
(this.text+=b.text,og("Merging SpliceTextAction"),!0):0!==this.text.length||0!==b.text.length||this.start!==b.start&&b.start+b.length!==this.start?!1:(this.length+=b.length,this.start<b.start?this.jg=this.jg.concat(b.jg):(this.jg=b.jg.concat(this.jg),this.start=b.start),og("Merging Deletes"),!0)};a.prototype.Ec=function(){og("Execute SpliceTextAction(del=%s/%s insert %s...)",this.start,this.length,this.text.substr(0,5));this.kc.cl(this.start);0<this.length&&(og("Removing text"),this.jg=this.kc.text.remove(this.start,
this.length));if(0<this.text.length){if(null===this.style)throw Error("style is null");var a=new zd(this.style,this.text);this.kc.text.Pn(this.start,[a])}};a.prototype.nd=function(){og("Undo SpliceTextAction(del=%s/%s insert %s)",this.start,this.length,this.text);0<this.text.length&&this.kc.text.remove(this.start,this.text.length);this.jg.length&&this.kc.text.Pn(this.start,this.jg);this.kc.cl(this.start)};return a}(gb);var qg=v.create("UNDO"),rg=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.kc=a;b.from=d;b.length=e;b.style=f;b.ox=[];return b}__extends(a,c);a.prototype.Ec=function(){qg("Do apply style");this.kc.cl(this.from);this.ox=this.kc.text.ew(this.from,this.length);this.kc.text.Va(this.style,this.from,this.length)};a.prototype.nd=function(){qg("Undo apply style");this.kc.cl(this.from);this.kc.text.HG(this.ox)};a.prototype.Uh=function(){return!1};return a}(gb);var sg=v.create("TextEditor"),tg=function(c){function a(a,d){var b=c.call(this)||this;b.Jd=a;b.sa=d;b.Zj=0;b.Gi=0;b.Cg=null;b.Fm=0;b.maxLength=-1;b.active=!1;b.text=new Ld(d);return b}__extends(a,c);a.prototype.setActive=function(a){this.active=a;sg("setActive: %s",this.active)};a.prototype.yj=function(a,d){switch(a){case "max-length":"number"===typeof d&&(this.maxLength=d)}};a.prototype.Yd=function(){return this.active};a.prototype.Kk=function(){return Math.min(this.Zj,this.Gi)};a.prototype.Jk=function(){return Math.max(this.Zj,
this.Gi)};a.prototype.save=function(a,d){void 0===a&&(a=0);void 0===d&&(d=this.text.length);return this.text.save(a,d,new vd).toString()};a.prototype.rr=function(){return this.text.count()};a.prototype.Fd=function(a,d){void 0===d&&(d=a);this.Gi=a;this.Zj=d;this.pe("selchange")};a.prototype.pb=function(){this.Fd(0,0)};a.prototype.exec=function(a,d){var b=this.Gi;switch(a){case "bold":this.ep("fontWeight","bold","normal");return;case "italic":this.ep("fontStyle","italic","normal");return;case "underline":this.ep("underline",
!0,!1);return;case "orange":this.ep("background","orange","transparent");return;case "undo":sg("Processing undo");this.Jd.nd(this);this.Fd(b);return;case "redo":sg("Processing redo");this.Jd.We(this);this.Fd(b);return;case "font":this.wm("fontFamily",d);return;case "fontSize":"string"===typeof d&&(d=parseFloat(d)||2);this.wm("fontSize",d);return;case "align":this.wm("align",d);break;case "delete":sg("Delete text");this.Ds(!1);return;case "backspace":sg("Delete text backspace");this.Ds(!0);return;
case "select-none":this.Fd(b,b);return;case "select-all":this.Fd(0,this.rr());return}this.bh()};a.prototype.ep=function(a,d,c){var b=this.Kk();b=this.text.ew(b,this.Jk()-b);for(var e,k=0;k<b.length&&(e=b[k].style,e.get(a)===d);k++);this.wm(a,k<b.length?d:c)};a.prototype.Cw=function(a){var b=this.Kk(),c=this.Jk()-b;a=a.replace("\r","\n");if(0<=this.maxLength){var f=this.rr();a=a.substr(0,this.maxLength-f+c);if(0===a.length)return}sg("Delete %s/%s Insert char %s...",b,c,a.substr(0,5));this.Cg&&this.Fm===
b&&0===c?(f=this.Cg,sg("Using recording caret style: %s",f)):f=0===c&&0<b?this.text.Yi(b-1):this.text.Yi(b);this.Jd.Ea(new pg(this,a,b,c,f),!1,this);this.Fd(b+a.length,b+a.length);this.Cg=null};a.prototype.wm=function(a,d){if("string"===typeof a){var b=new ud(rd);b.set(a,d||"")}else b=a;if(b.empty())sg("apply empty style; ignore");else{a=this.Kk();d=this.Jk();var c=[];if(b.has("align")){var h=new ud(rd);h.set("align",b.get("align"));var k=this.text.CD(a,d);0<k.length&&(sg("Apply paragraph style to %s:%s %s",
k.start,k.start+k.length,b),c.push(new rg(this,k.start,k.length,h)))}sg("applystyle called set %s:%s %s",a,d,b);a!==d?c.push(new rg(this,a,d-a,b)):(this.Cg=null===this.Cg||this.Fm!==a?this.text.Yi(a).clone():this.Cg.clone(),this.Cg.Uh(b),this.Fm=a,sg("Recording new caret style: %s",this.Cg));this.Jd.Ea(c,!1,this)}};a.prototype.Ds=function(a){var b=this.Kk(),c=this.Jk()-b;sg("Delete %s characters (totalCount=%s)",c,this.text.count());c?(this.Jd.Ea(new pg(this,"",b,c,null),!1,this),this.Fd(b)):a&&0<
b?(this.Jd.Ea(new pg(this,"",b-1,1,null),!1,this),this.Fd(b-1)):b<this.text.count()&&this.Jd.Ea(new pg(this,"",b,1,null),!1,this);this.Fm=-1};a.prototype.JD=function(){var a=this.Kk(),d=this.Jk()-a;sg("getSelectedText()=%s",this.text.zd(a,d));return this.text.zd(a,d)};a.prototype.nl=function(a){var b=this;if(this.active)switch(sg("Received clipboard event: %s",a.type),a.type){case "copy":case "cut":sg("Cut/Copy to system clipboard.");var c=this.JD();sg("text=%s",c);c.length&&(a.clipboardData.setData("text/plain",
c),a.preventDefault(),"cut"===a.type&&this.Ds(!1));break;case "paste":sg("There are %s items on the clipboard",a.clipboardData.items.length);for(c=0;c<a.clipboardData.items.length;c++){var f=a.clipboardData.items[c];sg("Item [%s] type is %s",c,f.type);"text/plain"===f.type&&f.getAsString(function(a){b.Cw(a)})}a.preventDefault()}};a.prototype.cl=function(){};a.prototype.bh=function(){};return a}(rb);var ug=v.create("HTMLTextEditor"),zg=function(c){function a(a,d,e){void 0===e&&(e={});var b=c.call(this,new hb,(new ud(rd)).hn(window.getComputedStyle(d),d.tagName))||this;b.ea=d;b.options=e;b.Bd=new sb;b.PG(a);a.addEventListener(document,"selectionchange",function(){b.WE()});a.addEventListener(document,"cut",function(a){b.nl(a)});a.addEventListener(document,"copy",function(a){b.nl(a)});a.addEventListener(document,"paste",function(a){b.nl(a)});vg(b.text,d,b.sa);b.bh();b.pa("reformat",function(){b.bh()});
return b}__extends(a,c);a.prototype.Er=function(){var a=this.ea.firstElementChild;a&&this.options.$B&&(a.style.whiteSpace=this.active?"nowrap":"",a.style.textOverflow="ellipsis",a.style.overflow="hidden");this.options.placeholder&&null===this.ea.firstChild&&(a=B("div").Va({opacity:"0.5"}).kd(this.options.placeholder).ke(this.ea).ea,this.sa.Ff(a.style))};a.prototype.kd=function(a){this.oG(B.dC(a))};a.prototype.oG=function(a){this.ea.innerHTML=a;this.text=new Ld(this.sa);vg(this.text,this.ea,this.sa);
B(this.ea).clear();a=this.text;var b=this.ea,c=this.sa,f=!!this.options.jh;a.save(0,a.count(),new wg(b,c,f));this.Fd(0,0);this.Er()};a.prototype.PG=function(a){var b=this;this.Bd.map("ctrl+b,cmd+b","bold");this.Bd.map("ctrl+i,cmd+i","italic");this.Bd.map("ctrl+u,cmd+u","underline");this.Bd.map("ctrl+z,cmd+z","undo");this.Bd.map("ctrl+shift+z,cmd+shift+z","redo");this.Bd.map("delete","delete");this.Bd.map("backspace","backspace");this.Bd.pa("*",function(a,d){ug("Keyboard event: ",a);d.preventDefault();
d.stopPropagation();b.exec(a)});this.Bd.Lu(this.ea);a.add(function(){b.Bd.detach(b.ea)});a.addEventListener(this.ea,"keypress",function(a){var d=a.charCode;13===d&&b.options.jh?b.ua("enter"):(b.Cw(String.fromCharCode(d)),a.preventDefault(),b.bh())})};a.prototype.setActive=function(a){c.prototype.setActive.call(this,a);a?(this.ea.setAttribute("contenteditable","TRUE"),this.ea.focus()):(this.ea.setAttribute("contenteditable","FALSE"),this.ea.blur());this.Er()};a.prototype.WE=function(){if(this.active){var a=
document.getSelection();if(null===a)this.pb();else if(null===a.focusNode||null===a.anchorNode)this.pb();else if(a.anchorNode===this.ea)ug("Select-all %s..%s",0,this.text.length),c.prototype.Fd.call(this,0,this.text.count());else{var d=xg(this.ea,a.anchorNode,a.anchorOffset);a=xg(this.ea,a.focusNode,a.focusOffset);-1!==d&&-1!==a&&(0===this.text.count()&&(a=d=0),a!==this.Gi||d!==this.Zj)&&(c.prototype.Fd.call(this,a,d),ug("Selected %s..%s",d,a))}}};a.prototype.Fd=function(a,d){void 0===d&&(d=a);ug("self-set caret position: %s..%s",
d,a);c.prototype.Fd.call(this,a,d);var b=yg(this.ea,a),f=yg(this.ea,d),h=document.createRange();d<=a?(h.setStart(f.node,f.offset),h.setEnd(b.node,b.offset)):(h.setStart(b.node,b.offset),h.setEnd(f.node,f.offset));if(a=window.getSelection())a.removeAllRanges(),a.addRange(h)};a.prototype.cl=function(a){ug("Mark for reformat: %s",a);this.pe("reformat")};a.prototype.bh=function(){B(this.ea).clear();var a=this.text,d=this.ea,c=this.sa,f=!!this.options.jh;a.save(0,a.count(),new wg(d,c,f));this.Fd(this.Gi,
this.Zj);this.Er()};a.prototype.exec=function(a,d){c.prototype.exec.call(this,a,d);this.bh()};return a}(tg);
function xg(c,a,b){function d(c){if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));if(c===a)return c instanceof Element&&c.children[0]&&"BR"===c.children[0].tagName&&1===b&&--e,h=!0;"DIV"===c.tagName&&(f=!0);for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){if(c===a)return h=!0;c=Ag(c.nodeValue,f);e+=c.length;c.length&&(f=!1)}return!1}var e=0,f=!0,h=!1;for(c=c.firstChild;c&&!d(c);)c=c.nextSibling;return h?e+b:-1}
function yg(c,a){function b(c){d=c;f=0;if(c.nodeType===Node.ELEMENT_NODE){var k=c.getAttribute("t-off");k&&(e=parseFloat(k));"DIV"===c.tagName&&(h=!0);for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return!!c}if(c.nodeType===Node.TEXT_NODE){c=Ag(c.nodeValue,h);if(e+c.length>=a)return f=a-e,!0;e+=c.length;c.length&&(h=!1)}return!1}var d=c,e=0,f=0,h=!0;for(c=c.firstChild;c&&!b(c);)c=c.nextSibling;return{node:d,offset:f}}
function Ag(c,a){for(var b="",d=0;d<c.length;d++){var e=c[d];switch(e){case " ":case "\n":case "\r":case "\t":a||(b+=" ",a=!0);break;default:b+=e,a=!1}}return b}
function vg(c,a,b){function d(a,b){if(a.nodeType===Node.ELEMENT_NODE){switch(a.tagName){case "DIV":case "P":l||(f+="\n"),l=!1}"DIV"===a.tagName&&(n=!0);a instanceof HTMLElement&&(b=b.hn(a.style,a.tagName));for(a=a.firstChild;a;)d(a,b),a=a.nextSibling}else a.nodeType===Node.TEXT_NODE&&(h.xd(b)||(e(h),h=b),b=Ag(a.nodeValue,n),f+=b,b.length&&(n=!1))}function e(a){f.length&&(k.push(new zd(a,f)),f="")}var f="",h=b,k=[],l=!0,n=!0;for(a=a.firstChild;a;)d(a,b),a=a.nextSibling;e(h);k.length&&c.append(k)}
var wg=function(){function c(a,b,d){this.root=a;this.nv=b;this.jh=d;this.gl=this.nv;this.span=this.wa=null;this.offset=0;this.style=b}c.prototype.hz=function(a){ug("writeStyle("+a.toString());this.gl=a};c.prototype.it=function(){ug("startLine");this.wa=document.createElement("DIV");this.root.appendChild(this.wa);this.wa.setAttribute("t-off",this.offset.toString());this.wa.style.whiteSpace=this.jh?"nowrap":"pre-wrap";this.style=this.nv;this.wa.style.fontSize=this.gl.get("fontSize")+"px"};c.prototype.Kq=
function(){ug("endLine");if(!this.wa)throw Error("Expected div to exist");null===this.wa.firstChild&&this.wa.appendChild(document.createElement("BR"));this.span=this.wa=null;this.offset+=1};c.prototype.iz=function(a){ug("writeText("+a+")");if(!this.wa)throw Error("Expected div to exist");null!==this.span&&this.style.xd(this.gl)||(this.span=document.createElement("SPAN"),this.wa.appendChild(this.span),this.gl.Ff(this.span.style),this.style=this.gl);this.span.appendChild(document.createTextNode(a));
this.offset+=a.length};return c}();var Bg=new (function(){function c(){this.Pq={}}c.prototype.xm=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.xm()?window.localStorage.setItem(a,b):this.Pq[a]=""+b};c.prototype.getItem=function(a){return this.xm()?window.localStorage.getItem(a):this.Pq[a]};c.prototype.removeItem=function(a){this.xm()?window.localStorage.removeItem(a):delete this.Pq[a]};return c}());var Dg=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.fd=[];this.fonts={};this.images=[];this.gp={};this.Ic=1;this.dB=!0;this.page={};this.log=v.create("PdfWriter");this.oj=this.object("Pages",{Kids:[],Count:0});this.OA=this.object("Catalog",{Pages:this.oj._id+" 0 R"});this.Gj()}c.prototype.gE=function(){if(null!==c.Jp)return c.Jp;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.Jp=
b;this.log("JPEG supported: %s",b);return b};c.prototype.Gj=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.y);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.oj._id+" 0 R"});this.oj.Kids.push(this.page._id+" 0 R");this.oj.Count+=1;this.gp={}};c.prototype.object=function(a,b){var d=this.fd.length+1;a&&(b.Type=a);b._id=d;this.fd.push(b);return b};c.prototype.kA=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.dB){var b=Hb.qh("LZWEncoder");b.gz(a);b.flush();a=b.Jh().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.GH=function(a){if(!(a in this.fonts)){var b="F"+this.Ic;this.Ic+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.em("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.$y=function(a,b){var d=""+a+"-"+b;if(!(d in this.gp)){var c="gs"+this.Ic;this.Ic+=1;var f=this.object("ExtGState",{_name:c});b?f.ca=this.ye(a):f.CA=this.ye(a);this.gp[d]=c;this.em("ExtGState",f)}return this.gp[d]};c.prototype.em=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.Hp=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].Qk===a&&b===this.images[d].vw)return this.images[d].ll;return null};c.prototype.lp=function(a,b){var d,c=this.Hp(a);if(!c){var f="I"+this.Ic;this.Ic+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));b=c.getContext("2d").getImageData(0,0,c.width,c.height);var h=!1;if(this.gE()){this.log("Using JPEG encoding");var k="[/DCTDecode]";var l=Hb.qh("");
for(d=0;d<b.data.length;d+=4)h=h||255>b.data[d+3];d=c.toDataURL("image/jpeg");var n=atob(d.split(",")[1]);for(d=0;d<n.length;d++)l.Sb(n.charCodeAt(d))}else{this.log("Using LZW encoding");k="[/LZWDecode]";l=Hb.qh("LZWEncoder");for(d=0;d<b.data.length;d+=4)l.Sb(b.data[d]),l.Sb(b.data[d+1]),l.Sb(b.data[d+2]),h=h||255>b.data[d+3];var r="[ <</EarlyChange 0 >> ]"}l.flush();l=l.Jh().toString();f=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:l.length,Interpolate:"true",Filter:k,_name:f,_stream:l});r&&(f.DecodeParms=r);if(h){l=Hb.qh("LZWEncoder");for(d=0;d<b.data.length;d+=4)l.Sb(b.data[d+3]);l.flush();l=l.Jh().toString();r=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:l.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:l});f.SMask=r._id+" 0 R"}this.images.push({Qk:a,vw:"",ll:f});c=f}this.em("XObject",c);return"/"+c._name};c.prototype.mp=
function(a,b){var d=Cg(a.Ma),c=this.Hp(d,b.toString());if(!c){c="P"+this.Ic;this.Ic+=1;this.lp(d,a.Ma);d=this.Hp(d);var f=new L(a.Ma.width,0,0,-a.Ma.height,0,a.Ma.height);f=b.multiply(f);var h="1",k="1",l=b.ub(!1);l=Math.max(l.x,l.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)h=""+Math.ceil(this.width/a.Ma.width/l);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)k=""+Math.ceil(this.height/a.Ma.height/l);c=this.object("Pattern",{_name:c,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:h,YStep:k,Matrix:"[ "+this.ye(f.m11,f.m21,f.m12,f.m22,f.Ha,f.Ia)+"]",Resources:"<< /XObject << /"+d._name+" "+d._id+" 0 R >> >>"});c._stream="/"+d._name+" Do";this.images.push({Qk:a.Ma,vw:b.toString(),ll:c})}this.em("Pattern",c);return"/"+c._name};c.prototype.dh=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.fd.length;d++)this.tu(a,b,this.fd[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.fd.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.fd.length;d++){for(var f=""+b[d];10>f.length;)f="0"+f;a.push(f+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.fd.length+1)+"\n");a.push("   /Root "+this.OA._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toString=function(){return this.dh()};c.prototype.toBlob=function(){for(var a=this.dh(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.tu=
function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var h=d[e];"object"===typeof h&&"[object Array]"===Object.prototype.toString.apply(h)?a.push("[ "+h.join(" ")+" ]"):"object"===typeof h?this.tu(a,b,h,!0):a.push(h);a.push("\n")}c&&a.push("    ");
a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.eC=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.ye=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.Jp=null;return c}(),Eg=function(c){function a(a,d){var b=c.call(this)||this;
b.sC=d;b.path=[];b.x=0;b.y=0;b.Gx=[];b.bi="";b.hi="";b.gi=-1;b.fi="";b.ei="";b.di="";b.ci="";b.ai=-1;b.log=v.create("PDFContext");b.mg=a.clone();b.mg.transform(new lc(.75,.75,0,0));b.Tb=new Dg(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle=q.Oa;b.strokeStyle=q.Oa;b.qu=b.Wz;b.ou();return b}__extends(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.Gx.push({bi:this.bi,hi:this.hi,gi:this.gi,fi:this.fi,ei:this.ei,di:this.di,
ci:this.ci,ai:this.ai})};a.prototype.restore=function(){c.prototype.restore.call(this);var a=this.Gx.pop();a&&(this.stream.push("Q"),this.bi=a.bi,this.hi=a.hi,this.gi=a.gi,this.fi=a.fi,this.ei=a.ei,this.di=a.di,this.ci=a.ci,this.ai=a.ai)};a.prototype.Gj=function(a){var b=new lc(.75,.75,0,0);a&&(this.mg=a.clone(),this.mg.transform(b));this.an();this.Tb.Gj(this.mg.x,this.mg.y,this.mg.width,this.mg.height);this.ou();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.fm=
function(){var a=this.path;this.path=[];return a};a.prototype.nm=function(a){this.path=a};a.prototype.ou=function(){this.log("Start page: %s",this.mg);this.setTransform(1,0,0,1,0,0);this.hi=this.bi="";this.gi=-1;this.ci=this.di=this.ei=this.fi="";this.ai=-1};a.prototype.an=function(){this.stream.length&&this.Tb.kA(this.Tb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.Ty=function(){this.an();for(var a=this.Tb.dh(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);
return d};a.prototype.toString=function(){this.an();return this.Tb.toString()};a.prototype.toBlob=function(){this.an();return this.Tb.toBlob()};a.prototype.setTransform=function(a,d,c,f,h,k){var b=this.mg.me();this.qa=(new L(a,c,d,f,h,k)).multiply(new mc(0,b.x,b.y)).multiply(new lc(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};a.prototype.fill=function(){this.Lp();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.Mp();
for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.qa.apply(a,d);this.path.push(this.Tb.ye(b.x,b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.qa.apply(a,d);this.path.push(this.Tb.ye(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){a=this.qa.apply(a,d);c=this.qa.apply(c,f);f=this.qa.apply(h,k);this.path.push(this.Tb.ye(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=h;
this.y=k};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.qu(a,d,c,0)};a.prototype.strokeText=function(a,d,c){this.qu(a,d,c,1)};a.prototype.measureText=function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.Lp=function(){if(this.bi!==this.fillStyle){if(this.fillStyle instanceof Ne){var a=this.Tb.mp(this.fillStyle,
this.qa);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=q.Wf(this.fillStyle).Ki(q.RGBA),this.stream.push(this.Tb.ye(a.values[0],a.values[1],a.values[2])+" rg"),a=this.Tb.$y(a.values[3]*this.globalAlpha,!0),this.stream.push("/"+a+" gs"));this.bi=this.fillStyle}};a.prototype.Mp=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.hi!==this.strokeStyle){if(this.strokeStyle instanceof
Ne){var c=this.Tb.mp(this.strokeStyle,this.qa);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=q.Wf(this.strokeStyle).Ki(q.RGBA),this.stream.push(this.Tb.ye(c.values[0],c.values[1],c.values[2])+" RG"),c=this.Tb.$y(c.values[3]*this.globalAlpha,!1),this.stream.push("/"+c+" gs"));this.hi=this.strokeStyle}this.gi!==this.lineWidth&&(this.gi=this.lineWidth,this.stream.push(this.Tb.ye(72*this.lineWidth/96)+" w"));this.fi!==this.lineJoin&&(this.fi=this.lineJoin,
this.stream.push(a(this.lineJoin)+" j"));this.ei!==this.lineCap&&(this.ei=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.Xz=function(a,d,c,f){var b=this.mm(this.font);if(this.di!==b.fontSize||this.ci!==b.fontFamily){var e=this.Tb.GH(b.fontFamily);this.stream.push(e+" "+this.Tb.ye(parseFloat(b.fontSize))+" Tf");this.di=b.fontSize;this.ci=b.fontFamily}this.ai!==f&&(this.stream.push(f+" Tr"),this.ai=f);0===f?this.Lp():this.Mp();this.stream.push("BT");d=this.qa.multiply(new L(1,0,0,
-1,d,c));this.stream.push(this.Tb.ye(d.m11,d.m21,d.m12,d.m22,d.Ha,d.Ia)+" Tm");this.stream.push(this.Tb.eC(a)+" Tj");this.stream.push("ET")};a.prototype.Wz=function(a,d,c,f){var b=this.mm(this.font),e=this.sC.sB(b.fontFamily,{bold:"700"===b.fontWeight||"bold"===b.fontWeight,Zd:"italic"===b.fontStyle});e?(0===f?this.Lp():this.Mp(),this.beginPath(),e.Hq(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.Xz(a,d,c,f)};a.prototype.mm=function(a){var b="",c="",f="normal",h="normal",
k="normal",l="normal";a=a.split(/\s+/);a:for(;;){var n=a.shift();if(!n)break;switch(n){case "normal":break;case "italic":case "oblique":f=n;break;case "small-caps":k=n;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":h=n;break;default:if(""===c)n=n.split("/"),c=n[0],1<n.length&&(l=n[1]);else{b=n;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,fontVariant:k,fontWeight:h,
fontSize:c,lineHeight:l,fontFamily:b}};a.prototype.Fp=function(a,d,c,f,h,k,l,n,r){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,h,k,l,n,r);l+=r;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=Cg(a,d,c,f,h);b=this.Tb.lp(a,b);this.stream.push("q");k=this.qa.multiply(new L(n,0,0,-r,k,l));this.stream.push(this.Tb.ye(k.m11,k.m21,k.m12,k.m22,k.Ha,k.Ia)+" cm");this.stream.push(b+" Do");this.stream.push("Q")};a.prototype.dh=function(){return this.Tb.dh()};
a.prototype.Ip=function(){return{}};a.prototype.Kp=function(){};a.prototype.clip=function(){for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("W");this.stream.push("n");this.path.length=0};return a}(Qe);function Cg(c){for(var a=[],b=1;b<arguments.length;b++)a[b-1]=arguments[b];return c instanceof HTMLCanvasElement?a.join("-")+c.toDataURL():a.join("-")+c.src};var Fg=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.su(a,"");return a.join("")};c.prototype.su=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.gu(""+this.attributes[d])),
a.push('"')));if(this.children.length||""!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].su(a,b+"  ");""!==this.text&&a.push(b+"  "+this.gu(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.Cl=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.sd=function(a){this.children.push(a)};
c.prototype.gu=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var Gg=function(){function c(){this.ga=[]}c.prototype.lineTo=function(a,b,d){this.ga.push({dk:"L",nj:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){this.ga.push({dk:"M",nj:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,c,f){this.ga.push({dk:"Q",nj:a.apply(b,d),Ao:a.apply(c,f)})};c.prototype.bezierCurveTo=function(a,b,d,c,f,h,k){this.ga.push({dk:"C",nj:a.apply(b,d),Ao:a.apply(c,f),ps:a.apply(h,k)})};c.prototype.closePath=function(){this.ga.push({dk:"Z"})};c.prototype.qt=function(a){a=
a.inverse();for(var b="",d=0;d<this.ga.length;d++){var c=this.ga[d];0<d&&(b+=" ");b+=c.dk;if(c.nj){var f=a.apply(c.nj.x,c.nj.y);b+=f.x+","+f.y;c.Ao&&(f=a.apply(c.Ao.x,c.Ao.y),b+=","+f.x+","+f.y,c.ps&&(c=a.apply(c.ps.x,c.ps.y),b+=","+c.x+","+c.y))}}return b};return c}(),Hg=function(c){function a(a){var b=c.call(this)||this;b.qa=new L;b.ga=[];b.path=new Gg;b.zh="";b.fd=[];b.Ic=0;b.log=v.create("SvgContext");b.Uj=1;b.zi=2;b.wp=4;b.log("SVG context rect: %s",a);b.root=new Fg("svg",{xmlns:"http://www.w3.org/2000/svg",
"xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:zwibbler":"http://zwibbler.com/xml",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.Rm=new Fg("defs",{});b.root.sd(b.Rm);b.groups=[b.root];return b}__extends(a,c);a.prototype.sE=function(){return"clip"+this.Ic++};a.prototype.ul=function(a){a=new Fg("g",a||{});this.uq().sd(a);this.groups.push(a)};a.prototype.tl=function(){var a=this.groups.pop();if(a&&1===a.children.length){var d=a.children[0];
d.Cl(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.uq=function(){return this.groups[this.groups.length-1]};a.prototype.node=function(a,d,c,f){function b(a,b){if(b instanceof Ne)c[a]="url(#"+e.mp(b)+")";else if("string"===typeof b){b=q.Wf(b);var d=b.values[3];1>d&&(b.values[3]=1,c[a+"-opacity"]=""+d);c[a]=b.toString()}}void 0===c&&(c={});var e=this;this.qa.Gw()||(c.transform="matrix("+this.qa.m11+" "+this.qa.m21+" "+this.qa.m12+" "+this.qa.m22+
" "+this.qa.Ha+" "+this.qa.Ia+")");1!==this.globalAlpha&&(c.opacity=""+this.globalAlpha);d&this.Uj?b("fill",this.fillStyle):c.fill="none";d&this.zi&&(b("stroke",this.strokeStyle),c["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(c["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(c["stroke-linecap"]=this.lineCap));d&this.wp&&(d=this.mm(this.font),c["font-weight"]=d.fontWeight,c["font-size"]=parseFloat(d.fontSize),c["font-style"]=d.fontStyle,c["font-family"]=d.fontFamily);""!==this.zh&&
(c["clip-path"]="url(#"+this.zh+")");this.gA(new Fg(a,c,f))};a.prototype.gA=function(a){var b=!0,c=null,f={},h,k=this.uq();0===k.children.length?b=!1:c=k.children[k.children.length-1];!c||a.name===c.name&&a.text===c.text||(b=!1);if(b&&c)for(h in c.attributes)if(c.attributes.hasOwnProperty(h))if(h in a.attributes){var l=c.attributes[h],n=a.attributes[h];if(l!==n)if(0===h.indexOf("fill")||0===h.indexOf("stroke"))if("none"===l)f[h]=n;else if("none"===n)f[h]=l;else{b=!1;break}else{b=!1;break}}else f[h]=
c.attributes[h];if(b&&c)for(h in a.attributes)a.attributes.hasOwnProperty(h)&&(h in c.attributes||(f[h]=a.attributes[h]));b&&c?c.Cl(f):k.sd(a)};a.prototype.Sn=function(a){if(a===this.zi){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=this.fillStyle;return a instanceof Ne?!0:"string"===typeof a?0<q.Wf(a).values[3]:!1};a.prototype.hu=function(a){for(var b=0;b<this.fd.length;b++)if(this.fd[b].Qk===a)return this.fd[b].ll;return null};a.prototype.lp=function(a){var b=this.hu(a);if(b)return b;
b="image"+this.fd.length;this.fd.push({Qk:a,ll:b});var c=document.createElement("canvas"),f=c.getContext("2d");c.width=a.width;c.height=a.height;f.drawImage(a,0,0);c=c.toDataURL();a=new Fg("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":c});this.Rm.sd(a);return b};a.prototype.mp=function(a){var b=this.hu(a);if(b)return b;var c=this.lp(a.Ma);b="pattern"+this.fd.length;this.fd.push({Qk:a,ll:b});var f=new Fg("pattern",{id:b});"no-repeat"===a.repeat?(f.attributes.width="1",f.attributes.height=
"1"):"repeat-x"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.Ma.width,f.attributes.height=1E4):("repeat-y"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=1E4):(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.Ma.width),f.attributes.height=a.Ma.height);f.sd(new Fg("use",{"xlink:href":"#"+c}));this.Rm.sd(f);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.Ty=
function(){return Sa(this.toString())};a.prototype.toBlob=function(){return new Blob([Sa(this.toString())],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new Gg};a.prototype.fm=function(){var a=this.path;this.beginPath();return a};a.prototype.nm=function(a){this.path=a};a.prototype.transform=function(a,d,c,f,h,k){a=new L(a,c,d,f,h,k);this.qa=this.qa.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.Sn(this.Uj)&&this.node("path",
this.Uj,{d:this.path.qt(this.qa)})};a.prototype.stroke=function(){this.Sn(this.zi)&&this.node("path",this.zi,{d:this.path.qt(this.qa)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.qa,a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.qa,a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(this.qa,a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,h,k){this.path.bezierCurveTo(this.qa,a,d,c,f,h,k)};a.prototype.fillText=function(a,d,c){this.Sn(this.Uj)&&
this.node("text",this.Uj|this.wp,{x:d,y:c},a)};a.prototype.strokeText=function(a,d,c){this.Sn(this.zi)&&this.node("text",this.zi|this.wp,{x:d,y:c},a)};a.prototype.Fp=function(a,d,c,f,h,k,l,n,r){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=h;e.drawImage(a,-d,-c);a=b.toDataURL();this.uq().sd(new Fg("image",{transform:"matrix("+this.qa.m11+" "+this.qa.m21+" "+this.qa.m12+" "+this.qa.m22+" "+this.qa.Ha+" "+this.qa.Ia+")",x:k,y:l,width:n,height:r,"xlink:href":a}))};a.prototype.measureText=
function(a){var b=document.createElement("canvas").getContext("2d");b.font=this.font;return b.measureText(a)};a.prototype.Gj=function(){};a.prototype.Ip=function(){return{name:this.zh}};a.prototype.Kp=function(a){this.zh=a?a.name:""};a.prototype.clip=function(){var a=this.sE(),d=new Fg("clipPath",{id:a});d.sd(new Fg("path",{d:this.path.qt(this.qa)}));this.Rm.sd(d);this.zh=a;this.path=new Gg};return a}(Qe);function Ig(c,a){function b(b){d&&clearTimeout(d);d=setTimeout(function(){d=null;a()},arguments.length?b:c)}var d=null;b.cancel=function(){d&&(clearTimeout(d),d=null)};return b};var Kg=function(){function c(a,b,d,c,f,h,k){void 0===d&&(d={});this.view=a;this.type=b;this.ba=d;this.jh=c;this.Lm=f;this.open=h;this.cf=k;this.node=null;this.Sq=new J(0,0);this.Wk=new J(0,0);this.index=0;this.state="start";this.log=v.create("DRAWLINES");"wrap"in this.ba||(this.ba.wrap=this.view.fa.get("multilineText"));this.view.fa.get("allowTextInShape")&&("fontSize"in this.ba||(this.ba.fontSize=this.view.fa.get("defaultFontSize")),"fontName"in this.ba||(this.ba.fontName=this.view.fa.get("defaultFont")));
this.Rc=new Gf(this.view);this.view.pb(!0)}c.prototype.Vd=function(){this.log("Entering DrawLinesBehaviour");this.view.zb("crosshair");this.view.fa.Ft()||this.view.Fl("click-to-place-first-point-of-line");this.view.ka()};c.prototype.reset=function(){this.Vd()};c.prototype.yb=function(a){a=this.Rc.yb(a);this.Rc.Yd()&&this.node&&(this.cancel(),this.state="start");return a};c.prototype.Dd=function(a){"cancel"===a?(null!==this.node&&this.view.Ta.Wb&&"curve"===this.type&&this.Ea(),null!==this.node&&(this.view.aa.lb(),
this.view.aa.wc([this.node.id]),this.view.aa.Ea(!0)),this.view.Ta.Wb?this.view.$c.ua("goto-toolbar"):this.view.Hb()):this.view.Ta.Wb||"enter"!==a||null===this.node||(this.Ea(),this.done())};c.prototype.done=function(){this.view.MA();this.cf?this.view.Hb():(this.state="start",this.view.Fl("click-to-place-first-point-of-line"))};c.prototype.vh=function(a,b){this.node instanceof O&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.jk(a,b):this.node.lineTo(a,b))};c.prototype.Eb=
function(a,b,d){var c=this.view.Ib(new J(a,b),d);this.view.Eg(c);this.log("onMouseDown(%s, %s) state=%s, index=%s",a,b,this.state,this.index);if("start"===this.state){d.setCapture();this.Sq=c;a={seed:Math.round(65535*Math.random()),strokeStyle:this.view.Ke,lineWidth:this.Xf(),sloppiness:this.view.sa.sloppiness,smoothness:this.view.sa.smoothness};"arrow"===this.type&&(a.arrowSize=this.view.fa.nb("defaultArrowSize"),a.arrowStyle=this.view.fa.nb("defaultArrowStyle"),a.arrowXOffset=this.view.fa.nb("defaultArrowXOffset"),
a.doubleArrow=this.view.sa.doubleArrow||!1);for(var f in this.ba)this.ba.hasOwnProperty(f)&&(a[f]=this.ba[f]);this.view.aa.lb();f=this.view.aa.createNode("PathNode",a,void 0,void 0,void 0,!0);this.view.aa.Ea(!0);this.node=this.view.aa.Ob(f);this.node.moveTo(c.x,c.y);this.vh(c.x,c.y);this.index=3;this.view.update();this.state="predrag"}else if("placing"===this.state)if(f=this.Wk.ic(c),this.log("Mouse moved by %s",f),"arrow"!==this.type&&8>this.Sq.ic(c)&&3<this.index)this.log("Clicked close to start; automatically closing path"),
this.node instanceof O&&!this.Wn()&&this.node.close(),this.Ea(),this.done();else if(8>this.Wk.ic(c))this.log("Didn't move. Stop drawing."),this.bv(),this.done();else{if(this.jh)return this.Ea(),this.done(),!0;this.node&&(this.vh(c.x,c.y),this.index+=3,this.view.aa.Sg(this.node.id),this.view.update())}else return this.log("Invalid state %s",this.state),!0;this.Wk=new J(c.x,c.y);return!0};c.prototype.bv=function(){3<this.index?(this.node instanceof O&&this.node.CF(this.index),this.Ea()):this.cancel()};
c.prototype.oc=function(a,b){var d=new J(a,b);this.view.Eg(d);d=this.Sq.ic(d);this.log("onMouseUp (%s,%s) %s",a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.Ea(),this.done()):(this.state="placing",this.view.Fl("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.Fb=function(a,b,d){a=this.view.Ib(new J(a,b),d);this.view.Eg(a);if(this.view.fa.Kn(d,this.view.fa.get("keySnappingOn")||"ctrl")||this.Lm){b=this.view.fa.get("snapAngle")||1;
d=new J(this.Wk.x,this.Wk.y);var c=a;a=gc(d.x,d.y,c.x,c.y);0===a?a=new J(c.x,c.y):(b=180/b,b=Math.round(Math.atan2(c.y-d.y,c.x-d.x)/Math.PI*b)*Math.PI/b,a=new J(d.x+Math.cos(b)*a,d.y+Math.sin(b)*a))}this.node&&(this.node.Qb(this.node.xf(this.index,a.x,a.y)),this.node.format(this.view.ma,this.view.request),this.view.ka());return!1};c.prototype.gB=function(a){for(var b=0,d=[],c,f,h,k,l,n;b<a.length;){var r=a[b];switch(r){case O.rh:h=a[b+1];k=a[b+2];d.push(r,h,k);break;case O.Fe:c=a[b+1],f=a[b+2],void 0!==
h&&void 0!==k&&void 0!==l&&void 0!==n&&d.push(O.De,c,f,(l+h)/2,(n+k)/2,(h+c)/2,(k+f)/2),l=h,n=k,h=c,k=f}b+=O.rb[r]+1}return d};c.prototype.Ea=function(){var a=this;if(this.node){this.node instanceof O&&!this.open&&this.node.yA();this.view.aa.wc([this.node.id]);var b=this.node.ia("commands");"linear-bezier"===this.type&&(b=this.gB(b));var d=this.Pg();d.seed=this.node.ia("seed");d.commands=b;this.view.aa.transaction(function(){a.view.aa.createNode("PathNode",d)});this.node=null}};c.prototype.cancel=
function(){this.node&&(this.view.aa.lb(),this.view.aa.wc([this.node.id]),this.view.aa.Ea(!0),this.node=null)};c.prototype.Qc=function(){this.bv();this.view.zb("default");this.view.Fl("");this.view.ka()};c.prototype.Wg=function(a,b){b?(this.view.Td=ad(this.view.Td,a),this.view.Yc=ad(this.view.Yc,a)):this.view.Ke=ad(this.view.Ke,a);this.view.at(a,b)};c.prototype.ad=function(){return this.type};c.prototype.Oh=function(){var a=["PathNode","PathNode-open"];this.Wn()||a.push("PathNode-closed");return a};
c.prototype.Wn=function(){return this.jh||this.open||"arrow"===this.type};c.prototype.Pg=function(){var a=Jg({fillStyle:this.view.Td,strokeStyle:this.view.Ke,lineWidth:this.Xf(),dashes:"",sloppiness:this.view.sa.sloppiness,smoothness:this.view.sa.smoothness,layer:this.view.Ud,opacity:this.ba.opacity||1},this.view,"arrow"===this.type,this.view.fa.get("defaultArrowSize"));a.doubleArrow="doubleArrow"in this.ba?this.ba.doubleArrow:this.view.sa.doubleArrow||!1;for(var b in this.ba)this.ba.hasOwnProperty(b)&&
(a[b]=this.ba[b]);this.Wn()&&(delete a.fontName,delete a.fontSize);return a};c.prototype.de=function(a,b){"doubleArrow"===a&&(b=ed(!0,b));var d=a;this.Wn()&&"fillStyle"===a&&(d="strokeStyle");this.ba[d]=b;switch(a){case "doubleArrow":this.view.sa[a]=b;break;case "fillStyle":this.view.Td=b;this.view.Yc=b;break;case "strokeStyle":this.view.Ke=b}};c.prototype.Xf=function(){return this.view.Tp(this.view.sa.lineWidth)};return c}();
function Jg(c,a,b,d){var e={};b&&(e={arrowSize:d,arrowStyle:a.fa.nb("defaultArrowStyle"),arrowXOffset:a.fa.nb("defaultArrowXOffset")});return dd(e,{opacity:1},c)};var Mg=function(){function c(a,b,d){this.view=a;this.options=b;this.mode=d;this.$g={};this.log=v.create("Brush");this.vq=null;this.view.pb(!0);this.Rc=new Gf(this.view)}c.prototype.yb=function(a){if(this.view.fa.get("multitouch"))return!1;a=this.Rc.yb(a);this.Rc.Yd()&&this.reset();return a};c.prototype.Vd=function(){this.view.zb("none")};c.prototype.Qc=function(){this.view.zb("default");this.view.Hm("brush")};c.prototype.reset=function(){this.$g={}};c.prototype.pi=function(a){this.options.strokeStyle=
a};c.prototype.Xf=function(){var a=this.options.lineWidth;this.view.fa.get("adaptiveBrushWidth")&&(a/=this.view.scale);return a};c.prototype.Gl=function(a){var b=this;this.options.lineWidth=a;this.view.qj("brush",function(a){return b.lg(a)})};c.prototype.ol=function(a,b,d){a=this.view.fa.get("wheelAdjustsBrush");if("up"!==a&&"down"!==a)return!1;b=this.Xf();var c=1+Math.abs(d.y/120*.1);b=0<d.y&&"down"==a||0>d.y&&"up"===a?b*c:b/c;b=Math.max(b,1);b=Math.min(b,128);this.Gl(b);return!0};c.prototype.Eb=
function(a,b,d){if(this.Rc.Yd())return!0;if(d.buttons&4||this.view.fa.get("rightButtonPans")&&d.buttons&2)return!1;if(d.target instanceof HTMLElement&&d.target.matches("[z-fixture] *"))return this.view.Hb(),this.view.ta.Eb&&this.view.ta.Eb(a,b,d),!0;d.setCapture();var c="freehand"===this.mode||"brush"===this.mode?new Kc:new Ic;c.vh(a,b);this.$g[d.pointerId]=c;return!0};c.prototype.pl=function(a){var b=this;this.view.fa.get("fastDraw")?this.view.qj("brush",function(a){return b.lg(a)}):this.lg(a)};
c.prototype.lg=function(a){a.save();var b=this.view.Zu(a),d="brush"!==this.mode&&"freehand"!==this.mode,c="round";d&&(c="butt");a.lineCap=this.options.lineCap||c;a.lineJoin="round"===a.lineCap?"round":"bevel";a.lineWidth=this.Xf();c=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);"blendMode"in this.options&&(a.globalCompositeOperation=this.options.blendMode);od(this.options.shadow,a);d=d?Ac(this.options.dashes||"",0,a.lineWidth):Ac(this.options.dashes||"",a.lineWidth);
a.beginPath();for(var f in this.$g)Bc(a,this.$g[f].xr(),d);cd(a,this.options.strokeStyle);b&&a.restore();a.globalAlpha=c;a.restore();this.MB(a)};c.prototype.MB=function(a){if(this.vq){var b=this.vq,d=this.view.scale,c=this.Xf()/2+1;a.beginPath();"round"===(this.options.lineCap||"round")?a.arc(b.x,b.y,c,0,2*Math.PI):a.rect(b.x-c,b.y-c,2*c,2*c);a.lineWidth=4/d;a.strokeStyle=q.Od;a.stroke();a.lineWidth=2/d;a.strokeStyle=q.Oa;a.stroke()}};c.prototype.Fb=function(a,b,d){var c=this,f=!0;d.Vb()||(this.vq=
new J(a,b));d.pointerId in this.$g&&(this.$g[d.pointerId].vh(a,b),f=!("erase"===this.options.strokeStyle||"blendMode"in this.options));f?this.view.qj("brush",function(a){return c.lg(a)}):this.view.ka(function(a){return c.lg(a)});return!0};c.prototype.oc=function(a,b,d){this.Fb(a,b,d);this.view.Hm("brush");this.Ea();return!0};c.prototype.Ea=function(){var a,b;this.view.aa.lb();var d="";for(var c in this.$g){var f=yc(this.$g[c].xr(),.5);if("brush"===this.mode||"freehand"===this.mode){Lg(f);var h=[];
if(1<f.length){d=a=0;for(b=f.length-1;a<=b;d=a+=1)h.push(f[d].x),h.push(f[d].y);d=this.view.aa.createNode("BrushNode",dd({points:h,layer:this.view.Ud},this.options,{lineWidth:this.Xf()}))}}else{if("shapebrush"===this.mode){f=yc(f,20);var k;var l=f;if(!(2>l.length)){a=l[0];f=l[l.length-1];h=40>a.ic(f);for(b=0;b<l.length;b++){var n=l[b];for(k=b+1;k<l.length;k++){var r=l[k];20>Math.abs(n.x-r.x)&&(r.x=n.x);20>Math.abs(n.y-r.y)&&(r.y=n.y)}}n=K.Ee(l).me();for(b=0;b<l.length;b++)k=l[b],20>Math.abs(k.x-n.x)&&
(k.x=n.x),20>Math.abs(k.y-n.y)&&(k.y=n.y);h&&(a.x=f.x,a.y=f.y)}f=l}else if("quadratic"===this.mode||"bezier"===this.mode){f=yc(f,10);1<f.length&&("bezier"===this.mode?d=He(f):(a=He(f,!0),d=a.ga[1],h=a.ga[2],l=a.ga[4],b=a.ga[5],f=a.ga[8],a=a.ga[9],l=((3*l-d)/2+(3*l-f)/2)/2,b=((3*b-h)/2+(3*b-a)/2)/2,k=new vc,k.moveTo(d,h),k.quadraticCurveTo(l,b,f,a),d=k),h=O.pz(d),d=this.view.aa.createNode("PathNode",dd({commands:h,fillStyle:this.view.Td,sloppiness:0,layer:this.view.Ud},this.options,{lineWidth:this.Xf()})));
continue}Lg(f);if(1<f.length){h=new P;h.moveTo(f[0].x,f[0].y);a=f[0].xd(f[f.length-1]);d=b=1;for(l=f.length-1;b<=l;d=b+=1)h.lineTo(f[d].x,f[d].y);a&&h.close();d=this.view.aa.createNode("PathNode",dd({commands:h.Jc(),fillStyle:this.view.Td,sloppiness:0,lockEditMode:"shapebrush"!==this.mode,layer:this.view.Ud},this.options,{lineWidth:this.Xf()}))}}}this.view.aa.Ea();this.view.pb();c=this.view.aa.Ob(d);this.view.fa.get("singleStrokeBrush")?(c&&this.view.bf(c),this.view.Hb()):this.reset();this.view.xc()};
c.prototype.Wg=function(a){this.view.Yc=ad(this.view.Yc,a);this.options.strokeStyle=ad(this.options.strokeStyle,a);this.view.Td=this.view.Yc};c.prototype.Dd=function(a){this.log("keyboard: %s",a);switch(a){case "cancel":this.log("ESC pressed. Abort brush and go back to toolbar.");this.view.Hb();this.view.$c.ua("goto-toolbar");break;case "undo":this.view.nd();break;case "redo":this.view.We()}};c.prototype.kg=function(a,b){"defaultBrushWidth"===a?this.Gl(b):"defaultBrushColour"===a&&this.pi(b)};c.prototype.de=
function(a,b){switch(a){case "lineWidth":this.Gl(b);break;case "strokeStyle":case "fillStyle":this.pi(b);break;default:this.options[a]=b}};c.prototype.ad=function(){return"circle"===this.mode?"ellipse":this.mode};c.prototype.Pg=function(){return Jg(dd({dashes:""},this.options),this.view,"bezier"===this.mode,0)};c.prototype.Oh=function(){return["BrushNode"]};return c}();
function Lg(c){var a=!0;if(1<c.length)for(var b=1;b<c.length;b++)if(c[0].x!==c[b].x||c[0].y!==c[b].y)a=!1;a&&0<c.length&&c.push(new J(c[0].x+.1,c[0].y+.1))};var Pg=function(){function c(a,b,d,c,f,h,k){var e=this;this.view=a;this.nodeType=b;this.Do=d;this.width=c;this.height=f;this.pH=h;this.options=k;this.state="initial";this.start=new J(0,0);this.end=new J(0,0);this.node=null;this.ba={};this.Se={};this.gq={};this.Os=this.Ps=0;this.log=v.create("DrawShape");this.view.Df(!0);"rectangle-tl"===k.Lo&&(this.wv=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke();
e.uv(a)});this.Rc=new Gf(this.view);this.view.pb(!0);this.ba=Ng(d)}c.prototype.wv=function(a){this.uv(a)};c.prototype.uv=function(a){var b=this.view.fa.Ov(Math.abs(this.Ps)),d=this.view.fa.Ov(Math.abs(this.Os)),c=b+"x"+d;d=this.view.scale;b=new ee;b.text=c;c=new Re(this.view.fa.get("hintFont"));b.El(c.fontFamily,c.fontSize/d,c.Ew(),c.Hw(),"");b.format(a,0,0);c=1/d;d=b.rect.width+2*c;c=b.rect.height+2*c;var f=(this.start.x+this.end.x)/2-d/2,h=(this.start.y+this.end.y)/2-c/2;a.fillStyle=q.Oa;a.fillRect(f,
h,d,c);a.fillStyle=q.Od;b.fillText(a,f,h)};c.prototype.Vd=function(){this.log("Entering DrawShapeBehaviour");this.view.zb("crosshair")};c.prototype.Qc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel();this.view.Df(!1)};c.prototype.cancel=function(){this.node&&(this.view.aa.lb(),this.view.aa.wc([this.node.id]),this.view.aa.Ea(!0,!0),this.view.update(),this.node=null);this.state="initial"};c.prototype.yb=function(a){a=this.Rc.yb(a);this.node&&this.Rc.Yd()&&(this.view.aa.lb(),this.view.aa.wc([this.node.id]),
this.view.aa.Ea(!0,!0),this.node=null,this.state="initial");return a};c.prototype.Dd=function(a){"cancel"===a&&this.view.Hb()};c.prototype.Eb=function(a,b,d){"initial"===this.state&&(d.setCapture(),this.start=this.view.Ib(new J(a,b),d),this.view.Eg(this.start),this.state="predraw",this.log("initial -> predraw"));return!0};c.prototype.Fb=function(a,b,d){var c=this;a=this.view.Ib(new J(a,b),d);this.view.Eg(a);b=d.ctrlKey||d.shiftKey;"predraw"===this.state&&10<this.start.ic(a)&&(this.create(),this.state=
"drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,a,b,d),this.end=a,this.view.update(!1,function(a){return c.wv(a)}));return!0};c.prototype.oc=function(a,b,d){function c(){var a=f.Ea();f.options.hH?f.view.Xm(a):f.options.cf&&f.view.Hb();f.state="initial";f.Ps=0;f.Os=0}var f=this;"predraw"===this.state?this.view.fa.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey,d),c()):this.cancel():"drawing"===this.state&&(this.transform(this.start,
this.view.Eg(this.view.Ib(new J(a,b),d)),d.ctrlKey||d.shiftKey,d),c());return!0};c.prototype.create=function(){this.ba=Ng(this.Do);var a=this.view.aa.createNode(this.nodeType,this.ba,void 0,void 0,void 0,!0);if(this.node=this.view.aa.Ob(a))this.Se=this.node.Ge(new L)};c.prototype.transform=function(a,b,d,c){if(b)if("circle"===this.options.Lo){c=a;a=a.ic(b);var e=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.options.Lo)a=a.clone(),b=b.clone(),a.x>b.x&&(c=a.x,a.x=b.x,b.x=c),a.y>b.y&&
(c=a.y,a.y=b.y,b.y=c),c=a;else{b=b.clone();if(d){c=b.x-a.x;e=b.y-a.y;var h=Math.min(Math.abs(c),Math.abs(e));c=Math.sign(c)*h;e=Math.sign(e)*h;b.x=a.x+c;b.y=a.y+e}c=dc([a,b])}e=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else h=this.view.Nh(c),e=this.width,b=this.height,h&&(e=Math.max(Math.round(this.width/h)*h,h),b=Math.max(Math.round(this.height/h)*h,h)),h=new J(a.x-e/2,a.y-b/2),c=this.view.Ib(h,c),c=new J(a.x+(c.x-h.x),a.y+(c.y-h.y)),e/=this.width,a=b/this.height;d&&(a=e=Math.min(e,a));this.Ps=
this.width*e;this.Os=this.height*a;d=new jc(c.x,c.y);d=d.multiply(new lc(e,a));this.node&&(this.node.Qb(this.Se),this.gq=this.node.Ge(d),this.node.Qb(this.gq),this.view.aa.Sg(this.node.id))};c.prototype.Ea=function(){var a=this,b="";this.node&&(this.ba=dd(this.ba,this.gq),this.view.aa.wc([this.node.id]),this.node=null,this.view.aa.transaction(function(){b=a.view.aa.createNode(a.nodeType,a.ba)}));return b};c.prototype.Gl=function(a){this.ba.lineWidth=this.Do.lineWidth=this.view.Tp(a)};c.prototype.Wg=
function(a,b){Og.prototype.Wg.call(this,a,b);b=b?"fillStyle":"strokeStyle";var d=ad(this.ba[b],a);this.log("oldColour=%s+opacity %s = %s",this.ba[b],a,d);this.ba[b]=this.Do[b]=d};c.prototype.ad=function(){return this.pH};c.prototype.de=function(a,b){this.Do[a]=b;this.ba[a]=b};c.prototype.Pg=function(){return this.ba.spotHighlight?this.ba:dd({opacity:1},this.ba)};c.prototype.Oh=function(){var a=[this.nodeType];"PathNode"===this.nodeType&&a.push("PathNode-closed");return a};c.prototype.kg=function(a,
b){"defaultLineWidth"===a&&this.Gl(b)};c.prototype.so=function(a,b,d){d.ctrlKey&&(this.log("Suppress contextmenu"),d.preventDefault());return!1};return c}();function Ng(c){var a={},b;for(b in c){var d=c[b];d instanceof Array?d=d.concat():d instanceof L&&(d=d.clone());a[b]=d}return a};var Qg=function(){function c(a,b,d){var c=this;this.view=a;this.ba=b;this.FE=d;this.state="none";this.scale=1;this.Yn=null;this.log=v.create("ImageStamp");this.Ma=document.createElement("img");this.url=this.Ma.src=b.url;"scale"in this.ba&&(this.scale=this.ba.scale,delete this.ba.scale);E.Zv(this.Ma.src,function(a,b){c.Ma.width=a;c.Ma.height=b;"width"in c.ba&&(c.scale=c.ba.width/a,delete c.ba.width)})}c.prototype.ad=function(){return"imagestamp"};c.prototype.Vd=function(){var a=this;this.log("Entering ImageStampBehaviour");
this.Ma.complete?this.view.zb("none"):(this.view.zb("move"),this.Ma.onload=function(){a.view.zb("none")})};c.prototype.Qc=function(){this.log("Leaving ImageStampBehaviour");this.Ma.onload=null;this.view.Hm("stamp")};c.prototype.Ib=function(a,b,d){this.Ma.complete&&(a-=this.Ma.width/2*this.scale,b-=this.Ma.height/2*this.scale);return this.view.Ib(new J(a,b),d)};c.prototype.Eb=function(a,b,d){var c=this;this.log("onMouseDown type %s",d.type);var f=this.Ib(a,b,d);this.view.aa.transaction(function(){var d=
c.view.aa.createNode(fd(c.url)?"SvgNode":"ImageNode",dd({},c.ba,{url:c.url,layer:c.view.Ud,matrix:(new jc(f.x,f.y)).multiply(new lc(c.scale,c.scale))}));c.YF(d,a,b,f)});this.FE?(this.view.pb(),this.view.xc()):(this.log("MultiStamp not set; return to pick mode."),this.view.Hb());return!0};c.prototype.YF=function(a,b,d,c){a={docX:b,docY:d,nodes:[{id:a,rect:new gf(c.x,c.y,this.Ma.width*this.scale,this.Ma.height*this.scale),shift:{x:0,y:0}}]};this.view.ra.Nb("drop-shape",a)};c.prototype.Fb=function(a,
b,d){var c=this;this.Ma.complete||this.log("Don't draw; image not loaded.");this.Yn=this.Ib(a,b,d);this.view.qj("stamp",function(a){return c.lg(a)});return!0};c.prototype.pl=function(a){var b=this;this.view.fa.get("fastDraw")?this.view.qj("stamp",function(a){return b.lg(a)}):this.lg(a)};c.prototype.lg=function(a){if(this.Yn){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(this.Ma,this.Yn.x,this.Yn.y,this.Ma.width*this.scale,this.Ma.height*this.scale);a.globalAlpha=b}};c.prototype.Oh=function(){return fd(this.url)?
["SvgNode"]:["ImageNode"]};c.prototype.Pg=function(){return this.ba};c.prototype.de=function(a,b){this.ba[a]=b};c.prototype.oc=function(){return!0};c.prototype.Dd=function(a){"cancel"===a&&(this.view.Hb(),this.view.$c.ua("goto-toolbar"))};return c}();var Rg=function(){function c(a){var b=this;this.view=a;this.state="none";this.start=new J(0,0);this.Ry=this.Qy=0;this.tj=null;this.log=v.create("PanTool");this.sx=function(a){a?b.view.zb("grabbing"):b.view.zb("not-allowed")};this.Rc=new Gf(a)}c.prototype.aH=function(a,b,d,c){this.tj=c;this.Eb(a,b,d)};c.prototype.Vd=function(){this.log("Entering PanToolBehaviour");this.view.fa.pa("allowScroll",this.sx)};c.prototype.Qc=function(){this.log("Leaving PanToolBehaviour");this.view.fa.removeListener("allowScroll",
this.sx)};c.prototype.yb=function(a){return this.Rc.yb(a)};c.prototype.BD=function(a){return new J(a.pageX,a.pageY)};c.prototype.Eb=function(a,b,d){this.log("onMouseDown type %s",d.type);if(!this.view.fa.get("allowScroll"))return this.log("Scrolling disabled."),!0;if(this.view.bE(d)){var c=new Og(this.view);this.view.Xa(c);return c.Eb(a,b,d)}d.setCapture();this.state="dragging";this.start=new J(d.Jb,d.Kb);this.Qy=this.view.Bb;this.Ry=this.view.Cb;return!0};c.prototype.Fb=function(a,b,d){if("dragging"!==
this.state)return!1;a=this.BD(d);b=this.Ry+a.y-this.start.y;this.view.Bb=this.Qy+a.x-this.start.x;this.view.Cb=b;this.view.Qd();this.view.ka();return!0};c.prototype.oc=function(){this.state="none";this.tj&&this.view.Xa(this.tj);return!0};c.prototype.ol=function(a,b,d,c){if(!this.view.fa.get("allowZoom"))return this.log("Zooming is disabled."),!1;this.log("onMouseWheel(%s, %s, [%s %s %s])",a,b,d.x,d.y,d.z);var e=1+Math.abs(d.y/120*.1);this.view.jz(0>d.y?1/e:e,a,b);c.stopPropagation();c.preventDefault();
return!0};c.prototype.Dd=function(a){"cancel"===a&&this.view.Hb()};c.prototype.ad=function(){return this.tj&&this.tj.ad?this.tj.ad():"pan"};return c}();var Tg=function(c){function a(a,d){var b=c.call(this)||this;b.Pe=d;b.hl=!0;b.width=32;b.height=500;b.RI=0;b.Ac=new K(0,0,0,0);b.Dc=!1;b.Ph="auto";b.nI="#fcfcfc";b.pI="#808080";b.borderWidth=0;b.Ig=0;b.Hg=100;b.Ht=10;b.position=5;b.offset=0;b.log=v.create("SCROLLBAR",!0);b.hl=!0;b.Iq=Sg("auto");b.canvas=Zc(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.canvas.classList.add("zwibbler-scrollbar");b.canvas.classList.add("zwibbler-passthrough");b.ma=b.canvas.getContext("2d");
a.addEventListener(b.canvas,"mousedown",function(a){b.Eb(a)});a.addEventListener(document.body,"mousemove",function(a){b.Fb(a)});a.addEventListener(document.body,"mouseup",function(){b.oc()});a.addEventListener(b.canvas,"touchstart",function(a){b.ms(a)},{passive:!1});a.addEventListener(document.body,"touchmove",function(a){b.ms(a)});a.addEventListener(document.body,"touchend",function(a){b.ms(a)});b.format();return b}__extends(a,c);a.prototype.ke=function(a){a.appendChild(this.canvas)};a.prototype.wy=
function(a){this.Ph=a;this.ka()};a.prototype.moveTo=function(a,d){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.Va=function(a){this.Iq=Sg(a);this.format();this.ka()};a.prototype.hh=function(a,d){this.width=a;this.height=d;this.canvas.width=this.width;this.canvas.height=d;this.format();this.ka()};a.prototype.ag=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.Kw=function(){return"block"===this.canvas.style.display};
a.prototype.By=function(a,d,c,f){this.Ig=a;this.Hg=d-a;this.Ht=c;this.position=f;this.format();this.ka()};a.prototype.format=function(){var a=this.Pe?this.width:this.height;var d=this.Ht/this.Hg*a;a*=(this.position-this.Ig)/this.Hg;this.Ac=this.Pe?new K(a,0,d,this.height):new K(0,a,this.width,d);this.Ac.x=Math.round(this.Ac.x);this.Ac.y=Math.round(this.Ac.y);this.Ac.width=Math.round(this.Ac.width);this.Ac.height=Math.round(this.Ac.height)};a.prototype.ka=function(){var a=this.Iq.gw();var d=this.An()-
a;this.Pe?a=0:(a=d,d=0);a={Pe:this.Pe,rect:{x:a,y:d,width:this.width-a,height:this.height-d},Be:{x:this.Ac.x+a,y:this.Ac.y+d,width:this.Ac.width-a,height:this.Ac.height-d},Ph:this.Ph};this.ma.clearRect(0,0,this.ma.canvas.width,this.ma.canvas.height);this.Iq.ka(this.ma,a)};a.prototype.Cv=function(a){var b=B(this.canvas).wb(),c=0,f=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)c=a.changedTouches[0].pageX,f=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||
"mousemove"===a.type)c=a.pageX,f=a.pageY;return new J(c-b.left,f-b.top)};a.prototype.ms=function(a){switch(a.type){case "touchstart":this.Eb(a);break;case "touchend":this.oc();break;case "touchmove":this.Fb(a)}};a.prototype.Lx=function(a){return this.Wu(this.Pe?a.x/this.width*this.Hg+this.Ig:a.y/this.height*this.Hg+this.Ig)};a.prototype.Wu=function(a){a=Math.min(a,this.Hg-this.Ht+this.Ig);return a=Math.max(a,this.Ig)};a.prototype.Eb=function(a){a.preventDefault();a=this.Cv(a);this.Ac.Xc(a.x,a.y)?
this.Pe?(this.offset=a.x-this.Ac.x,a.x-=this.offset):(this.offset=a.y-this.Ac.y,a.y-=this.offset):(this.position=this.Lx(a),this.offset=0,this.Pe?this.Ac.x=(this.position-this.Ig)/this.Hg*this.width:this.Ac.y=(this.position-this.Ig)/this.Hg*this.height,this.ua("scroll",this.position),this.ka());this.Dc=!0};a.prototype.Fb=function(a){this.Dc&&(this.Dc&&"mousemove"===a.type&&0===a.buttons?this.Dc=!1:(a.preventDefault(),a=this.Cv(a),this.Pe?a.x-=this.offset:a.y-=this.offset,this.position=this.Lx(a),
this.ua("scroll",this.position),this.format(),this.ka()))};a.prototype.oc=function(){this.Dc&&(this.Dc=!1)};a.prototype.scrollBy=function(a){this.position=this.Wu(this.position+a);this.ua("scroll",this.position);this.format();this.ka()};a.prototype.An=function(){return this.Pe?this.height:this.width};a.lI=0;a.hI=1;a.dI=2;a.jI=3;return a}(rb),Ug=function(){function c(){}c.prototype.gw=function(){return 16};c.prototype.ka=function(a,b){a.fillStyle="#e6e6e6";a.beginPath();a.rect(b.rect.x,b.rect.y,b.rect.width,
b.rect.height);a.fill();a.beginPath();a.fillStyle="auto"===b.Ph?"#b9b9b9":b.Ph;a.fillRect(b.Be.x,b.Be.y,b.Be.width,b.Be.height)};return c}(),Vg=function(){function c(){}c.prototype.gw=function(){return 8};c.prototype.ka=function(a,b){a.fillStyle="auto"===b.Ph?"rgba(0,0,0,0.5)":b.Ph;a.beginPath();b.Pe?wc(a,b.Be.x,b.Be.y-1,b.Be.width,b.Be.height-1,3.5):wc(a,b.Be.x-1,b.Be.y,b.Be.width-1,b.Be.height,3.5);a.fill()};return c}();
function Sg(c){switch(c){case "macos":return new Vg;case "auto":return $c()?new Vg:new Ug;default:return new Ug}};function Wg(c){var a;void 0===a&&(a="");if(!c)throw a||"Assertion failed";}function Xg(c){return"object"===typeof c&&"[object Array]"===Object.prototype.toString.apply(c)}function Yg(c){return"string"===typeof c}function Zg(c){return"number"===typeof c}function $g(c){return"object"===typeof c};var ah=v.create("CONFIG"),bh=function(){var c;if(document.currentScript&&(c=document.currentScript.getAttribute("src")))return c;if(!document.getElementsByTagName)return"";c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),ch={multiPick:!1,autoGroup:!1,adaptiveBrushWidth:!1,adaptiveLineWidth:!1,angleArcs:0,allowCrop:!1,allowDragDrop:!0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,
allowSystemClipboard:!0,allowScroll:!0,allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,autoZoomTextSize:0,background:"clear",backgroundImage:null,broadcastMouse:!1,confine:"none",collaborationServer:"wss://zwibbler.com/socket2",collaborationProtocolVersion:2,clickToDrawShapes:!1,clipToPage:!0,debug:!1,debugOutlineColour:"red",defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:q.Oa,defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",
defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoughness:0,defaultRoundRectRadius:10,defaultSmoothness:"smooth",defaultStrokeStyle:q.Oa,defaultText:"Lorum ipsum dolor",defaultTextBackground:q.he,defaultTextAlign:"left",defaultTextDecoration:"none",defaultTextFillStyle:q.Oa,defaultTextStrokeStyle:q.Oa,defaultTextLineWidth:0,defaultWritingMode:"",defaultZoom:1,drawShapeStyle:"box",emulateGestures:!1,fastDraw:!0,fonts:["Arial","Times New Roman"],gridBlocks:10,
gridColour:"#cccccc",gridSpacing:20,hintFont:"15px sans-serif",imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDragDuplicate:"Ctrl+Alt,Ctrl+\u2318",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G,\u2318+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",
keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPan:"",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z,\u2318+Shift+Z,Ctrl+Y",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A,\u2318+A",keySendToBack:"End",keySnappingOff:"Alt",keySnappingOn:"",keyUndo:"Ctrl+Z,\u2318+Z",keyUngroup:"Ctrl+Shift+G,\u2318+Shift+G",keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",latency:0,leaveTextToolOnBlur:!1,
maxReconnectSeconds:300,maximumZoom:0,magnet:!0,minAutoZoomTextSize:15,minimumZoom:0,multilineText:!1,multitouch:!1,nudge:10,outsidePageColour:"#707070",pageBorderColour:"rgba(0,0,0,0.0)",pageInflation:20,pagePlacement:"centre",pageSelectorDiv:"",pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,pixelsPerUnit:1,preciseNudge:1,readOnly:!1,rightButtonPans:!1,rulerBackgroundColour:"#ccc",rulerColour:q.Oa,scrollbars:!0,scrollbarStyle:"auto",setFocus:!0,scrollbarHandleColour:"auto",
selectMode:"surround",selectTransparent:!1,showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,showImageTool:!1,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showRuler:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,
showSmoothnessProperty:!0,showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,showOwnPointer:!0,showOtherPointers:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,snapAngle:45,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:1,symmetry:0,textMode:"interactive",toolbarButtonSize:50,touchRadius:0,useSelectionHandles:!0,useTouch:"auto",units:"",viewMargin:[0,0,0,0],wheelAdjustsBrush:"down",zoomOnResize:!1,colourPalette:"auto",colourPicker:"wheel",drawCircleStyle:"box",
enableArrowKeysNudge:!1,showKeyboardHelp:!0,showMenu:!1},dh={},eh;for(eh in ch)dh[eh.toLowerCase()]=eh;
var fh={useSelectionHandles:1,useTouch:1},gh=function(c){function a(a,d){a=c.call(this,a,ch,d)||this;a.ve="";""===a.ve&&a.set("imageFolder",a.options.imageFolder);"auto"===a.options.useTouch&&ah("Detected touch support: %s","ontouchstart"in window||"onmsgesturechange"in window);ah("Detect clipboard support: %s",a.Nr());return a}__extends(a,c);a.prototype.Wr=function(){var a=Ob(),d;for(d in a)this.set(d,a[d])};a.xz=function(a){return a.toLowerCase()in dh};a.prototype.has=function(a){return c.prototype.has.call(this,
a)||a.startsWith("_")};a.prototype.Hv=function(a,d){"debug"===a&&(a="showDebug");if("defaultZoom"===a){if("page"!==d&&"width"!==d&&!Zg(d)&&(d=parseFloat(d),isNaN(d))){ah("Error: Config option %s must be a number or 'page' or 'width'",a);return}}else if("imageFolder"===a){var b=this.HD();""===b?(this.ve=d.replace("$SCRIPT/",""),this.ve=this.ve.replace("$SCRIPT","")):this.ve=d.replace("$SCRIPT/","$SCRIPT").replace("$SCRIPT",b);""!==this.ve&&"/"!==this.ve[this.ve.length-1]&&(this.ve+="/");ah("scriptPath=%s imageFolder=%s, result:%s",
b,this.options.imageFolder,this.ve)}else if("broadcastMouse"===a)"true"===d?d=!0:"false"===d&&(d=!1);else if("viewMargin"===a){b=null;if(Yg(d)){b=[];var c=0;for(d=d.split(",");c<d.length;c++)b.push(parseFloat(d[c]))}else"number"===typeof d?b=[d,d,d,d]:Xg(d)&&(b=d);b&&(1===b.length?b.push(b[0],b[0],b[0]):2===b.length&&b.push(b[0],b[1]));d=b||this.options.viewMargin}else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d)){console.log(Error("Config option "+a+" expects a number"));
return}}else if("allowSelectBox"===a)"auto"!==d&&"pan"!==d&&(d="true"===d);else if(!fh[a]&&"boolean"===typeof this.options[a]||fh[a]&&"auto"!==d)d="1"===d||"true"===d||""===d;return{name:a,value:d}};a.prototype.HD=function(){var a=bh;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.KI=function(){return this.options.showBrushTool};a.prototype.NI=function(){return this.options.showPropertyPanel};a.prototype.LI=function(){return this.options.showColourPanel};a.prototype.MI=function(){return this.options.showDebug};
a.prototype.OI=function(){return this.options.showToolbar};a.prototype.nb=function(a){return this.get(a)};a.prototype.get=function(a){switch(a){case "useTouch":return this.Ft();default:return c.prototype.get.call(this,a)}};a.prototype.Ft=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.OH=function(a){return"boolean"===typeof this.options.useSelectionHandles?this.options.useSelectionHandles:!a};a.prototype.CC=function(){if("auto"===
this.options.allowSelectBox){var a=this.Ft(),d=document.documentElement.offsetHeight,c=window.innerHeight,f=!a||a&&0<c-d+50;ah("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",f,a,d,c);return f}return this.options.allowSelectBox};a.prototype.RC=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.mr=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===
a.indexOf("/")?a:this.ve+a};a.prototype.Fc=function(a){return B.Fc(this.get(a))};a.prototype.uA=function(a){function b(a){for(var b="",d=0;d<a.length;d++){var c=a.charAt(d);b=c===c.toUpperCase()?b+("-"+c.toLowerCase()):b+c}return b}function c(b){k&&(a.zt(k,"start-pan"),a.zt("up:"+k,"end-pan"));k=b;a.map(b,"start-pan");a.map("up:"+b,"end-pan")}var f=this,h={keyCut:1,keyCopy:1,keyPaste:1,keySnappingOff:1,keySnappingOn:1},k="",l;for(l in this.options)this.options.hasOwnProperty(l)&&("keyPan"===l?c(this.options[l]):
0!==l.indexOf("key")||h[l]||a.map(this.options[l],b(l).substr(4)));this.pa("update",function(d,e,f){"keyPan"===d?c(e):0!==d.indexOf("key")||h[d]||(d=b(d).substr(4),ah("Unmap keyboard %s=>%s",f,d),a.zt(f,d),ah("Map keyboard %s=>%s",e,d),a.map(e,d))});this.pa("allowSystemClipboard",function(){var b=!f.Nr();b?ah("Not using system clipboard. Mapping cut/copy/paste keys"):ah("Using system clipboard. Ignore keyCut/keyCopy/keyPaste.");a.map(f.options.keyCut,"cut",b);a.map(f.options.keyCopy,"copy",b);a.map(f.options.keyPaste,
"paste",b)})};a.prototype.sj=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&ah("Zoom restricted to %s",a);return a};a.prototype.Nr=function(){var a=document;return this.get("allowSystemClipboard")&&void 0!==a.oncopy&&void 0!==a.oncut&&void 0!==a.onpaste};a.prototype.Kn=function(a,d){var b=0;for(d=d.toLowerCase().split(",");b<d.length;b++){var c=d[b],h=!1,k=!1,l=!1,n=!1;0<=c.indexOf("shift")&&
(h=!0);0<=c.indexOf("alt")&&(n=!0);if(0<=c.indexOf("meta")||0<=c.indexOf("\u2318"))l=!0;if(0<=c.indexOf("ctrl")||0<=c.indexOf("control"))k=!0;if(!(!(k||h||n||l)||k&&!a.ctrlKey||n&&!a.altKey||h&&!a.shiftKey||l&&!a.metaKey))return!0}return!1};a.prototype.Ov=function(a){a/=this.get("pixelsPerUnit");var b=this.get("units");switch(b){case "px":case "":a=""+Math.round(a)+b;break;default:a=""+Math.round(100*a)/100+b}return a};a.prototype.Fy=function(a,d,c){switch(a){case "broadcastMouse":if(c instanceof
Object)return!0}return d!==c};return a}(Rb);var hh=function(){function c(){this.be=0;this.fn=null}c.prototype.request=function(a,b){var d=this;this.sA=a;this.fn=b;0===this.be&&(this.be=window.requestAnimationFrame(function(a){d.be=0;d.fn&&d.fn(d.sA,a)}))};c.prototype.cancel=function(){0!==this.be&&(window.cancelAnimationFrame(this.be),this.be=0)};return c}();var ih=v.create("MOVE"),mh=function(){function c(a,b,d,c){var e=this;this.Da=a;this.node=d;this.gj=c;this.lo=this.nx="";this.Et=!0;this.placeholder=this.Ix=null;this.nq="column";this.Xr=function(){};this.kh=new Me;this.Xp=new hh;this.oe=null;ih("Moving node: %s istool=%s",d.id,c);this.Da.Df(!0);this.Da.zb("move");this.NE=d.ea.style.position||"";this.mo=d.ea.style.left||"";this.oo=d.ea.style.top||"";this.no=d.ea.parentElement;this.OE=B(d.ea).pf("zIndex");this.ME=d.ea.nextElementSibling;this.Eg=null!==
d.ea.getAttribute("confine")||1===c;this.jj=d.Fk();this.QE=d.parent;this.nx=d.ea.style.pointerEvents;this.lo=d.ea.style.cursor;this.PE=d.parent?d.parent.te(d):-1;d.ea.style.cursor="move";var h=this.Da.Ed(b.Jb,b.Kb,!0);this.start=h;if(2===c){a=jh(this.node.ea);var k=this.Da.Ed(a.x,a.y,!0);ih("Moving fixture from %s; tl=%s",a,k);a.x=k.x;a.y=k.y;this.node.rect=a;this.jj=this.node.rect}"IFRAME"===d.ea.tagName&&(this.Et=!1);d.ea.style.position="absolute";this.Et&&this.Da.Ml.appendChild(d.ea);d.ea.style.zIndex=
"1";this.uE=B(d.ea).Ti();1===c&&(this.node.rect=new K(h.x-this.node.ea.offsetWidth/2,h.y-this.node.ea.offsetHeight/2,this.node.ea.offsetWidth,this.node.ea.offsetHeight),this.jj=this.node.rect,d.ea.style.pointerEvents="none",this.Xr=function(){ih("Got image load event from dragged tool");e.tF(h)},this.node.ea.addEventListener("load",this.Xr,!0));this.rect=this.node.Fk();d.ea.classList.add("dragging");this.Da.aa.Oc(function(a){var b=a.rect;Uc(a)&&(b=a.Fk());e.kh.zu(b,a.id)});this.Fb(h.x,h.y,b)}c.prototype.Vd=
function(){ih("Entering DragHTMLBehaviour")};c.prototype.yb=function(a){if(this.Da.fa.get("allowZoom")&&"gesturestart"===a.type){ih("Switch to default behaviour");var b=new Og(this.Da);this.Da.Xa(b);b.yb(a);return!0}return!1};c.prototype.Qc=function(){this.Da.fp(new L);this.Da.Df(!1);this.Da.zb("default");this.node.ea.style.left=this.mo;this.node.ea.style.top=this.oo;this.node.ea.style.position=this.NE;this.node.ea.style.zIndex=this.OE;this.node.ea.style.transform="";this.node.ea.style.pointerEvents=
this.nx;this.node.ea.style.cursor=this.lo;this.node.ea.classList.remove("dragging");this.no&&this.Da.aa.Xn(this.node.id)?this.Et&&this.no.insertBefore(this.node.ea,this.ME):B(this.node.ea).remove();this.oe&&this.oe.classList.remove("drop");ih("DragHTMLBehaviour.leave()");this.Xx();this.node.ea.removeEventListener("load",this.Xr,!0);1===this.gj&&this.node.Sa();this.Xp.cancel()};c.prototype.eB=function(a,b){b=jh(b);b.transform(this.Da.En());a.x<b.x&&(a.x=b.x);a.y<b.y&&(a.y=b.y)};c.prototype.Fb=function(a,
b,d){var c=this;this.Xp.request(d,function(a){var b=c.Da.Ed(a.pageX,a.pageY),d=b.kt(c.start),e=c.jj;c.rect.x=e.x+d.x;c.rect.y=e.y+d.y;c.Eg&&c.no&&c.eB(c.rect,c.no);c.Da.fa.get("magnet")&&(d=c.kh.YG(c.rect,c.node.id),c.rect.x+=d.x,c.rect.y+=d.y);(d="view"===c.Da.fa.get("confine"))&&c.rect.mq(c.Da.$b());c.node.ea.style.left=c.rect.x+"px";c.node.ea.style.top=c.rect.y+"px";c.node.Il(kh(c.rect,c.uE));e=new jc(c.rect.x-c.jj.x,c.rect.y-c.jj.y);1!==c.gj&&c.Da.fp(e);c.Da.aa.vC(c.Da.ma,c.Da.request,[c.node]);
c.Da.ka();e=jh(c.node.ea);e=c.nC(e);null!==e?c.iA(e,a.pageX,a.pageY):c.Xx();a=c.node.ia("$component");var f=null,r=jh(c.node.ea);B(c.Da.Yf()).query('[z-drop-accept="'+a+'"]',function(a){var b=jh(a),d=Math.min(r.Ei(),b.Ei());a!==c.node.ea&&b.Dx(r)>.7*d&&(f=a)});a=f;a!==c.oe&&(c.oe&&c.oe.classList.remove("drop"),c.oe=a,c.oe&&c.oe.classList.add("drop"));c.node.ea.dispatchEvent(new CustomEvent("zwibbler-dragging",{cancelable:!0,detail:{node:c.node.id,JB:c.rect.x,KB:c.rect.y,width:c.rect.width,height:c.rect.height}}));
d||c.Da.scrollIntoView(b.x,b.y)});return!0};c.prototype.nC=function(a){var b=this.node.ia("$component"),d=null;B(this.Da.Yf()).query("[container-for]",function(c){lh(c,b)&&jh(c).Dx(a)>.5*a.Ei()&&(d=c)});return d};c.prototype.iA=function(a,b,d){var c=B(a).pf("flex-direction");this.nq=c.startsWith("row")?"row":c.startsWith("col")?"column":"none";a:{c=this.nq;var f=0,h=null,k,l=new J(b,d),n=null;if("none"===c)b=a.lastElementChild;else{for(k=a.firstElementChild;k;){if(!k.classList.contains("placeholder")){if(!k.getAttribute("nid")){ih("Place at end -- non-zwibbler nodes present in container-for.");
b=null;break a}n=jh(k);n=(new J(n.x,n.y)).ic(l);if(!h||n<f)h=k,f=n;n=k}k=k.nextElementSibling}h&&h===n&&(n=jh(h),"column"===c&&d>n.y||"row"===c&&b>n.x+n.width/2)&&(h=null);b=h}}if(this.placeholder&&this.placeholder.parentNode){if(a!==this.placeholder.parentElement||b!==this.Ix)this.Ix=b,a.insertBefore(this.placeholder,b)}else d={},d.flex="column"===this.nq?"0 0 "+this.node.ea.clientHeight+"px":"0 0 "+this.node.ea.clientWidth+"px",this.placeholder=B("div",{"class":"placeholder"}).Va(d).Ag(),a.insertBefore(this.placeholder,
b)};c.prototype.Xx=function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)};c.prototype.oc=function(a,b,d){this.Xp.cancel();ih("onMouseUp()");if(1===this.gj&&!jh(this.Da.canvas.first).Xc(d.pageX,d.pageY))return ih("Dropped nowhere!"),this.Da.Xa(new Og(this.Da)),!0;a="static";var c=0,f=0,h=0;b=this.Da.aa.Oe();if(this.placeholder&&this.placeholder.parentElement)if("flex"!==B(this.placeholder.parentElement).pf("display")&&(a="absolute"),d=this.Da.aa.kr(this.placeholder)){b=
d;c=this.placeholder;f=this.placeholder.parentElement.firstElementChild;for(h=0;f&&f!==c;)f.getAttribute("nid")&&h++,f=f.nextElementSibling;h=Math.min(h,d.children.length-1);ih("Use placeholder, place at %s:%s",b.id,h);c=this.rect.x-d.rect.x;f=this.rect.y-d.rect.y}else ih("Placeholder is not in a NID node");else ih("No placeholder; add to root"),a="absolute",h=b===this.QE?this.PE:-1,c=this.rect.x,f=this.rect.y;d=!this.node.ea.dispatchEvent(new CustomEvent("zwibbler-drop",{cancelable:!0,detail:{node:this.node.id,
CI:b.id,BI:h,JB:c,KB:f,oe:this.oe}}));this.Da.Xa(new Og(this.Da));d?ih("DragHTML was cancelled by element"):(this.Da.aa.lb(),0===this.gj||2===this.gj?this.Da.aa.Cd(this.node.id,b.id,h):b&&1===this.gj&&(d=this.node.hb(),"absolute"===a&&(d["style.position"]="absolute",d["style.left"]=c+"px",d["style.top"]=f+"px"),this.Da.aa.createNode("HTMLNode",d,b.id,h),this.Da.pb(),this.Da.bf(this.node)),"absolute"===a?this.Da.aa.Ab([this.node.id],{"style.left":c+"px","style.top":f+"px","style.position":a}):this.Da.aa.Ab([this.node.id],
{"style.left":"","style.top":"","style.position":""}),this.oe&&(a=this.Da.ra.cw(this.oe))&&(a=this.Da.ra.un(a))&&a.element&&Q.Nb(a.element,"drop",this.node.Wi(null)),this.Da.aa.Ea(!1));return!0};c.prototype.tF=function(a){this.node.rect=new K(a.x-this.node.ea.offsetWidth/2,a.y-this.node.ea.offsetHeight/2,this.node.ea.offsetWidth,this.node.ea.offsetHeight);this.jj=this.node.rect};return c}();function jh(c){c=B(c).wb();return new K(c.left,c.top,c.width,c.height)}
function kh(c,a){c=c.clone();c.x+=a.left;c.width-=a.left+a.right;c.y+=a.top;c.height-=a.top+a.bottom;return c};var nh=v.create("Background"),oh=null;bc.then(function(c){return oh=c});
var qh=function(){function c(a){this.fa=a;this.rect=new K(0,0,0,0);this.kk=null;this.background=q.he;this.update=!0;this.Pw=null;this.Qw=1;this.Ga=[];this.canvas=document.createElement("canvas");this.Vo=""}c.prototype.GF=function(){this.update=!0};c.prototype.dG=function(a){a!==this.background&&(this.background=a,this.update=!0)};c.prototype.Dl=function(a){a!==this.kk&&(this.kk=a,this.update=!0)};c.prototype.aG=function(a){this.Ga=ph(a,function(a,d){return a.ue()-d.ue()});this.update=!0};c.prototype.ED=
function(a,b,d){if(this.update||a!==this.Pw||!b.xd(this.rect)||d!==this.Qw)this.vF(b,d),this.Pw=a,this.Qw=d,this.update=!1;if(this.Vo)return this.Vo;var c;this.canvas.width&&this.canvas.height&&(c=a.createPattern(this.canvas,"no-repeat"));return c||q.zp};c.prototype.vF=function(a,b){this.rect=a;nh("Regenerate background for %s, %s",a,b);if("grid"===this.background||"clear"===this.background||oh&&oh.cr(this.background)||0!==this.Ga.length||this.kk){this.Vo="";$c()&&(this.canvas=document.createElement("canvas"));
Math.floor(a.width*b)!==Math.floor(this.canvas.width)&&(this.canvas.width=a.width*b);Math.floor(a.height*b)!==Math.floor(this.canvas.height)&&(this.canvas.height=a.height*b);var d=this.canvas.getContext("2d");d.setTransform(b,0,0,b,-a.x*b,-a.y*b);(b=q.Ak(this.background))?(d.fillStyle=b.toString(),d.fillRect(a.x,a.y,a.width,a.height)):"grid"===this.background?this.aF(d,a):"clear"===this.background&&d.clearRect(a.x,a.y,a.width,a.height);if(oh&&(b=oh.cr(this.background)))try{b(d,a.x,a.y,a.width,a.height)}catch(e){console.warn("Error in custom background function "+
this.background+": ",e)}if(this.kk)try{this.kk(d,a.x,a.y,a.width,a.height)}catch(e){console.warn("Error in custom background function: ",e)}a=0;for(b=this.Ga;a<b.length;a++)b[a].ka(d)}else this.Vo="clear"===this.background?q.he:this.background};c.prototype.aF=function(a,b){function d(d){var c=Math.ceil(b.x/d)*d,e=Math.ceil(b.y/d)*d,f=Math.floor(b.right()/d)*d,h=Math.floor(b.bottom()/d)*d;for(a.beginPath();c<=f;c+=d)a.moveTo(c,b.y),a.lineTo(c,b.bottom());for(;e<=h;e+=d)a.moveTo(b.x,e),a.lineTo(b.right(),
e);a.stroke()}var c=this.fa.get("gridBlocks"),f=this.fa.get("gridSpacing"),h=(c||1)*f;a.strokeStyle=this.fa.get("gridColour");a.fillStyle=q.Od;a.fillRect(b.x,b.y,b.width,b.height);a.lineWidth=.5;d(f);c&&(a.lineWidth=2,d(h))};return c}();function ph(c,a){for(var b=[],d=0;d<c.length;d++)b.push(d);b.sort(function(b,d){var e=a(c[b],c[d]);return 0!==e?e:b-d});for(var e=[],f=0;f<b.length;f++)d=b[f],e.push(c[d]);return e};function rh(c){for(var a=[],b=0;b<c.length;b++)a.push(String.fromCharCode(c.charCodeAt(b)^"zwibbler3".charCodeAt(b%9)));return a.join("")}rh(">2$-");for(var sh=[115,116,114,111,107,101,84,101,120,116],th=[],uh=0;uh<sh.length;uh++)th.push(String.fromCharCode(sh[uh]));
var xh=function(){function c(a,b,d,e,f,h,k,l,n,r,u,x){var w=this;this.Wd=a;this.canvas=b;this.$c=e;this.fa=f;this.language=h;this.ra=k;this.Aa=l;this.Ml=n;this.Rd=r;this.by=u;this.kz=x;this.Ce="none";this.Sl=this.Rl=0;this.scale=1;this.code=this.Cb=this.Bb=0;this.Xe=new K(0,0,0,0);this.Ts=new zc;this.xj=this.Al=this.Mo=!0;this.Ss=new L;this.selection=[];this.ni=[];this.Ud="default";this.sa={};this.Qr=this.ih=this.Wm=!1;this.Me=1;this.zm={};this.Am=null;this.$p="";this.jf=this.ya=null;this.Bi=!1;this.Yc=
this.Td=this.Ke=q.Oa;this.Li=5;this.bj="";this.hd=0;this.gs=new K(0,0,0,0);this.hs=new K(0,0,0,0);this.Ta={Wb:!1,Dc:!1,eq:!1,x:100,y:100};this.Sw=!1;this.Nn=new pb;this.Hn=[];this.xv=0;this.kh=new Me;this.Op=null;this.uc=new K(0,0,0,0);this.Qe=new Hf(this);this.Rj=null;this.log=v.create("VIEW");this.ww=0;this.Xk="";this.Rw=new K(0,0,0,0);this.fs=0;this.ma=this.canvas.get(0);this.canvas.$z();this.fa.pa("fastDraw",function(a){w.canvas.GG(a)});this.ih=!0===f.get("pageView");this.background=new qh(f);
this.wF();this.ta=new Og(this);this.Aa.add(function(){w.ta&&w.ta.Qc&&w.ta.Qc();w.request.bk();w.bd.bk();w.od.bk();w.ta={};w.aa.Sa()});this.bd=new Tg(this.Aa,!0);this.bd.ke(this.canvas.get(0).canvas.parentNode);this.od=new Tg(this.Aa,!1);this.od.ke(this.canvas.get(0).canvas.parentNode);this.fa.pa("scrollbarHandleColour",function(a){w.bd.wy(a);w.od.wy(a)});this.fa.pa("scrollbarStyle",function(a){w.bd.Va(a);w.od.Va(a)});var y=this;this.request=new ag;this.request.canvas=this.canvas.get(0).canvas;this.request.fa=
this.fa;this.request.pa("reformat",function(a){w.log("Node %s requests reformat",a);w.aa.yd(a)&&(w.log("   Reformatting... zoom=%s",w.Ce),w.aa.Sg(a));w.update();(a=w.aa.Ob(a))&&"background"===a.Gc()&&w.Ch();w.uj();w.ra.pe("resource-loaded")});this.request.pa("redraw",function(a){w.log("Node %s requests redraw",a);w.ka()});this.request.pa("convert-dom-request",function(a,b){y.ra.ua("convert-dom-request",b,a)});this.request.pa("mouseevent",function(a){w.Uy.handleEvent(a)});this.request.pa("started",
function(){w.ra.yy(!0)});this.request.pa("done",function(){w.ra.yy(!1)});this.od.pa("scroll",function(a){y.Cb=-a*y.scale;y.ra.ua("scroll");w.aa.Qs(w.$b());w.wt();y.ka()});this.bd.pa("scroll",function(a){y.Bb=-a*y.scale;y.ka();w.aa.Qs(w.$b());w.wt();y.ra.ua("scroll")});this.aa=this.ri(new vh(!1,a,d,k.Pf,this.ma,this.request));this.Ch();this.fa.pa("update",function(a,b){w.kg(a,b)});$c()&&this.Aa.addEventListener(document,"webkitfullscreenchange",function(){w.log("SAFARI WORKAROUND: Disabling requestAnimationFrame.");
w.requestAnimationFrame=c.prototype.requestAnimationFrame});a=document;a.fonts&&this.Aa.addEventListener(a.fonts,"loadingdone",function(){w.log("Font loading done, redraw now.");w.ka()});this.je(.5,0,0,-30,"","rotate");this.je(0,0,0,0,"","scale");this.je(1,0,0,0,"","scale");this.je(1,1,0,0,"","scale");this.je(0,1,0,0,"","scale");this.je(.5,0,0,0,"","scale");this.je(1,.5,0,0,"","scale");this.je(.5,1,0,0,"","scale");this.je(0,.5,0,0,"","scale");this.ta=this.Hb()}c.prototype.Tp=function(a){this.fa.get("adaptiveBrushWidth")&&
(a/=this.scale);return a};c.prototype.RD=function(a,b){var d,c=!1;for(d=0;d<a.Io.length;d++){var f=a.Io[d];f in this.zm&&(this.log("Background node has been removed"),c=!0)}for(d=0;d<a.um.length;d++){f=a.um[d];var h=this.aa.za(f,!1);"background"===h.ia("layer")&&(this.log("Background node has been added"),c=!0)}for(d=0;d<a.ip.length;d++)f=a.ip[d],h=this.aa.za(f,!1),"background"===h.ia("layer")?(this.log("Background node has been changed"),c=!0):f in this.zm&&(this.log("Node removed from background layer"),
c=!0);(this.aa.Oe().ia("background")||this.$p)!==this.$p&&(c=!0);c&&this.Ch();a.um.length&&this.ra.ua("nodes-added",a.um,{},b);a.ip.length&&this.ra.ua("nodes-changed",a.ip,{},b);a.Io.length&&this.ra.ua("nodes-removed",a.Io,a.ba,b)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.AC=function(){this.log("getActiveLayer() -> %s",Array(this.Ub.entries()));return Array.from(this.Ub).join(",")};c.prototype.Oo=function(a){this.log("setActiveLayer(%s)",a);a=a.split(",");this.Ub=new Set;for(var b=
0;b<a.length;b++)this.Ub.add(a[b]);this.Ud=a[0];this.pb();this.xc();this.ka()};c.prototype.Kl=function(a,b){this.aa.Kl(a,b);this.Wh(!1);"background"===a&&this.Ch();!b&&this.Ub.has(a)&&(this.pb(),this.xc());this.ka()};c.prototype.ri=function(a){var b=this;this.log("setDocument()");this.Hb();this.aa&&this.aa.Sa();this.aa=a;this.aa.zx=function(a,d,c,k,l){b.ro(a,d,c,k,l)};this.scale=1;this.Cb=this.Bb=0;this.selection=[];this.jf=this.ya=null;this.hd+=1;this.Xe=new K(0,0,0,0);this.Ts=new zc(this.Xe);this.Ss=
new L;this.bj="";this.Ub=new Set;this.Ub.add("default");this.Td=q.Od;this.Yc=this.fa.nb("defaultBrushColour");this.Ke=this.fa.nb("defaultStrokeStyle");this.sa.lineWidth=this.fa.nb("defaultLineWidth");this.sa.lineHeight="100%";this.sa.roughness=this.fa.nb("defaultRoughness");this.sa.sloppiness=.5;this.sa.fontName=this.fa.nb("defaultFont");this.sa.fontSize=this.fa.nb("defaultFontSize");this.sa.bold=this.fa.nb("defaultBold");this.sa.italic=this.fa.nb("defaultItalic");this.sa.smoothness=.3;this.sa.textFillStyle=
this.fa.nb("defaultTextFillStyle");this.sa.textStrokeStyle=this.fa.nb("defaultTextStrokeStyle");this.sa.textLineWidth=this.fa.nb("defaultTextLineWidth");this.sa.textDecoration=this.fa.nb("defaultTextDecoration");this.sa.textAlign=this.fa.nb("defaultTextAlign");this.Li=this.fa.get("defaultBrushWidth");var d=this.nf(0);this.Bb=-d.x;this.Cb=-d.y;this.Qd();this.aa.ft=this.fa.get("spotHighlightColour");this.aa.Wo=this.fa.get("spotHighlightZIndex");this.aa.format(this.ma,this.request,!1);this.hs=new K(0,
0,0,0);this.gs=new K(0,0,0,0);this.Ae(this.fa.get("defaultZoom"));this.ka();return a};c.prototype.kg=function(a,b){var d=!1;switch(a){case "allowResize":this.xh();this.ka();break;case "defaultBrushColour":this.Yc=b;break;case "defaultFillStyle":this.Td=this.sa.fillStyle=b;break;case "defaultStrokeStyle":this.Ke=b;this.sa.strokeStyle=b;break;case "defaultLineWidth":this.sa.lineWidth=b;break;case "defaultRoughness":this.sa.roughness=b;break;case "defaultFont":this.sa.fontName=b;break;case "defaultBold":this.sa.bold=
b;break;case "defaultTextAlign":this.sa.textAlign=b;break;case "defaultTextDecoration":this.sa.textDecoration=b;break;case "defaultItalic":this.sa.italic=b;break;case "defaultFontSize":this.sa.fontSize=b;break;case "defaultTextFillStyle":this.sa.textFillStyle=b;break;case "defaultTextStokeStyle":this.sa.textStrokeStyle=b;break;case "defaultTextLineWidth":this.sa.textLineWidth=b;break;case "defaultBrushWidth":this.Li=b;break;case "defaultZoom":this.Ae(b);break;case "pageView":this.ih=b;d=!0;break;
case "pagePlacement":case "pageInflation":case "viewMargin":this.Ae(this.Ce);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":"background"===a&&(d=this.aa.Oe(),this.aa.ce([d.id],"background",b));this.Am=null;this.background.GF();this.Ch();d=!0;this.Wh(!1);break;case "pageShadow":case "outsidePageColour":case "clipToPage":d=!0;break;case "readOnly":!0===b&&(this.Hb(),this.pb(),this.xc(),d=!0);this.aa.Bj(b);break;case "spotHighlightColour":this.aa.ft=b;d=!0;
break;case "spotHighlightZIndex":this.aa.Wo=b;d=!0;break;case "showRuler":case "pixelsPerUnit":case "units":case "rulerBackgroundColour":case "rulerColour":d=!0;break;case "allowScroll":case "scrollbars":d=!0;this.Qd();break;case "useSelectionHandles":this.xh(),d=!0}this.ta.kg&&this.ta.kg(a,b);d&&this.ka()};c.prototype.Cf=function(a,b){var d=this.Kh();this.log("Set default %s=%s tool=%s",a,b,d);if("underline"===a)this.Cf("textDecoration",b?"underline":"none");else if(!(this.ta instanceof If)){switch(a){case "fillStyle":switch(d){case "text":this.sa.textFillStyle=
b;return;case "brush":this.Yc=b;return;default:this.Td=b}break;case "strokeStyle":this.Yc=this.Ke=b}this.sa[a]=ed(this.sa[a],b)}};c.prototype.Ae=function(a){a!==this.Ce&&this.log("Zooming to: %s (scale %s)",a,this.scale);var b=this.Ne(!0),d=b.width-20,c=this.aa.pw()||this.ih;this.Ce=a;c||"number"===typeof a||this.log("WARNING: Zoom to page/width but document size has not been set.");if("number"===typeof a)this.scale=a;else if("none"===a||this.aa.empty())"page"===a?this.Gd(this.nf(),!1,!1):this.scale=
1;else{if("page"===a){var f=this.Og();this.Gd(f,"centre"===this.fa.get("pagePlacement"),!0);this.Ce=c?a:this.scale;this.ta.Te&&this.ta.Te();return!0}"width"===a&&(f=this.Og(),this.scale=d/f.width,this.Bb=-f.x*this.scale+b.x,this.Cb=-f.y*this.scale+b.y,this.log("RECT=%s scale=%s tx=%s ty=%s",f,this.scale,this.Bb,this.Cb),this.Ce=a)}0>=this.scale&&(this.scale=1);c||(this.Ce=this.scale);this.Qd();this.ka();this.ta.Te&&this.ta.Te();return!0};c.prototype.Ed=function(a,b,d){void 0===d&&(d=!1);a=this.En().apply(a,
b);d||(a=this.Ib(a,0));return a};c.prototype.Jg=function(a,b){return this.En().inverse().apply(a,b)};c.prototype.IE=function(a,b,d){return a.lc().multiply(this.En()).apply(b,d)};c.prototype.Gf=function(a){return this.Ed(a.pageX,a.pageY,!0)};c.prototype.Dd=function(a,b){if(B.dg(b.target,b))this.log("Target is text entry -- ignore key command");else if(this.ra.Xb&&!1!==this.ra.Xb.Dd(a,b))b.stopPropagation(),b.preventDefault();else{this.ta.Dd&&this.ta.Dd(a,b);var d=this.Qe.Yd();this.Qe.Dd(a,b);!d&&this.Qe.Yd()&&
this.ta.cancel&&this.ta.cancel();if(!this.SD(a,b)){switch(a){case "next-page":this.jd(this.aa.bb+1);break;case "previous-page":this.jd(this.aa.bb-1);break;case "zoom-to-page":this.fa.get("allowZoom")&&this.Ae("page");break;case "zoom-to-width":this.fa.get("allowZoom")&&this.Ae("width")}b.preventDefault();b.stopPropagation()}}};c.prototype.Zg=function(a){var b=a instanceof rf?a.qb.target:a.target;var d=this.fa.get("readOnly");d=(b=b?B(b):null)&&(!b.matches(".zwibbler-canvas-holder,.zwibbler-canvas-holder *, [z-drag-tool], [z-drag-tool] *, [z-fixture] *")||
b.matches(".zwibbler-passthrough, .zwibbler-passthrough *")&&(!(a instanceof rf)||this.Iw(a)||b.matches(".zwibbler-scrollbar"))||d&&b.matches(".zwibbler-dom-node,.zwibbler-dom-node *"));if(a instanceof rf)if(d=d&&!a.getData("not-passthrough")&&!this.Qr,!d&&"down"===a.type)a.setData("not-passthrough",!0);else if("gesturestart"===a.type)d=d&&this.rf(a.Jb,a.Kb);else if(!d&&"wheel"===a.type&&!a.ctrlKey&&b&&b.matches("[nid] *, [nid]")&&this.Iw(a))for(a=b.Ag();a;){if(a.scrollHeight!==a.offsetHeight){this.log("wheel is over scrolling element; passthrough event.");
d=!0;break}if(a.hasAttribute("nid"))break;a=a.parentElement}return d};c.prototype.Iw=function(a){var b=this.Gf(a);a=this.aa.Db(b.x,b.y,this.Hc(a.Vb()),this.scale,this.Ub);return a.node&&Tc(a.node)};c.prototype.rf=function(a,b){a=this.Ed(a,b);return this.$b().Xc(a.x,a.y)};c.prototype.bE=function(a){return a.target instanceof HTMLElement?B(a.target).matches("[z-fixture], [z-fixture] *"):!1};c.prototype.MA=function(){this.ww=(new Date).getTime()+200};c.prototype.wF=function(){function a(a){b.log(a.type)}
var b=this,d=this,c=new Af(this.Wd,{Du:this.fa.get("allowPointerEvents"),jp:!0,Jy:this.fa.get("emulateGestures")});this.Uy=c;this.Aa.add(function(){c.Sa()});c.pa("gesturestart",function(a){d.log("GestureStart");b.Zg(a)||(d.ta.yb&&!1!==d.ta.yb(a)?(a.stopPropagation(),a.preventDefault()):d.log("Pass to browser"))});c.pa("gesturechange",function(a){d.ta.yb&&!1!==d.ta.yb(a)?(a.stopPropagation(),a.preventDefault()):d.log("Pass to browser")});c.pa("gestureend",function(a){d.log("GestureEnd");d.ta.yb&&!1!==
d.ta.yb(a)?(a.stopPropagation(),a.preventDefault()):d.log("Pass to browser")});var f="onpointerdown"in window,h="ongesturestart"in window,k="onmousedown"in window;this.log("Have TouchEvents: %s","ontouchstart"in window);this.log("Have PointerEvents: %s",f);this.log("Have GestureEvents: %s",h);this.log("Have MouseEvents: %s",k);f&&!this.fa.get("allowPointerEvents")&&this.log("Configuration does not allow PointerEvents");var l=!1,n;c.pa("down",function(a){d.log(a.toString());if(!b.Zg(a))if(b.PA(),b.Sw=
a.Vb(),n=d.Gf(a),l=!0,b.ra.Xb&&!1!==b.ra.Xb.Eb(n.x,n.y,a))a.stopPropagation(),a.preventDefault();else{var c=!1;d.ta.Eb&&!1!==d.ta.Eb(n.x,n.y,a)&&(a.stopPropagation(),a.preventDefault(),c=!0);c||b.Qe.handleEvent(a);b.Wm||B.dg(a.target)||b.$c.ua("goto-canvas");b.Wm=!1}});c.pa("move",function(a){if(!b.Zg(a))if(l&&0===a.buttons&&(d.log("MISSED POINTERUP! Fixing."),a.setData("not-passthrough",!1),r(a)),b.Qe.Yd()&&b.Qe.handleEvent(a))a.stopPropagation(),a.preventDefault();else{var c=!1;n=d.Gf(a);b.ra.Xb&&
!1!==b.ra.Xb.Fb(n.x,n.y,a)?(a.stopPropagation(),a.preventDefault()):(d.ta.Fb&&!1!==d.ta.Fb(n.x,n.y,a)&&(a.stopPropagation(),a.preventDefault(),c=!0),!c&&b.Qe.handleEvent(a)&&(a.stopPropagation(),a.preventDefault()))}});var r=function(a){if(!b.Zg(a)||b.ta instanceof mh){var c=l=!1;b.Qe.Yd()&&b.Qe.handleEvent(a)?(a.stopPropagation(),a.preventDefault()):(d.log(a.toString()),n=d.Gf(a),b.ra.Xb&&!1!==b.ra.Xb.oc(n.x,n.y,a)?(a.stopPropagation(),a.preventDefault()):(d.ta.oc&&!1!==d.ta.oc(n.x,n.y,a)&&(a.stopPropagation(),
a.preventDefault(),c=!0),c||b.Qe.handleEvent(a)))}};c.pa("up",r);c.pa("tap",function(a){d.log(a.toString());b.Zg(a)||(b.ra.Xb&&!1!==b.ra.Xb.to(n.x,n.y,a)?(a.stopPropagation(),a.preventDefault()):d.ta.to&&(n=d.Gf(a),!1!==d.ta.to(n.x,n.y,a)&&(a.stopPropagation(),a.preventDefault())))});c.pa("drag",function(a){d.log(a.toString());b.Zg(a)||(b.ra.Xb&&!1!==b.ra.Xb.uo(n.x,n.y,a)?(a.stopPropagation(),a.preventDefault()):d.ta.uo&&(n=d.Gf(a),!1!==d.ta.uo(n.x,n.y,a)&&(a.stopPropagation(),a.preventDefault())))});
c.pa("doubletap",function(a){d.log("doubletap: "+a.toString());a.startTime<b.ww?d.log("ignoring doubletap: "+a.toString()):(d.log("doubletap: "+a.toString()),!b.Zg(a)&&d.ta.ks&&(n=d.Gf(a),!1!==d.ta.ks(n.x,n.y,a)&&(a.stopPropagation(),a.preventDefault())))});this.Aa.addEventListener(this.Wd,"pointerleave",function(a){var c=d.Gf(a);b.ra.Xb&&!1!==b.ra.Xb.ls(c.x,c.y,a)?(a.stopPropagation(),a.preventDefault()):d.ta.ls&&!1!==d.ta.ls(c.x,c.y,a)&&(a.stopPropagation(),a.preventDefault())});this.Aa.addEventListener(this.Wd,
"contextmenu",function(a){var c=d.Gf(a);b.ra.Xb&&!1!==b.ra.Xb.so(c.x,c.y,a)?(a.stopPropagation(),a.preventDefault()):d.ta.so&&!1!==d.ta.so(c.x,c.y,a)||b.Qe.Yd()?(a.stopPropagation(),a.preventDefault()):d.log("Pass contextmenu to browser")});!window.parent&&this.fa.get("setFocus")&&this.Wd.focus();c.pa("wheel",function(a){if(!b.Zg(a)){var c=a.SC();n=d.Gf(a);if(b.ra.Xb&&!1!==b.ra.Xb.ol(n.x,n.y,c,a.qb))a.stopPropagation(),a.preventDefault();else if(d.ta.ol&&!1!==d.ta.ol(n.x,n.y,c,a.qb))a.stopPropagation(),
a.preventDefault();else if(a.ctrlKey&&b.fa.get("allowZoom")){var e=1+.1*Math.abs(c.y/120);b.jz(0>c.y?1/e:e,n.x,n.y);a.stopPropagation();a.preventDefault()}else if("page"!==b.Ce){e=20/b.scale;var f=!1;c.x&&d.bd.Kw()&&(b.bd.scrollBy(0<c.x?e:-e),f=!0);c.y&&d.od.Kw()&&(b.od.scrollBy(0<c.y?e:-e),f=!0);f&&(a.stopPropagation(),a.preventDefault())}}});this.Aa.addEventListener(this.Wd,"drop",a);this.Aa.addEventListener(this.Wd,"dragenter",a);this.Aa.addEventListener(this.Wd,"dragleave",a)};c.prototype.nl=
function(a){this.log("Received clipboard event: %s",a.type);if(B.dg(a.target))this.log("   ignored due to being in a "+a.target.tagName);else if(this.fa.get("allowSystemClipboard"))if(null===a.clipboardData)this.log("Ignored; clipboardData is null.");else{var b=this;switch(a.type){case "copy":case "cut":if(!this.ow())break;this.log("Cut to system clipboard.");var c=this.Ah(!0,this.Xd(!1));a.clipboardData.setData("application/zwibbler",c);a.preventDefault();"cut"===a.type&&this.Sm();break;case "paste":if(this.fa.get("readOnly"))this.log("Ignore paste; we are in readOnly mode.");
else for(this.log("There are %s items on the clipboard",a.clipboardData.items.length),c=0;c<a.clipboardData.items.length;c++){var e=a.clipboardData.items[c];this.log("Item [%s] type is %s",c,e.type);if(b.xs(e)){a.preventDefault();break}else if("application/zwibbler"===e.type){this.log("Pasting from system clipboard");e.getAsString(function(a){b.sl(a)});a.preventDefault();break}}}}else this.log("   ignored due to allowSystemClipboard setting.")};c.prototype.Yf=function(){return this.Wd};c.prototype.xs=
function(a,b,c){var d=this;if(0!==a.type.indexOf("image/"))return!1;a instanceof Blob||(a=a.getAsFile());if("number"===typeof b&&"number"===typeof c){b=this.Ed(b,c);var f=b.x;var h=b.y}if(!1===this.ra.Nb("paste",a,f,h))this.log("paste of file is cancelled by external app.");else{var k=new FileReader;k.readAsDataURL(a);k.onloadend=function(){d.ho({url:k.result},f,h)};return!0}};c.prototype.SD=function(a,b){if(!this.Ta.Wb)return!1;if(!(b.target instanceof HTMLElement&&B(b.target).matches(".zwibbler-passthrough, .zwibbler-passthrough *"))){var c=
0,e=0,f=this.fa.get("nudge");switch(a){case "right":c=f;break;case "left":c=-f;break;case "down":e=f;break;case "up":e=-f;break;case "enter":this.Ta.Dc=!this.Ta.Dc;var h=this.Ta.Dc?"down":"up"}if(c||e)h=this.Ne(!1),this.Ta.x+=c,this.Ta.x=Math.max(this.Ta.x,0),this.Ta.x=Math.min(h.width,this.Ta.x),this.Ta.y+=e,this.Ta.y=Math.max(this.Ta.y,0),this.Ta.y=Math.min(h.height,this.Ta.y),this.ka(),h="move";return h?(b.preventDefault(),b.stopPropagation(),this.ka(),e=this.uc,c=this.Ta.x+e.x,a=this.Ta.y+e.y,
e=this.Ed(c,a),this.log("Simulate a %s at (%s,%s)",h,c,a),b=new rf(h,c,a,c,a,(new Date).getTime(),(new Date).getTime(),b.target,b.target,b,0,{},0,0,0,b.ctrlKey,b.shiftKey,b.altKey,b.metaKey),"down"!==h&&"tap"!==h||!this.ta.Eb||this.ta.Eb(e.x,e.y,b),"move"===h&&this.ta.Fb&&this.ta.Fb(e.x,e.y,b),"up"!==h&&"tap"!==h||!this.ta.oc||this.ta.oc(e.x,e.y,b),!0):!1}};c.prototype.ct=function(a){void 0===a&&(a=!1);this.Ta.Wb=!0;this.Ta.Dc=!1;this.Ta.eq=a;this.log("Showing keyboard cursor, caret=%s",a);this.ka()};
c.prototype.UG=function(a){this.Ta.Wb=!0;this.Ta.eq=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.Ta.Dc=!0;var b=this.Xe.me();this.Ta.x=b.x;this.Ta.y=b.y;this.Hb();this.Xa(new Xf(this,new Sf(Kf,this.selection[0].Pa(),this.selection[0].xa),!1,b.x-4,b.y-4,sf(a,a)))}this.ka()};c.prototype.tw=function(){this.Ta.Wb&&(this.log("Hiding keyboard cursor"),this.Ta.Wb=!1,this.ka())};c.prototype.Nw=function(){return this.fa.OH(this.Sw)&&!(this.ta instanceof $f)};c.prototype.Nh=
function(a){var b=this.fa.get("snap")||0;if("number"===typeof a)return a||b;var c=this.fa.get("keySnappingOn");if(c){if(this.fa.Kn(a,c))return b}else if(!this.fa.Kn(a,this.fa.get("keySnappingOff")))return b;return 0};c.prototype.Ib=function(a,b){var c=this.Nh(b);0<c?(b=Math.round(a.x/c)*c,a=Math.round(a.y/c)*c):(b=a.x,a=a.y);return new J(b,a)};c.prototype.Eg=function(a){if("page"===this.fa.get("confine")){var b=this.nf();a.x=Math.max(b.x,Math.min(b.x+b.width,a.x));a.y=Math.max(b.y,Math.min(b.y+b.height,
a.y))}return a};c.prototype.Sd=function(a,b){void 0===b&&(b=this.Xd(!1));this.aa.lb();this.aa.Sd(b,a);this.aa.Ea()};c.prototype.setProperty=function(a,b){var c=this.Xd(!0);this.sa[a]=b;if(c.length){this.aa.lb();this.aa.ce(c,a,b);if("fillStyle"===a)for(var e=0;e<c.length;e++){var f=this.aa.za(c[e],!1);f&&(this.log("nodeType=%s closed=%s",f.type(),f.ia("closed")),"PathNode"===f.type()&&!1===f.ia("closed")&&this.aa.ce([c[e]],"strokeStyle",b))}this.aa.Ea()}0<this.selection.length&&"lineWidth"===a&&"BrushNode"===
this.selection[0].type()?this.Li=b:"textFillStyle"===a&&(this.sa.textFillStyle=b)};c.prototype.de=function(a,b){this.ta.de&&this.ta.de(a,b);this.ta.js&&("strokeStyle"===a?this.ta.js(b,!1):"fillStyle"===a&&this.ta.js(b,!0))};c.prototype.rn=function(){return this.sa.fillStyle};c.prototype.Lk=function(){return this.sa.strokeStyle};c.prototype.at=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);var c=this.Xd(!0);this.aa.lb();b=b?"fillStyle":"strokeStyle";for(var e=0;e<c.length;e++){var f=
c[e],h=this.aa.za(f);h&&(h=h.ia(b))&&(h=ad(h,a),this.aa.ce([f],b,h),this.log("   set %s of %s to %s",b,f,h))}this.aa.Ea()};c.prototype.group=function(){var a=this;this.aa.transaction(function(){a.aa.group(a.Xd(!1))})};c.prototype.Nj=function(){var a=this;this.aa.transaction(function(){a.aa.Nj(a.Xd(!1))})};c.prototype.Sm=function(){var a=this,b=this.Xd(!1);this.ra.Nb("start-transform",{transformType:"delete",nodes:b});this.aa.transaction(function(){a.aa.wc(b)})};c.prototype.pb=function(a){void 0===
a&&(a=!1);var b=!1;if(0<this.selection.length){b=0;for(var c=this.selection;b<c.length;b++){var e=c[b];Uc(e)&&e.ea.classList.remove("zwibbler-selected")}this.hd+=1;this.selection.length=0;b=!0}null!==this.jf&&(this.ra.ua("selected-edit-handle",null,null),b=!0);this.ya&&(this.log("Clear edit node."),this.jf=this.ya=null,b=!0);b&&a&&(this.xc(),this.ka())};c.prototype.bf=function(a,b){void 0===b&&(b=!0);this.fh(null);if(a.hd!==this.hd&&this.Ub.has(a.Gc())){this.selection.push(a);a.hd=this.hd;Uc(a)&&
(a.ea.classList.add("zwibbler-selected"),this.log("Added to selection: %s",a.id));if(a.Un()){for(var c=a.parent,e=0;e<c.children.length;e++){var f=c.tb(e);N(f)&&this.bf(f)}N(c)&&this.bf(c)}if("GroupNode"===a.type())for(c=0;c<a.children.length;c++)f=a.tb(c),N(f)&&this.bf(f);if(this.fa.get("autoGroup")&&b)for(b=0,a=this.aa.FC(a);b<a.length;b++)this.bf(a[b],!1)}};c.prototype.selectNodes=function(a){this.pb();for(var b=0;b<a.length;b++)a[b].ia("locked")||"PageNode"===a[b].type()||this.bf(a[b]);this.xc()};
c.prototype.WF=function(a,b){var c=this.aa.Ob(a,!1);c?c.Zf()&&(c.Fw()?(c!==this.ya&&this.fh(c),this.log("Select edit handle %s",b),this.jf=b,this.ra.ua("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable.")):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.VF=function(a){a=this.aa.vn(a,"overlap"===this.fa.get("selectMode"));for(var b=0;b<a.length;b++)this.bf(a[b])};c.prototype.xc=function(){this.xh();this.ra.pe("selected-nodes");this.ka()};
c.prototype.Cs=function(){for(var a=0,b=this.Hn;a<b.length;a++){var c=b[a];""!==c.Sh&&this.Nn.release(c.Sh)}this.Hn.length=0};c.prototype.je=function(a,b,c,e,f,h,k,l){this.Hn.push({type:h,position:new J(a,b),offset:new J(c,e),Sh:f,Yu:k,Hy:l});""!==f&&this.Nn.add(f,f)};c.prototype.xh=function(){var a;this.xj=this.Al=this.Mo=!0;var b=!1,c=!1,e=!1;this.ni.length=0;if(0!==this.selection.length){var f=!0;for(a=0;a<this.selection.length;a++){var h=this.selection[a];if("GroupNode"!==h.type()){f?(this.Xe=
h.rect.clone(),f=!1):this.Xe.Oj(h.rect);if(h.ia("lockSize")||5===(h.jb&5))this.Mo=!1;h.ia("lockRotation")&&(this.Al=!1);h.ia("lockAspectRatio")&&(b=!0);h.ia("lockAspectRatioY")&&(e=!0);h.ia("lockAspectRatioX")&&(c=!0);h.ia("lockPosition")&&(this.xj=!1)}}this.Ts=1===this.selection.length?this.selection[0].jn():new zc(this.Xe);if(this.Nw()){1<this.selection.length?(f=new L,a=null,h=this.Xe):(a=this.selection[0],h=a.xa,f=a.Pa());var k=!1;a&&a.Zf()&&a.bt()&&(this.fh(a),k=!0);for(var l=this.ra.Vi(),n=
0,r=this.Hn;n<r.length;n++){var u=r[n];if(u.Hy&&!u.Hy(l))return;if("scale"===u.type){if(!this.fa.get("allowResize")||!this.Mo)continue;if("scale"===u.type&&(0!==u.position.x&&1!==u.position.x||0!==u.position.y&&1!==u.position.y)&&b)continue;if("scale"===u.type&&0<u.position.x&&1>u.position.x&&e)continue;if("scale"===u.type&&0<u.position.y&&1>u.position.y&&c)continue;if(k)continue}else if("rotate"===u.type&&(!this.Al||k))continue;this.ni.push(Vf(u,h,f))}if(this.Al&&a&&a.ia("rotationHandles"))for(b=
a.ia("rotationHandles"),a=0;a<b.length;a+=4)c=new J(b[a+2],b[a+3]),this.ni.push(new Rf(Lf,f,h,c))}}};c.prototype.QA=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.aa.yd(this.selection[b].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=a);this.ya&&!this.aa.yd(this.ya.id)&&(this.ya=null,null!==this.jf&&this.ra.ua("selected-edit-handle",null,null),this.jf=null)};c.prototype.Jx=function(a,b,c){return this.selection.length&&this.Ts.Xc(a,
b,c)};c.prototype.ow=function(){return 0!==this.selection.length||null!==this.ya};c.prototype.mc=function(){var a=this.selection.concat();this.ya&&!this.Th(this.ya)&&a.push(this.ya);return a};c.prototype.yD=function(a){if(0===a.length)return new J(0,0);for(var b=a[0].rect.clone(),c=1;c<a.length;c++)b.Oj(a[c].rect);return b.me()};c.prototype.dw=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.En=function(){var a=this.uc.clone();this.fa.get("showRuler")&&(a.x+=20,a.y+=
20);return(new L).multiply(new lc(1/this.scale,1/this.scale)).multiply(new jc(-this.Bb,-this.Cb)).multiply(new jc(-a.x,-a.y))};c.prototype.Xd=function(a){var b=this.mc();a||(b=this.aa.Im(b));return this.dw(b)};c.prototype.Yq=function(a){for(var b=null,c=0;c<a.length;c++){var e=this.aa.Ob(a[c]);e&&0==(e.jb&2)&&(null===b?b=e.rect.clone():b.Oj(e.rect))}null===b&&(b=new K(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.aa.format(this.ma,this.request,!1)||a)this.xh(),this.ka(b)};
c.prototype.Ch=function(){var a=this,b=this.fa.get("background");this.Am=this.aa.Oe();b=this.Am.ia("background")||b;this.background.dG(b);this.$p=b;this.zm={};var c=[];this.aa.Oc(function(b){"background"===b.Gc()&&a.aa.Vn("background")&&(c.push(b),a.zm[b.id]=!0,b.gh(!0))});this.background.aG(c)};c.prototype.Rf=function(a,b,c,e,f,h,k,l,n){this.Am!==this.aa.Oe()&&this.Ch();k*=b;var d=this.background.ED(a,new K(c,e,f,h),k);a.save();a.scale(1/k,1/k);a.translate(-l*b,-n*b);a.fillStyle=d;a.fillRect(0,0,
f*k,h*k);a.restore();a.$t=function(c){a.scale(1/k,1/k);a.translate(-l*b,-n*b);c?(a.fillStyle=d,a.fill()):(a.strokeStyle=d,a.lineWidth*=k,a.stroke())};a.Zt=d};c.prototype.QB=function(a,b){var c=this.aa.wr();a.beginPath();a.fillStyle=q.Od;this.fa.get("pageShadow")&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,1.0)");a.rect(c.x,c.y,c.width,c.height);a.fill();a.lineWidth=1;a.shadowColor=q.he;a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.fa.get("pageBorderColour");
a.stroke();var e=this.$b().clone();e.Dw(c);this.Rf(a,b,e.x,e.y,e.width,e.height,this.scale,-e.x*this.scale,-e.y*this.scale)};c.prototype.Dl=function(a){a?this.log("Setting a custom background function."):this.log("Clearing custom background function.");this.background.Dl(a);this.Ch()};c.prototype.PB=function(a){if(this.Ta.Wb){var b=this.Ta.x,c=this.Ta.y,e=this.TC();a.save();a.setTransform(e,0,0,e,0,0);a.beginPath();this.Ta.eq?(a.moveTo(b-3,c-10),a.lineTo(b+3,c-10),a.moveTo(b-3,c+10),a.lineTo(b+3,
c+10),a.moveTo(b,c-10),a.lineTo(b,c+10)):(a.moveTo(b,c-3),a.lineTo(b,c-15),a.moveTo(b,c+3),a.lineTo(b,c+15),a.moveTo(b-3,c),a.lineTo(b-15,c),a.moveTo(b+3,c),a.lineTo(b+15,c));this.Ta.Dc&&this.ma.arc(b,c,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle=q.Oa;a.stroke();a.restore()}};c.prototype.PA=function(){var a=B(this.canvas.first).wb();if(a.left!==this.uc.x||a.top!==this.uc.y)this.log("Canvas was repositioned!"),this.uc.x=a.left,this.uc.y=a.top};c.prototype.Te=function(a,b){this.canvas.hh(a,b);a=this.fa.get("showRuler")?
20:0;b=B(this.canvas.first).wb();10===this.code&&.75<this.by&&(b.left-=100,b.top-=80);var c=B(this.canvas.first.parentElement).wb(),e=this.canvas.width,f=this.canvas.height,h=b.left-c.left;c=b.top-c.top;this.od.moveTo(h+e-20,c+a);this.od.hh(20,f-20);this.bd.moveTo(h+a,c+f-20);this.bd.hh(e-20,20);this.uc=new K(b.left,b.top,b.width,b.height);a=this.canvas.dr();a!==this.Me&&(this.Me=a,this.log("Detected DPR change to %s",this.Me),this.ta.Te&&this.ta.Te());this.fa.get("zoomOnResize")?(1>this.scale&&this.Ae(1),
a=this.Og(),b=this.$b(),e=!1,a.x<b.x&&(b.width+=b.x-a.x,b.x=a.x,e=!0),a.y<b.y&&(b.height+=b.y-a.y,b.y=a.y,e=!0),a.x+a.width>b.x+b.width&&(b.width+=a.x+a.width-b.x-b.width,e=!0),a.y+a.height>b.y+b.height&&(b.height+=a.y+a.height-b.y-b.height,e=!0),e&&this.Gd(b)):this.Rj&&!this.Lw()&&((new Date).getTime()<this.Rj.jC&&(this.log("Setting viewport rect again to compensate for quick resize."),this.Gd(this.Rj.rect)),this.Rj=null);this.uj();this.ka(void 0,!1)};c.prototype.Lw=function(a){void 0===a&&(a=this.Ce);
return"page"===a||"width"===a};c.prototype.uj=function(){if(!this.Rr()){var a=this.Og(),b=this.Ne(!0);b=new K(0,0,b.width,b.height);a.xd(this.hs)&&b.xd(this.gs)||!this.Ae(this.Ce)||(this.hs=a,this.gs=b)}};c.prototype.Zu=function(a){if(this.ih&&this.fa.get("clipToPage")){var b=this.aa.wr();a.save();a.beginPath();a.rect(b.x,b.y,b.width,b.height);a.clip();return!0}return!1};c.prototype.ka=function(a,b){var c=this;void 0===b&&(b=!0);this.Rr()||this.canvas.gd(0,"main",function(b,d){b.globalAlpha=1;c.vv(b,
d,a)},b)};c.prototype.vv=function(a,b,c){if(!this.ra.Mi){var d=this.$b();this.ih&&(a.fillStyle=this.fa.get("outsidePageColour"),a.fillRect(0,0,this.canvas.width,this.canvas.height));a.translate(this.Bb,this.Cb);a.scale(this.scale,this.scale);this.fa.get("showRuler")&&a.translate(20/this.scale,20/this.scale);var f=new jc(this.Bb,this.Cb);f=f.multiply(new lc(this.scale,this.scale));a.Tj=f;a.XI=this.scale;this.ih?this.QB(a,b):this.Rf(a,b,d.x,d.y,d.width,d.height,this.scale,this.Bb,this.Cb);this.aa.TG();
f=this.Zu(a);this.aa.ka(a,d,this.Op);this.ra.gf&&(a.save(),this.ra.gf(a),a.restore());f&&a.restore();0<this.selection.length&&this.Nw()&&(a.save(),this.TB(a),a.restore());this.ya&&!this.ya.hidden()&&this.ya.sk(a,1/this.scale,this.jf);""!==this.bj&&this.fa.get("showHints")&&(a.save(),d=new Re(this.fa.get("hintFont")),d.fontSize/=this.scale,a.font=d.toString(),a.fillStyle=q.Oa,a.textBaseline="top",a.fillText(this.bj,-this.Bb/this.scale,-this.Cb/this.scale),a.restore());this.PB(a);this.ra.Xb&&this.ra.Xb.pl(a);
this.ta.pl&&this.ta.pl(a);c&&c(a);this.ra.Nb("draw",a);this.fa.get("showRuler")&&(a.setTransform(b,0,0,b,0,0),b=this.fa.get("rulerColour"),c=this.fa.get("rulerBackgroundColour"),d=this.fa.get("pixelsPerUnit")*this.scale,f=this.fa.get("units"),a.fillStyle=c,a.fillRect(0,0,20,20),Ie(a,new K(20,0,this.canvas.width-20,20),0,f,d,-this.Bb,c,b),Ie(a,new K(0,20,20,this.canvas.height-20),2,f,d,-this.Cb,c,b));a.setTransform(1,0,0,1,0,0);a.globalAlpha=1}};c.prototype.qj=function(a,b){var c=this;this.fa.get("fastDraw")?
this.canvas.gd(1,a,function(a){a.translate(c.Bb,c.Cb);a.scale(c.scale,c.scale);c.fa.get("showRuler")&&a.translate(20/c.scale,20/c.scale);b(a)}):this.ka(b)};c.prototype.Hm=function(a){this.fa.get("fastDraw")?this.canvas.gd(1,a,function(){}):this.ka()};c.prototype.TB=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0,c=null,e=0;e<this.selection.length;e++){var f=this.selection[e];var h=f.Pa();if(!f.hidden()&&(b++,f!==this.ya&&!Tc(f)&&0==(f.jb&2))){var k=f.xa;if(this.ra.xq){f=
{rect:new gf(k.x,k.y,k.width,k.height),scale:this.scale,ctx:a,matrix:hf(h),node:f.id,points:[kf(h.apply(k.x,k.y)),kf(h.apply(k.x+k.width,k.y)),kf(h.apply(k.x+k.width,k.y+k.height)),kf(h.apply(k.x,k.y+k.height))]};a.save();try{this.ra.xq(f)}catch(l){console.warn("Exception when drawing selection rectangle:",l)}a.restore();k=k.clone();k.transform(h)}else f=new vc(k),f.transform(h),h=h.ub(!1),1E4>2*(k.width+k.height)*(h.x+h.y)/2/3*this.scale?f.Vm(a,[3/this.scale,3/this.scale]):f.ka(a),k=f.cq(5);b++;
c?c.Oj(k):c=k}}if(0!==b)for(a.stroke(),b=c?Math.min(c.width,c.height):0,e=0;e<this.ni.length;e++)this.ni[e].ka(a,this.Nn,this.scale,this.Ss,b)};c.prototype.fh=function(a){this.ya=a};c.prototype.gr=function(){return this.ya};c.prototype.fp=function(a){this.Ss=a};c.prototype.Th=function(a){return a.hd===this.hd};c.prototype.Hc=function(a){var b=10;a&&(b=this.fa.get("touchRadius")||12);return b/this.scale};c.prototype.lr=function(a,b,c){c=this.Hc(c);for(var d=null,f=0;f<this.ni.length;f++){var h=this.ni[f];
if(h.Db(this.Nn,a,b,c,this.scale)){d=h;break}}return d};c.prototype.nd=function(){this.Yy(!1)};c.prototype.We=function(){this.Yy(!0)};c.prototype.Yy=function(a){if(a?this.aa.Kf():this.aa.Lf())a?this.aa.We():this.aa.nd(),a=this.aa.Vh,this.log("Most recent change page=%s",a),a!==this.aa.bb?(this.log("Undo/redo switched page %s->%s",this.aa.bb,a),this.jd(a)):this.ka(),this.Wh(!1)};c.prototype.ro=function(a,b,c,e,f){var d=this;if(b.length&&!a&&!this.fa.get("readOnly")){for(var k=[],l=0;l<b.length;l++){var n=
this.aa.Ob(b[l],!1);n&&k.push(n)}this.fa.get("autoPickTool")&&this.selectNodes(k)}else if(this.selection.length||this.ya){k=0;this.hd+=1;n=this.aa.bb;for(l=0;l<this.selection.length;l++)l!==k&&(this.selection[k]=this.selection[l]),this.aa.yd(this.selection[k].id)&&this.aa.mf(this.selection[k].id)===n||this.aa.hE(this.selection[k])?(this.selection[k].hd=this.hd,k++):this.log("Node no longer exists; removing from selection %s",this.selection[k]);this.selection.length!==k&&(this.selection.length=k);
this.ya&&!this.aa.yd(this.ya.id)&&(this.log("EditNode %s no longer exists",this.ya.id),this.ya=null,null!==this.jf&&this.ra.ua("selected-edit-handle",null,null),this.jf=null);0!==this.selection.length||this.ya||this.pb();this.xc()}this.aa.format(this.ma,this.request,!1);this.QA();this.xh();this.uj();this.Qd();this.ka();this.kh.clear();this.aa.Oc(function(a){5===(a.jb&5)&&d.Ub.has(a.Gc())&&d.kh.zu(a.rect,a.id)});this.RD({um:b,Io:c,ip:e,ba:f},a);this.Wh(a)};c.prototype.yq=function(){this.Ah(!1,this.Xd(!0));
this.Sm()};c.prototype.Ah=function(a,b){this.ra.Nb("start-transform",{transformType:"copy",nodes:b});b=this.aa.vr(b,!1);var c=this.aa.SF(b);0<b.length&&(!0!==a&&Bg.setItem("clipboard",c),this.log("Reset paste offset to 0"),this.Sl=this.Rl=0);return c};c.prototype.duplicate=function(){function a(a,b){var c=Math.sign(a);a=Math.abs(a);return c*Math.max(b,Math.round(a/b)*b)}var b=this,c=this.Xd(!1);this.ra.Nb("start-transform",{transformType:"copy",nodes:c});var e=this.fa.get("pasteOffset"),f=e||this.fa.get("pasteOffsetX"),
h=e||this.fa.get("pasteOffsetY");if(e=this.fa.get("snap"))f=a(f,e),h=a(h,e);var k=[];this.aa.transaction(function(){k=b.aa.duplicate(c,new jc(f,h))});return k};c.prototype.sl=function(a){var b=this,c=[];if(!a){var e=Bg.getItem("clipboard");if(e)a=e;else return c}var f=this.fa.get("pasteOffset");e=f||this.fa.get("pasteOffsetX");f=f||this.fa.get("pasteOffsetY");this.Rl+=e;this.Sl+=f;this.log("Using paste offset %s,%s",this.Rl,this.Sl);var h=new jc(this.Rl,this.Sl);this.aa.transaction(function(){c=b.aa.Yw(a,
h,b.Ud)});return c};c.prototype.Fl=function(a){""!==a?(this.bj=this.language.get(a),this.ra.ua("hint",this.bj)):(this.bj="",this.ra.ua("hint",""))};c.prototype.Hb=function(){return this.Xa(new Og(this))};c.prototype.mB=function(){return requestAnimationFrame.name.substr(0,2)+"d"};c.prototype.Xa=function(a){this.ta&&this.ta.Qc&&this.ta.Qc();this.ta=a;a.Vd&&a.Vd();if(a.ad){var b=a.ad();b!==this.Xk&&(this.Xk=b,this.ra.ua("tool-changed",b))}10===this.code&&.25>this.by&&this.de("fillStyle",this.mB());
return a};c.prototype.Kh=function(){var a=null;this.ta.ad&&(a=this.ta.ad());return a};c.prototype.ot=function(a,b){void 0===b&&(b=this.fa.get("autoPickToolText"));a=new $f(this,a,b);this.Xa(a);return a};c.prototype.Xm=function(a){var b=this.aa.Ob(a,!1);b?b.Rg()?(a=this.ot({}))&&a.ht(b,b.rect.x,b.rect.y,null):this.log("editNodeText: node %s (%s) cannot contain text.",a,b.type()):this.log("editNodeText: ExtNodeID %s does not exist.",a)};c.prototype.ti=function(a){var b="";this.ta instanceof $f&&(b=
this.ta.bH(a));return b};c.prototype.Vw=function(a,b,c,e,f){this.Xa(new Kg(this,"line",a,b,c,e,f))};c.prototype.Cq=function(a){a.lineWidth=a.lineWidth||this.Li;a.strokeStyle=a.strokeStyle||this.Yc;this.Xa(new Mg(this,a,"brush"))};c.prototype.UB=function(a){a.lineWidth=a.lineWidth||this.Li;a.strokeStyle=a.strokeStyle||this.Yc;this.Xa(new Mg(this,a,"shapebrush"))};c.prototype.tv=function(a,b){a.lineWidth=a.lineWidth||this.Li;a.strokeStyle=a.strokeStyle||this.Yc;this.Xa(new Mg(this,a,b))};c.prototype.hv=
function(a){this.Xa(new Kg(this,"curve",a,!1,!1,!1,this.fa.get("autoPickTool")))};c.prototype.tA=function(a,b,c,e,f){this.Xa(new Kg(this,"arrow",a,b,c,e,f))};c.prototype.Og=function(){var a=this.fa.get("pageInflation");if(this.ih){a=this.aa.wr();var b=this.fa.get("pageInflation");a.dd(b,b)}else a=this.nf(this.aa.bb,a);return a};c.prototype.nf=function(a,b){void 0===a&&(a=this.aa.bb);void 0===b&&(b=0);var c=new fc(0,0);this.fa.get("pageView")&&(c=wh);c=this.aa.Pc(a,c);0===c.width&&0===c.height&&(c=
this.$b(),c.x=0,c.y=0,c.width*=this.scale,c.height*=this.scale,a=this.aa.Xq(a),this.aa.cE(a)||a.dd(b),c.Oj(a));return c};c.prototype.UD=function(){return this.fa.get("pageView")||this.aa.pw()};c.prototype.wt=function(){var a=this.uc.clone(),b=this.Ne(!1);this.fa.get("showRuler")&&(b.x+=20,b.y+=20);a.x+=b.x;a.y+=b.y;var c=B(this.Wd).wb(),e=a.x-c.left;a=a.y-c.top;this.aa.cd.style.transform="translate("+(this.Bb+b.x)+"px, "+(this.Cb+b.y)+"px) scale("+this.scale+")";this.Ml.style.transform="translate("+
(this.Bb+e)+"px, "+(this.Cb+a)+"px) scale("+this.scale+")";this.aa.pG(this.scale)};c.prototype.Qd=function(){if(!this.Rr()){this.wt();this.ra.ua("scroll");var a=this.$b();if(this.fa.get("scrollbars")&&this.fa.get("allowScroll")){var b=this.Ne(!1),c=this.Og(),e=!1,f=!1;Of(a.y,c.y)&&Pf(a.bottom(),c.bottom())?this.od.ag():(this.od.show(),this.od.By(Math.min(a.y,c.y),Math.max(a.bottom(),c.bottom()),a.height,-this.Cb/this.scale),e=!0);Of(a.x,c.x)&&Pf(a.right(),c.right())?this.bd.ag():(this.bd.show(),this.bd.By(Math.min(a.x,
c.x),Math.max(a.right(),c.right()),a.width,-this.Bb/this.scale),f=!0);f&&e?(this.od.hh(20,b.height-20),this.bd.hh(b.width-20,20)):e?this.od.hh(20,b.height):f&&this.bd.hh(b.width,20);this.Wd.classList.toggle("zwibbler-horizontal-scroll",f);this.Wd.classList.toggle("zwibbler-vertical-scroll",e);this.aa.Qs(a)}else this.od.ag(),this.bd.ag()}};c.prototype.zj=function(a,b,c){this.log("Set document size %s,%s",a,b);this.aa.lb();this.aa.setProperty("width",a);this.aa.setProperty("height",b);this.aa.Ea(c);
this.Qd();this.uj();this.Wh(!1)};c.prototype.ko=function(a,b,c){var d=this;if(this.xj)if(this.Ta.Wb)this.log("Not nudging; keyboard cursor shown.");else{a*=c/this.scale;b*=c/this.scale;this.log("Nudge selection by %s, %s",a,b);var f=this.Xd(!0),h=new jc(a,b);this.aa.transaction(function(){d.aa.nh(f,h)});return 0<f.length}else this.log("Can't nudge; selection motion is locked.")};c.prototype.Bn=function(a,b){var c={};b.spotHighlight||(this.fa.get("allowTextInShape")&&(c.fontSize=this.fa.get("defaultFontSize"),
c.fontName=this.fa.get("defaultFont"),c.textFillStyle=this.sa.textFillStyle,c.wrap=this.fa.get("multilineText")),c.fillStyle=this.sa.fillStyle,c.strokeStyle=this.sa.strokeStyle,c.seed=Math.round(65535*Math.random()),c.lineWidth=this.Tp(this.sa.lineWidth),c.roughness=this.sa.roughness,c.sloppiness=this.sa.sloppiness,c.dashes=this.sa.dashes||"");return dd(a,this.xu(c),b)};c.prototype.Ul=function(a,b){var c=new P;var e=new J(-50,-50);var f=new J(50,-50);var h=new J(50,50);var k=new J(-50,50);c.moveTo(e.x,
e.y);c.lineTo(f.x,f.y);c.lineTo(h.x,h.y);c.lineTo(k.x,k.y);c.lineTo(e.x,e.y);c.close();a=this.Bn({commands:c.Jc()},a);this.log("Create an item on layer %s",this.Ud);this.Xk="";this.Xa(new Pg(this,"PathNode",a,100,100,"rectangle",b))};c.prototype.Ct=function(a,b,c,e,f){var d=0,k=0;"matrix"in e&&(d=e.matrix.m12,k=e.matrix.m21,delete e.matrix);var l=K.Ee(Mc(a,50,b,c,e.matrix));e=this.Bn({sides:a,rotation:b,radius:50,oddRadiusScaling:c,skewX:d,skewY:k},e);this.log("Create an item on layer %s",this.Ud);
this.Xa(new Pg(this,"PathNode",e,l.width,l.height,"polygon",f))};c.prototype.bF=function(){this.Xa(new Rg(this))};c.prototype.kp=function(a,b){a=this.Bn({commands:Be()},a);this.Xk="";this.Xa(new Pg(this,"PathNode",a,100,100,"circle",b))};c.prototype.Dt=function(a,b,c,e,f){"PathNode"===a&&(b=this.Bn({},b));this.Xk="";this.Xa(new Pg(this,a,b,c,e,"shape",f))};c.prototype.IH=function(a,b){"custom"===a.fillMode&&(a=dd({fillStyle:this.sa.fillStyle,strokeStyle:this.sa.strokeStyle,lineWidth:this.sa.lineWidth},
a));this.Xa(new Qg(this,a,b))};c.prototype.Bt=function(a){var b=this.aa.Ob(a,!1);b?b.Zf()?(this.Hb(),this.pb(),this.xc(),this.fh(b),this.ka()):this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()):this.log("useEditHandleTool: node %s doesn't exist.",a)};c.prototype.xu=function(a){"layer"in a||"default"===this.Ud||(a=dd({layer:this.Ud},a));return a};c.prototype.ho=function(a,b,c){var d=this;return new Promise(function(e){function f(b){b=b instanceof HTMLImageElement?new fc(b.naturalWidth,
b.naturalHeight):new fc(b.width,b.height);b.Gv(a.width,a.height);return b}function k(f,h){var k=d.$b(),l=k.me();"number"===typeof b&&"number"===typeof c&&(l=new J(b,c));var n=Math.min(1,k.width/h.width);n=Math.min(n,k.height/h.height);l.x-=h.width*n/2;l.y-=h.height*n/2;var r=(new lc(n,n)).multiply(new jc(l.x,l.y));d.aa.transaction(function(){var b=d.aa.createNode(f,dd(d.xu({matrix:r,allowCrop:d.fa.get("allowCrop")}),a));e(b)});d.Hb()}var l=a.url;if(fd(l)){var n=new af;"custom"===a.fillMode&&(a.fillStyle=
a.fillStyle||d.sa.fillStyle,a.srokeStyle=a.strokeStyle||d.sa.strokeStyle,a.lineWidth=a.lineWidth||d.sa.lineWidth);n.ql(l).then(function(){k("SvgNode",f(n.rect))})}else ob.load(l,function(a){a&&k("ImageNode",f(a))})})};c.prototype.ue=function(){return B.Yv()};c.prototype.VE=function(a,b){this.ta.Wg?(this.log("Simulating opacity change %s",a),this.ta.Wg(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.jd=function(a){this.aa.jd(a)&&(this.pb(),this.xc(),this.uj(),this.ka(),this.ra.pe("set-page",
a))};c.prototype.Zs=function(a){this.ih=a;a=this.Og();this.Bb=-a.x;this.Cb=-a.y;this.Qd();this.ka()};c.prototype.ky=function(a){var b=this.$b(),c=b.width/a;a=b.height/a;b.x-=(c-b.width)/2;b.y-=(a-b.height)/2;b.width=c;b.height=a;this.Gd(b)};c.prototype.qp=function(){this.ky(this.fa.sj(1.1*this.scale)/this.scale)};c.prototype.rp=function(){this.ky(this.fa.sj(this.scale/1.1)/this.scale)};c.prototype.zk=function(a,b,c){var d=this;c=c||this.yD(a);var f=new mc(b,c.x,c.y);this.aa.transaction(function(){d.aa.nh(d.dw(a),
f)})};c.prototype.Jv=function(a,b){this.ow()||this.log("flipSelection: selection is empty");this.zk(this.mc(),a,b)};c.prototype.TC=function(){var a=this.ma;return(window.devicePixelRatio||1)/(a.UH||a.BE||a.EE||a.KE||a.zA||1)};c.prototype.Ck=function(){return new fc(this.canvas.width,this.canvas.height)};c.prototype.Ne=function(a){var b=this.Ck();b=new K(0,0,b.width,b.height);a&&(a=this.fa.get("viewMargin"),b.x+=a[3],b.y+=a[0],b.width-=a[1]+a[3],b.height-=a[0]+a[2]);return b};c.prototype.$b=function(){var a=
this.Ne(!0);if(0<a.width){var b=this.fa.get("viewMargin");this.Rw=new K((0-this.Bb+b[3])/this.scale,(0-this.Cb+b[0])/this.scale,a.width/this.scale,a.height/this.scale)}return this.Rw.clone()};c.prototype.Gd=function(a,b,c,e){void 0===b&&(b=!1);void 0===c&&(c=!1);void 0===e&&(e="centre"!==this.fa.get("pagePlacement"));this.log("setViewRect(%s)",a);e&&this.UD()&&(a=a.clone(),a.mq(this.Og()));e=this.Ne(!0);var d=Math.min(e.width/a.width,e.height/a.height)||1,h=a.x*d-e.x,k=a.y*d-e.y;this.Bb=b?(e.width-
a.width*d)/2-h:-h;this.Cb=c?(e.height-a.height*d)/2-k:-k;this.Ce=this.scale=d;this.ta.Te&&this.ta.Te();this.Qd();this.ka();this.Rj={jC:(new Date).getTime()+500,rect:a}};c.prototype.wC=function(a){this.request.Rn()?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.ao=function(a){!this.Bi&&a?(this.log("Locking updates."),this.Bi=!0):this.Bi&&!a&&(this.log("Resuming updates"),
this.Bi=!1,this.uj(),this.Qd(),this.ka())};c.prototype.Rr=function(){this.Bi&&this.log("Updates are locked. Ignoring draw/format request");return this.Bi};c.prototype.Wh=function(a){this.ra.pe("document-changed",{remote:a})};c.prototype.sj=function(a){return this.fa.sj(a)};c.prototype.zb=function(a){this.Rd.style.cursor=a;this.Qr=0<=a.indexOf("resize");this.fs++};c.prototype.scrollIntoView=function(a,b){if(this.fa.get("allowScroll")){var c=0,e=0,f=this.Og(),h=this.$b(),k=this.Jg(a,b),l=this.Jg(h.x,
h.y),n=this.Jg(h.right(),h.bottom());l=new K(l.x,l.y,n.x-l.x,n.y-l.y);k.x>l.x-50&&k.x<l.x+100&&(c=-25/this.scale);k.y>l.y-50&&k.y<l.y+100&&(e=-25/this.scale);k.x>l.right()-100&&k.x<l.right()+50&&(c=25/this.scale);k.y>l.bottom()-100&&k.y<l.bottom()+50&&(e=25/this.scale);0<c?(c=Math.max(0,Math.min(c,f.right()-h.right())),c=Math.max(0,c)):0>c&&(c=Math.max(c,Math.min(0,f.x-h.x)));0<e?(e=Math.min(e,f.bottom()-h.bottom()),e=Math.max(0,e)):0>e&&(e=Math.max(e,Math.min(0,f.y-h.y)));if(c||e)h.x+=c,h.y+=e,this.log("ScrollIntoView: offset %s,%s pt=%s,%s doc=%s view=%s",
c,e,a,b,f,h),this.Gd(h)}};c.prototype.Df=function(a){a?(this.kz.classList.add("dragging"),this.Wd.classList.add("zwibbler-dragging")):(this.kz.classList.remove("dragging"),this.Wd.classList.remove("zwibbler-dragging"))};c.prototype.$F=function(a){a!==this.Op&&(this.Op=a,this.ka())};c.prototype.jz=function(a,b,c){var d=this.fa.sj(this.scale/a);d!==this.scale/a&&(a=this.scale/d);a=new lc(a,a,b,c);b=this.$b();b.transform(a);this.Gd(b)};c.prototype.qq=function(a,b,c,e){b.$type="HTMLNode";b.$component=
a;a=this.aa.Zw(this.aa.Gk(),b);N(a)?(a.format(this.ma,this.request),this.Xa(new mh(this,{pageX:c,pageY:e,Jb:c,Kb:e},a,1))):this.log("Error: createHTMLNodeFromDrag: Node is not drawable.")};return c}();function yh(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||location.hostname===rh("        \u001d98$").toLowerCase()?1:0}
function zh(c,a){if(!(yh()||.04<a)){a=rh("2#=21VJ]i->+ .)7\\p5:F2+/.\\c40V").toLowerCase();var b=document.createElement("img");b.src=a+Ra(Sa("zwibbler-lib|1708335655840|"+location.href+"|"+bh+"|"+("0"+c)),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=").replace("=","");b.onload=function(){}}};var Bh=function(){function c(a,b,c,e,f){var d=this;this.Aa=a;this.ra=b;this.wa=c;this.fa=e;this.log=v.create("APP");this.mx=this.qx=this.oo=this.mo=-1;this.Um=[];this.qf=!1;this.Ks=this.xt=null;this.Zh=[];this.Vg=null;for(this.ji=0;null!==c.firstChild;)c.removeChild(c.firstChild);var k={style:null,"class":null},l;for(l in k)k[l]=c.getAttribute(l);this.Aa.add(function(){for(var a in k)null!==k[a]?c.setAttribute(a,k[a]):c.removeAttribute(a)});a=B(this.wa).pf("position");"absolute"!==a&&"fixed"!==a&&
(this.wa.style.position="relative");this.wa.style.overflow="none";this.wa.style.textAlign="left";this.wa.classList.add("zwibbler-main");E.cg('zwibbler,[zwibbler] { position: relative; }\n        .zwibbler-main { font-size: 16px; }\n        .zwibbler-passthrough { cursor: pointer; }\n        .zwibbler-selected {outline: 4px solid rgba(0, 80, 183, 0.2);}\n        .zwibbler-main.dragging .zwibbler-staging iframe,\n        .zwibbler-main.dragging .zwibbler-html-root iframe {\n            pointer-events: none !important;\n        }\n        [contenteditable="TRUE"] {\n            user-select: text !important;\n            -webkit-user-select: text !important;\n        }\n        ');
this.Pm=new kb(B("div").Va({width:"300px"}).ea,this.Aa);this.log("Zwibbler built on "+new Date(1708335655840)+" for 'zwibbler-lib'");this.language=new lb("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.xy(this.fa.get("language"));this.Rd=B("div").ie("zwibbler-canvas-holder").Va({position:"absolute",overflow:"hidden",touchAction:"none",WebkitUserSelect:"none"}).Ag();this.wa.appendChild(this.Rd);this.Aa.addEventListener(this.Rd,"touchend",function(a){a.preventDefault()});this.Aa.addEventListener(this.Rd,"touchcancel",function(a){a.preventDefault()});this.canvas=new fb(this.Rd,100,100);this.fa.pa("debugOutlineColour",function(a){d.canvas.AG(a)});this.log("getTransform supported: %s",
!!this.canvas.get(0).Qg);B(this.canvas.first).ie("zwibbler-main-canvas").Va({outline:"0",position:"absolute",left:"0",top:"0",pointerEvents:"none"});var n=this.Yf();this.$c=new rb;this.Ml=B("DIV").Va({position:"absolute",userSelect:"none",webkitUserSelect:"none",AI:"none",transformOrigin:"left top",left:0,top:0}).ie("zwibbler-staging").ke(n).Ag();this.vj={ctx:b};f&&(this.vj.$parent=f);this.ji=ue.Rv((new Date).getTime())();this.view=new xh(n,this.canvas,this.vj,this.$c,this.fa,this.language,this.ra,
this.Aa,this.Ml,this.Rd,this.ji,this.wa);this.cd=B(this.view.aa.cd).ie("zwibbler-html-root").Va({position:"absolute",left:"0",top:"0",userSelect:"none",msUserSelect:"none",webkitUserSelect:"none",transformOrigin:"left top"}).insertBefore(this.canvas.first).Ag();this.py();this.Bd=this.QG();ab.Iz()&&(this.log("Using resize observer"),this.Vg=new ab(this.wa,function(){return d.ra.resize(!1)}),this.Aa.add(function(){d.Vg&&d.Vg.Sa()}));this.Aa.addEventListener(window,"resize",function(){d.ra.resize(!1)});
window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){d.log("Bootstrap modal shown; resize now");d.ra.resize()}));f=this.canvas.get(0);a=this.canvas.dr();f.clearRect(0,0,this.canvas.width*a,this.canvas.height*a);f.globalAlpha=0;this.view.vv(f,a);null!==this.fa.nb("backgroundImage")&&(this.Vs(this.fa.nb("backgroundImage")),this.view.aa.Ko());this.fa.pa("update",function(a,b){d.kg(a,b)});E.cg(".zwibbler-progress-notification {\n            position: absolute;\n            top: 0;\n            right: 0;\n            box-shadow: 3px 3px 3px #444;\n            background: #ccc;\n            color: black;\n            border-bottom-left-radius: 4px;\n            font-family: arial,sans;\n        }");
this.Px=B("div").ie("zwibbler-progress-notification").ke(this.wa).Ag();b.resize();this.kg("showDebug",this.fa.get("showDebug"));this.view.Wh(!1);this.ra.pe("set-page",this.view.aa.bb);Bg.xm()&&(this.fa.pa("persistent",function(a){if(a&&!d.view.aa.Qf()&&(a=Bg.getItem("zwibbler-document")))try{var b=Ah.yi(a,n,d.vj,d.ra.Pf,d.view.ma,d.view.request);if(b)d.ri(b);else throw Error("Failed to open document.");}catch(w){w instanceof Error&&d.log("Failed to load persistent document: %s",w.message)}}),this.xt=
Ig(1E3,function(){d.fa.get("persistent")&&(d.log("Saving document"),Bg.setItem("zwibbler-document",d.ra.save()))}),this.ra.pa("document-changed",function(){d.xt()}),this.Aa.add(function(){d.xt.cancel()}));var r=setTimeout(function(){r=0;d.view.code=100*yh()+(d.view.xv?1:0);d.log("Spline contours now %s %s",d.view.code,d.ji);d.Wj(!0)},6E4);this.Aa.add(function(){for(r&&clearTimeout(r);d.wa.firstChild;)d.wa.removeChild(d.wa.firstChild);d.Bd.bk();d.$c.bk();B(d.Ml).remove()});this.Aa.addEventListener(this.Yf(),
"dragstart",function(a){if(a.target instanceof HTMLImageElement){var b=a.target.getAttribute("draggable");if(!b||"false"===b.toLowerCase())return a.preventDefault(),!1}});zh(this.view.xv,this.ji)}c.prototype.Sa=function(){this.Aa.Sa()};c.prototype.kg=function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "showDebug":b?(this.Pm.show(),this.Xj(0,"right",this.Pm.wa)):(this.Pm.ag(),this.wl(this.Pm.wa));c=!0;break;case "backgroundImage":this.Vs(b);break;case "language":this.language.xy(b);
break;case "latency":ob.hG(b)}c&&this.Wj(!0)};c.prototype.py=function(){this.fa.nb("sloppy")||this.view.Cf("sloppiness",0);this.view.Cf("smoothness",this.fa.RC());this.view.Cf("fillStyle",this.fa.nb("defaultFillStyle"));this.view.Cf("strokeStyle",this.fa.nb("defaultStrokeStyle"));this.view.Cf("fontName",this.fa.nb("defaultFont"));this.view.Cf("fontSize",this.fa.nb("defaultFontSize"));this.view.Cf("lineWidth",this.fa.nb("defaultLineWidth"));this.view.Cf("textFillStyle",this.fa.nb("defaultTextFillStyle"))};
c.prototype.ri=function(a){this.Rd.insertBefore(a.cd,this.cd);B(this.cd).remove();this.cd=a.cd;B(this.cd).Va({position:"absolute",left:0,top:0,userSelect:"none",webkitUserSelect:"none",transformOrigin:"left top"}).ie("zwibbler-html-root");this.view.ri(a);this.py();this.ra&&(this.view.Wh(!1),this.ra.pe("set-page",a.bb));for(a=0;a<this.Um.length;a++){var b=this.Um[a];this.log("Removing old DomElement of type %s",b.tagName);B(b).remove()}this.Um=[]};c.prototype.iq=function(){this.view.aa.Ko()};c.prototype.QG=
function(){var a=this,b=this;this.qf=!1;var c=new sb;this.fa.uA(c);c.pa("*",function(b,c){a.qf?(a.log("have focus, process %s",b),a.view.Dd(b,c)):a.log("Ignore key action -- don't have focus. (%s)",a.qf)});c.Lu(document.body);this.Aa.add(function(){a.Bd.detach(document.body)});this.$c.pa("goto-toolbar",function(){a.Ks&&a.Ks.focus();a.view.tw()});this.$c.pa("goto-canvas",function(){b.focus()});this.Aa.addEventListener(this.wa,"blur",function(){a.blur()});var e=!1;this.fa.pa("allowSystemClipboard",
function(){if(a.fa.Nr()&&!e){e=!0;var b=function(b){a.log("Received "+b.type);a.qf?a.view.nl(b):a.log("Ignore "+b.type+" -- don't have keyboard focus.")};a.Aa.addEventListener(document,"cut",b);a.Aa.addEventListener(document,"copy",b);a.Aa.addEventListener(document,"paste",b)}});this.Aa.addEventListener(document.body,"focus",function(){document.activeElement===a.Rd||document.activeElement===document.body||document.activeElement instanceof HTMLButtonElement&&(a.ra.Fc().contains(document.activeElement)||
document.activeElement.matches("[z-popup] *"))||(a.log("Someone else has focus. blur."),a.blur())},!0);this.fa.get("setFocus")&&this.focus();return c};c.prototype.EG=function(a){this.Ks=a};c.prototype.focus=function(){if(!this.qf){this.qf=!0;this.wa.classList.add("focus");this.ra.ua("focus");this.log("Set Fake Focus to canvas, %s",this.qf);for(var a=0,b=E.dj;a<b.length;a++){var c=b[a];c!==this.ra&&c.blur()}}document.activeElement instanceof HTMLElement&&document.activeElement!==this.Rd&&(this.log("Blurring active element"),
document.activeElement.blur())};c.prototype.blur=function(){"text"!==this.view.Kh()&&(this.log("Blur event received -- hide keyboard cursor"),this.view.tw());this.qf&&this.ra.ua("blur");this.qf=!1;this.wa.classList.remove("focus")};c.prototype.ct=function(a){void 0===a&&(a=!1);this.focus();this.view.ct(a)};c.prototype.hasFocus=function(){return this.qf};c.prototype.createNode=function(a,b,c,e){"layer"in b||(b.layer=this.view.Ud);c||(c=this.view.aa.ln());this.view.aa.lb();a=this.view.aa.createNode(a,
b,c,e);this.view.aa.Ea();return a};c.prototype.transformNode=function(a,b){var c=this;this.view.aa.transaction(function(){c.view.aa.nh(a,b)});return!0};c.prototype.Ys=function(a,b,c,e,f,h,k){var d=this,n=new L(b,e,c,f,h,k);this.view.aa.transaction(function(){d.view.aa.ce(a,"matrix",n)});return!0};c.prototype.Lj=function(a,b,c){var d=this,f=new jc(b,c);this.view.aa.transaction(function(){d.view.aa.nh(a,f)})};c.prototype.Ns=function(a,b,c,e,f){var d=this,k=new lc(b,c,e,f);this.view.aa.transaction(function(){d.view.aa.nh(a,
k)});return!0};c.prototype.Vs=function(a){var b=this;this.view.aa.lb();this.view.aa.Oc(function(a){"background"===a.Gc()&&b.view.aa.wc([a.id])});a&&(a=this.view.aa.createNode("ImageNode",{url:a,locked:!0,tag:"background",layer:"background"}),this.view.aa.Sd([a],1));this.view.aa.Ea(!0);this.view.pb();this.view.xc()};c.prototype.HC=function(){var a=null;this.view.aa.Oc(function(b){if("background"===b.Gc()&&"ImageNode"===b.type())return a=b.ia("url"),!1});return a};c.prototype.bs=function(){this.ri(new vh(!1,
this.Yf(),this.vj,this.ra.Pf,this.view.ma,this.view.request));null!==this.fa.nb("backgroundImage")&&(this.Vs(this.fa.nb("backgroundImage")),this.view.aa.Ko())};c.prototype.Wj=function(a){void 0===a&&(a=!1);var b=B(this.wa).wb();if(a||b.width!==this.qx||b.height!==this.mx||b.left!==this.mo||b.top!==this.oo){this.mo=b.left;this.oo=b.top;this.qx=b.width;this.mx=b.height;for(var c=a=0,e=0,f=0,h=0,k=this.Zh;h<k.length;h++){var l=k[h];switch(l.position){case "left":case "right":l.wa.style.top=e+"px";l.wa.style.bottom=
f+"px";break;case "top":case "bottom":l.wa.style.left=a+"px",l.wa.style.right=c+"px"}switch(l.position){case "left":l.wa.style.left=a+"px";a+=l.wa.offsetWidth;break;case "right":l.wa.style.right=c+"px";c+=l.wa.offsetWidth;break;case "top":l.wa.style.top=e+"px";e+=l.wa.offsetHeight;break;case "bottom":l.wa.style.bottom=f+"px",f+=l.wa.offsetHeight}}B(this.Rd).Va({left:a+"px",right:c+"px",top:e+"px",bottom:f+"px"});B(this.Px).Va({top:"0",right:c+"px"});this.view.Te(b.width-c-a,b.height-f-e);this.ra.ua("resize")}else this.log("Ignoring resize; div size did not change.")};
c.prototype.Ep=function(a,b,c){void 0===c&&(c=this.view.aa.bb);var d=this.view.aa.bb;this.view.aa.jd(c);a.translate(-b.x,-b.y);this.view.Rf(a,1,b.x,b.y,b.width,b.height,1,-b.x,-b.y);this.view.aa.ka(a);this.ra.gf&&this.ra.gf(a);this.view.aa.jd(d)};c.prototype.QF=function(a,b,c,e,f){0==c&&(c=b.width);var d=c/b.width,k=1;10===this.view.code&&.25>this.ji&&(k*=.1);if("image/svg+xml"===a||"application/pdf"===a){var l=!1;"image/svg+xml"===a?c=new Hg(new K(0,0,b.width,b.height)):(b=this.ra.Ri(e[0]||0),b=
new K(b.x,b.y,b.width,b.height),c=new Eg(new K(0,0,b.width,b.height),E.fonts),l=!0);c.scale(k,k);if(l)for(k=0;k<e.length;k++)l=e[k],0<k&&(b=this.view.aa.Pc(l,wh),c.Gj(b)),this.Ep(c,b,l);else e.length&&this.Ep(c,b,e[0]);switch(f){case "data-uri":return"data:"+a+";base64,"+Ra(c.Ty());case "string":return c.toString();case "blob":return c.toBlob();default:throw Error("Unsupported encoding specified: "+f);}}else{l=document.createElement("canvas");l.setAttribute("width",Math.ceil(b.width*d).toString());
l.setAttribute("height",Math.ceil(b.height*d).toString());c=l.getContext("2d");c.scale(d*k,d*k);if("image/jpeg"===a||"image/bmp"===a)c.fillStyle=q.Od,c.fillRect(0,0,b.width,b.height);e.length&&this.Ep(c,b,e[0]);return gd(l,a,f)}};c.prototype.ce=function(a,b,c){var d={};d[b]=c;this.Ab(a,d);return!0};c.prototype.Ab=function(a,b){var c=this;this.log("External app setNodeProperties %s: %s",a,JSON.stringify(b).substr(0,32));this.view.aa.transaction(function(){for(var d=c.view.aa.vr(a,!0),f=[],h=0;h<d.length;h++)f.push(d[h].id);
a=f;c.view.aa.Ab(a,b)});return!0};c.prototype.sq=function(a){var b,c;if(6>a.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var e=new P;var f=b=0;for(c=a.length-1;b<=c;f=b+=2){var h=this.view.Ib(new J(a[f],a[f+1]),0);if(0===f){e.moveTo(h.x,h.y);var k=h}else e.lineTo(h.x,h.y)}k&&(e.lineTo(k.x,k.y),e.close());return this.Mm(e.Jc())}};c.prototype.Mm=function(a){return this.createNode("PathNode",{commands:a,fillStyle:this.view.Td,strokeStyle:this.view.Ke,seed:Math.round(65535*
Math.random()),lineWidth:this.view.sa.lineWidth,sloppiness:this.view.sa.sloppiness,angleArcs:this.fa.get("angleArcs")})};c.prototype.uB=function(a){return new eb(this.Px,a)};c.prototype.Xj=function(a,b,c){for(var d=0,f=this.Zh;d<f.length;d++)if(f[d].wa===c)return;this.wa.appendChild(c);this.Zh.push({order:a,wa:c,position:b});c.style.position="absolute";this.Zh.sort(function(a,b){return a.order<b.order?-1:1});this.Wj(!0)};c.prototype.wl=function(a){for(var b=0;b<this.Zh.length;b++)if(this.Zh[b].wa===
a){this.Zh.splice(b,1);this.wa.removeChild(a);break}this.Wj(!0)};c.prototype.Yf=function(){for(var a=this.wa,b=a;b;){if(b instanceof HTMLElement&&(null!==b.getAttribute("zwibbler")||"ZWIBBLER"===b.tagName)){a=b;break}b=b.parentElement}return a};c.prototype.Rp=function(a,b){this.Bd.map(a,function(a){B.dg(a.target,a)||b(a)})};return c}();var R=function(){function c(a){this.node=a;this.request=null}c.prototype.nG=function(a){this.request=a};c.prototype.yn=function(){if(!this.request)throw Error("Cannot call this method before format() is called.");return this.request};c.prototype.xC=function(a,b,c){F.ha("formatFill",arguments,Ch,F.String,F.String);this.node.Lv(b,a,this.yn(),c)};c.prototype.ZC=function(a){F.ha("getFill",arguments,F.String);return this.node.hr(a)};c.prototype.bh=function(){this.yn().Bf(this.node.id)};c.prototype.eg=
function(a,b){F.ha("loadImage",arguments,F.String,F.Function);this.yn().eg(this.node.id,a,b)};c.prototype.lC=function(a){F.ha("fillEraser",arguments,Ch);a.save();this.node.lc().rc(a);this.node.zv(a,!0);a.restore()};c.prototype.eH=function(a){F.ha("strokeEraser",arguments,Ch);a.save();this.node.lc().rc(a);this.node.zv(a,!1);a.restore()};c.prototype.gn=function(a,b){return E.gn(a,b)};c.prototype.ub=function(){return 1};c.prototype.eF=function(a){F.ha("parseFont",arguments,F.String);return new Re(a)};
c.prototype.Zb=function(a){F.ha("getConfig",arguments,F.String);return this.yn().Zb(a)};c.prototype.uH=function(a,b){F.ha("transformPoint",arguments,F.Number,F.Number);var c=this.node.Pa().apply(a,b);return{x:c.x,y:c.y}};c.prototype.vH=function(a,b,c,e){F.ha("transformRectangle",arguments,F.Number,F.Number,F.Number,F.Number);var d=new K(a,b,c,e);d.transform(this.node.Pa());return{x:d.x,y:d.y,width:d.width,height:d.height}};c.prototype.zH=function(a,b){F.ha("untransformPoint",arguments,F.Number,F.Number);
var c=this.node.lc().apply(a,b);return{x:c.x,y:c.y}};c.prototype.rc=function(a){this.node.Pa().rc(a)};c.prototype.yH=function(a){F.ha("untransformCanvas",arguments,Ch);this.node.lc().rc(a)};c.prototype.un=function(){return this.node.Wi({})};c.prototype.ia=function(a){F.ha("getProperty",arguments,F.String);var b=this.node.ia(a,!0);"matrix"===a&&(b=hf(b));return b};c.prototype.Ui=function(a,b){F.ha("getNodeProperty",arguments,F.String,F.String);var c=this.node.aa.za(a);if(c)return c=c.ia(b),"matrix"===
b&&(c=hf(c)),c};c.prototype.Xn=function(a){F.ha("isNode",arguments,F.String);return null!==this.node.aa.za(a)};c.prototype.Hk=function(a){F.ha("getNodeRectangle",arguments,F.String);var b=this.node.aa.za(a);return b&&N(b)?(b=b.rect,new gf(b.x,b.y,b.width,b.height)):new gf(0,0,0,0)};c.prototype.getZoomLevel=function(){return 1};return c}();function Dh(c,a,b){for(var d=void 0,e=-1,f=0;f<c;f++){var h=a(f);null===h||void 0!==d&&!b(h,d)||(d=h,e=f)}return e}
var Eh=function(c){function a(a,d){a=c.call(this,a,d)||this;a.Ka=null;a.children=[];a.log=v.create("CUSTOM");a.kc=new R(a);a.setProperty("matrix",new L);return a}__extends(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.Jo=function(){return this.ba.nodeType||this.type()};a.prototype.tc=function(){return!0};a.prototype.mn=function(){return this.Ka&&this.Ka.getDependencies?this.Ka.getDependencies():[]};a.prototype.rj=function(a){return this.Ka&&this.Ka.replaceDependencies?this.Ka.replaceDependencies(a):
{}};a.prototype.setProperty=function(a,d){if(null===this.Ka&&"nodeType"===a){a=E.Nm[d];this.Ka=new a(this.id,this.kc);for(var b in this.ba)this.setProperty(b,this.ba[b]);this.ba.nodeType=d;this.Ka.getDependencies&&!this.Ka.replaceDependencies&&console.warn(d+" should implement replaceDependencies(), or copy/paste will not work")}else d=c.prototype.setProperty.call(this,a,d),"matrix"===a&&(d=hf(d)),this.Ka&&this.Ka.setProperty&&this.Ka.setProperty(a,d)};a.prototype.Zf=function(){return this.Ka&&this.Ka.hasEditMode?
this.Ka.hasEditMode():!1};a.prototype.Fr=function(){return this.Ka&&this.Ka.hasAlwaysOnEditHandles?this.Ka.hasAlwaysOnEditHandles():!1};a.prototype.fr=function(){var a=[];this.Ka&&this.Ka.getEditHandles&&(a=this.Ka.getEditHandles());for(var c=this.Pa(),e=[],f=0;f<a.length;f++){var h=a[f];e.push(c.apply(h.x||0,h.y||0))}return e};a.prototype.Db=function(a,c,e,f){a=this.lc().apply(a,c);c=this.lc().ub(!1);c=.5*(c.x+c.y);var b=this.xa;return this.hidden()||this.ia("locked")||!b.Xc(a.x,a.y,e*c)||this.Ka&&
this.Ka.hittest&&!this.Ka.hittest(a.x,a.y,e,f)?null:this};a.prototype.sk=function(a,c){a.beginPath();var b=10*c;c*=2;for(var d=0,h=this.fr();d<h.length;d++){var k=h[d];a.moveTo(k.x+b,k.y);a.arc(k.x,k.y,b,0,2*Math.PI,!1)}a.strokeStyle="#0050B7";a.lineWidth=c;a.stroke()};a.prototype.pn=function(a){if("number"!==typeof a)return null;var b=this.fr();return a<b.length?b[a]:null};a.prototype.bg=function(a,c,e,f){if(this.Ka&&this.Ka.hittestEditHandle)return this.Ka.hittestEditHandle(a,c,e,f);var b=this.fr(),
d=new J(a,c);a=Dh(b.length,function(a){a=b[a].ic(d);return a>=e?null:a},function(a,b){return a<b});return 0<=a?a:null};a.prototype.xf=function(a,c,e,f){var b={};this.Ka&&this.Ka.moveEditHandle&&(c=this.lc().apply(c,e),b=this.Ka.moveEditHandle(a,c.x,c.y,f),b||(console.warn("moveEditHandle(): Must update your code."),b={}));return b};a.prototype.ia=function(a,d){void 0===d&&(d=!1);var b;!d&&this.Ka&&this.Ka.getProperty&&(b=this.Ka.getProperty(a));void 0===b&&(b=c.prototype.ia.call(this,a));"matrix"===
a&&(b=jf(b));return b};a.prototype.gh=function(a){c.prototype.gh.call(this,a);this.Ka.setHidden&&this.Ka.setHidden(a)};a.prototype.Ej=function(a){this.Ka.setTextHidden&&this.Ka.setTextHidden(a)};a.prototype.format=function(a,c){this.Ka&&(this.kc.nG(c),"format"in this.Ka&&this.Ka.format(a,this.kc),this.Ka.getUntransformedRect?(a=this.Ka.getUntransformedRect(),this.xa=new K(a.x||0,a.y||0,a.width||0,a.height||0),this.rect=this.xa.clone(),this.rect.transform(this.Pa())):this.log("Error: NodeType %s missing getUntransformedRect()",
this.ba.nodeType))};a.prototype.zg=function(a){this.hidden()||(a.save(),a.getTransform=function(){return a.Tj?hf(a.Tj):hf(new L)},this.kc.getScale=this.kc.getZoomLevel=function(){return a.Tj?a.Tj.ub().x:1},this.Ka.draw(a,this.kc),a.restore())};a.prototype.bt=function(){var a=!1;this.Ka.shouldEditOnSelect&&(a=this.Ka.shouldEditOnSelect());return a};a.prototype.Ge=function(a){if(this.Ka.applyTransform){a=this.Ka.applyTransform(hf(a));if("object"!==typeof a)throw Error("Error! applyTransform must return {properties}");
"matrix"in a&&(a.matrix=jf(a.matrix))}else a=c.prototype.Ge.call(this,a);return a};a.prototype.Sa=function(){this.Ka.destroy&&this.Ka.destroy();c.prototype.Sa.call(this)};return a}(pd);pd.Pd("CustomNode",Eh);R.prototype.formatFill=R.prototype.xC;R.prototype.getFill=R.prototype.ZC;R.prototype.reformat=R.prototype.bh;R.prototype.loadImage=R.prototype.eg;R.prototype.fillEraser=R.prototype.lC;R.prototype.strokeEraser=R.prototype.eH;R.prototype.formatText=R.prototype.gn;R.prototype.getScale=R.prototype.ub;
R.prototype.parseFont=R.prototype.eF;R.prototype.getConfig=R.prototype.Zb;R.prototype.transformPoint=R.prototype.uH;R.prototype.transformRectangle=R.prototype.vH;R.prototype.untransformPoint=R.prototype.zH;R.prototype.transformCanvas=R.prototype.rc;R.prototype.untransformCanvas=R.prototype.yH;R.prototype.getNodeObject=R.prototype.un;R.prototype.getProperty=R.prototype.ia;R.prototype.getNodeProperty=R.prototype.Ui;R.prototype.isNode=R.prototype.Xn;R.prototype.getNodeRectangle=R.prototype.Hk;function Fh(c,a){void 0===a&&(a=Fh.lz);for(var b=[],d=0;d<c;d++)b.push(a[Math.floor(Math.random()*a.length)]);return b.join("")}var Gh=Fh||(Fh={});Gh.rz="01234567890";Gh.Nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";Gh.lz=Gh.Nt+Gh.rz;var Hh=Fh;var Ih={style:"\n        .zwibbler-builtin-toolbar {\n    background: white;\n    width: 130px;\n    flex: 0 0 auto;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none; \n     -khtml-user-select: none; \n       -moz-user-select: none; \n        -ms-user-select: none; \n            user-select: none; \n}\n\n.zwibbler-builtin-toolbar button {\n    font-family: inherit;\n    font-size: 100%;\n    padding: 5px;\n    background-color: white;\n    border: none;\n}\n\n.zwibbler-builtin-toolbar button img {\n    margin: 0;\n}\n\n.zwibbler-builtin-toolbar button:hover,\n.zwibbler-builtin-toolbar button.selected {\n    background-color: #9fb3e7;\n}\n",
cj:'<div style="overflow-y: auto;display:flex;overflow-x:hidden;">\n<div class="zwibbler-builtin-toolbar">\n<button \n    z-if="getConfig(\'showPickTool\')"\n    z-click="usePickTool()"\n    z-selected="getCurrentTool()===\'pick\'"\n    title="Pick">\n    <img z-bind:src="getImageUrl(\'wd-pick.png\')">\n</button>\n<button \n    z-if="getConfig(\'showSquareTool\')"\n    z-click="useRectangleTool()"\n    z-selected="getCurrentTool()===\'rectangle\'"\n    title="Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-box.png\')">\n</button>\n<button \n    z-if="getConfig(\'showRoundRectTool\')"\n    z-click="useRoundRectTool()"\n    title="Rounded Rectangle">\n    <img z-bind:src="getImageUrl(\'wd-roundrect.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCircleTool\')"\n    z-click="useCircleTool()"\n    z-selected="getCurrentTool()===\'circle\'"\n    title="Circle">\n    <img z-bind:src="getImageUrl(\'wd-circle.png\')">\n</button>\n<button \n    z-if="getConfig(\'showShapeBrushTool\')"\n    z-click="useShapeBrushTool()"\n    title="Shape brush">\n    <img z-bind:src="getImageUrl(\'wd-shapebrush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showBrushTool\')"\n    z-click="useBrushTool()"\n    z-selected="getCurrentTool()===\'brush\'"\n    title="Brush">\n    <img z-bind:src="getImageUrl(\'wd-brush.png\')">\n</button>\n<button \n    z-if="getConfig(\'showLineTool\')"\n    z-click="useLineTool()"\n    z-selected="getCurrentTool()===\'line\'"\n    title="Lines">\n    <img z-bind:src="getImageUrl(\'wd-line.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCurveTool\')"\n    z-click="useCurveTool()"\n    z-selected="getCurrentTool()===\'curve\'"\n    title="Curves">\n    <img z-bind:src="getImageUrl(\'wd-curve.png\')">\n</button>\n<button \n    z-if="getConfig(\'showArrowTool\')"\n    z-click="useArrowTool()"\n    z-selected="getCurrentTool()===\'arrow\'"\n    title="Arrows">\n    <img z-bind:src="getImageUrl(\'wd-arrow.png\')">\n</button>\n<button \n    z-if="getConfig(\'showTextTool\')"\n    z-selected="getCurrentTool()===\'text\'"\n    z-click="useTextTool()"\n    title="Text">\n    <img z-bind:src="getImageUrl(\'wd-text.png\')">\n</button>\n<button \n    z-if="getConfig(\'showImageTool\')"\n    z-click="insertImage()"\n    title="Insert image...">\n    <img z-bind:src="getImageUrl(\'wd-image.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="bringToFront()"\n    title="Bring to front">\n    <img z-bind:src="getImageUrl(\'wd-moveup.png\')">\n</button>\n<button \n    z-if="getConfig(\'showMoveToFrontBack\')"\n    z-click="sendToBack()"\n    title="Send to back">\n    <img z-bind:src="getImageUrl(\'wd-movedown.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canUndo()"\n    z-click="undo()"\n    title="Undo">\n    <img z-bind:src="getImageUrl(\'wd-undo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showUndoRedo\')"\n    z-disabled="!canRedo()"\n    z-click="redo()"\n    title="Redo">\n    <img z-bind:src="getImageUrl(\'wd-redo.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="copy()"\n    title="Copy">\n    <img z-bind:src="getImageUrl(\'wd-copy.png\')">\n</button>\n<button \n    z-if="getConfig(\'showCopyPaste\')"\n    z-click="paste()"\n    title="Paste">\n    <img z-bind:src="getImageUrl(\'wd-paste.png\')">\n</button>\n<button\n    z-for="button in _zwibblerButtons"\n    z-bind:title="button.name"\n    z-click="_zwibblerButtonClicked(this, button)">\n    <img z-bind:src="getImageUrl(button.image)">\n</button>\n</div>\n</div>\n',
controller:function(c){c._zwibblerButtons=E.buttons;c._zwibblerButtonClicked=function(a,b){b.onclick.call(a,c)}}};var Jh={style:".zwibbler-page-selector {\n    overflow-y: scroll;\n    background: #888;\n    width: 160px;\n    text-align: center;\n}\n\n.zwibbler-page-selector [z-page] {\n    border: 3px solid transparent;\n    margin: 5px;\n    display: inline-block;\n    box-shadow: 2px 2px 2px rgba(0,0,0,0.2);\n}\n\n.zwibbler-page-selector [z-page].selected {\n    border: 3px solid #9fb3e7;\n}\n",cj:'<div class="zwibbler-page-selector">\n    <button z-if="getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.setCurrentPage(ctx.insertPage(ctx.getCurrentPage()+1))">\n        Add Page\n    </button>\n    <button z-if="ctx.getConfig(\'showPageSelectorControls\')"\n        z-click="ctx.deletePage(ctx.getCurrentPage())">\n        Delete Page\n    </button>\n    <br>\n    <div z-sort="ctx.movePage($from,$to)">\n        <div z-for="page in ctx.getPageCount()"\n            draggable="TRUE"\n            z-sortable\n            z-page="page"\n            z-width="130"\n            z-height="130"\n            z-click="ctx.setCurrentPage(page)"\n            z-selected="page==ctx.getCurrentPage()">\n        </div>\n    </div>\n</div>\n'};var Kh=function(){function c(a){var b=this;this.ma=a;this.vf=[];this.ki=!1;this.Kc=Hh(5);this.oq=new K(0,0,0,0);this.enabled=!1;this.Ii="#ff0000 #00ff00 #0000ff #ff00ff #805221 #2f361e #6b35c2 #416323 #431b77 #af2f21 #5451ad #962e7f #456354 #a52e4f #273c4c #692d25 #455b8a #3f1a2a #382454 #774f63".split(" ");this.uc=null;this.Ji=document.body;this.scope={colour:"",color:"",ctx:a};this.listener=function(a){b.rf(a.pageX,a.pageY,!1)?b.move(b.Kc,1,a.pageX,a.pageY,b.scope):b.move(b.Kc,0,a.pageX,a.pageY,
b.scope)};var c={};this.lE=function(a){for(var d=0;d<a.length;d++){var e=a[d];e.name.startsWith("pointerscope.")&&(null===e.value||"delete"===e.value?delete c[e.name]:c[e.name]=e.value,b.Tm(e.name.substr(13)))}d=b.ma.yc();for(var k=0;k<a.length;k++)if(e=a[k],e.name.startsWith("pointer."))if(null===e.value||"delete"===e.value)b.Tm(e.name.substr(8));else{var l=e.value.rel,n=c["pointerscope."+e.value.id];n&&(1===l?(l=b.ma.zn(e.value.x,e.value.y),b.ma.rf(l.x,l.y)&&e.value.p===d?b.move(e.value.id,1,l.x,
l.y,n):b.move(e.value.id,-1,l.x,l.y,n)):b.move(e.value.id,l,e.value.x,e.value.y,n))}};a.pa("set-keys",this.lE);this.Av="onpointerdown"in window?"pointermove":"mousemove";a.pa("destroy",function(){b.uy(!1);for(var a=0,c=b.vf;a<c.length;a++){var d=c[a];d.ea.parentNode&&d.ea.parentNode.removeChild(d.ea)}});a.pa("showOwnPointer",function(){b.Iy()});a.pa("showOtherPointers",function(){b.Iy()});a.pa("resize",function(){var a=B(b.Ji).wb();b.oq=new K(a.left,a.top,a.width,a.height)});a.pa("broadcastMouse",
function(a){b.enabled&&a&&b.Tm(b.Kc);b.uy(a)});a.pa("scroll",function(){for(var a=0,c=b.vf;a<c.length;a++){var d=c[a];d.fo=!0;if(1===d.rel&&d.Kc!==b.Kc){var k=b.ma.zn(d.Ha,d.Ia);d.x=k.x;d.y=k.y}}b.uc=null;b.hx()})}c.prototype.Iy=function(){var a=this.ma.Zb("showOwnPointer"),b=this.ma.Zb("showOtherPointers");this.Ji.classList.toggle("zwibbler-hide-own-pointer",!a);this.Ji.classList.toggle("zwibbler-hide-other-pointers",!b)};c.prototype.uy=function(a){this.Ji=this.ma.Fc();var b=B(this.Ji).wb();this.oq=
new K(b.left,b.top,b.width,b.height);(a=!1!==a)&&!this.enabled?document.addEventListener(this.Av,this.listener,!0):!a&&this.enabled&&(document.removeEventListener(this.Av,this.listener,!0),this.ma.Cj("pointer."+this.Kc,"delete",!1),this.ma.Cj("pointerscope."+this.Kc,"delete",!1),this.Tm(this.Kc));if(this.enabled=a)a=this.ma.Zb("broadcastMouse"),b={},"object"===typeof a?b=a:"string"===typeof a&&(b.username=a),this.scope=b,this.ma.Cj("pointerscope."+this.Kc,this.scope,!1)};c.prototype.Tm=function(a){for(var b=
0;b<this.vf.length;b++)if(this.vf[b].Kc===a){a=this.vf[b];a.ea.parentNode&&a.ea.parentNode.removeChild(a.ea);Q.detach(a.ea);this.vf.splice(b,1);break}};c.prototype.fl=function(){return this.Ii[this.vf.length%this.Ii.length]};c.prototype.move=function(a,b,c,e,f){for(var d=null,k=0,l=this.vf;k<l.length;k++){var n=l[k];if(n.Kc==a){d=n;break}}k=this.ma.Dk(c,e);if(d)d.fo=!0,d.rel=b,d.x=c,d.y=e,d.Ha=k.x,d.Ia=k.y;else{d=this.fl();f.colour=f.colour||f.color||d;var r=this;"ctx"in f||Object.defineProperty(f,
"ctx",{get:function(){return r.ma}});d=Q.hk({},"MousePointer",{},f).node;if(!(d instanceof HTMLElement))throw Error("Expected HTMLElement");d.style.position="absolute";d.style.pointerEvents="none";a===this.Kc?d.classList.add("zwibbler-own-pointer"):d.classList.add("zwibbler-other-pointer");this.Ji.appendChild(d);d={Kc:a,rel:b,x:c,y:e,Ha:k.x,Ia:k.y,It:0,Dr:0,fo:!0,ea:d,scope:f};this.vf.push(d)}this.hx()};c.prototype.hx=function(){var a=this;this.ki||(this.ki=!0,requestAnimationFrame(function(){a.ki=
!1;for(var b=a.oq,c=0,e=a.vf;c<e.length;c++){var f=e[c];if(f.fo){var h=f.x,k=f.y;f.It=Math.max(f.It,f.ea.offsetWidth);f.Dr=Math.max(f.Dr,f.ea.offsetHeight);var l=h+f.It+15,n=k+f.Dr+15,r=!1;-1===f.rel||l>b.right()||n>b.bottom()?f.ea.style.display="none":(f.ea.style.display="block",r=!0);B(f.ea).Aj({left:h,top:k});f.fo=!1;f.Kc===a.Kc&&(h=0,a.rf(f.x,f.y,!0)&&(f=a.ma.Dk(f.x,f.y),h=1),r&&0!==h||(h=-1),a.ma.Cj("pointer."+a.Kc,{rel:h,x:f.x,y:f.y,id:a.Kc,p:a.ma.yc()},!1))}}}))};c.prototype.rf=function(a,
b,c){if(c||!this.uc)c=this.ma.iw(),this.uc=this.ma.zn(c.x,c.y,c.width,c.height);return a>=this.uc.x&&a<this.uc.x+this.uc.width&&b>=this.uc.y&&b<this.uc.y+this.uc.height};return c}();
bc.then(function(c){c.cg("\n    .zwibbler-hide-own-pointer .zwibbler-own-pointer { display: none !important }\n    .zwibbler-hide-other-pointers .zwibbler-other-pointer { display: none !important }\n    ");c.fk("MousePointer",{style:"\n\n        .ZwibblerMousePointer.with-image {\n            background: green;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            border-top-left-radius: 0;\n            position: absolute;\n            box-shadow: 3px 3px 3px rgba(0,0,0,0.2);\n            opacity: 0.8;\n        }\n\n        .ZwibblerMousePointer img {\n            width: 30px;\n            border-radius: 50%;\n            position: absolute;\n            left: 5px;\n            top: 5px;\n        }\n\n        .ZwibblerMousePointer.no-image {\n            transform-origin: bottom left;\n            transform: translate(0, 20px) translate(-50%, -100%);\n            font-size: 10px;\n            text-align: center;\n        }\n\n        .ZwibblerMousePointer .ZwibblerLaser {\n            width: 40px;\n            height: 40px;\n            margin: -10px auto 0 auto;\n        }\n\n        .ZwibblerMouseText {\n            text-shadow: 0px 0px 5px white;\n            font-family: sans-serif;\n            font-weight: bold;\n            font-size: 10px;\n        }\n\n        .ZwibblerMousePointer.with-image .ZwibblerMouseText {\n            transform: translate(0, -15px);\n        }\n    ",template:'\n        <div class="ZwibblerMousePointer" \n            z-class="{\'with-image\': image, \'no-image\':!image}" z-style="getBackground()">\n            <div class="ZwibblerMouseText" z-text="username"></div>\n            <div class="ZwibblerLaser" z-if="!image"\n                z-style="{background:\'radial-gradient(\'+colour+\', transparent 50%)\'}">\n            </div>\n            <img z-if="image" z-bind:src="image">\n        </div>\n    ',
controller:function(a){a.getBackground=function(){return a.image?{backgroundColor:a.colour}:{}}}})});var Lh=v.create("LSEQ");function Mh(c){return 64*Math.pow(2,c)}
var Nh=function(){function c(a,b){this.eb=a;this.Hd=b}c.prototype.kH=function(){for(var a=1,b=0,c=this.eb.length-1;0<=c;c--)b+=this.eb[c]*a,a*=Mh(c);return b};c.prototype.toString=function(){return this.encode()};c.prototype.encode=function(){for(var a="",b=0;b<this.eb.length;b++)0<b&&(a+=" "),a+=""+this.eb[b].toString(36),this.Hd[b]&&(a+="/"+this.Hd[b]);return a};c.prototype.jB=function(a,b){for(var d=this.eb.concat(),e=this.Hd.concat(),f=0;f<Math.min(this.eb.length,a.eb.length);f++)if(this.eb[f]===
a.eb[f]&&e[f]<=a.Hd[f])e[f]=a.Hd[f];else break;for(f=0;f<Math.min(this.eb.length,b.eb.length);f++)if(this.eb[f]===b.eb[f]&&e[f]>=b.Hd[f])e[f]=b.Hd[f];else break;return new c(d,e)};c.prototype.depth=function(){return this.eb.length};c.fc=function(a){var b=[],d=[],e=0;for(a=a.split(" ");e<a.length;e++){var f=a[e].split("/");b.push(parseInt(f[0],36));d.push(f[1]||"")}return new c(b,d)};c.prototype.kt=function(a){if(a.eb.length!==this.eb.length)throw Error("LPath.subtract: lengths must be equal");for(var b=
0,d=[],e=this.eb.length-1;0<=e;e--){var f=this.eb[e]-b-a.eb[e];0>f?(f+=Mh(e),b=1):b=0;d.push(f)}d.reverse();return new c(d,this.Hd)};c.prototype.wu=function(a){for(var b=[],d=this.eb.length-1;0<=d;d--){var e=this.eb[d]+a;e>Mh(d)?(a=Math.floor(e/Mh(d)),e%=Mh(d)):a=0;b.push(e)}b.reverse();return new c(b,this.Hd)};c.prototype.fH=function(a){for(var b=[],d=this.eb.length-1;0<=d;d--){var e=this.eb[d]-a;0>e?(a=Math.ceil(-e/Mh(d)),e+=a*Mh(d)):a=0;b.push(e)}b.reverse();return new c(b,this.Hd)};c.prototype.prefix=
function(a,b){for(var d=[],e=[],f=0;f<a;f++)f<this.eb.length?(d.push(this.eb[f]),e.push(this.Hd[f])):(d.push(0),e.push(b));e[e.length-1]=b;return new c(d,e)};c.prototype.extend=function(a){var b=this.eb.slice(),d=this.Hd.slice();b.push(Mh(b.length)-1);d.push(a);return new c(b,d)};c.pd=function(a,b,c){void 0===c&&(c=!0);for(var d=0;d<Math.max(a.eb.length,b.eb.length);d++){if(d===a.eb.length)return-1;if(d===b.eb.length)return 1;var f=a.eb[d],h=b.eb[d],k=a.Hd[d],l=b.Hd[d];if(f<h)return-1;if(f>h)return 1;
if(c&&k<l)return-1;if(c&&k>l)return 1}return 0};return c}(),Oh=function(){function c(a){this.pc=a;this.Ap={};this.jq=1;this.first=new Nh([0],[""]);this.ej=new Nh([63],["~"])}c.prototype.Wp=function(a,b){var c,e=0,f=0,h=this.pc;this.jq&&(h+=this.jq.toString(36),this.jq++);for(0<=Nh.pd(a,b,!1)&&(b=a.extend(h));1>f;)e++,f=b.prefix(e,h).kt(a.prefix(e,h)).kH()-1;var k=Math.min(f,2);e in this.Ap||(this.Ap[e]=1==(e&1));if(100<e)throw Lh("p=%s q=%s",a,b),Error("Bad depth");void 0===c&&(c=Math.floor(ue.random()*
k)+1);e=(k=this.Ap[e])?a.prefix(e,h).wu(c):a.prefix(e,h).wu(f+1).fH(c);e=e.jB(a,b);if(1>c)throw Error("Error r < 1");if(-1!==Nh.pd(a,e)||-1!==Nh.pd(e,b))throw Error("LSEQ failure: ("+a+") !< ("+e+") !< ("+b+"}) strategy="+k+" r="+c);return e};return c}();var Ph=function(){function c(a,b,c,e){this.Ni=a;this.name=b;this.Na=c;this.size=e;this.Ja=0}c.prototype.encode=function(){return JSON.stringify({d:this.Ni,o:this.Na.encode(),w:this.size})};c.fc=function(a,b){b=JSON.parse(b);return new c(b.d,a,Nh.fc(b.o),b.w)};c.Ut=function(){return Hh(1,Hh.Nt)+Hh(2)};c.prototype.toString=function(){return"line."+this.name+":"+this.size+"px"};c.prototype.clone=function(){return new c(this.Ni,this.name,this.Na,this.size)};return c}();
function Qh(c,a){function b(a,b){for(var c=e[a][0],f=0;f<b.length;f++)if(0===f){var h=e[a][0];h.size=b[f]}else c=new Ph(a,Ph.Ut(),d.Wp(c.Na,d.ej),b[f]),e[a].push(c)}var d=new Oh(c),e=[[],[]];e[0].push(new Ph(0,"colstart",d.first,100));e[1].push(new Ph(1,"rowstart",d.first,100));e[0].push(new Ph(0,"colend",d.ej,0));e[1].push(new Ph(1,"rowend",d.ej,0));b(0,a.av);b(1,a.rows);c={};for(a=0;2>a;a++)for(var f=0,h=e[a];f<h.length;f++){var k=h[f];c["line."+k.name]=k.encode()}return c};var S=v.create("CONTEXT");function Rh(c){return c instanceof Array?c:[c]}
var T=F.String,Sh=F.Wa(T),Th=F.cb(T,F.Zl(T)),Uh=F.Wa(Th),Vh=F.cb(F.Number,F.String,F.Object),Wh=F.Mc("ExternalRect",{x:F.Number,y:F.Number,width:F.Number,height:F.Number}),Xh=F.Mc("CanvasRenderingContext2D",{moveTo:F.Function}),Yh=F.Mc("DrawShapeOptions",{textEntry:F.Nc,dragStyle:F.Wa(F.wi("rectangle","circle","rectangle-tl")),autoPickTool:F.Nc}),Zh=F.Mc("LineToolOptions",{singleLine:F.Nc,orthogonal:F.Nc,open:F.Nc,autoPickTool:F.Nc}),$h=F.Mc("SelectOptions",{selectMode:F.Wa(F.wi("surround","overlap")),
radius:F.Qa}),ai=F.Mc("SaveOptions",{page:F.ge,oj:F.Wa(F.Zl(F.cc)),maxWidth:F.Qa,format:F.dc,rect:F.Wa(Wh),encoding:F.Wa(F.wi("string","data-uri","blob"))});function bi(c,a){var b=!1,d=!1,e=a.get("autoPickTool");$g(c)?(a=c.singleLine||!1,b=c.orthogonal||!1,d=c.open||!1,"autoPickTool"in c&&(e=c.autoPickTool)):a=!!c;return{Ky:a,Lm:b,open:d,cf:e}}
var U=function(){function c(a,b,c){var d=this;this.sb={};this.Pi={};this.Zr=null;this.Ci={};this.ec=this.gf=null;this.Mi=!1;this.Aa=new jb;this.Mg=new $a;this.globals={};this.Xb=this.Yh=null;this.Pf=[];this.xq=null;this.Pl=new Set;this.Qn=new Set;this.ctx=this;this.Bu=!1;this.hg={};this.el={};this.Ww=this.Xw=!1;this.Is=0;this.Yg=this.Hs=null;this.$u="";this.Jm=null;var f=this;E.dj.push(this);a.ZWIBBLER_CONTEXT=this;this.Aa.add(function(){d.Pl.forEach(function(a){clearTimeout(a)});d.Pl.clear();d.Qn.forEach(function(a){clearInterval(a)});
d.Qn.clear();delete a.ZWIBBLER_CONTEXT;S("Running ZwibblerContext destructor");d.Zo();delete a.zwibbler;delete f.sb;delete f.da;delete f.gf;for(var b=E.dj,c=0;c<b.length;c++)if(b[c]===f){b.splice(c,1);break}d.ec&&d.ec.stop()});this.fa=new gh(this.Aa,b);this.da=new Bh(this.Aa,this,a,this.fa,c||this);new Kh(this);this.wx();this.pa("document-changed",function(a){a&&(d.summary=d.Vi(),a.remote||d.ua("local-changes"))});this.da.fa.pa("latency",function(a){d.ec&&d.ec.uG(a)});this.da.fa.pa("collaborationServer",
function(a){d.ec&&d.ec.FG(a)});this.Tz();this.pa("selected-nodes",function(){d.summary=d.Vi()});this.pa("tool-changed",function(){d.summary=d.Vi()});this.summary=this.Vi();this.setTimeout(function(){d.gm(Ih,"left","showToolbar")},10);this.gm(Jh,"right","showPageSelector");this.gm(Sb(),"right","showPropertyPanel");this.gm(Ub,"bottom","showColourPanel");this.Oz()}c.prototype.rm=function(a,b){this.da.view.aa.rm(a,b)};c.prototype.Rp=function(a,b){F.ha("addKeyboardShortcut",arguments,F.String,F.Function);
this.da.Rp(a,b)};c.prototype.wh=function(a,b){void 0===b&&(b=!1);F.ha("addRemoteChanges",arguments,F.String,F.Nc);S("Add remote changes: %s reset=%s",a,b);b&&(this.da.ri(new vh(!0,this.da.Yf(),this.da.vj,this.Pf,this.da.view.ma,this.da.view.request)),this.ua("document-opened"));try{this.da.view.aa.vb.wh(a),0===this.ob()&&(S("After commit there are 0 pages. Create one!"),this.lb(),this.Uk(0),this.Ea(!0)),b&&this.da.view.Ae(this.fa.get("defaultZoom"))}catch(d){throw console.log(this.da.view.aa.toString()),
console.log(a),console.log(this.da.view.aa.vb.toString()),b||this.ua("session-error",d),d;}};c.prototype.rd=function(a,b){F.ha("attach",arguments,F.Object,F.HTMLElement);Q.rd(a,b);Q.digest();this.Aa.add(function(){S("DESTROYING A PANEL");Q.detach(b)});if(!this.Bu&&a instanceof c||a.ctx instanceof c)this.Bu=!0,this.pa("tool-changed",function(){return Q.digest()}),this.da.fa.pa("update",function(){return Q.digest()}),this.pa("document-changed",function(){return Q.digest()}),this.pa("selected-nodes",
function(){return Q.digest()});this.resize()};c.prototype.digest=function(a){F.ha("digest",arguments,F.wg);Q.digest(a)};c.prototype.Yz=function(){this.gb("abortTransaction is not implemented. Please contact support.")};c.prototype.Pp=function(a,b,c){void 0===c&&(c=-1);F.ha("addGridColumn",arguments,T,F.Number,F.ge);var d=this.da.view.aa.za(a);d&&Vc(d)&&this.hm(a,d.Pp(c,b))};c.prototype.Qp=function(a,b,c){void 0===c&&(c=-1);F.ha("addGridRow",arguments,T,F.Number,F.ge);var d=this.da.view.aa.za(a);d&&
Vc(d)&&this.hm(a,d.Qp(c,b))};c.prototype.eA=function(a,b,c){F.ha("addNodeToGrid",arguments,T,T,F.Mc("CellSpec",{column:F.cc,row:F.cc,endRow:F.ge,endColumn:F.ge,sticky:F.Wa(F.cb(F.Nd("column"),F.Nd("row"),F.Nd(""))),span:F.Wa(F.cb(F.Nd("none"),F.Nd("horizontal"),F.Nd("vertical")))}));var d=this.da.view.aa.za(a),f=this.da.view.aa.za(b);f&&5===(f.jb&5)&&d&&Vc(d)&&(d={"style.gridArea":d.bD(c.row,c.column,c.endRow||c.row+1,c.endColumn||c.column+1),"style.width":"auto","style.height":"auto",sticky:c.sticky},
c.span&&(d._spanGrid=c.span),this.lb(),this.Ab(b,d),this.Yj(a,b),this.Ea())};c.prototype.Ws=function(a,b,c){F.ha("setGridColumn",arguments,T,F.cc,F.Number);var d=this.da.view.aa.za(a);d&&Vc(d)&&this.Ab(a,d.Ws(b,c))};c.prototype.Xs=function(a,b,c){F.ha("setGridRow",arguments,T,F.cc,F.Number);var d=this.da.view.aa.za(a);d&&Vc(d)&&this.Ab(a,d.Xs(b,c))};c.prototype.je=function(a,b,c,e,f,h,k){F.ha("addSelectionHandle",arguments,F.Number,F.Number,F.Number,F.Number,F.String,F.cb(F.Function,F.String),F.wg);
switch(h){case "scale":case "rotate":case "translate":var d=h;break;default:if("function"===typeof h){d="click";var n=h}else{this.gb('addSelectionHandle: action must be "scale", "rotate", "translate", or a function');return}}this.da.view.je(a,b,c,e,f,d,n,k)};c.prototype.Yj=function(a,b){F.ha("addToParent",arguments,Th);var c=this.da.view.aa.za(a);if(c){switch(c.type()){case "GroupNode":case "GridNode":break;default:S("parent is not a group");return}var e=Rh(b);this.$e(function(a){a.Yj(c.id,e)})}else S("addToGroup: Bad node id")};
c.prototype.Sp=function(a){F.ha("addToLanguage",arguments,F.String);this.da.language.Sp(a)};c.prototype.hA=function(a,b){F.ha("addPage",arguments,F.Qa,F.Qa);return this.Fa()?this.yc():this.Uk(this.ob(),a,b)||0};c.prototype.Xj=function(a,b,c){F.ha("addPanel",arguments,F.Number,F.String,F.HTMLElement);this.da.Xj(a,b,c)};c.prototype.pA=function(a,b){function c(a){return e?{start:a.x,length:a.width}:{start:a.y,length:a.height}}void 0===b&&(b=this.mc());F.ha("alignNodes",arguments,F.wi("top","middle",
"bottom","centre","center","left","right"),Uh);var e=!0;switch(a){case "top":case "middle":case "bottom":e=!1;break;case "center":a="centre"}switch(a){case "top":case "left":a="start";break;case "middle":case "centre":a="centre";break;case "right":case "bottom":a="end";break;default:this.gb("Expected left|right|centre|top|middle|bottom but got '"+a+"'")}this.lb();var f=c(this.Hk(b)),h=f.start;f=f.length;for(var k=0,l=b;k<l.length;k++){var n=l[k],r=c(this.Hk(n)),u=0;switch(a){case "start":u=h-r.start;
break;case "end":u=h+f-r.start-r.length;break;case "centre":u=h+f/2-r.start-r.length/2}0!==u&&(n=[n],this.Nb("start-transform",{transformType:"translate",nodes:n}),e?this.Lj(n,u,0):this.Lj(n,0,u))}this.Ea()};c.prototype.xA=function(a,b){F.ha("autoScroll",arguments,F.Number,F.Number);this.da.view.scrollIntoView(a,b)};c.prototype.lb=function(){this.da.view.aa.lb()};c.prototype.aq=function(){this.lb()};c.prototype.IA=function(a){void 0===a&&(a=this.mc());F.ha("bringToFront",arguments,Uh);this.Fa()||
this.da.view.Sd(0,Rh(a))};c.prototype.Us=function(a){F.ha("sendBroadcast",arguments,F.String);this.ec&&this.ec.Us(a)};c.prototype.Cj=function(a,b,c){F.ha("setSessionKey",arguments,F.String,F.ph,F.Boolean);var d={name:a,value:b,persistent:c};this.el[a]=d;c||(null!==b&&void 0!==b?this.hg[a]=d:delete this.hg[a]);this.pe("local-keys")};c.prototype.Kf=function(){return this.Fa()?!1:this.da.view.aa.Kf()};c.prototype.Lf=function(){return this.Fa()?!1:this.da.view.aa.Lf()};c.prototype.LA=function(a){void 0===
a&&(a=this.mc());F.ha("canMoveUp",arguments,Uh);return this.Fa()?!1:this.da.view.aa.Su(Rh(a),2)};c.prototype.KA=function(a){void 0===a&&(a=this.mc());F.ha("canMoveDown",arguments,Uh);return this.Fa()?!1:this.da.view.aa.Su(Rh(a),3)};c.prototype.clearInterval=function(a){clearInterval(a);this.Qn.delete(a)};c.prototype.Hi=function(a){F.ha("clearTemporaryProperties",arguments,Th);this.da.view.aa.Hi(Rh(a))};c.prototype.pb=function(){this.ti(!0);this.da.view.pb();this.da.view.xc();this.da.view.ka()};c.prototype.clearTimeout=
function(a){clearTimeout(a);this.Pl.delete(a)};c.prototype.VA=function(){this.da.iq()};c.prototype.WA=function(a,b){F.ha("clickColour",arguments,F.String,F.Boolean);if(this.Fa())return!1;this.pi(a,!b)};c.prototype.Ea=function(a){void 0===a&&(a=!1);F.ha("commit",arguments,F.Nc);this.da.view.aa.Ea(a)};c.prototype.cB=function(){this.Ea(!0)};c.prototype.lq=function(){this.Ea(!1)};c.prototype.Km=function(){this.da.view.aa.Km();this.gd()};c.prototype.Ah=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=this.mc());
F.ha("copy",arguments,F.Nc,Uh);return this.da.view.Ah(a,Rh(b))};c.prototype.nB=function(a,b){F.ha("createDataNode",arguments,F.Object,Sh);return this.createNode("DataNode",a,b)};c.prototype.pB=function(a){void 0===a&&(a=this.mc());F.ha("createGroup",arguments,Uh);if(this.Fa())return!1;var b;this.$e(function(c){b=c.group(Rh(a))});return b};c.prototype.vc=function(a){void 0===a&&(a={});var b={};if(a instanceof Array)return a.concat();if(!(a instanceof Object))return a;for(var c in a)if(a.hasOwnProperty(c)){var e=
a[c];e=ci(c,e);b[c]=e}return b};c.prototype.rB=function(a){F.ha("createLogger",arguments,F.String);return v.create(a)};c.prototype.createNode=function(a,b,c,e){F.ha("createNode",arguments,F.String,F.Object,Sh,F.Qa);S("createNode(%s)",a);Yg(a)||this.gb("createNode: node type must be string");var d=this.vc(b);return c?this.da.createNode(a,d,c,e):this.da.createNode(a,d)};c.prototype.qB=function(a,b,c,e){void 0===b&&(b={});F.ha("createHTMLNode",arguments,F.String,F.qd,Sh,F.ge);if(!E.Ie[a])throw Error("Component "+
a+" not registered");var d=E.Ie[a].defaults;if(d)for(var h in d)h in b||(b[h]=d[h]);b.$component=a;return this.createNode("HTMLNode",b,c,e)};c.prototype.qq=function(a,b,c,e){F.ha("createHTMLNodeFromDrag",arguments,F.String,F.Object,F.Number,F.Number);var d=E.Wv(a);b=dd({},d,b);this.da.view.qq(a,b,c,e)};c.prototype.Mm=function(a){F.ha("createPath",arguments,F.cm);return this.da.Mm(a)};c.prototype.oB=function(a,b){void 0===b&&(b={});F.ha("createGridNode",arguments,F.Mc("GridSpec",{columns:F.cm,rows:F.cm}),
F.qd);var c=dd({},b,Qh(this.da.view.aa.pc,a));return this.createNode("HTMLGridNode",c)};c.prototype.gm=function(a,b,c){var d=this,f;this.da.fa.pa(c,function(c){c?(f||(a.style&&E.cg(a.style),c=document.createElement("div"),c.innerHTML=a.cj,f=c.firstChild,d.rd(d,f),a.controller&&a.controller(d)),d.da.Xj(1,b,f)):f&&d.da.wl(f)})};c.prototype.wB=function(a,b){F.ha("createToolbar",arguments,F.cb(F.String,F.HTMLElement),F.Zl(F.Mc("ToolbarItem",{toolName:F.dc,onclick:F.wg,title:F.dc,background:F.dc,image:F.dc,
html:F.dc})));var c=B.Fc(a);if(c){Xg(b)||this.gb("createToolbar: second parameter must be array");E.cg("a.zwibbler-button {\n            background-repeat: no-repeat;\n            background-position: center;\n            display: inline-block;\n            overflow: hidden;\n        }");for(var e=this,f=function(a,b){b.addEventListener("click",function(b){a.onclick.call(this,e,b)})},h=0;h<b.length;h++){var k=b[h],l=B("a").ie("zwibbler-button").Ag();l.setAttribute("href","javascript:void(0)");k.toolName&&
B(l).ie(k.toolName);k.onclick&&f(k,l);k.title&&l.setAttribute("title",k.title);k.background?l.style.background=k.background:k.image&&(l.style.backgroundImage="url("+k.image+")");k.html&&(l.innerHTML=k.html);c.appendChild(l)}var n;this.pa("tool-changed",function(a){n&&n.classList.remove("zwibbler-selected");(n=c.querySelector("."+a))&&n.classList.add("zwibbler-selected")})}else this.gb("createToolbar: Could not convert first parameter to an HTML element")};c.prototype.sq=function(a){F.ha("createShape",
arguments,F.cm);this.da.sq(a)||this.gb("createShape needs an array of at least 6 numbers")};c.prototype.yq=function(a){void 0===a&&(a=this.mc());F.ha("cut",arguments,Uh);var b=this.da.view.Ah(!1,a);this.Fa()||this.pv();return b};c.prototype.Of=function(a){F.ha("decoration",arguments,F.Mc("Decoration",{appliesTo:F.wg,xoffset:F.Qa,yoffset:F.Qa,x:F.Qa,y:F.Qa,width:F.Qa,image:F.dc,hoverImage:F.dc}));this.Pf.push(new Xc(this,a))};c.prototype.Sa=function(){if(!this.Mi){this.Nb("destroy");this.da.Sa();this.Mg.Sa();
for(var a in this)this.hasOwnProperty(a)&&delete this[a];this.Mi=!0}};c.prototype.$e=function(a){this.da.view.aa.transaction(a)};c.prototype.zB=function(a,b){F.ha("deleteGridColumn",arguments,T,F.cc);var c=this.da.view.aa.za(a);c&&Vc(c)&&this.hm(c.id,c.AB(b,b))};c.prototype.BB=function(a,b){F.ha("deleteGridRow",arguments,T,F.cc);var c=this.da.view.aa.za(a);c&&Vc(c)&&this.hm(c.id,c.CB(b,b))};c.prototype.hm=function(a,b){this.lb();for(var c=0,e=b.children;c<e.length;c++){var f=e[c];f.remove?this.ff(f.Ug):
this.Ab(f.Ug,f.Tg)}this.Ab(a,b.ba);this.Ea()};c.prototype.ff=function(a){this.wc(a)};c.prototype.Mz=function(a){for(var b=0;b<a.length;b++)this.da.view.aa.za(a[b],!1)||(a.splice(b,1),--b);return 0<a.length};c.prototype.wc=function(a){void 0===a&&(a=this.mc());F.ha("deleteNodes",arguments,Uh);if(!this.Fa()){S("deleteNodes()");var b=Rh(a);this.Nb("start-transform",{transformType:"delete",nodes:b});this.Mz(b)&&this.$e(function(a){return a.wc(b)})}};c.prototype.DB=function(a){var b=this;void 0===a&&(a=
this.yc());F.ha("deletePage",arguments,F.ge);if(!this.Fa())if((0>a||a>=this.ob())&&this.gb("deletePage: Asked to delete "+a+" but there are only "+this.ob()+" pages"),1===this.ob())this.$e(function(a){a.wc(Rh(b.Vq()));var c=a.Oe(0),d=c.hb(),e={},l=0,n;for(n in d)"_"===n[0]&&(e[n]=void 0,l++);l&&a.Ab([c.id],e)});else{var c=this.da.view.aa.Oe(a).id;this.$e(function(a){return a.wc([c])})}};c.prototype.pv=function(){this.Fa()||this.da.view.Sm()};c.prototype.Qf=function(){1===arguments.length&&!1===arguments[0]&&
this.da.view.aa.$w();return this.da.view.aa.Qf()};c.prototype.dispatchEvent=function(a,b){F.ha("dispatchEvent",arguments,F.bm(Event),F.Wa(F.bm(HTMLElement)));S("dispatchEvent(%s)",a.type);b=b||a.target||this.da.Rd;return Af.sz(b,a)};c.prototype.$r=function(a,b){function c(b){switch(a){case "down":case "up":case "move":case "over":case "out":return b+a}return a}var e=this;F.ha("mouseEvent",arguments,F.String,F.Object);if("click"===a){var f=this.$r("down",b);return f=f||this.$r("up",b)}var h={clientX:(b.pageX||
0)-(document.documentElement.scrollLeft+document.body.scrollLeft),clientY:(b.pageY||0)-(document.documentElement.scrollTop+document.body.scrollTop),bubbles:!0,cancelable:!0,buttons:b.buttons,ctrlKey:b.ctrlKey||!1,altKey:b.altKey||!1,pointerType:b.pointerType||"",pointerId:"pointerId"in b?b.pointerId:-1};try{f="onpointerdown"in window?new PointerEvent(c("pointer"),h):new MouseEvent(c("mouse"),h)}catch(k){return f=document.createEvent("MouseEvent"),f.initMouseEvent(c("mouse"),h.bubbles||!1,h.cancelable||
!1,window,0,h.screenX||0,h.screenY||0,h.clientX||0,h.clientY||0,h.ctrlKey||!1,h.altKey||!1,h.shiftKey||!1,h.metaKey||!1,h.button||0,h.relatedTarget||null),Object.defineProperty(f,"buttons",{get:function(){return h.buttons}}),Object.defineProperty(f,"target",{get:function(){return b.target||e.da.Rd}}),this.da.view.Uy.handleEvent(f),!f.defaultPrevented}return this.dispatchEvent(f,b.target)};c.prototype.kE=function(a,b){F.ha("keyboardEvent",arguments,F.String,F.Object);return this.dispatchEvent(function(a,
b){try{var c=new KeyboardEvent(a,b);Object.defineProperty(c,"keyCode",{get:function(){return b.keyCode||0}});return c}catch(k){}c=document.createEvent("KeyboardEvent");var d=[];b.ctrlKey&&d.push("Control");b.shiftKey&&d.push("Shift");b.altKey&&d.push("Alt");b.metaKey&&d.push("Meta");c.initKeyboardEvent(a,b.bubbles||!1,b.cancelable||!1,null,b.keyCode||0,0,d.join(" "),!1,"");Object.defineProperty(c,"keyCode",{get:function(){return b.keyCode||0}});return c}(a,b),document.body)};c.prototype.download=
function(a,b,c,e){if("string"===typeof b){F.ha("download",arguments,F.String,F.String,F.Wa(Wh),F.Qa);var d={format:a,rect:c,maxWidth:e};var h=b}else F.ha("download",arguments,F.String,ai),d=b,h=a;d=dd(d,{encoding:"data-uri"});d=this.save(d);this.Mg.RF(d,h)};c.prototype.ka=function(a,b){void 0===b&&(b={});F.ha("draw",arguments,Xh,F.Wa(F.Mc("DrawOptions",{page:F.ge,scaleHint:F.Qa})));var c="number"===typeof b.page?b.page:this.yc();var e=this.da.view.aa.bb;var f="page"in b?this.nf(c):this.Ri();var h=
1;b.jy?h=b.jy:a.getTransform&&(h=a.getTransform(),h=Math.min(1,.5*(Math.sqrt(h.a*h.a+h.c*h.c)+Math.sqrt(h.b*h.b+h.d*h.d))));this.da.view.aa.jd(c);this.da.view.Rf(a,1,f.x,f.y,f.width,f.height,h,0,0);this.da.view.aa.ka(a);this.gf&&this.gf(a);this.da.view.aa.jd(e)};c.prototype.Xm=function(a){F.ha("editNodeText",arguments,T);this.Fa()||this.da.view.Xm(a)};c.prototype.duplicate=function(){return this.Fa()?[]:this.da.view.duplicate()};c.prototype.Gp=function(a,b,c){var d=this;if(!this.Mi)if(a in this.Pi)this.Pi[a]=
b;else{var f=function(){if(!d.Mi&&!d.Qz(a)){a in d.Pi&&(b=d.Pi[a],delete d.Pi[a]);if(a in d.sb)for(var c=0,e=d.sb[a];c<e.length;c++){var f=e[c];try{var n=f.apply(null,b)}catch(r){console.log("Error in handler for '"+a+"':",r)}}d.digest();return n}};"once"===c&&(this.Pi[a]=b);if("now"===c)return f();setTimeout(f,0);return this}};c.prototype.ua=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];F.ha("emit",arguments,F.String);return this.Gp(a,b,"normal")};c.prototype.Nb=function(a){for(var b=
[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Gp(a,b,"now")};c.prototype.pe=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return this.Gp(a,b,"once")};c.prototype.WG=function(a){F.ha("skipEvent",arguments,F.String);this.Ci[a]=a in this.Ci?this.Ci[a]+1:1};c.prototype.Qz=function(a){return a in this.Ci&&0<this.Ci[a]?(S("Skipped %s event",a),--this.Ci[a],!0):!1};c.prototype.du=function(){this.pe("loading",this.Xw||this.Ww)};c.prototype.zy=function(a){this.Xw=
a;this.du()};c.prototype.yy=function(a){this.Ww=a;this.du()};c.prototype.focus=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=null);F.ha("focus",arguments,F.Nc,F.Wa(F.HTMLElement));this.da.EG(b);a?this.da.ct("text"===this.Kh()):this.da.focus()};c.prototype.blur=function(){this.da.blur()};c.prototype.tC=function(a){function b(b){return a(b.id)}F.ha("forEachNode",arguments,F.Function);this.da.view.aa.tk(b,this.da.view.aa.za(this.da.view.aa.root.id),!0);for(var c=0,e=this.da.view.aa.yk;c<e.length;c++)this.da.view.aa.tk(b,
e[c],!0)};c.prototype.pC=function(a){F.ha("findNode",arguments,F.String);var b=this.Dv(a);return b.length?b[0]:null};c.prototype.Dv=function(a){F.ha("findNodes",arguments,F.String);for(var b=this.da.view.aa.qC(a),c=[],e=0;e<b.length;e++)c.push(b[e].id);return c};c.prototype.rC=function(a,b,c){F.ha("flip",arguments,F.Number,F.Qa,F.Qa);if(!this.Fa())if(3===arguments.length)if("number"!==typeof b||"number"!==typeof c)this.gb("flip: 2nd and 3rd args must be numbers.");else{var d=new J(b,c);this.da.view.Jv(a/
180*Math.PI,d)}else this.da.view.Jv(a/180*Math.PI)};c.prototype.zk=function(a,b,c,e){F.ha("flipNodes",arguments,F.Zl(T),F.Number,F.Qa,F.Qa);if(!this.Fa()){var d=this.ru(Rh(a));if("number"===typeof c&&"number"===typeof e){var h=new J(c,e);this.da.view.zk(d,b/180*Math.PI,h)}else this.da.view.zk(d,b/180*Math.PI)}};c.prototype.Sv=function(a,b,c){var d=this;void 0===c&&(c={});F.ha("generatePalette",arguments,F.cb(F.String,F.HTMLElement),F.Number,F.Wa(F.Mc("Options",{onColour:F.wg,onOpacity:F.wg})));c.onColour=
c.onColour||c.onColor||function(a,b){d.pi(a,b)};c.onOpacity=c.onOpacity||function(a,b){d.Ay(a,b)};return Ff(a,b,c)};c.prototype.Uq=function(){return this.da.view.AC()};c.prototype.Vq=function(){var a=[];this.da.view.aa.ZB(function(b){a.push(b.id)},this.yc());return a};c.prototype.GC=function(){return this.da.HC()};c.prototype.Yq=function(a){F.ha("getBoundingRectangle",arguments,Th);return this.uh(this.da.view.Yq(Rh(a)))};c.prototype.Zb=function(a){F.ha("getConfig",arguments,F.String);return this.da.fa.get(a)};
c.prototype.yc=function(){return this.da.view.aa.bb};c.prototype.OC=function(){return this.da.view.rn()};c.prototype.PC=function(){return this.da.view.Lk()};c.prototype.Kh=function(){return this.da.view.Kh()};c.prototype.QC=function(a){if(null===a)return null;F.ha("getCustomNode",arguments,T);var b=this.da.view.aa.za(a),c=null;b instanceof Eh&&(c=b.Ka);return c};c.prototype.Dk=function(a,b,c,e){void 0===c&&(c=0);void 0===e&&(e=0);F.ha("getDocumentCoordinates",arguments,F.Number,F.Number,F.Qa,F.Qa);
var d=this.da.view.Ed(a,b,!0),h=this.Zq();return new gf(d.x,d.y,c/h,e/h)};c.prototype.VC=function(a){F.ha("getDocumentProperty",arguments,F.String);return this.da.view.aa.ia(a)};c.prototype.UC=function(){F.ha("getDocumentProperties",arguments);return this.da.view.aa.hb()};c.prototype.Ri=function(a){void 0===a&&(a=this.yc());F.ha("getDocumentSize",arguments,F.ge);var b;this.Zb("pageView")&&(b=wh);return this.uh(this.da.view.aa.Pc(a,b))};c.prototype.Fc=function(){return this.da.Yf()};c.prototype.rn=
function(){return this.da.view.rn()};c.prototype.cD=function(a){a=this.da.view.aa.za(a);if(!a)return null;for(var b=a.parent;b;){if(Vc(b)){var c=b.LC(a);if(c)return{gridID:b.id,row:c.OF,endRow:c.NF,column:c.ZA,endColumn:c.YA,sticky:a.ia("sticky")};break}a=b;b=b.parent}return null};c.prototype.jr=function(a){a=this.da.view.aa.za(a);if(!a||!Vc(a))return null;a=a.jr();return{rows:a.rows,columns:a.av}};c.prototype.fD=function(){for(var a=[],b=0,c=this.da.view.aa.zr();b<c.length;b++){var e=c[b];a.push({cid:e.RA,
ts:e.Rb/1E3})}return a};c.prototype.mr=function(a){F.ha("getImageUrl",arguments,F.String);return this.da.fa.mr(a)};c.prototype.kD=function(a){F.ha("getLanguageString",arguments,F.String);return this.da.language.get(a)};c.prototype.sr=function(){var a=this.da.view.aa.vb.KC();if(!a.empty())return this.Yh=a,a.toString();this.Yh=null;return""};c.prototype.uh=function(a){return new gf(a.x,a.y,a.width,a.height)};c.prototype.Vj=function(a){"object"!==typeof a&&this.gb("Error: Rectangle object expected.");
return new K(a.x||0,a.y||0,a.width||0,a.height||0)};c.prototype.XC=function(){return this.uh(this.da.view.aa.Xq())};c.prototype.eD=function(a){F.ha("getGroupParent",arguments,T);var b=this.da.view.aa.Ob(a);return null===b?(S("getGroupParent: No such node %s",a),null):b.parent&&"GroupNode"===b.parent.type()?b.parent.id:null};c.prototype.dD=function(a){F.ha("getGroupMembers",arguments,T);var b=[],c=this.da.view.aa.za(a);if(!c||"GroupNode"!==c.type())return S("getGroupMembers: Error node %s is not a group.",
a),b;for(var e=0;e<c.children.length;e++)b.push(c.tb(e).id);return b};c.prototype.iD=function(a,b){return this.Ui(a,b)};c.prototype.mD=function(){var a=[],b={};this.da.view.aa.wd(!1,function(d){!(c=d.Gc())||c in b||(b[c]=1,a.push(c))});var c=this.Uq();c in b||a.push(c);return a};c.prototype.lD=function(a){F.ha("getLayerNodes",arguments,F.String);var b=[];this.da.view.aa.Oc(function(c){c.Gc()===a&&b.push(c.id)});return b};c.prototype.qD=function(a,b,c){F.ha("getNodeCoordinates",arguments,T,F.Number,
F.Number);var d=this.da.view.aa.Ob(a);if(null===d)return this.gb("Error: node %s does not exist",a),null;d=this.da.view.IE(d,b,c);return{x:d.x,y:d.y}};c.prototype.sD=function(a){return this.Xv(a)};c.prototype.Xv=function(a){F.ha("getDrawOrder",arguments,T);var b=this.da.view.aa.za(a);return b&&b.parent?b.parent.te(b):-1};c.prototype.mf=function(a){F.ha("getNodePageNumber",arguments,T);return this.da.view.aa.mf(a)};c.prototype.Ui=function(a,b){F.ha("getNodeProperty",arguments,T,F.String);var c=this.da.view.aa.Ui(a,
b);return c instanceof L?hf(c):c};c.prototype.Hk=function(a){F.ha("getNodeRectangle",arguments,Th);for(var b=null,c=0,e=this.da.view.aa.vr(Rh(a),!0);c<e.length;c++){var f=e[c];N(f)&&"GroupNode"!=f.type()&&(Uc(f)&&this.da.view.aa.Pr(f)?(f=B(f.ea).wb(),f=this.Dk(f.left,f.top,f.width,f.height),f=new K(f.x,f.y,f.width,f.height)):f=f.rect,b?b.Oj(f):b=f.clone())}b||(b=new K(0,0,0,0));return this.uh(b)};c.prototype.tD=function(a){F.ha("getNodeScale",arguments,T);var b=this.da.view.aa.Ob(a);if(null===b)return this.gb("Error: node %s does not exist",
a),null;b=b.Pa().ub(!0);return{x:b.x,y:b.y}};c.prototype.uD=function(a){F.ha("getNodeTransform",arguments,T);var b=this.da.view.aa.Ob(a);if(null===b)this.gb("Error: node %s does not exist",a);else return b=b.Pa(),[b.m11,b.m21,b.m12,b.m22,b.Ha,b.Ia]};c.prototype.vD=function(a){F.ha("getNodeType",arguments,T);var b=this.da.view.aa.za(a),c="";b&&(c=b.Jo());return c};c.prototype.vn=function(a,b){F.ha("getNodesInRectangle",arguments,Wh,F.Wa($h));var c=b||{},e=c.radius||0;c="overlap"===(c.selectMode||this.fa.get("selectMode"));
var f=this.Vj(a);f.dd(2*e,2*e);e=[];var h=0;for(c=this.da.view.aa.vn(f,c);h<c.length;h++)e.push(c[h].id);return e};c.prototype.wD=function(a,b,c){void 0===c&&(c=0);F.ha("getNodeUnderPoint",arguments,F.Number,F.Number);var d=this.da.view.aa.Db(a,b,c,this.da.view.scale,this.da.view.Ub).node;return d?d.id:this.da.view.Jx(a,b,c)&&(d=this.mc(),d.length)?d[0]:null};c.prototype.zD=function(a,b,c){void 0===c&&(c=0);F.ha("getNodesUnderPoint",arguments,F.Number,F.Number,F.Qa);for(var d=[],f=0,h=this.da.view.aa.WD(a,
b,c,this.da.view.scale);f<h.length;f++)d.push(h[f].id);return d};c.prototype.xD=function(a){F.ha("getNodeVisibility",arguments,T);var b=this.da.view.aa.Ob(a,!0);return b?!b.hidden():!1};c.prototype.ob=function(){return this.da.view.aa.ob()};c.prototype.Ik=function(a){void 0===a&&(a=this.yc());F.ha("getPageNode",arguments,F.ge);(0>a||a>this.ob())&&this.gb("getPageNode: Invalid page number "+a+". Must be 0.."+this.ob());var b=this.da.view.aa.Oe(a);return b?b.id:null};c.prototype.nf=function(a){void 0===
a&&(a=this.yc());F.ha("getPageRect",arguments,F.ge);(0>a||a>=this.ob())&&this.gb("getPageRect: Invalid page number "+a+". Must be 0.."+this.ob());return this.uh(this.da.view.nf(a))};c.prototype.wn=function(a){F.ha("getPathData",arguments,T);var b=this.da.view.aa.Ob(a,!1);if(!b||"PathNode"!==b.type())return null;var c=[],e=0;for(b=b.wn().clone().fe();e<b.length;e++)for(var f=b[e],h=0;h<f.length;h++){var k=f[h];c.push(k.x);c.push(k.y)}return c};c.prototype.DD=function(a){F.ha("getPathAsPoints",arguments,
T);var b=this.da.view.aa.za(a,!1);if(!b||"PathNode"!==b.type())return null;b=b.wn();for(var c=[],e=[],f=0;f<b.ga.length;){switch(b.ga[f]){case vc.Wc:c=[{x:b.ga[f+1],y:b.ga[f+2]}];e.push(c);break;case vc.Ld:c.push({x:b.ga[f+1],y:b.ga[f+2]})}f+=vc.Md[b.ga[f]]}return e};c.prototype.Zq=function(){return this.da.view.scale};c.prototype.JC=function(){var a=this.da.view.Ne(!1);return{translateX:this.da.view.Bb+a.x,translateY:this.da.view.Cb+a.y}};c.prototype.Ck=function(){var a=this.da.view.Ne(!0);return{width:a.width,
height:a.height}};c.prototype.gr=function(){var a=this.da.view.gr();return a?a.id:null};c.prototype.FD=function(a){var b={cid:a,ts:0,addedIDs:[]};return this.da.view.aa.yr(a,{Cu:function(a){b.addedIDs.push(a)},JG:function(a){b.ts=a}})?b:null};c.prototype.zn=function(a,b,c,e){F.ha("getScreenCoordinates",arguments,F.Number,F.Number,F.Qa,F.Qa);var d=this.da.view.Jg(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};var h=this.da.view.Jg(a+c,b+e);return this.uh(new K(d.x,d.y,h.x-d.x,h.y-d.y))};c.prototype.ID=
function(){return this.da.view.jf};c.prototype.Lk=function(){return this.da.view.Lk()};c.prototype.Hc=function(a){return this.da.view.Hc(qf(a))};c.prototype.qn=function(a,b){F.ha("getEditHandleType",arguments,T,Vh);var c=this.da.view.aa.Ob(a,!1);return c&&c.Zf()?c.qn(b):null};c.prototype.kG=function(a,b,c){F.ha("setEditHandle",arguments,T,Vh,F.String);var d=this.da.view.aa.za(a,!1);if(!d)return S("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return S("setEditHandle: node %s is not a PathNode.",
a),!1;d=d.ia("commands");d=O.Hz(d,b,c);if(!d)return S("setEditHandle: failed"),!1;this.ce(a,"commands",d);return!0};c.prototype.mc=function(a){void 0===a&&(a=!0);F.ha("getSelectedNodes",arguments,F.Nc);return this.da.view.Xd(a)};c.prototype.Vi=function(a){function b(a,b){var c=e.properties[a];void 0!==b&&(e.properties[a]=c!==b&&void 0!==c?null:b);e.empty=!1}function c(a){var c=a.Jo();e.types[c]=!0;e.types.AnyNode=!0;e.empty=!1;e.nodes.push(a.id);var d=a.hb();"PathNode"===c?(c=d.closed?"PathNode-closed":
"PathNode-open",e.types[c]=!0):"HTMLNode"===c&&(e.types[d.$component]=!0);d=a.hb();"TextNode"===c&&(d["border-color"]=a.ia("border-color"),d["border-width"]=a.ia("border-width"),d.underline=a.ia("underline"),d.background=a.ia("background")||"transparent",d.textFillStyle=a.ia("fillStyle"));if("GroupNode"!==c)for(var h in d)d.hasOwnProperty(h)&&"matrix"!==h&&("BrushNode"!==c||"fillStyle"!==h)&&("PathNode-open"!==c||"fontSize"!==h&&"fontName"!==h&&"fillStyle"!==h)&&("PathNode-closed"!==c||(f&&d.text||
"fontSize"!==h&&"fontName"!==h)&&"arrowSize"!==h&&"arrowStyle"!==h)&&b(h,d[h])}void 0===a&&(a=this.mc(!1));F.ha("getPropertySummary",arguments,Uh);for(var e={properties:{},types:{},nodes:[],empty:!0},f=this.da.fa.get("allowTextInShape"),h=0;h<a.length;h++){var k=this.da.view.aa.za(a[h],!1);k&&(N(k)&&c(k),this.da.view.aa.tk(c,k))}!e.nodes.length||"opacity"in e.properties||e.properties.spotHighlight||(e.properties.opacity=1);if(this.da.view.ta.Pg){h=this.da.view.ta.Pg();for(var l in h)b(l,h[l])}if(this.da.view.ta.Oh)for(h=
0,k=this.da.view.ta.Oh();h<k.length;h++)e.types[k[h]]=!0;h=0;for(l in e.types){switch(l){case "AnyNode":case "PathNode-open":case "PathNode-closed":continue}h++}1===h&&e.types.TextNode&&0===e.properties.lineWidth&&delete e.properties.strokeStyle;return e};c.prototype.iw=function(){return this.uh(this.da.view.$b())};c.prototype.QD=function(a){F.ha("goToRevision",arguments,F.cb(F.String,F.sh));this.da.view.aa.Cr(a);this.eh(this.da.view.aa.Vh);this.yj("readOnly",this.da.view.aa.locked())};c.prototype.hasFocus=
function(){return this.da.hasFocus()};c.prototype.gb=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));b=c.join("");S(b);console.log(b);throw Error(b);};c.prototype.mj=function(a){return E.mj(a)};c.prototype.ZD=function(a,b,c){var d=this;void 0===a&&(a={});F.ha("insertImage",arguments,F.qd,F.Qa,F.Qa);return new Promise(function(e){d.Fa()||(a=d.vc(a),a.url?d.da.view.ho(a,b,c).then(e):
d.mj({accept:"image/*",format:"File"}).then(function(f){var h=d.da.view.$b().me();if(!1===d.Nb("paste",f.data,h.x,h.y))S("paste of file is cancelled by external app.");else{var l=new FileReader;l.readAsDataURL(f.data);l.onloadend=function(){d.da.view.ho(dd(a,{url:l.result}),b,c).then(e)}}}))})};c.prototype.Uk=function(a,b,c){void 0===a&&(a=this.yc());F.ha("insertPage",arguments,F.ge,F.Qa,F.Qa);if(this.Fa())return this.yc();var d={background:this.Zb("background")};Zg(b)&&Zg(c)&&(d.width=b,d.height=
c);this.$e(function(b){return b.createNode("PageNode",d,b.root.id,a)});return a};c.prototype.Vn=function(a){F.ha("isLayerVisible",arguments,F.String);return this.da.view.aa.Vn(a)};c.prototype.Th=function(a){F.ha("isNodeSelected",arguments,T);var b=this.da.view.aa.Ob(a);return null!==b&&this.da.view.Th(b)};c.prototype.rf=function(a,b){F.ha("isPointOverCanvas",arguments,F.Number,F.Number);return this.da.view.rf(a,b)};c.prototype.iE=function(a,b,c){void 0===c&&(c=-1);F.ha("isPointOverHandle",arguments,
F.Number,F.Number,F.Qa);0>c&&(console.warn("IsPointOverHandle using default radius; please use getTouchRadius(event)"),c=12/this.da.view.scale);if(null!==this.da.view.lr(a,b,!1)||null!==this.da.view.ya&&null!==this.da.view.ya.bg(a,b,c,this.da.view.scale))return!0;var d=this.da.view.aa.Db(a,b,c,this.da.view.scale,this.da.view.Ub).node;return d&&0!=(d.jb&16)&&d.bg(a,b,c,this.da.view.scale)?!0:!1};c.prototype.load=function(a,b){F.ha("load",arguments,F.String,F.Wa(F.cb(F.String,F.Object)));void 0===b&&
(b=a);var c=Ah.yi(b,this.da.Yf(),this.da.vj,this.Pf,this.da.view.ma,this.da.view.request);if(c)return this.Zo(),this.da.ri(c),this.ua("document-opened"),!0;S("load(): Could not open file.");return!1};c.prototype.ao=function(a){F.ha("lockUpdates",arguments,F.Number);var b=this;Zg(a)?(this.Zr&&clearTimeout(this.Zr),this.Zr=setTimeout(function(){b.da.view.ao(!1)},a),b.da.view.ao(!0)):this.gb("lockUpdates: Expected a number")};c.prototype.bl=function(a){F.ha("markChangesSent",arguments,F.String);if(this.Yh||
a){if(!this.Yh||a!==this.Yh.toString())throw Error("markChangesSent: does not match last getLocalChanges()");S("Mark changes sent!");this.da.view.aa.vb.bl(this.Yh.mE);this.Yh=null}};c.prototype.yE=function(a){void 0===a&&(a=this.mc());F.ha("moveDown",arguments,Uh);this.Fa()||this.da.view.Sd(3,Rh(a))};c.prototype.zE=function(a,b){F.ha("movePage",arguments,F.cc,F.cc);if(!this.Fa()){var c=this.ob();if(0>a||a>=c)this.gb("From page must be > 0 and less than getPageCount()");else if(0>b||b>=c)this.gb("From page must be > 0 and less than getPageCount()");
else{var e=this.Ik(a);null!==e&&this.$e(function(a){return a.Sd([e],4,b)})}}};c.prototype.AE=function(a){void 0===a&&(a=this.mc());F.ha("moveUp",arguments,Uh);this.Fa()||this.da.view.Sd(2,Rh(a))};c.prototype.bs=function(){this.Zo();this.da.bs();this.wx()};c.prototype.nextPage=function(){this.eh(Math.min(this.yc()+1,this.ob()-1))};c.prototype.pa=function(a,b){F.ha("on",arguments,F.String,F.Function);this.fa.has(a)?this.fa.pa(a,b):"draw"===a?this.gf=b:a in this.sb?this.sb[a].push(b):this.sb[a]=[b];
return this};c.prototype.RE=function(a){var b=this;F.ha("onComplete",arguments,F.Function);this.da.view.aa.format(this.da.view.ma,this.da.view.request,!0);this.da.view.wC(function(){a();b.digest()})};c.prototype.wx=function(){var a=this.da.fa.get("defaultPaperSize");S("onNewDocument()");"none"!==a&&this.$s(a);this.ua("document-opened")};c.prototype.YE=function(a){var b=this;F.ha("openFromComputer",arguments,F.String);return this.mj({accept:"."+a,format:"text"}).then(function(a){if("string"===typeof a.data&&
b.load(a.data))return b;throw Error("Could not open the file.");})};c.prototype.sl=function(a){F.ha("paste",arguments,F.dc);return this.Fa()?[]:this.da.view.sl(a)};c.prototype.jF=function(a){F.ha("pauseSharedSession",arguments,F.Boolean);this.ec&&this.ec.DG(a)};c.prototype.nF=function(){this.eh(Math.max(this.yc()-1,0))};c.prototype.print=function(a,b){F.ha("print",arguments,F.Wa(F.cb(F.cc,F.yz)),F.Wa(Wh));var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(Zg(a[e]))c.push(a[e]);
else{this.gb("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.ob();e++)c.push(e);var f=b?this.Vj(b):this.Vj(this.Ri());var h=this.yc(),k=document.createElement("canvas");k.width=f.width;k.height=f.height;var l=k.getContext("2d");l.translate(-f.x,-f.y);e=window.location.hostname;var n=window.open("about:blank","_blank");n.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.eh(c[e]),this.da.view.Rf(l,1,f.x,f.y,f.width,
f.height,1,0,0),this.da.view.aa.ka(l),0<e?n.document.write("<div style='page-break-before:always'>"):n.document.write("<div>"),n.document.write("<img style='width:100%' src='"),n.document.write(k.toDataURL()),n.document.write("'></div>"),l.clearRect(f.x,f.y,f.width,f.height);n.document.write("</body></html>");n.document.close();setTimeout(function(){n.focus();n.print();setTimeout(function(){n.close()},1E3)},1E3);this.eh(h)};c.prototype.Fa=function(){return this.da.fa.get("readOnly")?(S("readOnly; ignore tool click."),
!0):!1};c.prototype.We=function(){this.ti(!1);this.da.view.We()};c.prototype.gd=function(a){F.ha("redraw",arguments,F.wg);this.da.view.ka(a)};c.prototype.removeEventListener=function(a,b){this.removeListener(a,b)};c.prototype.removeListener=function(a,b){F.ha("removeListener",arguments,F.String,F.Function);if(this.fa.has(a))this.fa.removeListener(a,b);else if("draw"===a)this.gf===b&&(this.gf=null);else if(a in this.sb){for(var c=this.sb[a],e=0;e<c.length;e++)if(c[e]===b){c.splice(e,1);break}0===c.length&&
delete this.sb[a]}};c.prototype.resize=function(a){var b=this;void 0===a&&(a=!0);return this.Is?this.Hs:this.Hs=new Promise(function(c){b.Is=requestAnimationFrame(function(){b.Mi||(b.Is=0,b.Hs=null,b.da.Wj(a),c())})})};c.prototype.save=function(a,b,c){if("object"!==typeof a){F.ha("save",arguments,F.dc,F.Wa(Wh),F.Qa);var d={format:a||"zwibbler3",rect:b,maxWidth:c}}else F.ha("save",arguments,ai),d=a;var f=d.format||"zwibbler3";f={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",
pdf:"application/pdf"}[f]||f;var h=d.rect,k=d.maxWidth||0;if(void 0!==d.pages)var l=d.pages;else if(void 0!==d.page)l=[d.page];else if("application/pdf"===f){l=[];for(var n=0;n<this.ob();n++)l.push(n)}else l=[this.yc()];h=this.Vj(h||this.Ri());switch(f){case "list":return Ah.Cp(this.da.view.aa,"list","object");case "image/png":case "image/jpeg":case "image/bmp":case "image/svg+xml":case "application/pdf":return this.da.QF(f,h,k,l,d.encoding||"data-uri");case "zwibbler3":case "changedata":return Ah.Cp(this.da.view.aa,
f,d.encoding||"string");default:return"Unsupported format: "+f}};c.prototype.zb=function(a){F.ha("setCursor",arguments,F.String);this.da.view.zb(a)};c.prototype.de=function(a,b){F.ha("setToolProperty",arguments,F.String,F.ph);this.setProperty(a,b)};c.prototype.ru=function(a){for(var b=[],c=0;c<a.length;c++){var e=this.da.view.aa.Ob(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){F.ha("selectNodes",arguments,Th);var b=this.ru(Rh(a));this.da.view.selectNodes(b);this.da.view.xc();
this.da.view.ka()};c.prototype.ZF=function(a){F.ha("sendToBack",arguments,Uh);if(!this.Fa()){var b=Rh(a||this.mc());this.$e(function(a){return a.Sd(b,1)})}};c.prototype.Oo=function(a){F.ha("setActiveLayer",arguments,F.String);this.da.view.Oo(a)};c.prototype.yj=function(a,b){F.ha("setConfig",arguments,F.String,F.ph);"defaultPaperSize"===a&&this.$s(b);return this.da.fa.set(a,b)};c.prototype.ju=function(a,b){b=this.Nb("colour-clicked",a,b);void 0===b?b=a:b||(b="");return b};c.prototype.pi=function(a,
b){F.ha("setColour",arguments,F.String,F.Boolean);this.setProperty(b?"fillStyle":"strokeStyle",a);return!1};c.prototype.eh=function(a){F.ha("setCurrentPage",arguments,F.cc);a!==this.yc()&&this.da.view.ti(!0);this.da.view.jd(a)};c.prototype.Dl=function(a){F.ha("setCustomBackgroundFn",arguments,F.Function);this.da.view.Dl(a)};c.prototype.fG=function(a){F.ha("useCustomTool",arguments,F.Object);this.Xb=new If(this.da.view,a)};c.prototype.gG=function(a){F.ha("setCustomSelectionRectangleFn",arguments,F.cb(F.Function,
F.sh));this.xq=a;this.gd()};c.prototype.iG=function(a,b){F.ha("setDocumentProperty",arguments,F.String,F.Ez);this.da.view.aa.setProperty(a,b)};c.prototype.zj=function(a,b){F.ha("setDocumentSize",arguments,F.cb(F.Number,F.sh),F.cb(F.Number,F.sh));this.da.view.zj(a,b,!0)};c.prototype.qy=function(a,b){F.ha("setDocumentSizeInTransaction",arguments,F.cb(F.Number,F.sh),F.cb(F.Number,F.sh));this.da.view.zj(a,b,!1)};c.prototype.sy=function(a,b){F.ha("setDomElement",arguments,T,F.HTMLElement);var c=this.da.view.aa.za(a);
c?("DomNode"!==c.type()&&this.gb("setDomElement: Node %s is not a DomNode. It is %s",a,c.type()),c.lG(b),this.da.Um.push(b)):this.gb("setDomElement: Node %s does not exist",a)};c.prototype.jG=function(a,b){return this.sy(a,b)};c.prototype.Tz=function(){function a(a){a.preventDefault();if(!e.da.view.rf(a.pageX,a.pageY))S("Ignore drop event -- not over canvas");else if(e.Zb("readOnly"))S("Ignore drop event -- readOnly mode");else if(a.dataTransfer){try{var b=JSON.parse(a.dataTransfer.getData("text"))}catch(u){}if("object"===
typeof b&&b["zwibbler-src"]){var c=parseFloat(b["zwibbler-width"]),d=parseFloat(b["zwibbler-size"]),f=b["zwibbler-src"];b=b["zwibbler-props"];S("DragDrop received with src=%s size=%s",f,c);c&&(b.width=c);d&&(b.width=b.height=d);f&&(b.url=f,a=e.Dk(a.pageX,a.pageY),e.da.view.ho(b,a.x,a.y))}else if(a.dataTransfer.items)for(c=0;c<a.dataTransfer.items.length;c++){if("file"===a.dataTransfer.items[c].kind){e.da.view.xs(a.dataTransfer.items[c],a.pageX,a.pageY);break}}else for(c=0;c<a.dataTransfer.files.length;){e.da.view.xs(a.dataTransfer.files[c],
a.pageX,a.pageY);break}}}function b(a){e.da.view.rf(a.pageX,a.pageY)?a.preventDefault():S("Ignore drag event -- not over canvas")}function c(){f&&(f=!1,document.removeEventListener("dragover",b),document.removeEventListener("drop",a))}var e=this;S("Setting up dragdrop");var f=!1;this.Aa.add(c);this.fa.pa("allowDragDrop",function(d){d?f||(f=!0,document.addEventListener("dragover",b),document.addEventListener("drop",a)):c()})};c.prototype.WC=function(a){F.ha("getDomElement",arguments,T);var b=this.da.view.aa.za(a);
return b?Tc(b)?b.ea:(this.gb("getDomElement: Node %s is not a DomNode. It is %s",a,b.type()),null):(this.gb("getDomElement: Node %s does not exist",a),null)};c.prototype.cw=function(a){for(F.ha("getNodeFromElement",arguments,F.HTMLElement);a;){var b=a.getAttribute("nid");if(b)return b;a=a.parentElement}return null};c.prototype.un=function(a){F.ha("getNodeObject",arguments,T);var b=this.da.view.aa.za(a);return b?b.Wi({ctx:this}):null};c.prototype.vG=function(a,b){F.ha("setLayerName",arguments,F.String,
F.String);Yg(a)&&Yg(b)?(this.Uq()===a&&this.Oo(b),this.da.view.aa.wd(!1,function(c){c.Gc()===a&&c.setProperty("layer",b)})):this.gb("setLayerName() needs string arguments.")};c.prototype.BG=function(a,b){F.ha("setPageBackground",arguments,F.cc,F.String);var c=this.Ik(a);c&&this.ce(c,"background",b)};c.prototype.$s=function(a,b){F.ha("setPaperSize",arguments,F.cb(F.Number,F.String),F.Wa(F.cb(F.Number,F.Boolean)));var c=null,e=null,f=null,h=!0,k=!1;if(2===arguments.length)Zg(arguments[0])&&Zg(arguments[1])?
(f=arguments[0],c=arguments[1]):Yg(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],k=arguments[1]):h=!1;else if(1===arguments.length&&Yg(arguments[0]))for(var l=arguments[0].split(" "),n=0;n<l.length;n++)"landscape"===l[n]?k=!0:"portrait"===l[n]?k=!1:e=l[n];if(!1===h)return S("Bad arguments to setPaperSize()."),!1;if(null===e)return this.zj(f,c),!0;switch(e.toLowerCase()){case "letter":f=816;c=1056;break;case "legal":f=816;c=1344;break;case "11x17":f=1056;c=1632;break;case "tabloid":f=
1056;c=1632;break;case "a0":f=841/25.4*96;c=1189/25.4*96;break;case "a1":f=594/25.4*96;c=841/25.4*96;break;case "a2":f=420/25.4*96;c=594/25.4*96;break;case "a3":f=297/25.4*96;c=420/25.4*96;break;case "a4":f=210/25.4*96;c=297/25.4*96;break;case "none":c=f=null;break;default:return S("Invalid paper size: %s",e),!1}k&&(e=f,f=c,c=e);this.zj(f,c);return!0};c.prototype.sG=function(a,b,c){this.ce(a,b,c)};c.prototype.Po=function(a,b){F.ha("setDrawOrder",arguments,Th,F.cc);this.Fa()||(0>b&&(b=0),this.$e(function(c){return c.Sd(Rh(a),
4,b)}))};c.prototype.Ab=function(a,b){F.ha("setNodeProperties",arguments,Th,F.Object);this.Fa()||this.da.Ab(Rh(a),this.vc(b))};c.prototype.ce=function(a,b,c){F.ha("setNodeProperty",arguments,Th,F.String,F.ph);if(!this.Fa()){c=ci(b,c);var d={};d[b]=c;this.Ab(a,d)}};c.prototype.zG=function(a,b){F.ha("setNodeVisibility",arguments,Th,F.Boolean);for(var c=Rh(a),e=0;e<c.length;e++){var f=this.da.view.aa.Ob(c[e],!0);if(f&&(f.gh(!b),Tc(f))){var h=f.parent;Tc(h)&&h.Jl(h.te(f),b)}}this.da.view.ka()};c.prototype.Ay=
function(a,b){F.ha("setOpacity",arguments,F.Number,F.Boolean);this.Fa()||this.da.view.VE(a,b)};c.prototype.CG=function(a,b,c,e,f){F.ha("setPageSize",arguments,F.cc,F.Number,F.Number,F.Qa,F.Qa);var d=0,k=0;if(5===arguments.length){d=b;k=c;var l=e;var n=f}else l=b,n=c;var r=this.Ik(a);r?this.Ab(r,{x:d,y:k,width:l,height:n}):this.gb("setPageSize: no such page %s",a)};c.prototype.Zs=function(a){F.ha("setPageView",arguments,F.Boolean);this.da.view.Zs(a)};c.prototype.Qb=function(a){F.ha("setProperties",
arguments,F.Object);if(!this.Fa()){this.Ab(this.mc(),a);for(var b in a){var c=a[b];if("strokeStyle"===b||"fillStyle"===b)c=this.ju(c,"fillStyle"===b)||c;this.da.view.de(b,c);"lineWidth"===b&&"brush"===this.Kh()?this.yj("defaultBrushWidth",ci(b,c)):this.da.view.Cf(b,ci(b,c))}}};c.prototype.setProperty=function(a,b){F.ha("setProperty",arguments,F.String,F.ph);var c={};c[a]=b;this.Qb(c)};c.prototype.setInterval=function(a,b){a=setInterval(a,b);this.Qn.add(a);return a};c.prototype.tg=function(a,b){F.ha("setTemporaryProperties",
arguments,Th,F.Object);if(!this.Fa()){var c=this.da.view.aa.tg(Rh(a),b),e;for(e in c)this.Cj("_TP:"+e,c,!1)}};c.prototype.IG=function(a,b,c){F.ha("setTemporaryProperty",arguments,Th,F.String,F.ph);if(!this.Fa()){var d={};d[b]=c;this.tg(a,d)}};c.prototype.Oz=function(){var a=this,b=/^_TP:([^:]*)/;this.pa("set-keys",function(c){for(var d=0;d<c.length;d++){var f=c[d],h=b.exec(f);h&&(h=h[1],null!==f.value?a.da.view.aa.tg([h],f.value):a.da.view.aa.Hi([h]))}})};c.prototype.setTimeout=function(a,b){var c=
this,e=setTimeout(function(){c.Pl.delete(e);a()},b);this.Pl.add(e);return e};c.prototype.LG=function(a,b){void 0===b&&(b=!0);F.ha("setViewRectangle",arguments,Wh,F.Nc);0!==a.width&&0!==a.height||this.gb("setViewRect: width and height must be non-zero.");this.da.view.Gd(this.Vj(a),!1,!1,b)};c.prototype.Ae=function(a,b,c){F.ha("setZoom",arguments,F.cb(F.String,F.Number),F.Qa,F.Qa);if(!Zg(a)&&"page"!==a&&"width"!==a)S("setZoom: invalid parameter.");else if("string"==typeof a)this.da.view.Ae(a);else if("number"===
typeof a){var d=this.Zq()/a,f=this.da.view.$b();if("number"!==typeof b||"number"!==typeof c)b=f.x+f.width/2,c=f.y+f.height/2;f.transform(new lc(d,d,b,c));this.da.view.Gd(f)}};c.prototype.Kl=function(a,b){void 0===b&&(b=!0);F.ha("showLayer",arguments,F.String,F.Boolean);this.da.view.Kl(a,b)};c.prototype.Ib=function(a,b,c){F.ha("snap",arguments,F.Number,F.Number,F.cb(F.Qa,F.qd));var d=this.da.view.Ib(new J(a,b),c||this.fa.get("snap"));return{x:d.x,y:d.y}};c.prototype.ti=function(a){return this.da.view.ti(a)};
c.prototype.Tn=function(){return E.Tn()};c.prototype.jH=function(){return this.da.view.aa.toString()};c.prototype.Ql=function(a){F.ha("toggleFullScreen",arguments,F.Wa(F.cb(F.String,F.HTMLElement)));a?(a=B.Fc(a))||this.gb("toggleFullScreen: can't find element from "+a):a=this.Fc();a.style.backgroundColor=q.Od;E.Ql(a)};c.prototype.Lj=function(a,b,c){F.ha("translateNode",arguments,Th,F.Number,F.Number);if(this.Fa())return!1;S("Translate node %s by %s,%s",a,b,c);return this.da.Lj(Rh(a),b,c)};c.prototype.wl=
function(a){F.ha("removePanel",arguments,F.HTMLElement);this.da.wl(a)};c.prototype.Cs=function(){this.da.view.Cs()};c.prototype.LF=function(a){F.ha("rotateDocument",arguments,F.Number);if(!this.Fa()){var b=0===Math.round(a/(Math.PI/2))%2;this.aq();for(var c=0;c<this.ob();c++)this.fy(c,a);b||(b=this.da.view.aa.ia("width"),c=this.da.view.aa.ia("height"),b&&c||!this.Zb("pageView")||(b=wh.width,c=wh.height),b&&c&&this.qy(c,b));this.lq()}};c.prototype.ey=function(a,b,c,e){F.ha("rotateNode",arguments,Th,
F.Number,F.Qa,F.Qa);if(this.Fa())return!1;S("Rotate nodes by %s around (%s,%s)",b/Math.PI*180,c,e);for(var d=4===arguments.length,h=Rh(a),k=new J(0,0),l=0;l<h.length;l++){var n=h[l],r=this.da.view.aa.Ob(n);r&&(r||d)?!d&&r&&(n=r.rect.me(),k.x+=n.x,k.y+=n.y):S("rotateNode: Node %s does not exist",n)}d?(k.x=c,k.y=e):(k.x/=h.length,k.y/=h.length);d=new kc(b,k.x,k.y);return this.da.transformNode(h,d)};c.prototype.fy=function(a,b){F.ha("rotatePage",arguments,F.cc,F.Number);a>=this.ob()&&this.gb("rotatePage: page "+
a+" does not exist.");if(!this.Fa()){var c=Math.round(b/(Math.PI/2));b=c*Math.PI/2;var e=0===c%2;this.aq();c=this.yc();this.eh(a);var f=this.Vq(),h=this.Ri(),k=h.width/2,l=h.height/2;this.ey(f,b,k,l);e||this.Lj(f,l-k,k-l);e=this.Ik(a);this.Ab(e,{width:h.height,height:h.width});this.eh(c);this.lq()}};c.prototype.Ns=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);F.ha("scaleNode",arguments,Th,F.Number,F.Number,F.Qa,F.Qa);0!==b&&0!=c||this.gb("scaleNode("+a+", "+b+", "+c+") cannot scale by a zero-value.");
if(this.Fa())return!1;S("Scale node %s by %s,%s",a,b,c);return this.da.Ns(Rh(a),b,c,e,f)};c.prototype.Ys=function(a,b,c,e,f,h,k){F.ha("setNodeTransform",arguments,Th,F.Number,F.Number,F.Number,F.Number,F.Number,F.Number);if(this.Fa())return!1;S("setNodeTransform(id=%s %s %s %s %s %s %s %s)",a,b,c,e,f,h,k);return this.da.Ys(Rh(a),b,c,e,f,h,k)};c.prototype.Gy=function(a,b,c){var d=this;F.ha("showColourPicker",arguments,F.cb(F.String,F.Number),F.Number,F.Qa);if(!this.Yg){var f=document.createElement("div");
f.style.width="320px";f.style.lineHeight="0";f.style.position="absolute";f.style.webkitUserSelect="none";f.style.userSelect="none";f.style.boxShadow="2px 2px 2px rgba(0,0,0.2)";f.style.background="white";var h=this;this.Sv(f,20,{onColour:function(a,b){if(h.Jm)h.Jm(a),h.digest();else if(a=h.ju(a,b))for(var c=0,d=h.$u.split(",");c<d.length;c++){var e=d[c];""===e&&b?e="fillStyle":""!==e||b||(e="strokeStyle");h.setProperty(e,a)}}});this.Yg=E.vp(f);this.Aa.add(function(){d.Yg&&(d.Yg.destroy(),B(f).remove(),
d.Yg=null)})}this.Jm=null;if("string"===typeof a)this.$u=a,this.Yg.show(b,c,!0);else return c=b,b=a,new Promise(function(a){d.Jm=a;d.Yg&&d.Yg.show(b,c,!0)})};c.prototype.vB=function(a){void 0===a&&(a=Hh(32));F.ha("createSharedSession",arguments,F.dc);S("Creating shared session "+a);this.lu(a,2);return a};c.prototype.lu=function(a,b){var c=this;S("Attach to shared session %s, creating=%s",a,b);if(3>this.da.fa.get("collaborationProtocolVersion")&&255<Sa(a).length)throw Error("Shared session name is too long. You must use V3 version of the collaboration protocol.");
this.ec&&this.ec.stop();this.da.view.aa.vb.HF();this.zy(!0);return new Promise(function(d,f){var e=c.da.fa.get("collaborationServer");"custom"!==e?(e=new Fb(c,e.replace("{name}",a),c.Zb("latency"),E.WebSocket,c.Zb("collaborationProtocolVersion"),c.Zb("maxReconnectSeconds")),c.ec=e,e.pa("connected",function(){c.ua("connected");c.zy(!1);var a=0,b;for(b in c.hg)a++,S("Sending non-persistent key %s",b),c.el[b]=c.hg[b];a&&c.ua("local-keys");c.digest()}),e.pa("connect-error",function(){c.ua("connect-error");
c.digest()}),e.pa("broadcast",function(a){c.ua("broadcast",a);c.digest()}),e.pa("set-keys",function(a){c.ua("set-keys",a)}),e.start(a,b).then(function(){S("Session resolved");d(a)},function(a){S("Error joining session: %s",a.message);f(a)})):d(a);return a})};c.prototype.jE=function(a,b){void 0===a&&(a="");void 0===b&&(b=!1);F.ha("joinSharedSession",arguments,F.dc,F.Nc);return this.lu(a,b?0:1).then(function(){S("Successfully connected to session.")},function(a){console.log("Error connecting to session:",
a);throw a;})};c.prototype.Zo=function(){this.Tw()};c.prototype.Tw=function(){this.ec&&(this.ec.stop(),this.ec=null,this.ua("disconnected"))};c.prototype.LD=function(){return this.ec?this.ec.sv:""};c.prototype.bw=function(){var a=[],b;for(b in this.el)a.push(this.el[b]);this.el={};return a};c.prototype.pD=function(){var a=[],b;for(b in this.hg)a.push(this.hg[b]);return a};c.prototype.KD=function(){var a=[];if(this.ec){var b=this.ec.keys,c;for(c in b)if(!(c in this.hg)){var e=b[c];a.push({name:e.name,
value:e.value})}}for(var f in this.hg)e=this.hg[f],a.push({name:e.name,value:e.value});return a};c.prototype.nd=function(){this.Fa()||(this.ti(!1),this.da.view.nd())};c.prototype.Nj=function(a){void 0===a&&(a=this.mc());F.ha("ungroup",arguments,Uh);this.Fa()||this.$e(function(b){b.Nj(Rh(a))})};c.prototype.upload=function(a,b){function c(){}function e(){}void 0===b&&(b="Working");F.ha("upload",arguments,F.bm(HTMLFormElement),F.dc);var f=this.da.uB(b),h=new XMLHttpRequest,k=new FormData(a);h.upload.addEventListener("progress",
function(a){f.update(a.loaded/a.total)},!1);h.addEventListener("load",function(){200===h.status?(f.done(),e(h.response,h)):(f.error("Error"),c(h))},!1);h.addEventListener("error",function(){f.error("Error");c(h)},!1);h.addEventListener("abort",function(){f.error("Aborted");c(h)},!1);h.open(a.method,a.action);h.send(k);var l={success:function(a){e=a;return l},error:function(a){c=a;return l}};return l};c.prototype.BH=function(a,b){F.ha("useArrowTool",arguments,F.qd,F.cb(F.Nc,Zh));if(!this.Fa()){var c=
bi(b,this.fa),e=c.Ky,f=c.Lm,h=c.open;c=c.cf;this.da.view.tA(this.vc(a),e,f,h,c)}};c.prototype.CH=function(a,b){this.Fa()||(2===arguments.length?(F.ha("useBrushTool",arguments,F.String,F.Number),this.da.view.Cq({lineWidth:b,strokeStyle:a})):1===arguments.length?(F.ha("useBrushTool",arguments,F.Object),this.da.view.Cq(this.vc(arguments[0]))):this.da.view.Cq({}))};c.prototype.DH=function(a,b){F.ha("useCircleTool",arguments,F.qd);this.Fa()||this.da.view.kp(this.vc(a),this.yg(b))};c.prototype.EH=function(a){F.ha("useCurveTool",
arguments,F.qd);this.Fa()||this.da.view.hv(this.vc(a))};c.prototype.FH=function(a){F.ha("useCustomTool",arguments,F.Object);if(!this.Fa())if($g(a)){var b=new If(this.da.view,a);this.da.view.Xa(b)}else this.gb("useCustomTool(): requires an object as argument.")};c.prototype.Bt=function(a){F.ha("useEditHandleTool",arguments,T);this.Fa()||this.da.view.Bt(a)};c.prototype.kp=function(a,b){void 0===a&&(a={});F.ha("useEllipseTool",arguments,F.qd);this.Fa()||this.da.view.kp(this.vc(a),this.yg(b))};c.prototype.HH=
function(a,b,c){void 0===c&&(c="freehand");F.ha("useFreehandTool",arguments,F.Wa(F.cb(F.String,F.Object)),F.Wa(F.cb(F.Number,F.String)),F.dc);if(!this.Fa()){if($g(arguments[0])){var d=this.vc(arguments[0]);c=arguments[1]||"freehand"}else d={strokeStyle:a||this.Lk(),lineWidth:b||this.Zb("defaultLineWidth")};this.da.view.tv(d,c)}};c.prototype.RH=function(a,b){void 0===b&&(b=!0);F.ha("useStampTool",arguments,F.cb(F.String,F.Object),F.Nc);if(!this.Fa()){var c=a;Yg(a)?c={url:a}:"url"in c||this.gb("useStampTool: missing url in properties");
this.da.view.IH(this.vc(c),1===arguments.length||!0===b)}};c.prototype.JH=function(a,b){F.ha("useLineTool",arguments,F.Wa(F.Object),F.Wa(F.cb(F.Boolean,Zh)));if(!this.Fa()){var c=bi(b,this.fa),e=c.Ky,f=c.Lm,h=c.open;c=c.cf;this.da.view.Vw(this.vc(a),e,f,h,c)}};c.prototype.KH=function(){this.da.view.bF()};c.prototype.LH=function(){this.da.view.Hb()};c.prototype.Ct=function(a,b,c,e,f){void 0===c&&(c=1);void 0===e&&(e={});F.ha("usePolygonTool",arguments,F.cc,F.Qa,F.Qa,F.qd);this.Fa()||this.da.view.Ct(a,
b,c,this.vc(e),this.yg(f))};c.prototype.MH=function(a){void 0===a&&(a={});F.ha("useQuadraticBezierTool",arguments,F.qd);this.Fa()||this.da.view.tv(this.vc(a),"quadratic")};c.prototype.Ul=function(a,b){void 0===a&&(a={});F.ha("useRectangleTool",arguments,F.qd,F.Wa(Yh));this.Fa()||this.da.view.Ul(this.vc(a),this.yg(b))};c.prototype.NH=function(a,b){void 0===a&&(a={});F.ha("useRoundRectTool",arguments,F.qd,F.Wa(Yh));this.Fa()||this.da.view.Ul(dd({roundRadius:this.da.fa.get("defaultRoundRectRadius")},
a),this.yg(b))};c.prototype.PH=function(a,b){F.ha("useShapeBrushTool",arguments,F.Wa(F.cb(F.Object,F.String)),F.Qa);if(!this.Fa()){var c={};$g(a)?c=this.vc(a):Yg(a)&&(c.stokeStyle=a);Zg(b)&&(c.lineWidth=b);this.da.view.UB(c)}};c.prototype.Dt=function(a,b,c,e,f,h){F.ha("useShapeTool",arguments,F.String,F.Object,F.Number,F.Number,F.Wa(F.cb(F.wi("rectangle","circle","rectangle-tl"),Yh)),F.Nc);if(!this.Fa()){b=this.vc(b);"SvgNode"===a&&"custom"===b.fillMode&&(b.fillStyle=b.fillStyle||this.da.view.sa.fillStyle,
b.strokeStyle=b.strokeStyle||this.da.view.sa.strokeStyle,"lineWidth"in b||(b.lineWidth=this.da.view.sa.lineWidth));if("object"===typeof f)var d=this.yg(f);else d=this.yg(),d.Lo=f,d.cf=h||!1;this.da.view.Dt(a,b,c,e,d)}};c.prototype.yg=function(a){void 0===a&&(a={});return{cf:"boolean"===typeof a.autoPickTool?a.autoPickTool:this.Zb("autoPickTool"),Lo:"string"===typeof a.dragStyle?a.dragStyle:this.Zb("drawShapeStyle"),hH:a.textEntry||!1}};c.prototype.QH=function(a,b){F.ha("useSquareTool",arguments,F.qd,
F.Wa(Yh));this.Fa()||this.da.view.Ul(this.vc(a),this.yg(b))};c.prototype.SH=function(a){F.ha("useTextTool",arguments,F.qd);this.Fa()||this.da.view.ot(this.vc(a))};c.prototype.qp=function(){this.da.view.qp()};c.prototype.rp=function(){this.da.view.rp()};return c}();
function ci(c,a){switch(c){case "lineWidth":case "fontSize":case "arrowSize":case "arrowXOffset":case "brightness":case "contrast":case "cloudRadius":case "gamma":case "opacity":case "snap":case "zIndex":"string"===typeof a&&(a=parseFloat(a));break;case "matrix":"[object Array]"===Object.prototype.toString.apply(a)&&"Matrix"===a[0]?(a.splice(0,1),a=new L(a)):a instanceof L||(a="object"===typeof a&&"m11"in a?new L(a.m11,a.m21,a.m12,a.m22,a.dx,a.dy):new L(a))}return a}
U.prototype.addKeyboardShortcut=U.prototype.Rp;U.prototype.addRemoteChanges=U.prototype.wh;U.prototype.attach=U.prototype.rd;U.prototype.abortTransaction=U.prototype.Yz;U.prototype.addGridColumn=U.prototype.Pp;U.prototype.addGridRow=U.prototype.Qp;U.prototype.addNodeToGrid=U.prototype.eA;U.setGridColumn=U.Ws;U.setGridRow=U.Xs;U.prototype.addSelectionHandle=U.prototype.je;U.prototype.addToGroup=U.prototype.Yj;U.prototype.addToLanguage=U.prototype.Sp;U.prototype.addPage=U.prototype.hA;
U.prototype.addPanel=U.prototype.Xj;U.prototype.alignNodes=U.prototype.pA;U.prototype.autoScroll=U.prototype.xA;U.prototype.begin=U.prototype.lb;U.prototype.beginTransaction=U.prototype.aq;U.prototype.bringToFront=U.prototype.IA;U.prototype.sendBroadcast=U.prototype.Us;U.prototype.setSessionKey=U.prototype.Cj;U.prototype.canRedo=U.prototype.Kf;U.prototype.canUndo=U.prototype.Lf;U.prototype.canMoveUp=U.prototype.LA;U.prototype.canMoveDown=U.prototype.KA;U.prototype.clearInterval=U.prototype.clearInterval;
U.prototype.clearTemporaryProperties=U.prototype.Hi;U.prototype.clearSelection=U.prototype.pb;U.prototype.clearTimeout=U.prototype.clearTimeout;U.prototype.clearUndo=U.prototype.VA;U.prototype.clickColour=U.prototype.WA;U.prototype.commit=U.prototype.Ea;U.prototype.commitIrreversibleTransaction=U.prototype.cB;U.prototype.commitTransaction=U.prototype.lq;U.prototype.computeHTMLRects=U.prototype.Km;U.prototype.copy=U.prototype.Ah;U.prototype.createDataNode=U.prototype.nB;U.prototype.createGroup=U.prototype.pB;
U.prototype.createLogger=U.prototype.rB;U.prototype.createNode=U.prototype.createNode;U.prototype.createHTMLNode=U.prototype.qB;U.prototype.createHTMLNodeFromDrag=U.prototype.qq;U.prototype.createPath=U.prototype.Mm;U.prototype.createGridNode=U.prototype.oB;U.prototype.createToolbar=U.prototype.wB;U.prototype.createShape=U.prototype.sq;U.prototype.cut=U.prototype.yq;U.prototype.decoration=U.prototype.Of;U.prototype.destroy=U.prototype.Sa;U.prototype.deleteGridColumn=U.prototype.zB;
U.prototype.deleteGridRow=U.prototype.BB;U.prototype.deleteNode=U.prototype.ff;U.prototype.deleteNodes=U.prototype.wc;U.prototype.deletePage=U.prototype.DB;U.prototype.deleteSelection=U.prototype.pv;U.prototype.dirty=U.prototype.Qf;U.prototype.dispatchEvent=U.prototype.dispatchEvent;U.prototype.mouseEvent=U.prototype.$r;U.prototype.keyboardEvent=U.prototype.kE;U.prototype.download=U.prototype.download;U.prototype.draw=U.prototype.ka;U.prototype.editNodeText=U.prototype.Xm;U.prototype.duplicate=U.prototype.duplicate;
U.prototype.emit=U.prototype.ua;U.prototype.emitNow=U.prototype.Nb;U.prototype.emitOnce=U.prototype.pe;U.prototype.skipEvent=U.prototype.WG;U.prototype.focus=U.prototype.focus;U.prototype.blur=U.prototype.blur;U.prototype.forEachNode=U.prototype.tC;U.prototype.findNode=U.prototype.pC;U.prototype.findNodes=U.prototype.Dv;U.prototype.flip=U.prototype.rC;U.prototype.flipNodes=U.prototype.zk;U.prototype.generatePalette=U.prototype.Sv;U.prototype.getActiveLayer=U.prototype.Uq;U.prototype.getAllNodes=U.prototype.Vq;
U.prototype.getBackgroundImage=U.prototype.GC;U.prototype.getBoundingRectangle=U.prototype.Yq;U.prototype.getConfig=U.prototype.Zb;U.prototype.getCurrentPage=U.prototype.yc;U.prototype.getCurrentFillColour=U.prototype.OC;U.prototype.getCurrentOutlineColour=U.prototype.PC;U.prototype.getCurrentTool=U.prototype.Kh;U.prototype.getCustomNode=U.prototype.QC;U.prototype.getDocumentCoordinates=U.prototype.Dk;U.prototype.getDocumentProperty=U.prototype.VC;U.prototype.getDocumentProperties=U.prototype.UC;
U.prototype.getDocumentSize=U.prototype.Ri;U.prototype.getElement=U.prototype.Fc;U.prototype.getFillColour=U.prototype.rn;U.prototype.getGridCell=U.prototype.cD;U.prototype.getGridSize=U.prototype.jr;U.prototype.getHistory=U.prototype.fD;U.prototype.getImageUrl=U.prototype.mr;U.prototype.getLanguageString=U.prototype.kD;U.prototype.getLocalChanges=U.prototype.sr;U.prototype.getDrawingRectangle=U.prototype.XC;U.prototype.getGroupParent=U.prototype.eD;U.prototype.getGroupMembers=U.prototype.dD;
U.prototype.getItemProperty=U.prototype.iD;U.prototype.getLayers=U.prototype.mD;U.prototype.getLayerNodes=U.prototype.lD;U.prototype.getNodeCoordinates=U.prototype.qD;U.prototype.getNodeIndex=U.prototype.sD;U.prototype.getDrawOrder=U.prototype.Xv;U.prototype.getNodePageNumber=U.prototype.mf;U.prototype.getNodeProperty=U.prototype.Ui;U.prototype.getNodeRectangle=U.prototype.Hk;U.prototype.getNodeScale=U.prototype.tD;U.prototype.getNodeTransform=U.prototype.uD;U.prototype.getNodeType=U.prototype.vD;
U.prototype.getNodesInRectangle=U.prototype.vn;U.prototype.getNodeUnderPoint=U.prototype.wD;U.prototype.getNodesUnderPoint=U.prototype.zD;U.prototype.getNodeVisibility=U.prototype.xD;U.prototype.getPageCount=U.prototype.ob;U.prototype.getPageNode=U.prototype.Ik;U.prototype.getPageRect=U.prototype.nf;U.prototype.getPathData=U.prototype.wn;U.prototype.getPathAsPoints=U.prototype.DD;U.prototype.getCanvasScale=U.prototype.Zq;U.prototype.getCanvasTranslate=U.prototype.JC;U.prototype.getCanvasSize=U.prototype.Ck;
U.prototype.getEditNode=U.prototype.gr;U.prototype.getRevisionInfo=U.prototype.FD;U.prototype.getScreenCoordinates=U.prototype.zn;U.prototype.getSelectedEditHandle=U.prototype.ID;U.prototype.getStrokeColour=U.prototype.Lk;U.prototype.getTouchRadius=U.prototype.Hc;U.prototype.getEditHandleType=U.prototype.qn;U.prototype.setEditHandle=U.prototype.kG;U.prototype.getSelectedNodes=U.prototype.mc;U.prototype.getPropertySummary=U.prototype.Vi;U.prototype.getViewRectangle=U.prototype.iw;
U.prototype.goToRevision=U.prototype.QD;U.prototype.hasFocus=U.prototype.hasFocus;U.prototype.openFile=U.prototype.mj;U.prototype.insertImage=U.prototype.ZD;U.prototype.insertPage=U.prototype.Uk;U.prototype.isLayerVisible=U.prototype.Vn;U.prototype.isNodeSelected=U.prototype.Th;U.prototype.isPointOverCanvas=U.prototype.rf;U.prototype.isPointOverHandle=U.prototype.iE;U.prototype.load=U.prototype.load;U.prototype.lockUpdates=U.prototype.ao;U.prototype.markChangesSent=U.prototype.bl;
U.prototype.moveDown=U.prototype.yE;U.prototype.movePage=U.prototype.zE;U.prototype.moveUp=U.prototype.AE;U.prototype.newDocument=U.prototype.bs;U.prototype.nextPage=U.prototype.nextPage;U.prototype.on=U.prototype.pa;U.prototype.onComplete=U.prototype.RE;U.prototype.openFromComputer=U.prototype.YE;U.prototype.paste=U.prototype.sl;U.prototype.pauseSharedSession=U.prototype.jF;U.prototype.previousPage=U.prototype.nF;U.prototype.print=U.prototype.print;U.prototype.redo=U.prototype.We;
U.prototype.redraw=U.prototype.gd;U.prototype.removeEventListener=U.prototype.removeEventListener;U.prototype.removeListener=U.prototype.removeListener;U.prototype.resize=U.prototype.resize;U.prototype.save=U.prototype.save;U.prototype.setCursor=U.prototype.zb;U.prototype.setToolProperty=U.prototype.de;U.prototype.selectNodes=U.prototype.selectNodes;U.prototype.sendToBack=U.prototype.ZF;U.prototype.setActiveLayer=U.prototype.Oo;U.prototype.setConfig=U.prototype.yj;U.prototype.setColour=U.prototype.pi;
U.prototype.setCurrentPage=U.prototype.eh;U.prototype.setCustomBackgroundFn=U.prototype.Dl;U.prototype.setCustomMouseHandler=U.prototype.fG;U.prototype.setCustomSelectionRectangleFn=U.prototype.gG;U.prototype.setDocumentProperty=U.prototype.iG;U.prototype.setDocumentSize=U.prototype.zj;U.prototype.setDocumentSizeInTransaction=U.prototype.qy;U.prototype.setDomElement=U.prototype.sy;U.prototype.setDomNode=U.prototype.jG;U.prototype.getDomElement=U.prototype.WC;U.prototype.getNodeFromElement=U.prototype.cw;
U.prototype.getNodeObject=U.prototype.un;U.prototype.setLayerName=U.prototype.vG;U.prototype.setPageBackground=U.prototype.BG;U.prototype.setPaperSize=U.prototype.$s;U.prototype.setItemProperty=U.prototype.sG;U.prototype.setDrawOrder=U.prototype.Po;U.prototype.setNodeProperties=U.prototype.Ab;U.prototype.setNodeProperty=U.prototype.ce;U.prototype.setNodeVisibility=U.prototype.zG;U.prototype.setOpacity=U.prototype.Ay;U.prototype.setPageSize=U.prototype.CG;U.prototype.setPageView=U.prototype.Zs;
U.prototype.setProperties=U.prototype.Qb;U.prototype.setProperty=U.prototype.setProperty;U.prototype.setTimeout=U.prototype.setTimeout;U.prototype.setTemporaryProperties=U.prototype.tg;U.prototype.setTemporaryProperty=U.prototype.IG;U.prototype.setViewRectangle=U.prototype.LG;U.prototype.setZoom=U.prototype.Ae;U.prototype.showLayer=U.prototype.Kl;U.prototype.snap=U.prototype.Ib;U.prototype.stopEditingText=U.prototype.ti;U.prototype.isFullscreenSupported=U.prototype.Tn;U.prototype.toDebugString=U.prototype.jH;
U.prototype.toggleFullscreen=U.prototype.Ql;U.prototype.translateNode=U.prototype.Lj;U.prototype.removePanel=U.prototype.wl;U.prototype.removeSelectionHandles=U.prototype.Cs;U.prototype.rotateDocument=U.prototype.LF;U.prototype.rotateNode=U.prototype.ey;U.prototype.rotatePage=U.prototype.fy;U.prototype.scaleNode=U.prototype.Ns;U.prototype.setNodeTransform=U.prototype.Ys;U.prototype.showColourPicker=U.prototype.Gy;U.prototype.createSharedSession=U.prototype.vB;U.prototype.joinSharedSession=U.prototype.jE;
U.prototype.stopSharing=U.prototype.Zo;U.prototype.leaveSharedSession=U.prototype.Tw;U.prototype.getSharedSessionName=U.prototype.LD;U.prototype.getNewLocalSessionKeys=U.prototype.bw;U.prototype.getLocalSessionKeys=U.prototype.pD;U.prototype.getSessionKeys=U.prototype.KD;U.prototype.undo=U.prototype.nd;U.prototype.ungroup=U.prototype.Nj;U.prototype.upload=U.prototype.upload;U.prototype.useArrowTool=U.prototype.BH;U.prototype.useBrushTool=U.prototype.CH;U.prototype.useCircleTool=U.prototype.DH;
U.prototype.useCurveTool=U.prototype.EH;U.prototype.useCustomTool=U.prototype.FH;U.prototype.useEditHandleTool=U.prototype.Bt;U.prototype.useEllipseTool=U.prototype.kp;U.prototype.useFreehandTool=U.prototype.HH;U.prototype.useStampTool=U.prototype.RH;U.prototype.useLineTool=U.prototype.JH;U.prototype.usePanTool=U.prototype.KH;U.prototype.usePickTool=U.prototype.LH;U.prototype.usePolygonTool=U.prototype.Ct;U.prototype.useQuadraticBezierTool=U.prototype.MH;U.prototype.useRectangleTool=U.prototype.Ul;
U.prototype.useRoundRectTool=U.prototype.NH;U.prototype.useShapeBrushTool=U.prototype.PH;U.prototype.useShapeTool=U.prototype.Dt;U.prototype.useSquareTool=U.prototype.QH;U.prototype.useTextTool=U.prototype.SH;U.prototype.zoomIn=U.prototype.qp;U.prototype.zoomOut=U.prototype.rp;var di=v.create("zeact");function ei(c){"BUTTON"===c.tagName&&(c.getAttribute("type")||c.setAttribute("type","button"))}var Q=ng.qh();
Q.vm=function(c){c.showPopup=function(a,b){F.ha("showPopup",arguments,F.String,F.Wa(F.Mc("ShowPopupArgs",{x:F.Qa,y:F.Qa,refElement:F.Wa(F.HTMLElement),showPosition:F.dc,parent:F.Wa(F.HTMLElement),onhide:F.wg,overlay:F.dc,clickToDismiss:F.Wa(F.cb(F.String,F.sh))})));return fi(c,a,b)};c.hidePopup=function(a){F.ha("hidePopup",arguments,F.String);var b=gi(c,a);b&&b.Eh&&b.Eh.hide()};c.$listen=function(a,b,d,e){if(c.$element){var f=c.$element;if("string"===typeof a){var h=a;var k=b;var l=d}else if(a instanceof
HTMLElement)f=a,h=b,k=d,l=e;else throw Error("$listen: Invalid args");f.addEventListener(h,k,l);Q.Aa(c.$element,function(){f.removeEventListener(h,k,l)})}}};
Q.Mb("click",function(c,a,b,d){function e(b){var e="touchend"===b.type?b.changedTouches[0]:b,f=(new Date).getTime();if(300>f-l)di("z-click=["+d+"] received "+b.type+", ignore due to duplicate event");else if(a.hasAttribute("disabled"))di("z-click=["+d+"] received "+b.type+", ignore due to disabled");else{if("click"!==b.type||b.isTrusted||0!==b.clientX||0!==b.clientY)if(l=f,u&&(300<(new Date).getTime()-k||10<gc(e.pageX,e.pageY,n,r))){di("z-click=["+d+"] received "+b.type+", ignore due to lack of corresponding down");
return}di("z-click=["+d+"] received "+b.type+" timediff="+((new Date).getTime()-k)+", needDown="+u+" isTrusted="+(b.isTrusted||0!==b.clientX||0!==b.clientY)+" pageX="+b.pageX+" pageY="+b.pageY);ng.bn(c,d,a,b,h);Q.digest();b.preventDefault()}}function f(a){k=(new Date).getTime();a="touchstart"===a.type?a.changedTouches[0]:a;n=a.pageX;r=a.pageY}function h(a,b){a instanceof U&&0<=b.indexOf("Tool")&&(jg("Called %s",b),x=!0);return a[b]}var k=0,l=0,n=0,r=0,u=!1;ei(a);b="ontouchstart"in window;"onpointerdown"in
window?(u=!0,Q.Ua(a,"pointerup",e),Q.Ua(a,"pointerdown",f)):b?(u=!0,Q.Ua(a,"touchstart",f),Q.Ua(a,"touchend",e)):(u=!0,Q.Ua(a,"mouseup",e),Q.Ua(a,"mousedown",f));Q.Ua(a,"click",e);var x;Q.Ua(a,"keydown",function(b){b.target===a&&13===b.keyCode&&(u=x=!1,e(b),x&&c.ctx.focus(!0,a))})});
Q.Mb("has",function(c,a,b,d){var e=a.style.display;b=[];var f=0;for(d=d.split("|");f<d.length;f++){var h=d[f];h=h.trim();b.push('("'+h+'" in ctx.summary.types || "'+h+'" in ctx.summary.properties)')}(b=b.join("||"))&&Q.Bc(c,a,b,function(b){a.style.display=b?e:"none"})});
Q.Mb("property",function(c,a,b,d){var e='ctx.summary.properties["'+d+'"]',f=a.getAttribute("z-value"),h=null!==a.getAttribute("z-colour"),k=void 0;Q.To(c,function(){Q.Bc(c,a,e,function(b){k=b;ng.ty(c,a,b);null!==f&&B(a).rt("selected",""+b===f);h&&(a.style.backgroundColor=b)})});"BUTTON"===a.tagName?(ei(a),Q.Ua(a,"click",function(){var b=a.getAttribute("z-value")||"";switch(b){case "true":b=!0;break;case "false":b=!1}c.ctx.setProperty(d,b);k=b})):a.Jf?Q.Bc(a.Jf,a,"value",function(a){void 0!==a&&k!==
a&&(k=a,c.ctx.setProperty(d,a))}):Q.Ua(a,"change",function(){var b=ng.YC(c,a);void 0!==b&&k!==b&&(k=b,c.ctx.setProperty(d,b))});"SELECT"===a.tagName&&Q.Ua(a,"options-changed",function(){setTimeout(function(){void 0!==k&&ng.ty(c,a,k)},1)})});function hi(c){c.hasOwnProperty("$popups")||(c.$popups={});return c.$popups}function gi(c,a){for(;c;){if(c.$popups&&c.$popups[a])return c.$popups[a];c=c.$parent}}
Q.Mb("popup",function(c,a,b,d){if(!a.hasAttribute("z-ignore-popup-hack")){var e=a.parentNode;if(!e)throw Error("z-popup: no parent node?!");var f=document.createComment("z-popup="+d);e.replaceChild(f,a);a.setAttribute("z-ignore-popup-hack","");var h=hi(c);Q.Aa(e,function(){a.removeAttribute("z-ignore-popup-hack");e&&e.replaceChild(a,f);if(h[d]){var b=h[d];b.Eh&&b.Eh.destroy();delete h[d]}Q.detach(a)});h[d]={ea:a,Eh:null}}},0);
function fi(c,a,b){void 0===b&&(b={});var d=gi(c,a);if(!d)throw Error("Popup "+a+" not found");di("show-popup "+a);var e=d.ea;if(d.Eh)di("Dialog %s already shown by another button",a);else{"string"!==typeof b.clickToDismiss&&(b.clickToDismiss=e.getAttribute("z-click-dismiss"));var f=e.getAttribute("z-popup");e=e.cloneNode(!0);var h=!1;""===b.clickToDismiss?h=!0:"string"===typeof b.clickToDismiss?h=b.clickToDismiss:b.clickToDismiss&&(h=!0);var k=Q.rd(c,e).node,l=b.parent;l||k.parentNode||(l=document.fullscreenElement?
document.fullscreenElement:c.ctx?c.ctx.Fc():document.body);l&&l.appendChild(k);f&&k.setAttribute("z-popup",f);var n=Ee(k,{overlay:b.overlay||"transparent"});d.Eh=n;n.onhide=function(){if(b.onhide)try{b.onhide()}catch(r){console.warn("Got error in showPopup/onhide() method: ",r)}di("Popup "+a+" is hidden.");n&&(n.destroy(),d.Eh=null,Q.detach(k),B(e).remove())};Q.digest(function(){var a=b.showPosition||k.getAttribute("z-show-position")||"";if("centre"===a||"center"===a)n.show(void 0,void 0,h);else if(a&&
b.refElement)n.show(b.refElement,a,h);else if("number"===typeof b.x&&"number"===typeof b.y)n.show(b.x,b.y,h);else throw Error("Invalid arguments to showPopup; you must have one of x/y, or showPosition and refElement.");})}}Q.Mb("show-popup",function(c,a,b,d){ei(a);Q.Ua(a,"click",function(b){fi(c,d,{refElement:a,showPosition:a.getAttribute("z-show-position"),x:b.pageX,y:b.pageY,clickToDismiss:a.getAttribute("z-click-dismiss")})})});
Q.Mb("colour",function(c,a,b){Q.Ua(a,"click",function(d){c.ctx.Gy(a.getAttribute(b)||a.getAttribute("z-property")||"",d.pageX,d.pageY)})});
Q.Mb("page",function(c,a,b,d){function e(){if(!(k>=f.ob())){var a=f.nf(k);u&&(a=u);var b=Math.min(l/a.width,n/a.height);1<b&&(b=1);h.width=a.width*b|0;h.height=a.height*b|0;r.save();r.scale(b,b);r.translate(-a.x,-a.y);r.fillStyle="white";r.fillRect(0,0,a.width,a.height);f.ka(r,{page:k,jy:b});r.restore()}}if(!a.cI){var f=c.ctx,h=document.createElement("canvas"),k=gg(c,d)||0,l=parseInt(a.getAttribute("z-width")||"1000000"),n=parseInt(a.getAttribute("z-height")||"1000000");b=a.parentNode;h.style.backgroundColor=
"white";var r=h.getContext("2d");d=a.getAttribute("z-rect");var u=null;d&&(u=gg(c,d));for(var x=0;x<a.attributes.length;x++){var w=a.attributes[x];"z-page"!==w.name&&h.setAttribute(w.name,w.value)}a.parentNode&&a.parentNode.replaceChild(h,a);f.setTimeout(e,10);d&&Q.Bc(c,b,d,function(a){u=a;e()});var y=Ig(100,e);f.pa("document-changed",e);f.pa("resource-loaded",e);f.pa("resize",y);b&&Q.Aa(b,function(){f.removeListener("document-changed",e);f.removeListener("resource-loaded",e);f.removeListener("resize",
y);y.cancel();h.parentNode&&h.parentNode.replaceChild(a,h)});for(x=0;x<a.attributes.length;x++)h.setAttribute(a.attributes[x].name,a.attributes[x].value);h.cI=!0;return Q.rd(c,h).node}},1);Q.Mb("sort",function(c,a,b,d){E.cg(".zwibbler-sort-highlight { outline: 3px solid orange }");var e=db({parent:a,Nu:"z-sortable",os:"zwibbler-sort-highlight",UE:function(a,b){c.$from=a;c.$to=b;gg(c,d);Q.digest()}});Q.Aa(a,function(){e()})});
Q.Mb("fixture",function(c,a,b,d){setTimeout(function(){var b=E.getContext(a);b?b.rm(a,d):console.warn("z-fixture: no ctx in scope; scope is ",c)})});function ii(){jg("Document loaded.");Array.prototype.forEach.call(document.querySelectorAll("zwibbler,[zwibbler]"),function(c){ji(c,null,!1)})}function ki(c,a,b){B(c).matches(a)&&b(c);Array.prototype.forEach.call(c.querySelectorAll(a),b)}
function ji(c,a,b){if(c.dm)return c.af;"ZWIBBLER"===c.tagName&&E.cg("zwibbler {display: block}");if(b||null===c.getAttribute("z-no-auto-init")){ki(c,"[z-component]",function(a){var b=a.getAttribute("z-component"),c=a.getAttribute("z-controller"),d=(a.getAttribute("z-properties")||"").split(/[ ,]+/);if(b){var e=null;if(c)if(c in E.controllers)e=E.controllers[c];else if("function"===typeof window.zcontroller)e=window.zcontroller;else throw Error("While processing component: "+b+" could not find controller function "+
c);E.fk(b,{template:a,properties:d,controller:function(a){a.$parent.ctx&&!a.ctx&&(a.ctx=a.$parent.ctx);e&&e(a)}});a.parentNode.removeChild(a)}});var d,e={};for(b=0;b<c.attributes.length;b++){var f=c.attributes[b];E.mw(f.name)&&(e[f.name]=f.value)}ki(c,"z-canvas,[z-canvas]",function(b){d=E.create(b,e,a)});a||(a=d||{});a.$digest=function(a){if(a)Q.digest(a);else return new Promise(function(a){Q.digest(a)})};a.$watch=function(b,d){Q.Bc(a,c,b,d)};a.$apply=function(b){if(b)return gg(a,b);Q.digest()};a.$element=
c;Q.vm(a);d?(a.ctx=d,d.rd(a,c)):Q.rd(a,c);b=c.getAttribute("z-controller")||"";b in E.controllers?(jg("Running controller: %s",b),E.controllers[b](a)):"function"===typeof window[b]?(jg("Running controller: %s",b),window[b](a)):b&&console.log("Controller not found: %s",b);Q.digest();return a}}document.addEventListener("DOMContentLoaded",function(){ii()});
Q.Mb("editable",function(c,a,b,d){function e(b){void 0===b&&(b=!1);if(b)f=gg(c,d),k&&k.kd(f);else{f=b=(a.textContent||"").trim();gg(c,d+"="+JSON.stringify(b));var e=gg(c,d);k&&e!==b&&k.kd(e)}di("Text editor no longer selected. Blurring");k&&k.exec("select-none");k&&k.setActive(!1)}a.hasAttribute("tabindex")||a.setAttribute("tabindex","0");if(!(a instanceof HTMLElement))throw Error("Cannot use z-editable on this type of element: "+a.tagName);var f="";Q.Bc(c,a,d,function(a){f!==a&&(f=""+a,k&&k.kd(f))});
var h=new jb,k=null;setTimeout(function(){k=new zg(h,a,{jh:"no-wrap"===getComputedStyle(a).whiteSpace||a.hasAttribute("z-single-line"),placeholder:a.getAttribute("placeholder")||"",$B:"ellipsis"===getComputedStyle(a).textOverflow});k.kd(f);var b=a.getAttribute("maxlength");null!==b&&k.yj("max-length",parseFloat(b));k.pa("enter",e)});Q.Aa(a,function(){h.Sa()});Q.Ua(a,"focus",function(){di("Got text focus event");k&&k.setActive(!0);k&&-1==f.indexOf("\n")&&k.exec("select-all")});Q.Ua(a,"click",function(){di("Clicked on text");
k&&k.setActive(!0)});Q.Ua(a,"blur",function(){di("Got text blur event");e()});Q.Ua(a,"keydown",function(a){27===a.keyCode&&e(!0)});if(c.ctx){var l=function(){c.id&&!c.ctx.Th(c.id)&&k&&k.Yd()&&e()};c.ctx.pa("selected-nodes",l);h.add(function(){c.ctx.removeListener("selected-nodes",l)})}});
Q.Ze("clear-glyph",function(c,a,b){di("Drawing colour panel, width=%s tag=%s",JSON.stringify(a),c.tagName);"CANVAS"===c.tagName&&(c.width=a.width,c.height=a.width,"clear"===a.style?Cf(c.getContext("2d"),0,0,a.width):Df(c.getContext("2d"),0,0,a.width),b.ctx.resize())});
Q.Mb("drag",function(c,a,b,d){var e=!1,f=new J(0,0),h=null;Q.Ua(a,"mousedown",function(a){e=!0;f=new J(a.pageX,a.pageY);h=a});Q.Ua(document.body,"mousemove",function(b){e&&(0===b.buttons?(e=!1,h=null):10<(new J(b.pageX,b.pageY)).ic(f)&&(ng.bn(c,d,a,h),e=!1,h=null))});Q.Ua(a,"mouseup",function(){e=!1;h=null})});var li=v.create("HTMLNode");
function mi(c){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.ea=null;b.children=[];b.jb|=6;return b}__extends(b,a);b.prototype.removeChild=function(a){var b=this.children[a];this.children.splice(a,1);Tc(b.node)&&b.node.ea&&b.node.ea.parentNode&&(b.node.ea.parentNode?b.node.ea.parentNode.removeChild(b.node.ea):b.Mf.parentNode&&b.Mf.parentNode.removeChild(b.Mf));return b.node};b.prototype.cs=function(a){for(a+=1;a<this.children.length;a++){var b=
this.children[a];if(Tc(b.node)&&b.node.ea)return b.node.ea.parentNode?b.node.ea:b.Mf}return null};b.prototype.Lr=function(a,b){this.children.splice(b,0,{node:a,Mf:document.createComment("node "+a.id)});this.ea&&Tc(a)&&a.ea&&this.Pz(a.ea,this.cs(b),a.ia("$component"))};b.prototype.Pz=function(a,b,c){if(b){c=b.parentNode;if(!c)for(var d=0,e=this.children;d<e.length;d++){var f=e[d];Tc(f.node)&&f.node.ea===b&&(c=f.Mf.parentNode,b=f.Mf)}if(!c)throw Error("Could not find parent");c.insertBefore(a,b)}else this.ea&&
(c=c||a.getAttribute("z-type")||"",ni(this.ea,c).appendChild(a))};b.prototype.tb=function(a){if(0>a||a>=this.children.length)throw Error("getChild("+a+") but there are only "+this.children.length+" children");return this.children[a].node};b.prototype.Jl=function(a,b){li("showChild("+a+", "+b+")");if(a>=this.children.length||0>a)throw Error("showChild: Asked to show "+a+" but only "+this.children.length+" children");a=this.children[a];if(Tc(a.node)&&a.node.ea){var c=a.node.ea.parentNode||a.Mf.parentNode;
c?b&&!a.node.ea.parentNode?c.replaceChild(a.node.ea,a.Mf):!b&&a.node.ea.parentNode&&c.replaceChild(a.Mf,a.node.ea):li("Could not find HTML parent for "+a.node.type())}};b.prototype.Fk=function(){return new K(0,0,0,0)};b.prototype.Il=function(){};b.prototype.Ro=function(){};return b}(c)}
var pi=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Eq=null;b.Tq=null;b.yl=null;b.ze=new K(0,0,0,0);b.Iv=!1;b.rs={};for(var f in b.ba)switch(f){case "layer":case "matrix":break;default:delete b.ba[f]}"ResizeObserver"in window&&(b.yl=new window.ResizeObserver(function(){b.Te()}));return b}__extends(a,c);a.prototype.type=function(){return"HTMLNode"};a.prototype.Sa=function(){this.ea&&!this.Iv&&(Q.detach(this.ea),B(this.ea).remove(),this.yl&&this.yl.unobserve(this.ea))};a.prototype.Ro=
function(a){this.rs=a};a.prototype.Ge=function(a){return{"style.left":parseFloat(this.ba["style.left"]||"0")+a.Ha+"px","style.top":parseFloat(this.ba["style.top"]||"0")+a.Ia+"px"}};a.prototype.setProperty=function(a,d){"matrix"===a||"object"!==typeof d||d instanceof Array?(d=c.prototype.setProperty.call(this,a,d),this.Va(a,d)):this.Qb(oi(d,{},a+"."))};a.prototype.ia=function(a){switch(a){case "lockRotation":return!0}return c.prototype.ia.call(this,a)};a.prototype.Va=function(a,c){"opacity"===a&&(a=
"style.opacity");this.ea&&"style."===a.substr(0,6)&&(this.ea.style[a.substr(6)]=c||"")};a.prototype.createElement=function(){var a=this.ba.$component;li("Create component element of type %s",a);var c=id(this.rs,this);if(!(a in E.Ie))throw Error("Error: No component registered for "+a);c=E.hk(this.rs,a,{nid:this.id,"z-type":a},c);this.Tq=E.Ie[a].format||null;this.Eq=E.Ie[a].draw||null;this.scope=c.scope;return c.node};a.prototype.format=function(a,c){var b=this;this.Yx=c;li("FORMAT type %s",this.ba.$component);
if(null===this.ea){this.ea=this.createElement();this.ea.style.boxSizing="border-box";this.ea.HI=function(){return!1};this.parent&&Tc(this.parent)&&this.SE();this.yl&&this.yl.observe(this.ea);for(var d in this.ba)this.Va(d,this.ba[d]);this.ea.addEventListener("load",function(){li("Something loaded; request reformat.");c.ua("reformat",b.id)})}d=this.Pa();"style.left"in this.ba&&(this.ea.style.left=parseFloat(this.ba["style.left"])+d.Ha+"px");"style.top"in this.ba&&(this.ea.style.top=parseFloat(this.ba["style.top"])+
d.Ia+"px");this.Tq&&this.Tq(this.scope,a);for(d=0;d<this.children.length;d++){var h=this.tb(d);N(h)&&h.format(a,c)}};a.prototype.Te=function(){if(this.ea&&this.ea.offsetWidth){var a=this.ea.offsetWidth,c=this.ea.offsetHeight;this.ze.width=a;this.ze.height=c;this.rect.width=a;this.rect.height=c;this.xa.width=a;this.xa.height=c;this.Yx&&(this.log("%s size has changed: %sx%s",this,a,c),this.Yx.Bf(this.id))}};a.prototype.Il=function(a){this.rect=a;this.xa=a.clone();this.ze=a.clone()};a.prototype.So=function(a,
d){c.prototype.So.call(this,a,d);this.ea&&(this.ea.style.transform="translate("+a+"px, "+d+"px)",this.ea.style.zIndex=a||d?"1":"")};a.prototype.Br=function(){for(var a=[],c=0;c<this.children.length;c++){var e=this.tb(c);if(N(e)){var f=e.ia("sticky");f&&(e={Ug:e.id},"row"===f?(e.op=this.rect.width,a.push(e)):"column"===f&&(e.pp=this.rect.height,a.push(e)))}}return a};a.prototype.ka=function(a){if(!this.hidden())if(this.log("%s: Drawing %sx%s",this,this.ze.width,this.ze.height),a.Tj){a.translate(this.offsetX,
this.offsetY);var b=a.globalCompositeOperation;a.globalCompositeOperation="destination-out";var c=this.ze;this.ea&&this.ea.classList.contains("zwibbler-selected")&&(c=c.clone(),c.dd(8,8));a.fillRect(c.x,c.y,c.width,c.height);a.globalCompositeOperation=b;a.strokeStyle="rgba(255,0,0,0.2)";a.lineWidth=3;a.translate(-this.offsetX,-this.offsetY)}else if(this.Eq)b=parseFloat(this.ba["style.left"]||"0"),c=parseFloat(this.ba["style.top"]||"0"),a.save(),a.translate(b,c),this.Eq(this.scope,a),a.restore();else if(this.ea){b=
"VIDEO"===this.ea.tagName?this.ea:this.ea.querySelector("video");c=!1;var f=this.ze;b&&3<=b.readyState&&!B.fE(b)&&(a.drawImage(b,f.x,f.y,f.width,f.height),c=!0);c||(a.fillStyle="#cccccc",a.fillRect(f.x,f.y,f.width,f.height))}};a.prototype.tc=function(){return!0};a.prototype.SE=function(){if(this.parent&&Tc(this.parent)&&this.parent.ea){var a=this.parent.te(this);if(-1===a)throw Error("Child node not found");var c=ni(this.parent.ea,this.ba.$component);a=this.parent.cs(a);c&&this.ea&&c.insertBefore(this.ea,
a)}};a.prototype.Fk=function(){if(!this.ea)return this.rect;var a=B(this.ea).Ti();return new K(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};a.prototype.Rg=function(){return!1};a.prototype.Gh=function(a,d){switch(a){case "style.width":case "style.left":case "style.top":case "style.height":if("number"===typeof d)return d+"px"}return c.prototype.Gh.call(this,a,d)};a.prototype.Zf=function(){return!1};return a}(mi(pd));jd.Pd("HTMLNode",pi);
function ni(c,a){if(c.classList.contains("zwibbler-page"))return c;for(var b=c.querySelectorAll("[container-for]"),d=null,e=0;e<b.length;e++)if(lh(b[e],a)){d=b[e];break}if(d){a=d.parentElement;for(b=!0;a;){if(a.getAttribute("nid")){b=a==c;break}a=a.parentElement}if(b)return d}return c}function lh(c,a){return(c=c.getAttribute("container-for"))&&0<=c.indexOf(a)}
function oi(c,a,b){void 0===a&&(a={});void 0===b&&(b="");for(var d in c){var e=c[d];e instanceof Object&&!(e instanceof Array)?oi(e,a,d+"."):a[b+d]=e}return a};var qi=function(c){function a(a,d){d=c.call(this,a,d)||this;d.jb|=2;d.ea=document.createElement("div");d.ea.classList.add("zwibbler-page");d.ea.setAttribute("nid",a);return d}__extends(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.format=function(a,c){for(var b=0;b<this.children.length;b++){var d=this.tb(b);N(d)&&d.format(a,c)}};return a}(mi(pd));pd.Pd("GroupNode",qi);var si=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Dw=function(a){var b;Wg(a instanceof c);var d=new c;for(b in this.keys)a.contains(b)&&d.add(b)};c.prototype.nk=function(a){var b;Wg(a instanceof c);var d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.Jc=
function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(a);return b};c.prototype.lH=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.wd=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var ti=function(c){function a(a,d){d=c.call(this,a,d)||this;d.log=v.create("PAGE",!0);d.ea=document.createElement("div");d.ea.classList.add("zwibbler-page");d.ea.setAttribute("nid",a);return d}__extends(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.setProperty=function(a,d){if(void 0===d)delete this.ba[a];else switch(a){case "x":case "y":case "width":case "height":case "background":this.ba[a]=d;break;default:c.prototype.setProperty.call(this,a,d)}};a.prototype.Pc=function(){return"width"in
this.ba&&"height"in this.ba?new K(this.ba.x||0,this.ba.y||0,this.ba.width,this.ba.height):null};return a}(mi(jd));pd.Pd("PageNode",ti);var ui=v.create("crdt"),vi=function(){function c(a,b,c){this.$d=a;this.pc=b;this.Pj=c}c.prototype.before=function(a){return this.$d<a.$d||this.$d===a.$d&&(this.pc<a.pc||this.pc===a.pc&&this.Pj<a.Pj)};c.prototype.encode=function(){return this.$d.toString(36)+":"+this.pc+":"+this.Pj.toString(36)};c.prototype.toString=function(){return this.encode()};c.fc=function(a){for(var b=a.split(":"),d,e;3===b.length;){d=parseInt(b[0],36);e=parseInt(b[2],36);if(isNaN(d)||isNaN(e))break;return new c(d,b[1],e)}throw Error("Could not decode Timestamp: "+
a);};return c}(),wi=function(){function c(a,b){void 0===b&&(b=[]);this.Rb=a;this.ops=b;this.ds=!1}c.prototype.se=function(){return this.Rb.pc+"-"+this.Rb.Pj.toString(36)};c.prototype.before=function(a){return this.Rb.before(a.Rb)};c.prototype.yG=function(){this.ds=!0};c.pd=function(a,b){return a.before(b)?-1:b.before(a)?1:0};c.prototype.clone=function(a){void 0===a&&(a=this.Rb);for(var b=[],d=0,e=this.ops;d<e.length;d++)e[d].clone(b);return new c(a,b)};c.prototype.inverse=function(a){void 0===a&&
(a=this.Rb);for(var b=[],d=this.ops.length-1;0<=d;d--)this.ops[d].inverse(b);return new c(a,b)};c.prototype.Ng=function(a){for(var b=0,c=this.ops;b<c.length;b++)c[b].Ng(a)};c.prototype.toString=function(){for(var a="  "+this.Rb+" --\x3e\n",b=0,c=this.ops;b<c.length;b++)a+="    "+c[b]+"\n";return a};return c}(),xi=function(){function c(a,b){this.Ve=a;this.Na=b}c.prototype.encode=function(){return this.Ve+":"+this.Na.encode()};c.prototype.toString=function(){return this.encode()};c.fc=function(a){var b=
a.split(":");if(2!==b.length)throw Error("Could not decode treepath: "+a);return new c(b[0],Nh.fc(b[1]))};return c}(),Ai=function(){function c(a,b,c){this.La=a;this.vd=b;this.ba=c;this.type="c"}c.prototype.encode=function(){var a=JSON.stringify(this.ba);return"C"+this.La+";"+this.vd.encode()+";"+a.length+";"+a+";"};c.prototype.clone=function(a){a.push(new yi(this.La))};c.prototype.toString=function(){return"CREATE "+this.La+" "+(this.ba.$type||this.ba.type||this.ba.name||"")+" at "+this.vd+" len="+
JSON.stringify(this.ba).length};c.prototype.inverse=function(a){a.push(new zi(this.La))};c.fc=function(a,b){var d=/C([^;]+);([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);return e&&e.index===b?(b=parseInt(e[3],10),a=JSON.parse(a.substr(d.lastIndex,b)),{Dg:new c(e[1],xi.fc(e[2]),a),position:d.lastIndex+b+1}):null};c.prototype.zl=function(a){this.vd=a.zl(this.vd,this.La)};c.prototype.Ec=function(a){a.createNode(this.La,this.vd,this.ba)};c.prototype.Ng=function(a){a.Cu(this.La)};return c}();
(function(){function c(a){this.XE=a;this.type="n"}c.prototype.clone=function(a){a.push(this)};c.prototype.inverse=function(a){a.push(this)};c.prototype.encode=function(){return""};c.prototype.Ec=function(){};c.prototype.toString=function(){return"NULLIFIED "+this.XE};c.prototype.Ng=function(){};return c})();
var zi=function(){function c(a){this.La=a;this.type="d";this.il=!1}c.prototype.clone=function(a){a.push(new c(this.La))};c.prototype.inverse=function(a){a.push(new yi(this.La))};c.prototype.encode=function(){return"D"+this.La+";"};c.prototype.toString=function(){return"DELETE "+this.La};c.fc=function(a,b){var d=/D([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{Dg:new c(a[1]),position:d.lastIndex}:null};c.prototype.Ec=function(a){a.ff(this.La)};c.prototype.Ng=function(){};return c}(),yi=
function(){function c(a){this.La=a;this.type="u"}c.prototype.clone=function(a){a.push(new c(this.La))};c.prototype.inverse=function(a){a.push(new zi(this.La))};c.prototype.encode=function(){return"U"+this.La+";"};c.prototype.toString=function(){return"UNDELETE "+this.La};c.fc=function(a,b){var d=/U([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{Dg:new c(a[1]),position:d.lastIndex}:null};c.prototype.Ec=function(a){a.Xy(this.La)};c.prototype.Ng=function(a){a.Cu(this.La)};return c}(),Bi=/^\\*undefined$/;
function Ci(c,a){return"undefined"===typeof a?"undefined":"string"===typeof a&&a.match(Bi)?"/"+a:a}
var Di=function(){function c(a,b,c){void 0===c&&(c=null);this.La=a;this.ba=b;this.yf=c;this.type="s";this.il=!1;a:{for(var d in b){a=!1;break a}a=!0}if(a)throw Error("Empty properties in constructor");}c.prototype.clone=function(a){a.push(new c(this.La,this.ba))};c.prototype.inverse=function(a){if(null===this.yf){if(this.il)return;throw Error("SetPropertiesOp was not executed before inversion: "+this);}a.push(new c(this.La,this.yf))};c.prototype.encode=function(){var a=JSON.stringify(this.ba,Ci);
return"S"+this.La+";"+a.length+";"+a+";"};c.prototype.toString=function(){return"SET "+this.La+" "+JSON.stringify(this.ba,Ci)};c.fc=function(a,b){var d=/S([^;]+);(\d+);/g;d.lastIndex=b;var e=d.exec(a);if(e&&e.index===b){b=parseInt(e[2],10);a=JSON.parse(a.substr(d.lastIndex,b));for(var f in a){var h=f;var k=a[f];k="undefined"===k?void 0:"string"===typeof k&&k.match(Bi)?k.substr(1):k;a[h]=k}return{Dg:new c(e[1],a,null),position:d.lastIndex+b+1}}return null};c.prototype.Ec=function(a){var b=a.hb(this.La);
this.yf={};for(var c in this.ba)this.yf[c]=b[c];a.Qb(this.La,this.ba)};c.prototype.Ng=function(){};return c}(),Ei=function(){function c(a,b,c){void 0===c&&(c=null);this.La=a;this.vd=b;this.src=c;this.type="m";this.il=!1}c.prototype.clone=function(a){a.push(new c(this.La,this.vd,this.src))};c.prototype.inverse=function(a){if(!this.src){if(this.il)return;throw Error("moveOp: Must be executed before inversion");}a.push(new c(this.La,this.src,this.vd))};c.prototype.encode=function(){return"M"+this.La+
";"+this.vd.encode()+";"};c.prototype.toString=function(){return"MOVE "+this.La+" -> "+this.vd};c.fc=function(a,b){var d=/M([^;]+);([^;]+);/g;d.lastIndex=b;return(a=d.exec(a))&&a.index===b?{Dg:new c(a[1],xi.fc(a[2])),position:d.lastIndex}:null};c.prototype.zl=function(a){this.vd=a.zl(this.vd,this.La)};c.prototype.Ec=function(a){var b=a.Ga[this.La];b&&b.parent&&a.has(this.vd.Ve)?(this.src=new xi(b.parent.La,b.Na),a.Cd(this.La,this.vd)):this.il=!0};c.prototype.Ng=function(){};return c}();
function Fi(c){for(var a=[],b=1;b<arguments.length;b++)a[b-1]=arguments[b];for(b=0;b<a.length;b++){var d=a[b],e;for(e in d)c[e]=d[e]}}
var Gi=function(){function c(a,b){this.Ra=b;this.Ga={};this.fg=new Oh(a);this.tm("0")}c.prototype.tm=function(a){this.Ga[a]={La:a,parent:null,Na:new Nh([],[]),children:[],index:0,ne:!1,Le:null,Gt:0}};c.prototype.has=function(a){return a in this.Ga};c.prototype.yd=function(a){a=this.Ga[a];if(!a)return!1;for(;;){if(a.ne)return!1;if(!a.parent)break;a=a.parent}return!0};c.prototype.zl=function(a,b){if(!this.has(a.Ve))return a;ui("Attempt to retarget %s",a);var c=this.Ek(a);b=this.qr(a.Ve,b,c);var e=this.Ek(a);
if(c!==e)throw Error("retarget failed: index="+c+" newIndex="+c+" "+a+"   "+b);ui("Retarget %s -> %s",a,b);return b};c.prototype.qr=function(a,b,c){var d=this.Ga[a];if(!d)throw Error("getInsertPath: "+a+" does not exist.");var f=0,h;for(h=0;h<d.children.length;h++){var k=d.children[h];if(!k.ne){k.La===b&&c++;if(f===c)break;f++}}if(0>h||h>d.children.length)throw Error("getInsertPath: index="+h+" wanted="+c+" but "+a+" has "+d.children.length+" children.");ui("Move "+a+" index="+h+" children.length="+
d.children.length);0===d.children.length?(b=this.fg.first,c=this.fg.ej):0===h?(b=this.fg.first,c=d.children[h].Na):h===d.children.length?(b=d.children[d.children.length-1].Na,c=this.fg.ej):(b=d.children[h-1].Na,c=h<d.children.length?d.children[h].Na:this.fg.ej);try{var l=new xi(a,this.fg.Wp(b,c))}catch(n){ui("Path between %s and %s, index=%s children=%s",b,c,h,d.children.length);ui("debug info: index is %s",h);for(a=0;a<d.children.length;a++)ui("Child %s nid=%s lpath %s",a,d.children[a].La,d.children[a].Na);
throw n;}ui("Path between "+b+" and "+c+" is "+l.Na);a=this.Ek(l);if(a!==h){ui("debug info: wanted index is %s, got %s",h,a);for(a=0;a<d.children.length;a++)ui("Child %s nid=%s lpath %s",a,d.children[a].La,d.children[a].Na);throw Error("getInsertPath() failed; ("+l+") index="+h);}return l};c.prototype.Ek=function(a){var b=this.Ga[a.Ve];if(!b)throw Error("getInsertIndex: parent "+a.Ve+" does not exist");var c=Ad(b.children.length,function(c){return Nh.pd(a.Na,b.children[c].Na)});if(0>c||c>b.children.length)throw Error("Asked to insert at "+
a.Ve+":"+c+" but parent has "+b.children.length+" children.");return c};c.prototype.createNode=function(a,b,c){if(a in this.Ga)this.Xy(a);else{var d=this.Ga[b.Ve],f=this.Ek(b),h={La:a,parent:d,children:[],Na:b.Na,index:f,ne:!1,Le:null,Gt:0};this.Ga[a]=h;d.children.splice(f,0,h);d.Gt=f-1;this.Vu(d.children,f);this.yd(a)?this.Ra&&this.Ra.createNode(a,b.Ve,this.pr(h),c):h.Le=c}};c.prototype.Vu=function(a,b){if(0<b&&0<=Nh.pd(a[b-1].Na,a[b].Na)){ui("debug info: index is %s",b);for(var c=0;c<a.length;c++)ui("Child %s nid=%s lpath %s",
c,a[c].La,a[c].Na);throw Error("Error: LPaths out of order. "+a[b-1].Na+" >=  "+a[b].Na);}if(b<a.length-1&&0<=Nh.pd(a[b].Na,a[b+1].Na)){ui("debug info: index is %s",b);for(c=0;c<a.length;c++)ui("Child %s nid=%s lpath %s",c,a[c].La,a[c].Na);throw Error("Error: LPaths out of order. "+a[b].Na+" >=  "+a[b+1].Na);}};c.prototype.ff=function(a){(a=this.Ga[a])&&a.parent&&!a.ne&&(a.ne=!0,this.remove(a))};c.prototype.remove=function(a){for(var b=a.children.length-1;0<=b;b--){var c=a.children[b];c.ne||this.remove(c)}this.Ra?
(a.Le=this.Ra.hb(a.La),this.Ra.ff(a.La)):a.Le={}};c.prototype.pr=function(a){if(!a.parent)throw Error("Expected parent");for(var b=a.parent,c=0,e=0;e<b.children.length;e++){if(b.children[e]===a)return c;b.children[e].ne||c++}throw Error("node "+a.La+" not in parent's child list");};c.prototype.Xy=function(a){(a=this.Ga[a])&&a.ne&&a.parent&&(a.ne=!1,this.Vx(a))};c.prototype.Vx=function(a){if(this.Ra&&this.yd(a.La)&&a.parent){if(!a.Le)throw Error("Properties of "+a.La+" should have been saved");this.Ra.createNode(a.La,
a.parent.La,this.pr(a),a.Le)}a.Le={};var b=0;for(a=a.children;b<a.length;b++){var c=a[b];c.ne||this.Vx(c)}};c.prototype.za=function(a){a in this.Ga||(this.Ga[a]={La:a,ne:!0,children:[],index:0,Le:{},Na:this.fg.first,Gt:0,parent:null});return this.Ga[a]};c.prototype.Cd=function(a,b){var c=this.Ga[a];if(c&&c.parent){var e=this.Ga[b.Ve];if(e){for(var f=0;f<c.parent.children.length;f++)if(c.parent.children[f]===c){c.parent.children.splice(f,1);break}f=this.Ek(b);c.parent=e;c.Na=b.Na;e.children.splice(f,
0,c);this.Vu(e.children,f);this.Ra&&this.yd(a)&&this.Ra.Cd(a,b.Ve,this.pr(c))}}};c.prototype.Qb=function(a,b){var c=this.za(a);this.Ra&&this.yd(a)?this.Ra.Qb(a,b):c.Le&&Fi(c.Le,b)};c.prototype.hb=function(a){var b=this.Ga[a];return b&&b.ne?b.Le:this.Ra?this.Ra.hb(a):{}};c.prototype.Ea=function(a,b){this.Ra&&this.Ra.Ea(a,b)};return c}(),Ji=function(){function c(a,b){this.pc=b;this.$d=0;this.all=[];this.Ok={};this.Jd=[];this.next=0;this.le=!1;this.Yr="";this.Mj=[];this.local=[];this.Tl="";this.Ur=0;
this.As=!1;this.Ra=new Gi(this.pc,a)}c.prototype.kx=function(){var a=(new Date).getTime();a<=this.Ur&&(a=this.Ur+1);return this.Ur=a};c.prototype.Ec=function(a){var b=0;for(a=a.ops;b<a.length;b++){var c=a[b];ui("Executing %s",c);c.Ec(this.Ra)}};c.prototype.locked=function(){return""!==this.Yr};c.prototype.createNode=function(a,b,c,e){this.le||this.sm(new Ai(a,this.Ra.qr(b,a,c),e));return a};c.prototype.ff=function(a){this.le||this.sm(new zi(a))};c.prototype.Cd=function(a,b,c){this.le||this.sm(new Ei(a,
this.Ra.qr(b,a,c)))};c.prototype.Qb=function(a,b){var c=!1,e=this.hb(a),f;for(f in b)if(e[f]!==b[f]){c=!0;break}ui("Ignore setProperties of "+a+"; no change detected.");c&&!this.le&&this.sm(new Di(a,b))};c.prototype.hb=function(a){return this.Ra.hb(a)};c.prototype.sm=function(a){this.Mj.push(a);this.locked()||(ui("Executing %s",a),a.Ec(this.Ra))};c.prototype.Ea=function(a,b,c){void 0===c&&(c=!1);if(!this.As){if(!this.le&&this.Mj.length){a=new vi(this.$d,this.pc,this.kx());a=new wi(a);c&&a.yG();c=
0;for(var d=this.Mj;c<d.length;c++)a.ops.push(d[c]);b||(this.Jd.length=this.next++,this.Jd.push(a));this.local.push(a);this.all.push(a);this.Ok[a.se()]=!0;this.$d++;this.Mj.length=0;this.Tl&&(this.wh(this.Tl),this.Tl="")}else this.le&&(this.As=!0,this.Ra.Ea(a,b),this.As=!1);this.Mj.length=0}};c.prototype.encode=function(a){for(var b="",c=0;c<a.length;c++){var e=a[c];if(!e.ds){b+="B"+e.Rb.encode()+";";var f=0;for(e=e.ops;f<e.length;f++)b+=e[f].encode()}}return b};c.prototype.wh=function(a){if(this.locked()||
this.Mj.length)this.Tl+=a,ui("Ignore remote changes while "+(this.locked()?"locked":"uncommitted"));else{var b=0;a=Hi(a);for(var c=0;c<a.length;c++)b=Math.max(b,a[c].Rb.$d),this.Ok[a[c].se()]&&(a.splice(c,1),c--);if(0!==a.length){this.$d=Math.max(this.$d,b)+1;b=a[0];for(c=1;c<a.length;c++)a[c].before(b)&&(b=a[c]);for(var e=this.all.length-1;0<=e&&!this.all[e].before(b);e--);e++;this.le=!0;for(c=0;c<a.length;c++){var f=a[c];this.all.push(f);this.Ok[f.se()]=!0}this.all.sort(wi.pd);if(this.all[e]!==
b){for(c=0;c<this.all.length;c++)c===e&&ui("MergePoint"),ui(this.all[c].toString());ui("New lists:");for(b=0;b<a.length;b++)ui(a[b].toString());throw Error("Assumption violated");}ui("%s Executing new changes from %s",this.pc,e);for(c=e;c<this.all.length;c++)this.Ec(this.all[c]);this.Ea(!0,!1);this.le=!1;ui("%s addRemoteChanges done",this.pc)}}};c.prototype.HF=function(){this.local=this.all.concat()};c.prototype.KC=function(){return this.yv(this.local)};c.prototype.BC=function(){return this.yv(this.all)};
c.prototype.yv=function(a){for(var b=0,c=0;c<a.length;c++)a[c].ds||b++;return b?new Ii(this.encode(a),this.local[a.length-1].se()):new Ii("","0")};c.prototype.bl=function(a){for(var b=this.local.length-1;0<=b;b--)if(a===this.local[b].se()){this.local.splice(0,b+1);break}};c.prototype.Lf=function(){return 0<this.next&&!this.locked()};c.prototype.Kf=function(){return this.next<this.Jd.length&&!this.locked()};c.prototype.nd=function(){this.Lf()&&this.Tx(this.Jd[--this.next],!0)};c.prototype.We=function(){this.Kf()&&
this.Tx(this.Jd[this.next++],!1)};c.prototype.iq=function(){this.next=this.Jd.length=0};c.prototype.Tx=function(a,b){this.le=!0;var c=new vi(this.$d,this.pc,this.kx());a=b?a.inverse(c):a.clone(c);b=0;for(c=a.ops;b<c.length;b++){var e=c[b];"m"!==e.type&&"c"!==e.type||e.zl(this.Ra)}this.local.push(a);this.all.push(a);this.Ok[a.se()]=!0;this.$d++;this.Ec(a);this.Ea(!1,!0);this.le=!1};c.prototype.zr=function(){for(var a=[],b=0,c=this.all;b<c.length;b++){var e=c[b];a.push({RA:e.se(),Rb:e.Rb.Pj})}return a};
c.prototype.yr=function(a,b){for(var c=0,e=this.all;c<e.length;c++){var f=e[c];if(f.se()===a)return b.JG(f.Rb.Pj),f.Ng(b),!0}return!1};c.prototype.Cr=function(a){if(0!==this.all.length&&(!a||this.Ok[a])){var b=this.all[this.all.length-1].se();a&&(b=a);for(var c=this.all.length-1,e=c,f=0;f<this.all.length;f++){var h=this.all[f];h.se()===b&&(e=f);h.se()===this.Yr&&(c=f)}this.le=!0;for(b=!1;c!==e;)c>e?this.Ec(this.all[c--].inverse()):this.Ec(this.all[++c]),b=!0;b&&this.Ea(!1,!1);this.le=!1;this.Yr=a?
this.all[c].se():""}};c.prototype.tm=function(a){this.Ra.tm(a)};return c}(),Ii=function(){function c(a,b){this.hq=a;this.mE=b}c.prototype.getData=function(){return this.hq};c.prototype.empty=function(){return 0===this.hq.length};c.prototype.toString=function(){return this.hq};return c}();
function Hi(c){for(var a=[],b=0,d=/B([^;]+);/g;b<c.length;){var e;switch(c[b]){case "B":d.lastIndex=b;if((e=d.exec(c))&&e.index===b)b=vi.fc(e[1]),b=new wi(b),a.push(b),b=d.lastIndex;else throw Error("Could not decode Batch from "+c.substr(b,256));continue;case "C":e=Ai.fc(c,b);break;case "D":e=zi.fc(c,b);break;case "U":e=yi.fc(c,b);break;case "S":e=Di.fc(c,b);break;case "M":e=Ei.fc(c,b);break;case "\r":case "\t":case "\n":case " ":b+=1;continue;default:throw Error("Could not decode Operation from "+
c.substr(b,256));}if(0===a.length)throw Error("Got change outside of batch");if(null===e)throw Error("change is null while decoding: "+c.substr(b,500));b=e.position;a[a.length-1].ops.push(e.Dg)}return a};var Ki=v.create("DOCTREE"),Mi=function(){function c(a,b){this.gg=a;this.Ga={};this.bp=new Li;this.Ga["0"]=b}c.prototype.jA=function(a,b){if(a in this.Ga)throw Error("Node "+a+" already exists");this.Ga[a]=b};c.prototype.createNode=function(a,b,c,e){Ki("createNode("+a+", "+b+", "+c+")");if(a in this.Ga)throw Error("createNode "+a+" already exists");b=this.za(b);if(b.children.length+1<c)throw Error("Asked to insert at index "+c+" but parent only has "+b.children.length+" children");e=this.gg.Zw(a,e);
b.Lr(e,c);e.parent=b;this.Ga[a]=e;this.gg.tx&&this.gg.tx(e)};c.prototype.za=function(a){if(a in this.Ga)return this.Ga[a];throw Error("nid "+a+" does not exist");};c.prototype.yd=function(a){return a in this.Ga};c.prototype.ff=function(a){Ki("deleteNode("+a+")");var b=this.za(a),c=b.parent;if(!c)throw Error("Parent of "+a+" is null?!");var e=c.te(b);if(0>e)throw Error("Asked to delete "+a+" but it is not in parent's children");if(0!==b.children.length)throw Error("Asked to delete "+a+" but it still has children.");
for(a=b.children.length-1;0<=a;a--){var f=b.tb(a);this.ff(f.id)}this.gg.ux&&this.gg.ux(b);c.removeChild(e);delete this.Ga[b.id]};c.prototype.Cd=function(a,b,c){Ki("moveNode("+a+", dest="+b+":"+c+")");var d=this.za(a),f=this.za(b),h=d.parent;if(null===h)throw Error("node "+a+" does not have any parent");a=h.te(d);if(f.children.length<(d.parent===f?c+1:c))throw Error("asked to shift node at "+b+":"+c+" but it only has "+f.children.length+" children");h.removeChild(a);f.Lr(d,c);d.parent=f};c.prototype.Qb=
function(a,b){a in this.Ga&&(a=this.za(a),this.bp.Qb(a,b),this.gg.xx&&this.gg.xx(a,b))};c.prototype.tg=function(a,b){if(!(a in this.Ga))return{};a=this.za(a);return this.bp.tg(a,b)};c.prototype.Hi=function(a){a in this.Ga&&(a=this.za(a),this.bp.clear(a))};c.prototype.hb=function(a){if(!(a in this.Ga))return{};a=this.za(a);return this.bp.hb(a)};c.prototype.Ea=function(a){this.gg.ro&&this.gg.ro(a)};c.prototype.wd=function(a){for(var b in this.Ga)a(this.Ga[b])};return c}(),Li=function(){function c(){this.Kj=
{};this.Se={}}c.prototype.clear=function(a){if(a.id in this.Se){var b=this.Se[a.id],c;for(c in b)a.setProperty(c,b[c]);delete this.Kj[a.id];delete this.Se[a.id]}};c.prototype.tg=function(a,b){var c=a.id in this.Kj?this.Kj[a.id]:this.Kj[a.id]={};for(var e in b)c[e]=b[e],a.setProperty(e,b[e]);return c};c.prototype.Qb=function(a,b){if(a.id in this.Kj){var c=a.hb();var e=a.id in this.Se?this.Se[a.id]:this.Se[a.id]={};for(f in b)e[f]=c[f],this.Kj[a.id][f]=b[f],a.setProperty(f,b[f])}else for(var f in b)a.setProperty(f,
b[f])};c.prototype.hb=function(a){var b=a.hb();if(a.id in this.Se){a=this.Se[a.id];for(var c in a)void 0===a?delete b[c]:b[c]=a[c]}return b};return c}();var Ni=v.create("BRUSH"),Oi=function(c){function a(a,d){a=c.call(this,a,d)||this;a.na=[];a.hc=[];Ni("New BrushNode created.");a.ba.points=[];a.ba.strokeStyle=q.zp;a.ba.lineWidth=10;return a}__extends(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.hb=function(){var a=c.prototype.hb.call(this);a.dashes=a.dashes||"";return a};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");switch(a){case "dashes":case "lineCap":case "blendMode":this.ba[a]=d;break;default:c.prototype.setProperty.call(this,
a,d)}};a.prototype.ia=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.ia.call(this,a)};a.prototype.format=function(){var a,c;this.na.length=0;var e=this.ba.points;var f=a=0;for(c=e.length-1;a<=c;f=a+=2)this.na.push(new J(e[f],e[f+1]));e=K.Ee(this.na);a=this.Pa().ub(!1);f=this.ba.lineWidth;e.dd(f/a.x,f/a.y);this.xa=e.clone();e=new zc(e);e.transform(this.ba.matrix);this.rect=K.Ee(e.na);this.hc=Ac(this.ba.dashes||"",f)};a.prototype.Db=function(a,c,e,f){return this.rect.Xc(a,c,e)&&(a=
this.lc().apply(a,c),c=this.lc().ub(!1),tc(this.na,a.x,a.y,.5*(c.x+c.y)*Math.max(12/f,e,this.ba.lineWidth/2)))?this:null};a.prototype.zg=function(a){var b,c;var f=this.ba.points;if(0!==f.length){a.save();a.beginPath();var h=this.ia("lineCap")||"round";a.lineCap=h;a.lineJoin="round"===h?"round":"bevel";this.ba.blendMode&&(a.globalCompositeOperation=this.ba.blendMode);if(1<this.hc.length)Bc(a,this.na,this.hc);else for(a.moveTo(f[0],f[1]),h=b=2,c=f.length-1;b<=c;h=b+=2)a.lineTo(f[h],f[h+1]);this.lc().rc(a);
cd(a,this.ba.strokeStyle);a.restore()}};a.kI=!1;return a}(pd);pd.Pd("BrushNode",Oi);var Pi=function(c){function a(a,d){a=c.call(this,a,d)||this;a.ea=null;a.Om=void 0;a.fb=new zc;a.Jr=new zc;a.Kg=new L;a.readOnly=!1;a.Wb=!1;a.qe=null;a.width=0;a.height=0;a.ae=null;a.Nx="";a.log=v.create("DomNode",!0);a.Sj=-1;a.canvas=null;a.ba.data="";a.ba.locked=!1;a.jb|=4;return a}__extends(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.cs=function(){return null};a.prototype.setProperty=function(a,d){if("data"===a)this.ea&&(B(this.ea).remove(),this.Om=this.ea=null);else if("border"===
a||"lockSize"===a||"lockRotate"===a||"preview"===a){this.ba[a]=d;return}c.prototype.setProperty.call(this,a,d)};a.prototype.lG=function(a){null!==this.qe&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.ea&&(this.log("   Remove existing DOM element"),B(this.ea).remove()),this.ea=a,this.ea.style.position="absolute",B(this.ea).Kr(this.qe.canvas),this.width=this.ea.offsetWidth||parseFloat(this.ea.getAttribute("width")||"0"),this.height=this.ea.offsetHeight||parseFloat(this.ea.getAttribute("height")||
"0"),B(this.ea).remove(),this.Bj(this.readOnly,!0),this.ea.style.top="0px",this.ea.style.left="0px",this.ea.style.boxSizing="border-box",this.ea.classList.add("zwibbler-dom-node"),this.ea.setAttribute("zwibbler-node-id",""+this.id),this.Np("transformOrigin","top left"),this.log("element height: %s, %s",this.ea.offsetWidth,this.ea.offsetHeight),this.qe.Bf(this.id))};a.prototype.Fc=function(){return this.ea};a.prototype.Np=function(a,c){if(null!==this.ea){for(var b=a.charAt(0).toUpperCase()+a.substr(1),
d=["ms","Webkit","O","Moz"],h=0;h<d.length;h++)this.ea.style[d[h]+b]=c;this.ea.style[a]=c}};a.prototype.gh=function(a){pd.prototype.gh.call(this,a);this.ea&&(this.ea.style.visibility=this.jm?"hidden":"visible")};a.prototype.Bj=function(a,c){void 0===c&&(c=!1);if(c||this.readOnly!==a)this.readOnly=a,this.ea&&this.qe&&this.Wb&&(this.ss(this.Sj),B(this.ea).Kr(this.qe.canvas))};a.prototype.format=function(a,c){var b=this;this.canvas=c.canvas;null===this.ea&&this.Om!==this.ia("data")&&c&&(this.Om=this.ia("data"),
this.qe=c,this.log("DomNode %s requests conversion to DOM element",this.id),this.qe.fB(this.Om,this.id));if(this.ea){this.ea.mI=this.id;a=this.Pa();var d=a.ub(!1);this.ea.style.width=this.width*d.x+"px";this.ea.style.height=this.height*d.y+"px";a=a.multiply(new lc(1/d.x,1/d.y));d=this.Kg;d=d.multiply(a);d.Mw()?(this.Np("transform",""),this.ea.style.left=""+d.Ha+"px",this.ea.style.top=""+d.Ia+"px"):(this.ea.style.left="0px",this.ea.style.top="0px",this.Np("transform","matrix("+d.m11+","+d.m21+","+
d.m12+","+d.m22+","+d.Ha+","+d.Ia+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.ea.style.visibility=this.jm?"hidden":"visible"}else this.rect.x=0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.fb=new zc(this.rect);this.xa=this.rect.clone();this.rect.transform(this.Pa());this.fb.transform(this.Pa());if(a=this.ba.border)this.rect.dd(a),this.Jr=this.fb.clone(),this.Jr.dd(a/2),this.fb.dd(a);!this.ba.preview||null!==this.ae&&this.Nx===this.ba.preview?
this.ba.preview||(this.ae=null):(this.log("Requesting new preview image for %s",this.ba.preview),this.ae=document.createElement("img"),this.Nx=this.ae.src=this.ba.preview,this.ae.onload=function(){b.log("Preview image loaded.");c.Bf(b.id)},this.ae.onerror=function(){b.log("Failed to load preview image")})};a.prototype.zg=function(a){var b=a.Tj;b&&this.qe&&(b.m11!==this.Kg.m11||b.m21!==this.Kg.m21||b.m12!==this.Kg.m12||b.m22!==this.Kg.m22||b.Ha!==this.Kg.Ha||b.Ia!==this.Kg.Ia)&&(this.log("Moving DOM element as result of draw zooming"),
this.Kg=b,this.format(a,this.qe));if(this.ea){var c=this.ba.border;if(c){var f=this.Jr;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=c;a.strokeStyle="#cccccc";a.moveTo(f.na[0].x,f.na[0].y);a.lineTo(f.na[1].x,f.na[1].y);a.lineTo(f.na[2].x,f.na[2].y);a.lineTo(f.na[3].x,f.na[3].y);a.lineTo(f.na[0].x,f.na[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",
0,0);if(this.ae&&this.ae.naturalHeight&&!b&&this.Wb){this.log("Drawing preview image %s,%s ->%s,s",this.ae.naturalWidth,this.ae.naturalHeight,this.width,this.height);try{a.drawImage(this.ae,0,0,this.ae.naturalWidth,this.ae.naturalHeight,0,0,this.width,this.height)}catch(h){h instanceof Error&&this.log("Tried to draw image, got error: %s",h.toString())}}else b&&(b=a.globalCompositeOperation,a.globalCompositeOperation="destination-out",a.fillRect(this.xa.x,this.xa.y,this.xa.width,this.xa.height),a.globalCompositeOperation=
b)};a.prototype.clip=function(a){this.fb.ka(a)};a.prototype.Db=function(a,c,e,f){return!this.ba.locked&&this.rect.Xc(a,c,e)&&this.fb.Xc(a,c,Math.max(3/f,e))?this:null};a.prototype.qo=function(){this.ea&&this.qe&&(this.log("Added DOM NODE %s",this.id),this.ss(this.Sj));this.Wb=!0};a.prototype.vo=function(){this.log("Removed DOM NODE %s",this.id);this.ea&&B(this.ea).remove();this.Wb=!1};a.prototype.ss=function(a){if(this.ea&&this.canvas&&!(0>a)){a!==this.Sj?(this.ea.classList.remove("zwibbler-zorder-"+
this.Sj),this.ea.classList.add("zwibbler-zorder-"+a),this.Sj=a,this.log("Add class zwibbler-zorder-%s",a)):this.log("order=zorder=%s",this.Sj);var b=null;for(--a;0<=a;a--){var c=this.canvas.parentElement.querySelector(".zwibbler-zorder-"+a);if(c){b=c;this.log("Found element zorder-%s",a);break}this.log("Did not find element zorder-%s",a)}if(this.ea.previousSibling!==b||null===b)b?(this.log("Insert after previous."),B(this.ea).Kr(b)):(this.log("Insert before canvas %s",this.canvas),B(this.ea).insertBefore(this.canvas))}};
a.prototype.Sa=function(){this.ea&&(this.log("DomNode %s destroyed",this.id),Q.detach(this.ea))};a.prototype.Po=function(a){this.ss(a)};a.prototype.Fk=function(){if(!this.ea)return this.rect;var a=B(this.ea).Ti();return new K(this.rect.x-a.left,this.rect.y-a.top,this.rect.width+a.left+a.right,this.rect.height+a.top+a.bottom)};a.prototype.Il=function(a){this.rect=a;this.xa=a.clone()};a.prototype.Ro=function(){};a.prototype.Jl=function(){throw Error("DomNode: showChild not implemented!");};return a}(pd);
pd.Pd("DomNode",Pi);var Qi=function(c){function a(a,d){a=c.call(this,a,d)||this;a.Ye=null;a.Uf=null;a.scale=1;a.fb=new zc;a.Fh=[];a.Oq=!1;a.xb=new K(0,0,100,20);a.ud=new K(0,0,100,20);a.log=v.create("IMAGE",!0);a.$x="";delete a.ba.fillStyle;delete a.ba.strokeStyle;delete a.ba.lineWidth;a.ba.url="";return a}__extends(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.toString=function(){return c.prototype.toString.call(this)+" url="+this.ia("url").substr(0,64)};a.prototype.setProperty=function(a,d){"fillStyle"===
a&&"colour"in this.ba&&(a="colour");switch(a){case "url":d!==this.ba.url&&(this.Uf=this.Ye=null);break;case "brightness":case "contrast":case "gamma":case "colour":case "perspectiveQuad":case "distortQuad":this.Uf=null}c.prototype.setProperty.call(this,a,d)};a.prototype.tc=function(a){switch(a){case "url":case "brightness":case "gamma":case "colour":case "allowCrop":case "crop":case "blendMode":case "opacity":case "width":case "height":case "perspectiveQuad":case "distortQuad":return!0}return c.prototype.tc.call(this,
a)};a.prototype.eG=function(a){a.x=Math.max(a.x,this.xb.x);a.y=Math.max(a.y,this.xb.x);a.width=Math.min(a.width,this.xb.width);a.height=Math.min(a.height,this.xb.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);return{crop:[a.x,a.y,a.width,a.height].join()}};a.prototype.Qu=function(a){var b=this.ba.crop;a=new K(this.xb.x*a,this.xb.y*a,this.xb.width*a,this.xb.height*a);b&&(b=b.split(","),a.x=parseFloat(b[0])|0,a.y=parseFloat(b[1])|0,a.width=parseFloat(b[2])|0,a.height=parseFloat(b[3])|
0);return a};a.prototype.PF=function(){var a={brightness:this.ia("brightness"),contrast:this.ia("contrast"),gamma:this.ia("gamma"),td:this.ia("colour")};void 0!==a.td&&(a.brightness=1,a.contrast=0,a.gamma=0);var c=J.xp(this.ia("perspectiveQuad")||[]);4===c.length&&(cc(c),a.Hx=c);c=J.xp(this.ia("distortQuad")||[]);4===c.length&&(a.qk=c);return!this.Ye||void 0===a.brightness&&void 0===a.contrast&&void 0===a.gamma&&void 0===a.td&&void 0===a.Hx&&void 0===a.qk?this.Ye:this.mC(this.Ye,a)||this.Ye};a.prototype.format=
function(a,c){function b(a,b,c){l.Fh.push({x:l.ud.x+a*l.ud.width,y:l.ud.y+b*l.ud.height,type:c})}var d=this;if(null===this.Ye&&"ImageSurface"in window)this.Ye=new window.ImageSurface(this.ba.url);else if(null===this.Ye){this.xb=new K(0,0,100,20);this.$x!==this.ba.url&&(this.$x=this.ba.url,this.Oq=!1,c.eg(this.id,this.ba.url,function(a){d.log("%s Got image response. Request reformat",d.id);d.Ye=a;c.Bf(d.id)},function(){d.log("Node %s failed to load image",d.id);d.Oq=!0;c.Bf(d.id)}));return}this.xb=
new K(0,0,this.Ye.width,this.Ye.height);null===this.Uf&&(this.Uf=this.PF(),this.xb=new K(0,0,this.Uf.width,this.Uf.height));a=J.xp(this.ia("distortQuad")||[]);4===a.length&&(this.xb=K.Ee(a));this.scale=(new fc(this.xb.width,this.xb.height)).Gv(this.ia("width"),this.ia("height"));this.ud=this.Qu(this.scale);this.rect=this.ud.clone();if(a=this.ia("boundingPolygon")){for(var h=[],k=0;k<a.length;k+=2)h.push(new J(a[k],a[k+1]));this.fb=new zc(h)}else this.fb=new zc(this.rect);this.xa=this.rect.clone();
this.fb.transform(this.ba.matrix);this.rect.transform(this.ba.matrix);this.Fh.length=0;var l=this;b(.5,0,1);b(1,.5,2);b(.5,1,1);b(0,.5,2);b(0,0,3);b(1,0,3);b(1,1,3);b(0,1,3)};a.prototype.jn=function(){return this.fb};a.prototype.Db=function(a,c,e,f){return!this.ba.locked&&this.fb.Xc(a,c,Math.max(3/f,e))?this:null};a.prototype.zg=function(b){var c,e,f=!1;if(this.Uf)try{var h=b.globalCompositeOperation,k=b.globalAlpha,l=this.ia("blendMode"),n=this.ia("opacity");l&&(b.globalCompositeOperation=""+l,this.log("Using globalCompsiteOperation=%s (requested %s)",
b.globalCompositeOperation,l));void 0!==n&&(b.globalAlpha=n);var r=this.ia("lineWidth")||0;if(r){b.save();this.lc().rc(b);var u=this.fb.clone();u.dd(r/2);b.beginPath();u.ka(b);b.lineWidth=r;b.strokeStyle=this.ia("strokeStyle")||q.Oa;b.stroke();b.restore()}var x=this.scale;b.drawImage(this.Uf,(this.ud.x-this.xb.x)/x,(this.ud.y-this.xb.y)/x,this.ud.width/x,this.ud.height/x,this.ud.x,this.ud.y,this.ud.width,this.ud.height);b.globalAlpha=k;b.globalCompositeOperation=h;if(a.Rt){var w=this.fb.na;b.save();
b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle=q.Oa;b.moveTo(w[0].x,w[0].y);var y=c=1;for(e=w.length-1;c<=e;y=c+=1)b.lineTo(w[y].x,w[y].y);b.closePath();b.stroke();b.restore()}}catch(z){z instanceof Error&&this.log("Error drawing image: %s",z.message),f=!0}if(null===this.Uf&&this.Oq||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.xb.width,this.xb.height),b.restore()};a.prototype.Zf=function(){return!0===this.ia("allowCrop")&&!0!==this.ia("lockEditMode")};
a.prototype.sk=function(a,c){a.save();a.beginPath();a.lineWidth=2*c;a.strokeStyle="#ccc";a.fillStyle="#000";var b=this.Pa(),d=20*c;c*=8;var h=b.ub(!0),k=Math.min(this.xa.width*h.x,this.xa.height*h.y);d>k/5&&0<k&&(k=d/(k/5),d=Math.max(2,d/k),c=Math.max(2,c/k));for(k=0;k<this.Fh.length;k++){var l=this.Fh[k],n=b.apply(l.x,l.y);var r=n.x;n=n.y;var u=0;switch(l.type){case 2:u=Math.PI/2;break;case 3:u=Math.PI/2*(k-4)}var x=0,w=0;switch(k){case 0:w=-c/2;break;case 1:x=c/2;break;case 2:w=c/2;break;case 3:x=
-c/2}a.save();3!==l.type?(a.translate(r,n),a.scale(Math.sign(h.x),Math.sign(h.y)),a.rotate(b.Ar()+u),a.rect(x-d/2,w-c/2,d,c)):(a.translate(r,n),a.scale(Math.sign(h.x),Math.sign(h.y)),a.rotate(b.Ar()+u),a.moveTo(x-c/2,w-c/2),a.lineTo(x+d,w-c/2),a.lineTo(x+d,w+c/2),a.lineTo(x+c/2,w+c/2),a.lineTo(x+c/2,w+d),a.lineTo(x-c/2,w+d),a.lineTo(x-c/2,w-c/2));a.restore()}a.stroke();a.fill();a.restore()};a.prototype.bg=function(a,c,e){var b=this.Pa();e+=10;for(var d=0;d<this.Fh.length;d++){var k=this.Fh[d];k=b.apply(k.x,
k.y);if(k.x-e<=a&&a<k.x+e&&k.y-e<=c&&c<k.y+e)return d}return null};a.prototype.pn=function(a){a=this.Fh[a];return this.Pa().apply(a.x,a.y)};a.prototype.xf=function(a,c,e){var b=this.Qu(this.scale);c=this.lc().apply(c,e);c.x=Math.round(c.x);c.y=Math.round(c.y);c.x<this.xb.x&&(c.x=this.xb.x);c.x>this.xb.width&&(c.x=this.xb.width);c.y<this.xb.y&&(c.y=this.xb.y);c.y>this.xb.height&&(c.y=this.xb.height);if(0===a||4===a||5===a)b.height-=c.y-b.y,b.y=c.y;if(3===a||4===a||7===a)b.width-=c.x-b.x,b.x=c.x;if(1===
a||5===a||6===a)b.width=c.x-b.x;if(2===a||6===a||7===a)b.height=c.y-b.y;return this.eG(b)};a.prototype.mC=function(a,c){var b=c.qk?K.Ee(c.qk):new K(0,0,a.width,a.height);if(c.qk){var d=document.createElement("canvas"),h=d.getContext("2d");a=new Sc(h,a);d.width=b.width;d.height=b.height;var k=c.qk;h.translate(-b.x,-b.y);a.ka({qH:k[0].x,rH:k[0].y,sH:k[1].x,tH:k[1].y,FA:k[2].x,GA:k[2].y,DA:k[3].x,EA:k[3].y});return d}a instanceof HTMLCanvasElement||(d=document.createElement("canvas"),d.width=b.width,
d.height=b.height,d.getContext("2d").drawImage(a,0,0),a=d);d="number"===typeof c.brightness?c.brightness:-1;k="number"===typeof c.contrast?c.contrast:-1;var l="number"===typeof c.gamma?c.gamma:-1,n="string"===typeof c.td?q.Wf(c.td):null,r=c.Hx,u=document.createElement("canvas");this.log("filterSpec: %s",JSON.stringify(c));this.log("brightness=%s contrast=%s gamma=%s w=%s h=%s",d,k,l,b.width,b.height);u.width=b.width;u.height=b.height;try{h=a.getContext("2d").getImageData(0,0,a.width,a.height).data}catch(C){return console.warn("Cannot filter external image. Please load using CORS: %s",
this.ia("url").substr(0,256)),null}b=u.getContext("2d").getImageData(0,0,u.width,u.height);c=b.data;for(var x=0,w=0,y=0;y<h.length;y+=4){var z=y;if(r){var A=ec(r,x/a.width,w/a.height);A.x=Math.round(Math.min(a.width-1,Math.max(0,A.x)));A.y=Math.round(Math.min(a.height-1,Math.max(0,A.y)));z=4*(A.y*a.width+A.x);x++;x>=a.width&&(w++,x=0)}A=h[z]/255;var G=h[z+1]/255,I=h[z+2]/255;z=h[z+3];0<=l&&(A=Math.pow(A,l),G=Math.pow(G,l),I=Math.pow(I,l));0<=d&&(A*=d,I*=d,G*=d);0<=k&&(A=A*k-.5*k+.5,G=G*k-.5*k+.5,
I=I*k-.5*k+.5);n&&0<z&&(A=n.values[0],G=n.values[1],I=n.values[2]);c[y]=Math.min(255*A|0,255);c[y+1]=Math.min(255*G|0,255);c[y+2]=Math.min(255*I|0,255);c[y+3]=z}u.getContext("2d").putImageData(b,0,0);return u};a.Rt=!1;return a}(pd);pd.Pd("ImageNode",Qi);var Ti=function(c){function a(a,d){a=c.call(this,a,d)||this;a.log=v.create("SvgNode",!0);a.md=null;a.Kt="";a.fb=new zc;a.Ya=new ee;a.scale=1;a.gx=0;a.Uu=0;a.path=null;delete a.ba.lineWidth;delete a.ba.fillStyle;delete a.ba.strokeStyle;a.ba.url="";return a}__extends(a,c);a.prototype.type=function(){return"SvgNode"};a.prototype.tc=function(a){switch(a){case "url":case "textFillStyle":case "textAlign":case "fontSize":case "fontName":case "bold":case "italic":case "textDecoration":case "text":case "width":case "fillStyle":case "strokeStyle":case "lineWidth":case "fillMode":case "centerShift":return!0}return c.prototype.tc.call(this,
a)};a.prototype.setProperty=function(a,d){"fillStyle"===a&&this.md&&!this.md.closed&&(a="strokeStyle");c.prototype.setProperty.call(this,a,d)};a.prototype.Rg=function(){return!0};a.prototype.format=function(a,c){var b=this,d=this.ia("url");this.Kt!==d?(this.Kt=d,c.oE(d,function(a){a&&a.src===b.Kt&&(b.md=a,b.path=null,c.Bf(b.id))})):this.md&&(d="",this.ba.fillStyle&&(d+="\n               .fill {\n                 fill: "+this.ba.fillStyle+";\n               }"),this.ba.strokeStyle&&(d+="\n               .stroke {\n                fill: "+
this.ba.strokeStyle+";\n                 stroke: "+this.ba.strokeStyle+";\n               }"),this.md.Va(d),null===this.path&&"custom"===this.ba.fillMode&&(this.path=new vc,d=new Se(this.path),this.md.ka(d),this.path=this.path.mh(2)),this.xa=this.md.rect.clone(),this.scale=this.ba.width?this.ba.width/this.xa.width:1,this.xa.width*=this.scale,this.xa.height*=this.scale,this.fb=new zc(this.xa),d=this.Pa(),this.fb.transform(d),this.rect=this.fb.Cm(),d=this.ba.text)&&(this.Ya.El(this.ba.fontName||"sans-serif",
this.ba.fontSize||10,this.ba.bold||!1,this.ba.italic||!1,this.ba.textDecoration||""),this.Ya.kd(d),this.Ya.Bl(this.ia("textAlign"),"middle"),d=Ri(this.md,this.Pa().multiply(new lc(this.scale,this.scale))),this.Ya.Qo([d]),this.Ya.bG(this.ba.centerShift||0),this.gx=Si(d),this.Ya.format(a,0,0))};a.prototype.ia=function(a){if("custom"===this.ba.fillMode)switch(a){case "fillStyle":return this.ba.fillStyle||"transparent";case "strokeStyle":return this.ba.strokeStyle||q.Oa;case "lineWidth":return this.ba.lineWidth||
0}switch(a){case "textAlign":return this.ba.name||"center";case "text":return this.ba.text||""}return c.prototype.ia.call(this,a)};a.prototype.hb=function(){var a=c.prototype.hb.call(this);"custom"===a.fillMode&&(a.fillStyle=this.ia("fillStyle"),a.strokeStyle=this.ia("strokeStyle"),a.lineWidth=this.ia("lineWidth"));return a};a.prototype.zg=function(a){if(this.md){a.save();if("custom"===this.ba.fillMode){if(a.scale(this.scale,this.scale),a.beginPath(),this.path?this.path.ka(a):this.md.ka(a,null,!0),
a.fillStyle=this.ia("fillStyle"),a.fill(),0<this.ia("lineWidth")){var b=this.lc();b.hp().multiply(b).rc(a);a.strokeStyle=this.ia("strokeStyle");a.lineWidth=this.ia("lineWidth")/this.scale;a.stroke()}}else b=this.Pa(),b.inverse().rc(a),b=(new lc(this.scale,this.scale)).multiply(b),this.md.ka(a,null,!1,b);a.restore();this.ba.text&&(a.save(),a.beginPath(),this.lc().rc(a),a.fillStyle=this.ba.textFillStyle||q.Oa,this.Ya.fillText(a,0,this.gx),a.restore())}};return a}(pd);pd.Pd("SvgNode",Ti);
function Ri(c,a){var b=new vc,d=new Se(b);a.rc(d);c.ka(d);c=[];a=0;for(b=b.mh(1).fe();a<b.length;a++)c.push.apply(c,b[a]);return Pc(c)}function Si(c){if(0===c.length)return 0;for(var a=c[0].y,b=1;b<c.length;b++)c[b].y<a&&(a=c[b].y);return a};var Ui=function(c){function a(a,d){a=c.call(this,a,d)||this;a.qm="UnknownNode";a.width=100;a.height=20;a.Ya=new ee;a.log=v.create("UNKNOWN",!0);a.Ya.Bl("center","middle");return a}__extends(a,c);a.prototype.KG=function(a){this.qm=a;this.Ya.kd(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.qm};a.prototype.tc=function(){return!0};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.qm);this.rect=new K(0,0,this.width,this.height);
this.xa=this.rect.clone();this.rect.transform(this.ba.matrix);this.Ya.format(a,this.width,this.height)};a.prototype.zg=function(a){this.log("Drawing placeholder for for %s",this.qm);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle=q.Oa;this.Ya.ka(a,0,0);a.restore()};a.Rt=!1;return a}(pd);pd.Pd("UnknownNode",Ui);var Vi=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.rI="DataNode";return a}__extends(a,c);a.prototype.type=function(){return"DataNode"};a.prototype.tc=function(){return!0};return a}(jd);jd.Pd("DataNode",Vi);var Wi=v.create("HTMLGridNode"),Yi=function(c){function a(a,d){a=c.call(this,a,d)||this;a.lines=[[],[]];a.jb|=8;a.fg=new Oh(a.aa.pc);a.Qb(Qh(a.aa.pc,{columns:[100],rows:[100]}));return a}__extends(a,c);a.prototype.type=function(){return"GridNode"};a.prototype.tc=function(a){return 0===a.indexOf("line.")||c.prototype.tc.call(this,a)};a.prototype.setProperty=function(a,d){if(0===a.indexOf("line.")){var b=a.substr(5);d?this.FF(Ph.fc(b,d)):this.AF(b)}return c.prototype.setProperty.call(this,a,d)};a.prototype.FF=
function(a){for(var b=a.Ni,c=0;c<this.lines[b].length;c++)if(this.lines[b][c].name===a.name){this.lines[b][c]=a;this.Ly();return}this.lines[b].push(a);this.Ly()};a.prototype.AF=function(a){for(var b=0;1>=b;b++)for(var c=0;c<this.lines[b].length;c++)if(this.lines[b][c].name===a){this.lines[b].splice(c,1);return}};a.prototype.Ly=function(){this.lines[0].sort(function(a,c){return Nh.pd(a.Na,c.Na)});this.lines[1].sort(function(a,c){return Nh.pd(a.Na,c.Na)})};a.prototype.nD=function(a){for(var b=0;1>=
b;b++)for(var c=0,f=this.lines[b];c<f.length;c++){var h=f[c];if(h.name===a)return h}return null};a.prototype.sn=function(a,c){var b=0,d=null,h=0;for(a=this.lines[a];h<a.length;h++){d=a[h];if(c===b)return d;b++}return-1===c?d:null};a.prototype.tn=function(a,c){var b=0,d=0;for(a=this.lines[a];d<a.length;d++){if(a[d].name===c.name)return b;b++}return-1};a.prototype.Pp=function(a,c,e){void 0===e&&(e={});return this.Au(0,c,a,e)};a.prototype.Qp=function(a,c,e){void 0===e&&(e={});return this.Au(1,c,a,e)};
a.prototype.CB=function(a,c){return this.Wx(1,a,c)};a.prototype.AB=function(a,c){return this.Wx(0,a,c)};a.prototype.Ws=function(a,c,e){void 0===e&&(e={});return this.vy(0,a,c,e)};a.prototype.Xs=function(a,c,e){void 0===e&&(e={});return this.vy(1,a,c,e)};a.prototype.vy=function(a,c,e,f){if(0>c||c>=this.lines[a].length-1)return Wi("Error: asked to set grid index "+c+" but there are "+this.lines[a].length+" grid lines"),f;var b=this.lines[a][c];b=new Ph(b.Ni,b.name,b.Na,e);f["line."+b.name]=b.encode();
Wi("Set grid %s, index=%s, size=%s, props",a,c,e,f);return f};a.prototype.Au=function(a,c,e,f){var b={ba:{},children:[]};var d=this.lines[a];var l=!1;if(-1==e||e==d.length-1){var n=d[d.length-2];d=d[d.length-1];l=!0}else n=d[e],d=d[e+1];if(!n||!d)return Wi("Can't addToGrid(%s,%s,%s)",a,c,e,n,d),b;if(c!==n.size){var r=n.clone(),u=r.size;r.size=c;c=u;b.ba["line."+r.name]=r.encode()}r=new Ph(a,Ph.Ut(),this.fg.Wp(n.Na,d.Na),c);b.ba["line."+r.name]=r.encode();Wi("Add grid %s, %s, %s, props",a,c,e,f);c=
1===a?"vertical":"horizontal";for(e=0;e<this.children.length;e++)if(f=this.tb(e),f.ia("_spanGrid")!==c&&(u=this.$q(f))){var x=!1;l&&u.end[a].name===d.name?(u.end[a]=r,x=!0):u.start[a].name===n.name&&(u.start[a]=r,x=!0);x&&(x={},x["style.gridArea"]=u.start[1].name+" / "+u.start[0].name+" / "+u.end[1].name+" / "+u.end[0].name,b.children.push({Ug:f.id,remove:!1,Tg:x}))}for(e=0;e<this.lines[a].length;e++);return b};a.prototype.Wx=function(a,c,e){var b={ba:{},children:[]},d=this.lines[a],k=d[c],l=d[e+
1];l||(l=d[d.length-1]);for(var n=0;n<this.children.length;n++){var r=this.tb(n),u=this.$q(r);if(u){var x=0>=Nh.pd(k.Na,u.start[a].Na)&&0<=Nh.pd(l.Na,u.start[a].Na),w=0>=Nh.pd(k.Na,u.end[a].Na)&&0<=Nh.pd(l.Na,u.end[a].Na),y=!1;x&&w?b.children.push({Ug:r.id,remove:!0,Tg:{}}):x?(u.start[a]=0<c?l:k,y=!0):w&&(u.end[a]=l,y=!0);y&&(x={},x["style.gridArea"]=u.start[1].name+" / "+u.start[0].name+" / "+u.end[1].name+" / "+u.end[0].name,b.children.push({Ug:r.id,remove:!1,Tg:x}))}}for(n=0;n<this.lines[a].length;n++);
for(n=c+1;n<=e;n++)a=d[n+1],b.ba["line."+a.name]=void 0;if(0!==c||e!==this.lines.length-1)0===c?(a=d[0].clone(),a.size=d[1].size,b.ba["line."+a.name]=a.encode(),b.ba["line."+d[c+1].name]=void 0):b.ba["line."+d[c].name]=void 0;return b};a.prototype.bD=function(a,c,e,f){a=this.sn(1,a);c=this.sn(0,c);e=-1===e?this.lines[1][this.lines[1].length-1]:this.sn(1,e);f=-1===f?this.lines[0][this.lines[0].length-1]:this.sn(0,f);return a&&c&&e&&f?a.name+" / "+c.name+" / "+e.name+" / "+f.name:""};a.prototype.$q=
function(a){var b=a.ia("style.gridArea");if(!b)return null;a=[];var c=0;for(b=b.replace(/ /g,"").split("/");c<b.length;c++){var f=b[c],h=this.nD(f);if(!h)return Wi("HTMLGridNode: Could not get line by name: %s",f),null;a.push(h)}return{start:[a[1],a[0]],end:[a[3],a[2]]}};a.prototype.LC=function(a){var b=this.$q(a);if(!b)return null;var c=this.tn(1,b.start[1]),f=this.tn(1,b.end[1]),h=this.tn(0,b.start[0]);b=this.tn(0,b.end[0]);return-1===c||-1===f||-1===h||-1===b?(Wi("Child %s has invalid gridArea: %s",
a,a.ia("style.gridArea")),null):{OF:c,NF:f,ZA:h,YA:b}};a.prototype.NC=function(){function a(a,b){for(var c=0;c<a.length;c++){var d=a[c];c<a.length-1?b.push("["+d.name+"] "+d.size+"px"):b.push("["+d.name+"]")}}var c=[];a(this.lines[1],c);c.push("/");a(this.lines[0],c);return c.join(" ")};a.prototype.createElement=function(){var a=document.createElement("div");a.style.display="grid";return a};a.prototype.format=function(a,d){for(var b=0;1>=b;b++)for(var f=0,h=0,k=this.lines[b];h<k.length;h++){var l=
k[h];l.Ja=f;f+=l.size}c.prototype.format.call(this,a,d);this.ea&&(this.ea.style.wI=this.NC())};a.prototype.ka=function(a){c.prototype.ka.call(this,a);a.beginPath();for(var b=this.ze,e=0,f=this.lines[0];e<f.length;e++){var h=f[e];a.moveTo(b.x+h.Ja,b.y);a.lineTo(b.x+h.Ja,b.bottom())}e=0;for(f=this.lines[1];e<f.length;e++)h=f[e],a.moveTo(b.x,b.y+h.Ja),a.lineTo(b.right(),b.y+h.Ja);a.rect(b.x,b.y,b.width,b.height);a.strokeStyle="#000";a.lineWidth=1;a.setLineDash&&a.setLineDash([3,2]);a.stroke()};a.prototype.sk=
function(a){var b=this.ze;a.beginPath();for(var c=0,f=this.lines[0];c<f.length;c++){var h=f[c];a.moveTo(b.x+h.Ja,b.y);a.lineTo(b.x+h.Ja,b.bottom())}c=0;for(f=this.lines[1];c<f.length;c++)h=f[c],a.moveTo(b.x,b.y+h.Ja),a.lineTo(b.right(),b.y+h.Ja);a.rect(b.x,b.y,b.width,b.height);a.strokeStyle="blue";a.lineWidth=3;a.setLineDash&&a.setLineDash([3,2]);a.stroke()};a.prototype.Fr=function(){return!0};a.prototype.bg=function(a,c,e){function b(b){if(0===b){var f=d.ze.x;var h=a}else f=d.ze.y,h=c;for(var k=
0;k<d.lines[b].length-1;k++){var l=d.lines[b][k];f+=l.size;if(Math.abs(f-h)<e)return new Xi(l,h)}return null}var d=this,k=this.Pa().apply(a,c);return this.ze.Xc(k.x,k.y,e)?b(0)||b(1):null};a.prototype.xf=function(a,c,e){var b={};if(!(a instanceof Xi))return b;var d=a.line.clone();e=(1===d.Ni?e:c)-a.Oy;d.size=Math.max(10,d.size+e);Wi("Adjust from %s to %s, offset=%s, newSize=%s",a.Oy,c,e,d.size);b["line."+d.name]=d.encode();return b};a.prototype.jr=function(){return{rows:this.lines[1].length-1,av:this.lines[0].length-
1}};return a}(pi),Xi=function(){function c(a,b){this.line=a;this.Oy=b}c.prototype.Lh=function(){return 1===this.line.Ni?"row-resize":"col-resize"};return c}();pd.Pd("HTMLGridNode",Yi);var Zi=v.create("RootNode"),$i=function(c){function a(a,d,e){a=c.call(this,a,d)||this;Zi("Root node is constructed: Traits=%s",a.jb);a.ea=e;return a}__extends(a,c);a.prototype.tc=function(){return!0};return a}(mi(jd));var wh=new fc(816,1056),aj=v.create("DOC"),vh=function(){function c(a,b,c,e,f,h){this.uw=c;this.Pf=e;this.uC=f;this.qe=h;this.cd=document.createElement("DIV");this.pc=Hh(3);this.gd=new si;this.Ic="0";this.dl=new si;this.removedNodes=new si;this.Es={};this.ak=new si;this.Wo=0;this.ft="magenta";this.readOnly=!1;this.Bq=new si;this.Pk=new si;this.Mt=new si;this.Ef=[];this.iy=this.Vh=this.rk=this.bb=0;this.zx=function(){};this.yk=[];this.Gg=new Wc;this.Zn=1;this.mt={};this.hj=0;this.Gr=!1;this.dz=new si;
this.cd.setAttribute("nid","0");this.root=new $i(this.Gk(),this,this.cd);this.Ra=new Mi(this,this.root);this.vb=new Ji(this.Ra,this.pc);a||(this.lb(),this.Uk(0,{}),this.Ea(!0));b&&this.cA(b);this.$w()}c.prototype.pG=function(a){this.Zn=a};c.prototype.cA=function(a){var b=this;B(a).query("[z-fixture]",function(a){var c=a.getAttribute("z-fixture")||"";b.rm(a,c)})};c.prototype.rm=function(a,b){var c=new pi(b,this);c.ea=a;c.Iv=!0;c.Ro(this.uw);aj("Register fixture %s",b);c.ea.setAttribute("nid",b);this.vb.tm(b);
this.Ra.jA(b,c);this.yk.push(c)};c.prototype.empty=function(){return 0===this.root.children.length};c.prototype.$w=function(){this.iy=this.vb.next};c.prototype.Qf=function(){return this.iy!==this.vb.next};c.prototype.Sa=function(){this.Ra.wd(function(a){a.Sa()})};c.prototype.Gk=function(){var a=this.Ic;this.Ic=((2147483647*Math.random()|0)+1).toString(36);return a};c.prototype.yd=function(a){return this.Ra.yd(a)};c.prototype.tx=function(a){aj("onCreateNode: %s",a);"PageNode"!==a.type()&&(this.dl.add(a.id),
this.removedNodes.remove(a.id));a.ia("spotHighlight")&&"PathNode"===a.type()&&this.Ef.push(a);this.Vh=this.mf(a.id)||0;"DomNode"===a.type()?this.Bq.add(a.id):"PageNode"===a.type()&&(this.rk=-1);N(a)&&(a.qo(),a.Bj(this.readOnly),this.gd.add(a.id),this.Mt.add(a.ue()));N(a)&&a.mn&&this.Gg.oy(a.id,a.mn())};c.prototype.Sg=function(a){this.ak.add(a);this.gd.add(a);var b=0;for(a=this.Gg.Wq([a]);b<a.length;b++){var c=a[b];this.ak.add(c);this.gd.add(c)}};c.prototype.za=function(a,b){void 0===b&&(b=!1);if(this.Ra.yd(a)){var c=
this.Ra.za(a);b&&this.Sg(a);return c}return null};c.prototype.Ob=function(a,b){void 0===b&&(b=!1);return(a=this.za(a,b))&&N(a)?a:null};c.prototype.mf=function(a){for(a=this.za(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;a=this.root.te(a);return 0<=a?a:null};c.prototype.vr=function(a,b){for(var c=[],e=0;e<a.length;e++){var f=this.za(a[e],!1);f&&c.push(f)}return c=b?this.hC(c):this.Im(c)};c.prototype.qC=function(a){var b=[];this.Ra.wd(function(c){c.ia("tag")===
a&&b.push(c)});return b};c.prototype.lb=function(){this.hj++;aj("begin(); nested transactions=%s",this.hj)};c.prototype.Ea=function(a,b){void 0===a&&(a=!1);void 0===b&&(b=!1);this.hj=Math.max(this.hj-1,0);aj("commit(skip=%s); nested transactions=%s",a,this.hj);0===this.hj?(this.vb.Ea(!1,a,b),this.Ra.Ea(!1)):aj("In a nested transaction; not committing.")};c.prototype.transaction=function(a,b){void 0===b&&(b=!1);this.lb();a(this);this.Ea(b)};c.prototype.ro=function(a){aj("onCommit occured");this.zx(a,
this.dl.Jc(),this.removedNodes.Jc(),this.ak.nk(this.dl).nk(this.removedNodes).Jc(),this.Es);this.dl=new si;this.removedNodes=new si;this.ak=new si;this.Es={}};c.prototype.nd=function(){this.vb.nd()};c.prototype.We=function(){this.vb.We()};c.prototype.Lf=function(){return this.vb.Lf()};c.prototype.Kf=function(){return this.vb.Kf()};c.prototype.Ko=function(){this.vb.iq()};c.prototype.vC=function(a,b,c){this.Nv(a,b,c,!0)};c.prototype.Nv=function(a,b,c,e){void 0===e&&(e=!1);for(var d=[],h=0;h<c.length;h++){var k=
c[h];d.push(k.id)}d=this.Gg.Wq(d);c=e?[]:c.concat();for(e=0;e<d.length;e++)(k=this.Ra.za(d[e]))&&N(k)&&c.push(k);this.rv(a,b,c)};c.prototype.format=function(a,b,c){var d=this,f=[];if(c)this.Ra.wd(function(a){N(a)&&f.push(a)});else{var h=this.bb;this.gd.wd(function(a){var b=d.Ra.za(a);a=d.mf(a);!N(b)||a!==h&&null!==a||f.push(b);return!1})}return this.rv(a,b,f)};c.prototype.rv=function(a,b,c){c=this.Im(c);this.Gg.sort(c);for(var d=B(this.cd).wb(),f=d.left,h=d.top,k=0,l=c;k<l.length;k++)d=l[k],d.format(a,
b),this.gd.remove(d.id),Uc(d)&&this.Dp(d.ea,f,h,this.Zn);if(!this.Gr)for(a=0,b=c;a<b.length;a++)d=b[a],d.Br().length&&(this.Gr=!0);return c.length};c.prototype.VB=function(a,b,c){if(0!==this.Ef.length&&b===this.Wo){a.save();a.beginPath();b=c||this.Pc();a.moveTo(b.x,b.y);a.lineTo(b.x,b.bottom());a.lineTo(b.right(),b.bottom());a.lineTo(b.right(),b.y);a.closePath();c=!1;for(var d=0;d<this.Ef.length;d++)this.mf(this.Ef[d].id)===this.bb&&(this.Ef[d].clip(a),c=!0);c&&(a.clip(),a.fillStyle=this.ft,a.fillRect(b.x,
b.y,b.width,b.height));a.restore()}};c.prototype.Rf=function(a,b){b=b||this.Pc();var c=this.ia("background");c&&(c=q.Ak(c))&&(a.fillStyle=c.toString(),a.fillRect(b.x,b.y,b.width,b.height))};c.prototype.ka=function(a,b,c){function d(d){k.Oc(function(b){if(!k.Pk.contains(b.Gc())&&b.ue()===d&&!b.hidden()){b.Po(n++);b.ka(a);for(var e=0,h=f.Pf;e<h.length;e++){var l=h[e];l.Eu(b)&&l.ka(a,b,l===c)}}});k.VB(a,d,b)}var f=this,h,k=this;this.Mt.add(this.Wo);var l=this.Mt.lH();l.sort(function(a,b){return a-b});
var n=0;var r=0;for(h=l.length;r<h;r++)d(l[r])};c.prototype.Db=function(a,b,c,e,f){var d=this,k={node:null,Of:null};this.Oc(function(h){if(f.has(h.Gc())){for(var l=h.Db(a,b,c,e),r=null,u=0,x=d.Pf;u<x.length;u++){var w=x[u];if(w.Eu(h)&&w.Db(h,a,b,0)){r=w;break}}(l||r)&&(null===k.node||k.node.ue()<=h.ue())&&(k.node=h,k.Of=r)}});return k};c.prototype.WD=function(a,b,c,e){var d=[],h=0,k={};this.Oc(function(f){f.Db(a,b,c,e)&&(d.push(f),k[f.id]=h,h+=1)});d.sort(function(a,b){return a.ue()!=b.ue()?a.ue()-
b.ue():k[a.id]-k[b.id]});d.reverse();return d};c.prototype.vn=function(a,b){var c=[];0===a.Ei()&&(b=!1);this.Oc(function(d){(!b&&a.contains(d.rect)||b&&a.Ex(d.rect))&&c.push(d)});return c};c.prototype.Im=function(a){var b,c=[],e={};var f=0;for(b=a.length;f<b;f++){var h=a[f];if("PageNode"!==h.type()){if(!N(h))continue;for(;h.Un()&&h.parent;)if(aj("Node type %s:%s is a group member",h.id,h.type()),N(h.parent))h=h.parent;else break}h.id in e||(e[h.id]=h,c.push(h))}this.ZG(c);return c};c.prototype.hC=
function(a){function b(a){if(!(a.id in e)&&(e[a.id]=a,c.push(a),0!=(a.jb&2)&&"PageNode"!==a.type()))for(var d=0;d<a.children.length;d++)b(a.tb(d))}for(var c=[],e={},f=0;f<a.length;f++)b(a[f]);return c};c.prototype.wd=function(a,b){function c(d){if(d.children.length){a&&N(d)&&b(d);for(var e=0;e<d.children.length;e++)c(d.tb(e))}else N(d)&&b(d)}c(this.root)};c.prototype.tk=function(a,b,c){function d(b){if((N(b)||c)&&!1===a(b))return!1;if(0!=(b.jb&2)){for(var e=[],f=0;f<b.children.length;f++)e.push(b.tb(f));
for(b=0;b<e.length;b++)if(!1===d(e[b]))return!1}return!0}void 0===c&&(c=!1);for(var f=0;f<b.children.length;f++)d(b.tb(f))};c.prototype.Oc=function(a,b){void 0===b&&(b=this.bb);b<this.root.children.length&&this.tk(a,this.root.tb(b||0))};c.prototype.ZB=function(a,b){void 0===b&&(b=this.bb);b<this.root.children.length&&this.tk(a,this.root.tb(b||0),!0)};c.prototype.FC=function(a){var b=!1,c=a.jn(),e=[];this.Oc(function(d){b?d.jn().$D(c)&&e.push(d):d===a&&(b=!0)});return e};c.prototype.ZG=function(a){var b=
0,c={};this.wd(!0,function(a){c[a.id]=b++});a.sort(function(a,b){return c[a.id]-c[b.id]})};c.prototype.SF=function(a){var b=[],c=0;this.Gg.sort(a);var e={};a=this.Im(a);for(var f=0;f<a.length;f++)c=this.nu(a[f],b,c,null,e);return"zwibblerclip."+JSON.stringify(b)};c.prototype.nu=function(a,b,c,e,f){var d=a.hb(),k={},l;for(l in d){var n=d[l];n instanceof L&&(n=["Matrix",n.m11,n.m12,n.m21,n.m22,n.Ha,n.Ia]);k[l]=n}if(N(a)&&a.rj){d=a.rj(f);for(var r in d)k[r]=d[r]}null===e&&a.parent&&"PageNode"!==a.parent.type()&&
(e=a.parent.id);b.push({type:"CreateAction",node:a.type(),parent:e,properties:k});f[a.id]=c.toString();k=c+1;for(e=0;e<a.children.length;e++)k=this.nu(a.tb(e),b,k,c,f);return k};c.prototype.Yw=function(a,b,c){var d,f;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var h=[];a=JSON.parse(a);var k={},l=0,n=0;var r=0;for(f=a.length;r<f;r++){var u=a[r];if("GroupAction"===u.type){var x=this.Gk();k[l++]=x;var w=[];x=0;for(u=u.members;x<u.length;x++)w.push(k[u[x]]);u=this.group(w);k[l++]=u;h.push(u)}else if("CreateAction"===
u.type){var y=u.properties;x={};for(d in y)y.hasOwnProperty(d)&&(w=y[d],"[object Array]"===Object.prototype.toString.apply(w)&&"Matrix"===w[0]&&(w.splice(0,1),w=new L(w)),x[d]=w);y=this.ln();var z=-1;w=!0;if("parent"in u&&u.parent in k)y=k[u.parent],w=!1;else if("PageNode"===u.node)y=this.root.id,z=this.bb+1+n,n+=1;else if("string"===typeof u.parent){var A=this.za(u.parent,!1);A&&this.Pr(A)?y=A.id:A&&this.mf(A.id)===this.bb&&(y=A.id)}"PageNode"!==u.node&&0===n&&(x.layer=c,"default"!==x.layer&&""!==
x.layer||delete x.layer);x=this.createNode(u.node,x,y,z);if((y=this.za(x,!1))&&N(y)&&y.rj){z=y.rj(k);A=!0;for(var G in z){A=!1;break}A||this.Ab([y.id],z)}k[l++]=x;("HTMLNode"!==u.node||w)&&h.push(x)}}0!==n||b.Gw()||this.nh(h,b);return h};c.prototype.yF=function(a,b){var c="function"!==typeof b?function(a){return a===b}:b;for(var e=0,f=0;f<a.length;f++)c(a[f])?e+=1:e&&(a[f-e]=a[f]);a.length-=e};c.prototype.ux=function(a){var b=this.mf(a.id)||0;this.dl.remove(a.id);this.ak.remove(a.id);this.removedNodes.add(a.id);
this.Es[a.id]=a.hb();N(a)&&a.vo();a.Sa();this.gd.remove(a.id);this.Gg.BF(a.id);a.ia("spotHighlight")&&this.yF(this.Ef,a);this.Bq.remove(a.id);"PageNode"===a.type()?(b===this.bb?(aj("Removed current page."),this.jd(Math.min(b,this.ob()-2)),this.Vh=this.bb):b<this.bb&&(this.jd(this.bb-1),this.Vh=this.bb),this.rk=-1):this.Vh=b};c.prototype.Xq=function(a){function b(a){if(!(a instanceof qi)){a=a.jw();if(!k||a.x<c)c=a.x;if(!k||a.right()>e)e=a.right();if(!k||a.y<f)f=a.y;if(!k||a.bottom()>h)h=a.bottom();
k=!0}}var c=0,e=0,f=0,h=0,k=!1;"number"===typeof a?this.Oc(b,a):this.wd(!0,b);return k?new K(c,f,e-c,h-f):new K(0,0,10,10)};c.prototype.cE=function(a){return 0===a.x&&0===a.y&&10===a.width&&10===a.height};c.prototype.pw=function(){var a=this.Oe(void 0),b=null;a instanceof ti&&(b=a.Pc());return b||this.root.Qh("width")};c.prototype.Pc=function(a,b){var c=null;if(void 0!==a){var e=this.Oe(a);e instanceof ti&&(c=e.Pc())}return c?c:this.ia("width")?new K(this.ia("x")||0,this.ia("y")||0,this.ia("width"),
this.ia("height")):b?new K(0,0,b.width,b.height):this.Xq(a)};c.prototype.ia=function(a){return this.root.ia(a)};c.prototype.Qh=function(a){return this.root.Qh(a)};c.prototype.setProperty=function(a,b){this.ce([this.root.id],a,b)};c.prototype.hb=function(){return this.root.hb()};c.prototype.ce=function(a,b,c){var d={};d[b]=c;this.lb();this.Ab(a,d);this.Ea()};c.prototype.Ui=function(a,b){if(a=this.za(a))return a.ia(b)};c.prototype.Xn=function(a){return this.Ra.yd(a)};c.prototype.Ab=function(a,b){var c=
this;this.hf(a,function(a){c.vb.Qb(a.id,b)})};c.prototype.tg=function(a,b){var c=this,e={};this.hf(a,function(a){e[a.id]=c.Ra.tg(a.id,b)});return e};c.prototype.Hi=function(a){var b=this;this.hf(a,function(a){b.Ra.Hi(a.id)})};c.prototype.xx=function(a,b){N(a)&&a.mn&&this.Gg.oy(a.id,a.mn());this.Sg(a.id);this.Vh=this.mf(a.id)||0;if("spotHighlight"in b&&"PathNode"===a.type()){for(var c=0;c<this.Ef.length;c++)if(this.Ef[c]===a){this.Ef.splice(c,1);break}b.spotHighlight&&"PathNode"===a.type()?(aj("Added node %s to spotHighlightNodes",
a.id),this.Ef.push(a)):aj("Removed node %s from spotHighlightNodes",a.id)}};c.prototype.Kl=function(a,b){aj("showLayer(%s, %s)",a,b);b?(this.Pk.remove(a),this.Oc(function(b){if(b.Gc()===a){b.qo();var c=b.parent;Tc(c)&&(b=c.te(b),c.Jl(b,!0))}})):(this.Pk.add(a),this.Oc(function(b){if(b.Gc()===a){b.vo();var c=b.parent;Tc(c)&&(b=c.te(b),c.Jl(b,!1))}}))};c.prototype.Vn=function(a){return!this.Pk.contains(a)};c.prototype.Uk=function(a,b){aj("Adding page to document with index %s",a);if(a>this.root.children.length)return aj("Error: Can insert page with index %s",
a),-1;this.createNode("PageNode",b,this.root.id,a);return a};c.prototype.ob=function(){return this.root.children.length};c.prototype.jd=function(a){if(a!==this.bb)if(0<=a&&a<this.ob())aj("Set current page to %s/%s",a,this.ob()),this.bb=a,this.format(this.uC,this.qe,!1);else return aj("Tried to set page to non-existing %s",a),!1;return!0};c.prototype.TG=function(){if(this.rk!==this.bb){this.st(this.rk,!1);this.st(this.bb,!0);this.rk=this.bb;for(var a=0;a<this.ob();a++)this.root.Jl(a,a===this.bb)}};
c.prototype.st=function(a,b){var c=this;b?this.Oc(function(a){"DomNode"!==a.type()||c.Pk.contains(a.Gc())||a.qo()},a):this.Bq.wd(function(a){(a=c.Ob(a,!1))&&a.vo()})};c.prototype.Oe=function(a){void 0===a&&(a=this.bb);return 0===this.root.children.length?this.root:this.root.tb(a)};c.prototype.wr=function(){return this.Pc(this.bb,wh)};c.prototype.Bj=function(a){this.wd(!1,function(b){b.Bj(a)})};c.prototype.getRootNode=function(){return this.root};c.prototype.Zw=function(a,b){var c=b.$type||b.type||
"",e=jd.create(c,a,this);e||(c in E.Nm?(e=new Eh(a,this),e.setProperty("nodeType",c)):(aj("Bad node type: %s",c),a=jd.create("UnknownNode",a,this),a.KG(c),e=a));5===(e.jb&5)&&e.Ro(this.uw);e.Qb(b);return e};c.prototype.createNode=function(a,b,c,e,f,h){void 0===h&&(h=!1);f||(f=this.Gk());c||(c=this.ln());var d=this.za(c);if(!d)throw Error("createNode type="+a+": parent "+c+" does not exist");if(void 0===e||-1==e)e=d.children.length;b.$type=a;h?(this.mt[f]=!0,this.Ra.createNode(f,c,e,b)):this.vb.createNode(f,
c,e,b);return f};c.prototype.hf=function(a,b){for(var c=0;c<a.length;c++){var e=a[c],f=this.za(e);f?b(f):aj("Node %s does not exist",e)}};c.prototype.wc=function(a){function b(a){for(var d=a.children.length-1;0<=d;d--)b(a.tb(d));c.mt[a.id]?(delete c.mt[a.id],c.Ra.ff(a.id)):c.vb.ff(a.id)}var c=this;a.push.apply(a,this.Gg.Wq(a));this.hf(a,function(a){a.parent?b(a):aj("deleteNode(%s): node has no parent",a.id)})};c.prototype.nh=function(a,b){var c=this;this.hf(a,function(a){N(a)&&c.Ab([a.id],a.Ge(b))})};
c.prototype.xf=function(a,b,c,e,f){var d=this.Ob(a,!0);d&&0!=(d.jb&16)&&this.Ab([a],d.xf(b,c,e,f))};c.prototype.ln=function(){return this.root.tb(this.bb).id};c.prototype.group=function(a){var b=this.createNode("GroupNode",{});this.Yj(b,a);return b};c.prototype.Yj=function(a,b){var c=this,e=this.za(a);if(e&&0!=(e.jb&2)){var f=e.children.length;this.hf(b,function(b){if(!b.parent)throw Error("Expected node to have a parent");c.vb.Cd(b.id,a,f++)});this.Sg(a)}};c.prototype.Nj=function(a){var b=this,c=
{};this.hf(a,function(a){if(a instanceof qi&&!(a.id in c)&&a.parent){c[a.id]=!0;for(var d=a.parent.children.length,e=a.children.length-1;0<=e;e--){var k=a.tb(e);b.vb.Cd(k.id,a.parent.id,d)}b.wc([a.id])}})};c.prototype.duplicate=function(a,b){function c(a,d){if(!f.has(a.id)){f.add(a.id);var l=a.hb();if(N(a)){var n=a.Ge(b),x;for(x in n)l[x]=n[x];if(a.rj){n=a.rj(k);for(var w in n)l[w]=n[w]}}d=e.createNode(a.type(),l,d);h.push(d);k[a.id]=d;if(0!=(a.jb&2))for(l=0;l<a.children.length;l++)c(a.tb(l),d)}}
var e=this,f=new Set,h=[],k={};this.hf(a,function(a){null!==a.parent&&c(a,a.parent.id)});return h};c.prototype.Cd=function(a,b,c){var d=this.za(a);if(null===d)throw Error("moveNode: "+a+" does not exist");var f=this.za(b);if(null===f)throw Error("moveNode: New parent "+b+" does not exist");-1===c&&(c=d.parent!==f?f.children.length:f.children.length-1);if(null===d.parent)throw Error("Expected a parent");f===d.parent&&c===d.parent.te(d)?aj("moveNode: Skip moving to the same place"):this.vb.Cd(a,b,c)};
c.prototype.Sd=function(a,b,c){var d=this;void 0===c&&(c=-1);this.hf(a,function(a){if(a.parent){var e=a.parent.id,f=a.parent.te(a);switch(b){case 0:d.Cd(a.id,e,-1);break;case 1:d.Cd(a.id,e,0);break;case 3:0<f&&d.Cd(a.id,e,f-1);break;case 2:f<a.parent.children.length-1&&d.Cd(a.id,e,f+1);break;case 4:d.Cd(a.id,e,c)}}})};c.prototype.Su=function(a,b){var c=!0;this.hf(a,function(a){if(a.parent){var d=a.parent.te(a);switch(b){case 0:case 2:d===a.parent.children.length-1&&(c=!1);break;case 1:case 3:0===
d&&(c=!1)}}});return c};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a,b){void 0===b&&(b="");if(!(a instanceof jd))return b+"NOT A NODE: "+a+"\n";for(var c=b+" "+a+"\n",e=0;e<a.children.length;e++)c+=this.encode(a.tb(e),b+"  ");return c};c.prototype.kr=function(a){if(a instanceof Element)for(;a;){var b=a.getAttribute("nid");if(b&&(b=this.za(b))&&5===(b.jb&5))return b;a=a.parentElement}return null};c.prototype.Km=function(){var a=B(this.cd).wb();this.Dp(this.cd,
a.left,a.top,this.Zn)};c.prototype.Dp=function(a,b,c,e){if(a instanceof HTMLElement){var d=a.getAttribute("nid")||"0";if((d=this.za(d))&&Uc(d)){var h=B(a).wb();e=new K((h.left-b)/e,(h.top-c)/e,h.width/e,h.height/e);d.Il(e)}for(a=a.firstElementChild;a;)this.Dp(a,b,c,this.Zn),a=a.nextElementSibling}};c.prototype.zr=function(){return this.vb.zr()};c.prototype.yr=function(a,b){return this.vb.yr(a,b)};c.prototype.locked=function(){return this.vb.locked()};c.prototype.Cr=function(a){return this.vb.Cr(a)};
c.prototype.hE=function(a){return Uc(a)?B(a.ea).matches("[z-fixture] *"):!1};c.prototype.Pr=function(a){return Uc(a)&&a.ea.hasAttribute("z-fixture")};c.prototype.Qs=function(a){var b=this;if(this.Gr){var c=new si;this.Ra.wd(function(d){if(N(d)){var e=0;for(d=d.Br();e<d.length;e++){var h=d[e],k=b.za(h.Ug);if(k&&N(k)){var l=0,n=0;void 0!==h.pp&&(a.y>k.rect.y&&(n=a.y-k.rect.y),0<h.pp&&n+k.rect.height>h.pp&&(n=h.pp-k.rect.height));void 0!==h.op&&(a.x>k.rect.x&&(l=a.x-k.rect.x),0<h.op&&l+k.rect.width>
h.op&&(l=h.op-k.rect.width));if(0<n||0<l)k.So(l,n),c.add(k.id)}}}});this.dz.nk(c).wd(function(a){(a=b.za(a))&&N(a)&&a.So(0,0)});this.dz=c}};return c}();var Ah=new (function(){function c(){this.log=v.create("serializer");this.Pt={pdf:"application/pdf",svg:"image/svg+xml",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp"}}c.prototype.yi=function(a,b,c,e,f,h){if(a instanceof Array)b=this.yw(a,b,c,e,f,h);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.pE(a,b,c,e,f,h);else if(0===a.indexOf("zwibbler3."))a=JSON.parse(a.substr(10)),b=this.yw(a,b,c,e,f,h);else if(0===
a.indexOf("zwibblerclip."))b=new vh(!1,b,c,e,f,h),b.Yw(a,new L,"default"),b.setProperty("background",q.he),1<b.ob()&&b.wc([b.Oe(0).id]),b.Ko();else{try{Hi(a);var d=!0}catch(l){d=!1}if(d)b=new vh(!0,b,c,e,f,h),b.vb.wh(a);else throw Error("Format detection failed.");}}for(a=1;a<b.ob();a++)b.st(a,!1);return b};c.prototype.pE=function(a,b,c,e,f,h){function d(a){var b=new L;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Ha=a.dx;b.Ia=a.dy;return b}function l(a,b){switch(a.type){case "Node":var c=[];
a=a.children;for(var e=a.length-1;0<=e;e--)try{c.push(l(a[e],b+1))}catch(M){}return 0<b?r.group(c):"";case "PathNode":case "ArrowNode":var f=a;c=0;"arrowSize"in f&&(c=f.arrowSize,f=f.path);b=d(f.matrix);c={strokeStyle:f.strokeStyle,fillStyle:f.fillStyle,lineWidth:f.lineWidth,smoothness:f.smoothness,sloppiness:f.sloppiness,shadow:f.shadow,arrowSize:c,seed:Math.round(65535*Math.random())};"textNode"in f&&(a=f.textNode,c.fontSize=a.fontSize,c.fontName=a.fontName,c.text=a.text,c.textFillStyle="textFillStyle"in
a?a.textFillStyle:a.fillStyle);"path"in f&&(f=f.path);var h=f.startX,k=f.startY;a=f.closed;e=new P;f=f.segments;h=b.apply(h,k);e.moveTo(h.x,h.y);for(h=0;h<f.length;h++){var n=f[h];switch(n.type){case 1:k=b.apply(n.x,n.y);e.lineTo(k.x,k.y);break;case 2:k=b.apply(n.x,n.y);e.jk(k.x,k.y);break;case 3:k=b.apply(n.x1,n.y1);n=b.apply(n.x,n.y);e.Bh(k.x,k.y,n.x,n.y);break;default:throw Error("Unknown path segment type: "+n.type);}}a&&e.close();c.commands=e.Jc();return r.createNode("PathNode",c);case "TextNode":return b=
d(a.matrix),b=b.multiply(new jc(0,1.3*a.fontSize)),r.createNode("TextNode",{fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:b});default:throw Error("Unknown node type: "+a.type);}}var n=v.create("IMPORT"),r=new vh(!1,b,c,e,f,h);try{var u=JSON.parse(a)}catch(x){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{u=JSON.parse(a)}catch(w){throw n("Couldn't parse file."),Error("Couldn't parse file.");}}n("Successfully parsed!");l(u,0);r.Ea(!0);return r};c.prototype.yw=
function(a,b,c,e,f,h){function d(a,b){if(void 0!==a){var c=a;switch(a.type){case "StampLineNode":c={id:a.id,parent:a.parent,type:"PathNode",arrowSize:0,closed:!1,fillStyle:q.he,fontName:"Arial",layer:"default",lineWidth:2,matrix:a.matrix,seed:6125,shadow:!1,sloppiness:0,smoothness:.3,text:"",textFillStyle:q.Oa,children:a.children,commands:[0,a.x1||0,a.y1||0,1,a.x2||0,a.y2||0],strokeStyle:"url("+a.url+")"}}a=c;c={};for(var e in a)if(a.hasOwnProperty(e)&&"children"!==e&&"parent"!==e&&"id"!==e&&"type"!==
e)if("matrix"===e){var f=new L(a[e]);if(!f.isFinite()){z.log("Tried to load node a with malformed Matrix. Skipping.");return}c[e]=f}else"__type"===e?c.type=a[e]:c[e]=a[e];if(a.fixture)e=a.fixture;else if("id"in a)e=a.id.toString(36);else return;"0"!==b||n||(b=x.ln());0===a.id||w[a.id]||x.createNode(a.type,c,b,-1,e);if(void 0!==a.children)for(b=0;b<a.children.length;b++)d(a.children[b],e)}}a=JSON.parse(JSON.stringify(a));for(var l={},n=!1,r=0,u=a;r<u.length;r++)if("PageNode"===u[r].type){n=!0;break}var x=
new vh(n,b,c,e,f,h),w={};b=0;for(c=x.yk;b<c.length;b++)w[c[b].id]=!0;x.lb();for(b=0;b<a.length;b++){e=a[b];if("document"===e.type||0===e.id){delete e.type;for(var y in e)x.setProperty(y,e[y])}if("parent"in e){if(!(e.parent in l))throw Error("Error: child "+e.id+" references parent "+e.parent+" before it was defined.");c=l[e.parent];void 0!==c.children?c.children.push(e):c.children=[e]}"GroupNode"!==e.type&&"PageNode"!==e.type||void 0!==e.children||(e.children=[]);l[e.fixture||e.id]=e}var z=this;d(l[0],
"0");for(var A in l)A in w&&d(l[A],"");x.Ea(!0);return x};c.prototype.Bv=function(a){function b(a,d){var f=d.id in e,h={type:d.type()};f?h.fixture=d.id:h.id=parseInt(d.id,36);c.push(h);a&&(h.parent=a.id in e?a.id:parseInt(a.id,36));a=d.hb();for(var k in a)a.hasOwnProperty(k)&&(a[k]instanceof L?h[k]=a[k].Jc():"inverse"!==k&&("type"===k?h.__type=a[k]:h[k]=a[k]));for(h=0;h<d.children.length;h++)b(d,d.tb(h))}for(var c=[],e={},f=0,h=a.yk;f<h.length;f++){var k=h[f];e[k.id]=!0}b(null,a.getRootNode());f=
0;for(a=a.yk;f<a.length;f++)k=a[f],b(null,k);return c};c.prototype.Cp=function(a,b,c){b in this.Pt&&(b=this.Pt[b]);if("list"===b){a=this.Bv(a);var d="application/json"}else if("zwibbler3"===b)a=this.Bv(a),a="zwibbler3."+JSON.stringify(a),d="application/octet-stream";else if("changedata"===b)a=a.vb.BC().toString(),d="application/octet-stream";else if("image/svg+xml"===b){d=a.Pc();var f=new Hg(d);a.Rf(f);a.ka(f);a=f;d="image/svg+xml"}else if("application/pdf"===b){d=a.Pc(0);f=new Eg(new K(0,0,d.width,
d.height),E.fonts);var h=a.bb;for(b=0;b<a.ob();b++)0<b&&(d=a.Pc(b),f.Gj(d)),f.translate(-d.x,-d.y),a.jd(b),a.Rf(f),a.ka(f);a.jd(h);a=f;d="application/pdf"}else if(!(d="image/png"===b||"image/bmp"===b)&&(d="image/jpeg"==b)&&(d=document.createElement("canvas"),f=!1,d.width=10,d.height=10,"toDataURL"in d&&(f=0<d.toDataURL("image/jpeg").indexOf("jpeg")),Yc("JPEG supported: %s",f),d=f),d)f=document.createElement("canvas"),d=a.Pc(),f.width=d.width,f.height=d.height,h=f.getContext("2d"),h.translate(-d.x,
-d.y),a.Rf(h),a.ka(h),a=gd(f,b,"data-uri"),a=a.split(",")[1],a=atob(a),d=b;else throw Error("Unknown save format: "+b);if("string"===typeof a)if("string"===c)var k=a;else if("data-uri"===c)c=d.startsWith("image")?btoa(a):Ra(Sa(a)),console.log("Result is 1st case",a),k="data:"+d+";base64,"+c;else{if("blob"===c){c=new Uint8Array(a.length);for(b=0;b<a.length;b++)c[b]=a.charCodeAt(b);k=new Blob([c],{type:d})}}else if(a.toBlob&&a.toString)"string"===c?k=a.toString():"data-uri"===c?k="data:"+d+";base64,"+
btoa(a.toString()):"blob"===c&&(k=a.toBlob());else if("object"===c)k=a;else throw Error("Error in ZwibblerDocument.save()");return k};return c}());var bj=v.create("OPENTYPE");function cj(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw console.log(Error(a)),Error(a);}
var dj=function(){function c(a,b){this.code=a;this.Ue=b}c.prototype.toString=function(){return(255<this.code?"code=12 "+(this.code&255):""+this.code)+" "+JSON.stringify(this.Ue)};return c}(),ej=function(){function c(a,b,c){void 0===b&&(b=0);void 0===c&&(c=a.length-b);this.Hu=a;this.start=b;this.length=c;this.Ja=0}c.prototype.oa=function(a){for(var b=0;a--;)b=256*b+this.Hu[this.Ja++ +this.start];return b};c.prototype.getInt16=function(){var a=this.oa(2);a&32768&&(a-=65536);return a};c.prototype.Xi=
function(a,b){void 0===b&&(b=1);for(var c="",e=0;e<a;e+=b)c+=String.fromCharCode(this.oa(b));return c};c.prototype.Ih=function(){return this.getInt16()/16384};c.prototype.seek=function(a){if(a>this.length)throw Error("Seek to invalid location");var b=this.Ja;this.Ja=a;return b};c.prototype.slice=function(a,b){void 0===b&&(b=this.length-a);return new c(this.Hu,a+this.start,b)};c.prototype.Hr=function(){var a;void 0===a&&(a=this.Ja);this.seek(a);var b=this.oa(2);if(0<b){var c=this.oa(1);this.seek(a+
3+c*b);var e=this.oa(c);this.seek(a+3+(b+1)*c-1+e)}return a};c.prototype.nr=function(a){this.seek(a);a=this.oa(2);var b=this.oa(1);if(4<b)throw Error("Error: This is not an index; offsetSize="+b);return a};c.prototype.Tk=function(a,b){this.seek(a);var c=this.oa(2);if(b>=c)throw Error("Tried to read past end of index");var e=this.oa(1);this.seek(a+3+e*b);b=this.oa(e);var f=this.oa(e);return this.slice(a+3+(c+1)*e-1+b,f-b)};c.prototype.Lq=function(){return this.Ja>=this.length};c.prototype.aw=function(a,
b){void 0===a&&(a=!1);void 0===b&&(b=[]);for(b=new dj(0,b);;){if(this.Lq())throw Error("Unexpected end of charstring");var c=this.oa(1);if(12===c)return b.code=3072|this.oa(1),b;if(28>c||a&&29<=c&&31>=c)return b.code=c,b;if(30===c){var e="";a:for(;;){c=this.oa(1);for(var f=4;0<=f;f-=4){var h=c>>f&15;switch(h){case 10:e+=".";break;case 11:e+="E";break;case 12:e+="E-";break;case 14:e+="-";break;case 15:break a;case 14:break;default:e+=h.toString()}}}b.Ue.push(parseFloat(e))}else 29===c?(e=this.oa(1),
c=this.oa(1),f=this.oa(1),h=this.oa(1),b.Ue.push(e<<24|c<<16|f<<8|h)):28===c?(e=this.oa(1),c=this.oa(1),b.Ue.push(e<<8|c)):a&&255===c?b.Ue.push(this.oa(4)/65536):251<=c?(e=this.oa(1),b.Ue.push(256*-(c-251)-e-108)):247<=c?(e=this.oa(1),b.Ue.push(256*(c-247)+e+108)):b.Ue.push(c-139)}};return c}(),fj=function(){function c(a){this.tt=[];var b=this.n=0;for(a=a.split(/([:\[\]\(\)\-\.{}]|\d+)|\s+/);b<a.length;b++){var c=a[b];c&&c.length&&this.tt.push(c)}}c.prototype.next=function(){return this.tt[this.n++]};
c.prototype.match=function(a){return this.tt[this.n]===a?(this.n+=1,!0):!1};c.prototype.value=function(a){var b=this.next(),c=parseFloat(b);return isNaN(c)?a[b]:c};c.prototype.vk=function(a){this.n=a;return!1};return c}();function gj(c,a,b,d){if(c.match("{")){for(b={};hj(c,a,b,d););c.match("}");return b}return ij(c,a,b,d)}
function hj(c,a,b,d){var e=c.n;if(c.match("push")){var f=jj(c,b);for(a=a.slice(f);hj(c,a,b,d););return c.match("pop")?!0:!1}f=c.next();return c.match(":")?(c=ij(c,a,b,d),"_"!==f&&(b[f]=c),!0):c.vk(e)}
function ij(c,a,b,d){var e=c.n;if(c.match("[")){var f=jj(c,b),h="",k=[];c.match(".")&&(h=c.next(),k={});if(!c.match("]"))return c.vk(e);e=c.n;for(var l=0;l<f;l++){c.n=e;var n=gj(c,a,b,d);""===h?k.push(n):k[n[h]]=n}0===f&&gj(c,a,b,!0);return k}if(c.match("("))return b=jj(c,b),c.match(")"),b;if(c.match("uint"))return b=c.value(b)/8,d?0:a.oa(b);if(c.match("int"))return c.next(),d?0:a.getInt16();if(c.match("offset"))return a.Ja;if(c.match("date"))return c=1E3*(4294967296*a.oa(4)+a.oa(4))+Date.UTC(1904,
0,1),new Date(c);if(c.match("fixed"))return d?0:a.oa(4)/65536;if(c.match("string")){if(!c.match("("))return c.vk(e);b=jj(c,b);return c.match(")")?d?0:a.Xi(b):c.vk(e)}return c.vk(e)}function jj(c,a){var b=c.value(a);c.match("-")?b-=c.value(a):c.match(":")&&(c=c.value(a),b=b>>c&1);return b}function kj(c,a){return gj(new fj(a),c,null,!1)}
var nj=function(){function c(){this.fonts=[]}c.prototype.add=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return[4,fetch(a,{cache:"force-cache"})];case 1:b=d.sent();if(200!==b.status)throw Error("Received HTTP "+b.status+" when fetching "+a);return[4,b.arrayBuffer()];case 2:return c=d.sent(),[2,this.ZE(new Uint8Array(c))]}})})};c.prototype.xF=function(){this.fonts.length=0};c.prototype.get=function(a){for(var b=0,c=this.fonts;b<
c.length;b++){var e=c[b];if(e.Qi===a||e.fontFamily===a)return e}return null};c.prototype.sB=function(a,b){var c=[],e=b.bold||!1,f=b.Zd||!1;b=0;for(var h=this.fonts;b<h.length;b++){var k=h[b];k.fontFamily===a&&c.push(k)}c.sort(function(a,b){var c=0,d=0;a.bold===e&&c++;a.Zd===f&&c++;b.bold===e&&d++;b.Zd===f&&d++;return d-c});return 0===c.length?null:new lj(c,f)};c.prototype.ZE=function(a){a=new ej(a);var b=a.oa(4);a.seek(0);a=1953784678===b?this.fA(a):[new mj(a)];b=0;a:for(;b<a.length;b++){for(var c=
a[b],e=0,f=this.fonts;e<f.length;e++)if(f[e].Qi===c.Qi){bj("Not adding %s; already have it.");continue a}bj("Opened font: %s weight=%s italic=%s",c.Qi,c.weight,c.Zd);this.fonts.push(c)}return a};c.prototype.fA=function(a){var b=kj(a,"{\n    ttcTag:string(4)\n    majorVersion:uint16\n    minorVersion:uint16\n    numFonts:uint32\n    offsetTable:[numFonts] uint32\n}");bj(JSON.stringify(b,null,2));bj("Collection contains %s fonts",b.numFonts);var c=[],e=0;for(b=b.offsetTable;e<b.length;e++)c.push(new mj(a,
b[e]));return c};return c}(),lj=function(){function c(a,b){this.fonts=a;this.Zd=b}c.prototype.tE=function(a,b){if(0!==this.fonts.length){for(var c=0,e=1,f=this.fonts[0];c+e<a.length;e++){var h=a.charCodeAt(c+e);if(0===f.ir(h)){for(var k=null,l=0,n=this.fonts;l<n.length;l++){var r=n[l];if(r!==f&&r.ir(h)){k=f;break}}k&&(e&&(b(f,a.substr(c,e)),c+=e,e=0),f=k)}}e&&b(f,a.substr(c,e))}};c.prototype.Hq=function(a,b,c,e,f){var d=this;this.tE(b,function(b,h){b=b.Hq(a,h,c,e,f,d.Zd&&!b.Zd?.2:0);h=b.y;c=b.x;e=
h})};return c}(),mj=function(){function c(a,b){void 0===b&&(b=0);this.Ba=a;this.ee={};this.Qi=this.fontFamily="";this.weight=0;this.bold=this.Zd=!1;this.ck=[];this.fq=null;this.Sr=[];a.seek(b);this.Re=kj(a,"{  \n    scalarType:uint32\n    numTables:uint16\n    searchRange:uint16\n    entrySelector:uint16\n    rangeShift:uint16\n    tables:[numTables.tag] {\n        tag:string(4)\n        checksum:uint32\n        offset:uint32\n        length:uint32\n    }\n}");bj(JSON.stringify(this.Re,null,2));for(var c in this.Re.tables)bj("Table: %s",
c);this.Fg("head","{\n    version:fixed\n    fontRevision:fixed\n    checksumAdjustment:uint32\n    magicNumber:uint32\n    flags:uint16\n    unitsPerEm:uint16\n    created:date\n    modified:date\n    xMin:int16\n    yMin:int16\n    xMax:int16\n    yMax:int16\n    macStyle:uint16\n    lowestRectPPEM:uint16\n    fontDirectionHint:uint16\n    indexToLocFormat:uint16\n    glyphDataFormat:uint16\n\n    bold:(macStyle:0)\n    italic:(macStyle:1)\n}");this.Fg("name","{\n    offset:offset\n    format:uint16\n    count:uint16\n    stringOffset:uint16\n    names:[count] {\n        platformID:uint16\n        platformSpecificID:uint16\n        languageID:uint16\n        nameID:uint16\n        length:uint16\n        offset:uint16\n    }\n}");
this.Fg("cmap","{\n    offset:offset\n    version:uint16\n    numberSubtables:uint16\n    subTables:[numberSubtables] {\n        platformID:uint16\n        platformSpecificID:uint16\n        offset:uint32\n    }\n}");this.Fg("hhea","{\n    version:fixed\n    ascent:int16\n    descent:int16\n    lineGap:int16\n    advanceWidthMax:uint16\n    minLeftSideBearing:int16\n    minRightSideBearing:int16\n    xMaxExtent:int16\n    caretSlopeRise:int16\n    caretSlopeRun:uint16\n    caretOffset:int16\n    reserved:uint64\n    metricDataFormat:int16\n    numOfLongHorMetrics:uint16\n}");
this.Fg("kern","{\n    version:uint16\n    nTables:uint16\n    tables:[nTables] {\n        version:uint16\n        length:uint16\n        coverage:uint16\n        offset:offset\n        _:[length-6] uint8\n    }\n}");this.Fg("maxp","{\n    version:fixed\n    numGlyphs:uint16\n}");this.Fg("OS/2","{\n    version:uint16\n    xAvgCharWidth:int16\n    usWeightClass:uint16\n    usWidthClass:uint16\n}");this.Fg("CFF ","{\n    offset:offset\n    major:uint8\n    minor:uint8\n}");this.hF(a,this.ee.name);this.cF(a,
this.ee.cmap);this.fF(a);this.gF(a,this.ee.kern);this.Zd=!!this.ee.head.italic;this.bold=!!this.ee.head.bold;this.weight=this.ee["OS/2"].usWeightClass;"CFF "in this.ee&&(this.fq=new oj(a.slice(this.ee["CFF "].offset)))}c.prototype.Fg=function(a,b){a in this.Re.tables&&(bj("Decoding %s",a),this.Ba.seek(this.Re.tables[a].offset),this.ee[a]=kj(this.Ba,b),bj(a+" table: %s",JSON.stringify(this.ee[a],null,2)))};c.prototype.hF=function(a,b){for(var c=0,e=b.names;c<e.length;c++){var f=e[c];a.seek(b.offset+
b.stringOffset+f.offset);var h=0===f.platformID||3===f.platformID?a.Xi(f.length,2):a.Xi(f.length);bj("PlatformID "+f.platformID+" NameID "+f.nameID+" is "+h);switch(f.nameID){case 1:this.fontFamily=h;break;case 4:this.Qi=h}}};c.prototype.cF=function(a,b){for(var c=0,e=b.subTables;c<e.length;c++){var f=e[c],h=f.platformID,k=f.platformSpecificID;f=b.offset+f.offset;a.seek(f);var l=a.oa(2),n=a.oa(2);bj("CMAP platform "+h+" "+k+" format "+l+" length "+n+" at "+f);switch(l){case 0:this.ck.push(new pj(a.slice(f,
n)));break;case 4:this.ck.push(new qj(a.slice(f,n)));break;case 12:n=a.oa(4),this.ck.push(new rj(a.slice(f,n)))}}};c.prototype.fF=function(a){var b=this.Re.tables.GPOS;b&&this.Sr.push(new sj(a.slice(b.offset,b.length)))};c.prototype.gF=function(a,b){if(b){var c=0;for(b=b.tables;c<b.length;c++){var e=b[c];0===e.coverage>>8&&(bj("Format 0 kern table detected"),this.Sr.push(new tj(a.slice(e.offset,e.length))))}}};c.prototype.transform=function(a,b,c){b=this.ub(b);a.scale(b,-b);a.transform(1,0,c,1,0,
0)};c.prototype.Fq=function(a,b,c,e){if(this.fq)this.fq.Fq(a,b,c,e);else if(b=this.Sx(b),null!==b)for(var d=0,h=0,k=0,l=0,n;h<b.na.length;h++){var r=b.na[h];0===d?(a.moveTo(r.x+c,r.y+e),d=1):1===d?r.kj?a.lineTo(r.x+c,r.y+e):d=2:(n=b.na[h-1],r.kj?(a.quadraticCurveTo(n.x+c,n.y+e,r.x+c,r.y+e),d=1):a.quadraticCurveTo(n.x+c,n.y+e,(n.x+r.x)/2+c,(n.y+r.y)/2+e));h===b.Nf[k]&&(2===d&&(n=r,r=b.na[l],r.kj?a.quadraticCurveTo(n.x+c,n.y+e,r.x+c,r.y+e):a.quadraticCurveTo(n.x+c,n.y+e,(n.x+r.x)/2+c,(n.y+r.y)/2+e)),
l=h+1,k+=1,d=0)}};c.prototype.Sx=function(a){var b=this.aD(a);a=this.Ba;var c=this.Re.tables.glyf;if(0===b||b>=c.offset+c.length)return null;cj(b>=c.offset);cj(b<c.offset+c.length);a.seek(b);b={Nf:[],kl:a.getInt16(),na:[],UI:a.getInt16(),WI:a.getInt16(),TI:a.getInt16(),VI:a.getInt16()};cj(-1<=b.kl);-1===b.kl?this.qF(a,b):this.sF(a,b);return b};c.prototype.aD=function(a){cj("loca"in this.Re.tables);var b=this.Re.tables.loca,c=this.Ba;if(1===this.ee.head.indexToLocFormat){b=c.seek(b.offset+4*a);a=c.oa(4);
var e=c.oa(4)}else b=c.seek(b.offset+2*a),a=2*c.oa(2),e=2*c.oa(2);c.seek(b);return a===e?0:a+this.Re.tables.glyf.offset};c.prototype.qF=function(a,b){var c,e,f=32;b.Nf=[];for(b.na=[];f&32;){f=a.oa(2);var h=a.oa(2);var k=1;var l=c=0;var n=1;var r=e=0;if(f&1){var u=a.getInt16();var x=a.getInt16()}else u=a.oa(1),x=a.oa(1);f&2&&(e=u,r=x);f&8?n=k=a.Ih():f&64?(k=a.Ih(),n=a.Ih()):f&128&&(k=a.Ih(),c=a.Ih(),l=a.Ih(),n=a.Ih());u=a.Ja;if(h=this.Sx(h)){var w=b.na.length;for(x=0;x<h.Nf.length;x++)b.Nf.push(h.Nf[x]+
w);for(x=0;x<h.na.length;x++){w=h.na[x].x;var y=h.na[x].y;w=k*w+c*y+e;y=l*w+n*y+r;b.na.push({x:w,y:y,kj:h.na[x].kj})}}a.seek(u)}b.kl=b.Nf.length;f&256&&a.seek(a.oa(2)+a.Ja)};c.prototype.sF=function(a,b){function c(b,c,d){for(var f=0,l=0;l<h;l++){var n=k[l];n&c?f=n&d?f+a.oa(1):f-a.oa(1):~n&d&&(f+=a.getInt16());e[l][b]=f}}b.Nf=[];for(var e=b.na=[],f=0;f<b.kl;f++)b.Nf.push(a.oa(2));a.seek(a.oa(2)+a.Ja);if(0!==b.kl){var h=Math.max.apply(null,b.Nf)+1,k=[];for(f=0;f<h;f++)if(b=a.oa(1),k.push(b),e.push({x:0,
y:0,kj:0<(b&1)}),b&8){var l=a.oa(1);cj(0<l);for(f+=l;l--;)k.push(b),e.push({x:0,y:0,kj:0<(b&1)})}c("x",2,16);c("y",4,32)}};c.prototype.ub=function(a){return a/this.ee.head.unitsPerEm};c.prototype.gD=function(a){cj("hmtx"in this.Re.tables);var b=this.Ba,c=this.Re.tables.hmtx.offset;b.seek(c+4);var e=this.ee.hhea.numOfLongHorMetrics;if(a<e){var f=this.Ba.seek(c+4*a);var h=b.oa(2)}else f=b.seek(c+4*(e-1)),h=b.oa(2),b.seek(c+4*e+2*(a-e));a=b.getInt16();b.seek(f);return{mA:h,zI:a}};c.prototype.ir=function(a){for(var b=
0,c=this.ck.length-1;0<=c&&!(b=this.ck[c].map(a));c--);return b};c.prototype.Hq=function(a,b,c,e,f,h){void 0===h&&(h=0);a.save();a.translate(c,e);this.transform(a,f,h);f=[];for(h=0;h<b.length;h++)f.push(new uj(this.ir(b.charCodeAt(h))));b=0;for(h=this.Sr;b<h.length;b++)h[b].Vk(f);for(var d=h=b=0;d<f.length;d++){var l=f[d],n=this.gD(l.Ad);this.Fq(a,l.Ad,b+l.ng.x,h+l.ng.y);b+=n.mA+l.advance.x;h+=l.advance.y}a.restore();return{x:c+b,y:e+h}};return c}(),pj=function(){function c(a){this.Ba=a}c.prototype.map=
function(a){return 0<=a&&255>=a?(this.Ba.seek(a+6),bj("charCode %s maps to %s",a,this.Ba.oa(1)),this.Ba.seek(a+6),this.Ba.oa(1)):0};return c}(),qj=function(){function c(a){this.Ba=a;a.seek(6);this.wj=a.oa(2)/2}c.prototype.map=function(a){var b=this;bj("Try to map charcode %s using %s ranges",a,this.wj);var c=this.Ba,e=0,f=0,h=Ad(this.wj-1,function(d){c.seek(14+2*d);var f=c.oa(2);c.seek(2*b.wj+16+2*d);e=c.oa(2);return a<e?-1:a>f?1:0});if(0<=h){c.seek(6*this.wj+16+2*h);f=c.oa(2);c.seek(4*this.wj+16+
2*h);var k=c.getInt16();0===f?f=k+a&65535:(c.seek(6*this.wj+16+2*h+(2*(a-e)+f)),f=c.oa(2),0!==f&&(f=f+k&65535))}return f};return c}(),rj=function(){function c(a){this.Ba=a;a.seek(12);this.es=a.oa(4);bj("CMAP 12 numGroups="+this.es)}c.prototype.map=function(a){bj("Try to map charcode %s using %s ranges",a,this.es);var b=this.Ba,c=0,e=0,f=0;Ad(this.es-1,function(d){b.seek(16+12*d);c=b.oa(4);e=b.oa(4);if(a<c)return-1;if(a>e)return 1;f=b.oa(4)+(a-c);return 0});return f};return c}(),oj=function(){function c(a){this.Ba=
a;this.Rq=null;this.Qq=[];var b=a.oa(1),c=a.oa(1),e=a.oa(1);bj("CFF Version "+b+"."+c);a.seek(e);a.Hr();this.IB=a.Hr();this.dH=a.Hr();this.gH=a.Ja;b=this.ut=this.Rx(a.Tk(this.IB,0));this.JE=a.nr(b.CharStrings);bj("CFF Font contains "+this.JE+" glyphs");this.ut.FDSelect?(this.Rq=new vj(a.slice(b.FDSelect)),this.rF(a,b)):this.Qq.push(b)}c.prototype.Rx=function(a){a=wj(a,{},this);if(a.Private){var b=a.Private[1];wj(this.Ba.slice(b,a.Private[0]),a,this);a.Subrs&&(a.Subrs+=b)}return a};c.prototype.Xi=
function(a){if(a<xj.length)return xj[a];a=this.Ba.Tk(this.dH,a-xj.length);return a.Xi(a.length)};c.prototype.rF=function(a,b){b=b.FDArray;var c=a.nr(b);bj("There are %s items in FDArray",c);for(var e=0;e<c;e++)this.Qq.push(this.Rx(a.Tk(b,e)))};c.prototype.fw=function(a,b){void 0===b&&(b=-1);if(-1===b){b=this.gH;var c=this.ut.CharstringType}else c=this.Qq[b],b=c.Subrs,c=c.CharstringType;var e=this.Ba.nr(b);return this.Ba.Tk(b,a+(0===c?0:1240>e?107:33900>e?1131:32768))};c.prototype.$C=function(a){return this.Rq?
this.Rq.Zk(a):0};c.prototype.Fq=function(a,b,c,e){a.translate(c,e);var d=this.ut.CharStrings,h=this.$C(b);yj(this.Ba.Tk(d,b),a,h,this);a.translate(-c,-e)};return c}(),zj=0,Aj=1,W=2,Bj=3,Cj={};function X(c,a,b,d){var e=b instanceof Array;Cj[a]={name:c,mv:d,type:e?b:[b],fn:function(a,d){a[c]=e||b===Bj?d:d[0]}}}X("version",0,zj);X("Notice",1,zj);X("Copyright",12,zj);X("FullName",2,zj);X("FamilyName",3,zj);X("Weight",4,zj);X("isFixedPitch",3073,Aj,!1);X("ItalicAngle",3074,W,0);
X("UnderlinePosition",3075,W,-100);X("UnderlineThickness",3076,W,50);X("PaintType",3077,W,0);X("CharstringType",3078,W,2);X("FontMatrix",3079,Bj,[.001,0,0,.001,0,0]);X("UniqueID",13,W);X("FontBBox",5,Bj,[0,0,0,0]);X("StrokeWidth",3080,W,0);X("XUID",14,Bj);X("charset",15,W,0);X("Encoding",16,W,0);X("CharStrings",17,W,0);X("Private",18,[W,W]);X("SyntheticBase",3092,W);X("PostSCript",3093,zj);X("BaseFontName",3094,zj);X("BaseFontBlend",3095,zj);X("ROS",3102,[zj,zj]);X("CIDFontVersion",3103,W,0);
X("CIDFontRevision",3104,W,0);X("CIDFontType",3105,W,0);X("CIDCount",3106,W);X("FDArray",3108,W);X("FDSelect",3109,W);X("FontName",3110,zj);X("BlueValues",6,W);X("OtherBlues",7,W);X("FamilyBlues",8,W);X("FamilyOtherBlues",9,W);X("BlueScale",3081,W,.039625);X("BlueShift",3082,8);X("BlueFuzz",3073,1);X("StdHW",10,W);X("StdVW",11,W);X("StemSnapH",3084,W);X("StemSnapV",3085,W);X("ForceBold",3086,Aj,!1);X("LanguageGroup",3089,W,0);X("ExpansionFactor",3090,W,.6);X("initialRandomSeed",3091,W,0);
X("Subrs",19,W);X("defaultWidthX",20,W);X("NominalWidthX",21,W);
function wj(c,a,b){for(;!c.Lq();){var d=c.aw();if(d.code in Cj){var e=Cj[d.code],f=[],h=0;a:for(;h<e.type.length;h++){var k=e.type[h];if(h>=d.Ue.length)throw Error("Not enough operands for instruction:"+d);var l=d.Ue[h];switch(k){case zj:f.push(b.Xi(l));break;case Aj:f.push(!!l);break;case Bj:f=d.Ue;break a;case W:f.push(l)}}e.fn(a,f)}else bj("Uknown dict opcode: %s",d.code)}for(var n in Cj)e=Cj[n],!e.mv||e.name in a||(a[e.name]=e.mv);return a}
function yj(c,a,b,d,e){for(e=e||{first:!0,width:0,jl:0,stack:[],x:0,y:0,si:!1,Jb:0,Kb:0};!c.Lq();){switch(c.aw(!0,e.stack).code){case 1:case 3:e.stack.length&1&&Dj(e);break;case 4:1<e.stack.length&&Dj(e);e.y+=e.stack[0];Ej(e,a);break;case 5:for(var f=0;f+1<e.stack.length;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);break;case 6:for(f=0;f<e.stack.length;f+=2)e.x+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.y+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 7:for(f=0;f<e.stack.length;f+=
2)e.y+=e.stack[f],a.lineTo(e.x,e.y),f+1<e.stack.length&&(e.x+=e.stack[f+1],a.lineTo(e.x,e.y));break;case 8:Fj(e,a);break;case 10:yj(d.fw(e.stack.pop(),b),a,b,d,e);continue;case 11:return;case 14:e.stack.length&&Dj(e);e.si&&a.lineTo(e.Jb,e.Kb);break;case 18:case 23:e.stack.length&1&&Dj(e);e.jl+=e.stack.length>>1;break;case 19:case 20:e.stack.length&1&&Dj(e);e.jl+=e.stack.length>>1;f=e.jl+7>>3;for(var h=0;h<f;h++)c.oa(1);break;case 21:e.stack.length&1&&Dj(e);e.x+=e.stack[0];e.y+=e.stack[1];Ej(e,a);
break;case 22:2===e.stack.length&&Dj(e);e.x+=e.stack[0];Ej(e,a);break;case 24:Fj(e,a);e.y+=e.stack.pop();e.x+=e.stack.pop();a.lineTo(e.x,e.y);break;case 25:for(f=0;f<e.stack.length-6;f+=2)e.x+=e.stack[f],e.y+=e.stack[f+1],a.lineTo(e.x,e.y);Fj(e,a,f);break;case 26:var k=e.stack.length&1;k&&(e.x+=e.stack[0]);for(;k<e.stack.length;k+=4){f=e.x;h=e.y+=e.stack[k+0];var l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],r=e.x,u=e.y+=e.stack[k+3];a.bezierCurveTo(f,h,l,n,r,u)}break;case 27:if(k=e.stack.length&1)e.y+=
e.stack[0];for(;k<e.stack.length;k+=4)f=e.x+=e.stack[k+0],h=e.y,l=e.x+=e.stack[k+1],n=e.y+=e.stack[k+2],r=e.x+=e.stack[k+3],u=e.y,a.bezierCurveTo(f,h,l,n,r,u);break;case 29:yj(d.fw(e.stack.pop(),-1),a,b,d,e);continue;case 30:Gj(e,!1,a);break;case 31:Gj(e,!0,a);break;case 3075:case 3076:case 3077:case 3081:case 3082:case 3083:case 3084:case 3086:case 3087:case 3090:case 3092:case 3093:case 3094:case 3095:case 3096:case 3098:case 3099:case 3100:case 3101:case 3102:case 3106:case 3107:case 3108:case 3109:throw Error("Not implemented.");
}e.stack.length=0}}function Ej(c,a){c.si&&a.lineTo(c.Jb,c.Kb);c.Jb=c.x;c.Kb=c.y;c.si=!0;a.moveTo(c.x,c.y)}function Fj(c,a,b){for(void 0===b&&(b=0);b+5<c.stack.length;b+=6){var d=c.x+=c.stack[b+0],e=c.y+=c.stack[b+1],f=c.x+=c.stack[b+2],h=c.y+=c.stack[b+3],k=c.x+=c.stack[b+4],l=c.y+=c.stack[b+5];a.bezierCurveTo(d,e,f,h,k,l)}}
function Gj(c,a,b){for(var d=0;d+1<c.stack.length;d+=4){var e=d==c.stack.length-5;if(a){var f=c.x+=c.stack[d+0],h=c.y,k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=e?c.x+=c.stack[d+4]:c.x;e=c.y+=c.stack[d+3]}else f=c.x,h=c.y+=c.stack[d+0],k=c.x+=c.stack[d+1],l=c.y+=c.stack[d+2],n=c.x+=c.stack[d+3],e=e?c.y+=c.stack[d+4]:c.y;b.bezierCurveTo(f,h,k,l,n,e);a=!a}}function Dj(c){c.first?(c.width=c.stack.shift(),c.first=!1):(bj("Warning; already have width"),c.stack.shift())}
var vj=function(){function c(a){this.Ba=a;this.ix=0;this.format=a.oa(1);bj("Reading FDSelect format %s",this.format);if(3!==this.format&&0!==this.format)throw Error("Can't read format "+this.format+" FDSelect");3===this.format&&(this.ix=a.oa(2))}c.prototype.Zk=function(a){var b=this;if(0===this.format)return this.Ba.seek(1+a),this.Ba.oa(1);var c=-1;Ad(this.ix,function(d){b.Ba.seek(3+3*d);d=b.Ba.oa(2);c=b.Ba.oa(1);var e=b.Ba.oa(2);return a<d?-1:a>=e?1:0});return c};return c}(),xj=".notdef space exclam quotedbl numbersign dollar percent ampersand quoteright \nparenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven \neight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U\nV W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k \nl m n o p q r s t u v w x y z braceleft bar braceright asciitilde exclamdown cent sterling fraction\nyen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi\nfl endash dagger daggerdbl periodcentered paragraph bullet quotesinglbase quotedblbase quotedblright\nguillemotright ellipsis perthousand questiondown grave acute circumflex tilde macron breve dotaccent \ndieresis ring cedilla hungarumlaut ogonek caron emdash AE ordfeminine Lslash Oslash OE ordmasculine \nae dotlessi lslash oslash oe germandbls onesuperior logicalnot mu trademark Eth onehalf plusminus \nThorn onequarter divide brokenbar degree thorn threequarters twosuperior registered minus eth \nmultiply threesuperior copyright Aacute Acircumflex Adieresis Agrave Aring Atilde Ccedilla Eacute \nEcircumflex Edieresis Egrave Iacute Icircumflex Idieresis Igrave Ntilde Oacute Ocircumflex \nOdieresis Ograve Otilde Scaron Uacute Ucircumflex Udieresis Ugrave Yacute Ydieresis Zcaron aacute \nacircumflex adieresis agrave aring atilde ccedilla eacute ecircumflex edieresis egrave iacute \nicircumflex idieresis igrave ntilde oacute ocircumflex odieresis ograve otilde scaron uacute \nucircumflex udieresis ugrave yacute ydieresis zcaron exclamsmall Hungarumlautsmall dollaroldstyle \ndollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader \nonedotenleader zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle \nsixoldstyle sevenoldstyle eightoldstyle nineoldstyle commasuperior threequartersemdash \nperiodsuperior questionsmall asuperior bsuperior centsuperior dsuperior esuperior isuperior \nlsuperior msuperior nsuperior osuperior rsuperior ssuperior tsuperior ff ffi ffl parenleftinferior \nparenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall \nFsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall \nTsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall \nexclamdownsmall centoldstyle Lslashsmall Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall \nDotaccentsmall Macronsmall figuredash hypheninferior Ogoneksmall Ringsmall Cedillasmall \nquestiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds zerosuperior \nfoursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior \noneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior \neightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall \nAacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall \nEacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall \nEthsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall \nOslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall \nYdieresissmall 001.000 001.001 001.002 001.003 Black Bold Book Light Medium Regular Roman Semibold".split(/\s+/);
function uj(c){this.Ad=c;this.ng={x:0,y:0};this.advance={x:0,y:0}}
var sj=function(){function c(a){this.Up=[];this.rw=kj(a,"{\n    majorVersion:uint16\n    minorVersion:uint16\n    scriptListOffset:uint16\n    featureListOffset:uint16\n    lookupListOffset:uint16\n    featureVariationsOffset:uint16\n\n    push scriptListOffset\n    scriptCount:uint16\n    scriptRecords:[scriptCount] {\n        tag:string(4)\n        scriptOffset:uint16\n        push scriptOffset\n        defaultLangSys:uint16\n        langSysCount:uint16\n        langSysRecords:[langSysCount] {\n            langSysTag:string(4)\n            langSysOffset:uint16\n            push langSysOffset\n            lookupOrder:uint16\n            requiredFeatureIndex:uint16\n            featureIndexCount:uint16\n            featureIndices:[featureIndexCount] uint16\n            pop\n        }\n        pop\n    }\n    pop\n\n    push lookupListOffset\n    lookupCount:uint16\n    lookups:[lookupCount] {\n        offset:uint16\n        push offset\n        lookupType:uint16\n        lookupFlag:uint16\n        subTableCount:uint16\n        subTables:[subTableCount] {\n            offset:uint16\n            push offset\n            posFormat:uint16\n            coverageOffset:uint16\n        }\n        pop\n    }\n    pop\n\n    push featureListOffset\n    featureCount:uint16\n    featureRecords[featureCount] {\n        featureTag:string(4)\n        featureOffset:uint16\n        push featureOffset\n        featureParams:uint16\n        lookupIndexCount:uint16\n        lookupListIndicies:[lookupIndexCount] uint16\n        pop\n    }\n    pop\n}");for(var b=
this.rw.lookupListOffset,c=0,e=this.rw.lookups;c<e.length;c++){var f=e[c],h=b+f.offset,k=f.lookupType;bj("Lookup type %s has %s subtables",k,f.subTables.length);var l=0;for(f=f.subTables;l<f.length;l++){var n=f[l],r=h+n.offset;bj("   Subtable type "+n.posFormat);2===k&&1===n.posFormat?this.Up.push(new Hj(a.slice(r))):2===k&&2===n.posFormat&&this.Up.push(new Ij(a.slice(r)))}}}c.prototype.Vk=function(a){for(var b=0,c=this.Up;b<c.length;b++)c[b].Vk(a)};return c}(),Jj=function(){function c(a){this.Ba=
a;this.aj=4;this.format=a.oa(2);this.count=a.oa(2);bj("CoverageTable format %s count %s",this.format,this.count);if(1===this.format)for(a=0;a<this.count;a++)this.Ba.seek(this.aj+2*a),bj("    glyph "+this.Ba.oa(2));else for(a=0;a<this.count;a++)this.Ba.seek(this.aj+6*a),bj("    glyph "+this.Ba.oa(2)+"..."+this.Ba.oa(2)+": "+this.Ba.oa(2))}c.prototype.ar=function(a){var b=this,c=-1;1===this.format?Ad(this.count,function(d){b.Ba.seek(b.aj+2*d);var e=b.Ba.oa(2);if(a<e)return-1;if(a>e)return 1;c=d;return 0}):
Ad(this.count,function(d){b.Ba.seek(b.aj+6*d);d=b.Ba.oa(2);var e=b.Ba.oa(2),h=b.Ba.oa(2);return a>=d&&a<=e?(c=h+a-d,0):a<d?-1:1});return c};return c}(),Kj=function(c){function a(a){var b=c.call(this,a)||this;b.Py=0;1===b.format&&(b.Py=b.count,b.count=a.oa(2),b.aj+=2);return b}__extends(a,c);a.prototype.Vv=function(a){return Math.max(0,this.ar(a-this.Py))};return a}(Jj);
function Lj(c,a,b){var d=a.ng.x,e=a.advance.x;b&1&&(a.ng.x=c.getInt16());b&2&&(a.ng.y=c.getInt16());b&4&&(a.advance.x=c.getInt16());b&8&&(a.advance.y=c.getInt16());b&16&&c.getInt16();b&32&&c.getInt16();b&64&&c.getInt16();b&128&&c.getInt16();a.ng.x!==d&&bj("Adjusted kern by "+(a.ng.x-d)+" "+(a.advance.x-e))}
var Mj=function(){function c(){}c.prototype.Vk=function(a){for(var b=0;b<a.length-1;b++)this.Zk(a[b],a[b+1])};return c}(),Hj=function(c){function a(a){var b=c.call(this)||this;b.Ba=a;a.oa(2);var e=a.oa(2);b.pq=new Jj(a.slice(e));b.Vl=a.oa(2);b.Wl=a.oa(2);b.count=a.oa(2);b.uF=2*Nj(b.Vl)+2*Nj(b.Wl)+2;return b}__extends(a,c);a.prototype.Zk=function(a,c){var b=this,d=this.pq.ar(a.Ad);bj("KErn lookup type 2_1 coverage of glyph "+a.Ad+"/"+c.Ad+": "+d);if(-1===d)return 0;this.Ba.seek(10+2*d);this.Ba.seek(this.Ba.oa(2));
var h=this.Ba.Ja;d=this.Ba.oa(2);return 0<=Ad(d,function(d){b.Ba.seek(h+d*b.uF);d=b.Ba.oa(2);if(d<c.Ad)return-1;if(d>c.Ad)return 1;Lj(b.Ba,a,b.Vl);Lj(b.Ba,c,b.Wl);return 0})?1:0};return a}(Mj),Ij=function(c){function a(a){var b=c.call(this)||this;b.Ba=a;a.oa(2);b.pq=new Jj(a.slice(a.oa(2)));b.Vl=a.oa(2);b.Wl=a.oa(2);b.TA=new Kj(a.slice(a.oa(2)));b.UA=new Kj(a.slice(a.oa(2)));b.sI=a.oa(2);b.SA=a.oa(2);b.Ux=2*Nj(b.Vl)+2*Nj(b.Wl);return b}__extends(a,c);a.prototype.Zk=function(a,c){var b=this.pq.ar(a.Ad);
bj("KErn lookup type 2_2 coverage of glyph "+a.Ad+"/"+c.Ad+": "+b);if(-1===b)return 0;b=this.TA.Vv(a.Ad);var d=this.UA.Vv(c.Ad);this.Ba.seek(16+b*this.Ux*this.SA+d*this.Ux);Lj(this.Ba,a,this.Vl);Lj(this.Ba,c,this.Wl);return 1};return a}(Mj),tj=function(c){function a(a,d){void 0===d&&(d=a.oa(2));var b=c.call(this)||this;b.Ba=a;b.count=d;bj("Kern table has %s entries",b.count);return b}__extends(a,c);a.prototype.Zk=function(a,c){var b=this,d=a.Ad<<16|c.Ad,h=0;Ad(this.count,function(a){b.Ba.seek(8+6*
a);a=b.Ba.oa(4);if(d<a)return-1;if(d>a)return 1;a=b.Ba.getInt16();c.ng.x+=a;c.advance.x+=a;h=1;return 0});return h};return a}(Mj);function Nj(c){c-=c>>1&1431655765;c=(c&858993459)+(c>>2&858993459);return 16843009*(c+(c>>4)&252645135)>>24};var Ch=F.Mc("CanvasRenderingContext2D",{beginPath:F.Function}),Oj=F.Mc("TextOptions",{text:F.String,width:F.Qa,height:F.Qa,font:F.dc,valign:F.Wa(F.cb(F.Nd("top"),F.Nd("bottom"),F.Nd("middle"))),halign:F.Wa(F.cb(F.Nd("left"),F.Nd("right"),F.Nd("centre"),F.Nd("center"))),textDecoration:F.dc});F.Wa(F.Dz());var Pj="BaseNode BrushNode CustomNode DataNode DomNode GraphicsNode GroupNode HTMLNode ImageNode PageNode PathNode RootNode SvgNode TextNode UnknownNode".split(" ");
function Qj(c){if(-1!==Pj.indexOf(c))throw Error('Zwibbler: You cannot use name "'+c+'" for a custom component. It is reserved for internal use.');}"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new U(d,c,{});d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Y=function(){function c(){this.dj=[];this.buttons=[];this.Nm={};this.fonts=new nj;this.Ie={};this.iv=[];this.GraphingCalculator=this.wk=this.Mg=null;this.wq={};this.NODEJS_INSTANCE="#nodejs-instance";this.log=v.create("ZWIBBLER");this.WebSocket=WebSocket;this.qc=new Ya;this.controllers={};this.qz=U}c.prototype.create=function(a,b,c){void 0===c&&(c={});"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);if(a!==this.NODEJS_INSTANCE){var d=B.Fc(a);if(!d)throw alert("Zwibbler.create: Cannot find an element with id "+
a),Error("Error in Zwibbler.create");}else d=document.createElement("div");return new U(d,b,c)};c.prototype.aA=function(a,b){this.wq[a]=b};c.prototype.Zz=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);return!0};c.prototype.digest=function(){return new Promise(function(a){Q.digest(a)})};c.prototype.bA=function(a,b){Qj(a);this.Nm[a]=b};c.prototype.Gz=function(a,b){void 0===b&&(b={});return this.vp(a,
b)};c.prototype.vp=function(a,b){void 0===b&&(b={});return Ee(a,b)};c.prototype.tB=function(a,b){return this.dh(a,b)};c.prototype.Mb=function(a,b){Q.Mb(a,function(a,c,f,h){b(new lg(Q,a,c,f,h))})};c.prototype.IC=function(){return new Date(1708335655840)};c.prototype.getContext=function(a){for(;a;){if(a.ZWIBBLER_CONTEXT)return a.ZWIBBLER_CONTEXT;if("ZWIBBLER"===a.tagName||a.getAttribute("zwibbler")){if(a=a.querySelector("[z-canvas]"))return a.ZWIBBLER_CONTEXT;break}a=a.parentElement}return null};c.prototype.dh=
function(a,b,c){function d(){var a=z.Pc(),b=1,d=0,e=0;l&&(a.y=l);u&&(a.height=u-a.y);n&&(a.x=n);r&&(a.width=r-a.x);h&&k?b=Math.min(h/a.width,k/a.height):h?(b=h/a.width,k=a.height*b):k?(b=k/a.height,h=a.width*b):(h=a.width,k=a.height);a.width*b<h&&(d=h/2-a.width*b/2);a.height*b<k&&(e=k/2-a.height*b/2);d-=a.x*b;e-=a.y*b;x.width=Math.ceil(h);x.height=Math.ceil(k);w.translate(d,e);w.scale(b,b);z.ka(w);f.log("Drawn.");c(x)}var f=this;void 0===b&&(b={});void 0===c&&(c=function(){});var h=b.width||0,k=b.height||
0,l=b.top||0,n=b.left||0,r=b.right||0,u=b.bottom||0,x=Zc(null),w=x.getContext("2d"),y=new ag,z=Ah.yi(a,null,{},[],w,y);if(!z)throw Error("Zwibbler.render: Could not open document");z.format(w,y,!0);y.pa("reformat",function(a){z.Sg(a)});y.Rn()?y.pa("done",function(){z.format(w,y,!0);d()}):d();return x};c.prototype.save=function(a,b,c){if(2===arguments.length&&"object"===typeof b){F.ha("Zwibbler.save()",arguments,F.String,ai);var d=b;var f=d.format||"zwibbler3"}else F.ha("Zwibbler.save()",arguments,
F.String,F.String,F.Wa(ai)),d=c||{},f=b||d.format||"zwibbler3";return new Promise(function(b,c){var e=Zc(null).getContext("2d"),h=new ag,k=Ah.yi(a,null,{},[],e,h);if(k){k.Qh("background")||k.setProperty("background","white");h.pa("reformat",function(a){k.Sg(a)});var u=function(){try{k.format(e,h,!0);d.page&&k.jd(d.page);var a=Ah.Cp(k,f,d.encoding||"string");b(a)}catch(w){c(w)}};h.pa("done",u);k.format(e,h,!0);h.Rn()||u()}else c(Error("Failed to open document"))})};c.prototype.ob=function(a){var b=
Zc(null).getContext("2d"),c=new ag;a=Ah.yi(a,null,{},[],b,c);if(!a)throw Error("Failed to open document");return a.ob()};c.prototype.dF=function(a,b){if("string"!==typeof a)throw Error("parseColour: Expected a string; got "+typeof a);if(b){if(a=q.Ak(a),!a)return null}else a=q.Wf(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.rE=function(a){return(new q(q.RGBA,[a.r,a.g,a.b,void 0===a.a?1:a.a])).toString()};c.prototype.zC=function(a){var b=document.createElement("a");
b.href=a;return b.href};c.prototype.cr=function(a){return this.wq[a]||null};c.prototype.AA=function(a){return Ra(Sa(a))};c.prototype.dA=function(a){var b=this;return this.fonts.add(a).then(function(c){b.cg('\n@font-face {\n    font-family: "'+c[0].fontFamily+'";\n    font-weight: '+(c[0].bold?700:400)+";\n    font-style: "+(c[0].Zd?"italic":"normal")+';\n    src: url("'+a+'");\n}');(new FontFace(c[0].Qi,"url("+a+")")).load().then(function(a){document.fonts.add(a)});for(var d=0,f=b.dj;d<f.length;d++){var h=
f[d],k=h.Zb("fonts").concat();-1===k.indexOf(c[0].fontFamily)&&(k.push(c[0].fontFamily),h.yj("fonts",k))}return c[0].fontFamily})};c.prototype.Fz=function(a){return new P(a)};c.prototype.Ot=function(a){var b=new P;Ec(b,a);return b.Jc()};c.prototype.bB=function(a){return this.Ot(a)};c.prototype.SB=function(a,b){Ec(a,b)};c.prototype.Zv=function(a,b){var c=document.createElement("img");if(fd(a)){var e=new af;if(b)e.ql(a).then(function(){b&&b(e.rect.width,e.rect.height,c)});else return e.ql(a).then(function(){return{width:e.rect.width,
height:e.rect.height}})}else if(b)c.src=a,c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)};else return new Promise(function(b,d){function e(){clearInterval(f);var a={width:c.naturalWidth,height:c.naturalHeight};c.onload=c.onerror=null;c.src="";b(a)}var f=0;c.onerror=function(){clearInterval(f);d(Error("Failed to load image"))};c.onload=function(){e()};f=setInterval(function(){(c.naturalWidth||c.naturalHeight)&&e()},10);c.src=a})};c.prototype.eg=function(a){return new Promise(function(b,c){var d=
document.createElement("img");d.src=a;d.onerror=function(){c(Error("Error loading image "+a))};d.onload=function(){b(d)}})};c.prototype.cG=function(a,b){F.ha("setColourOpacity",arguments,F.String,F.Number);return ad(a,b)};c.prototype.oH=function(a){return this.Ql(a)};c.prototype.Tn=function(){var a=document.createElement("DIV");return!!(a.requestFullscreen||a.msRequestFullscreen||a.DE||a.webkitRequestFullscreen)};c.prototype.Ql=function(a){var b=B.Fc(a);if(!b)throw Error("Zwibbler.toggleFullScreen: "+
a+" not found");a=document;this.Or()?document.exitFullscreen?document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.CE?a.CE():a.webkitExitFullscreen&&a.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.DE?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):console.log("Element does not contain any requestFullscreen methods")};c.prototype.eE=function(){return this.Or()};
c.prototype.Or=function(){var a=document;return a.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement?!0:!1};c.prototype.bC=function(){v.aC()};c.prototype.mw=function(a){return gh.xz(a)};c.prototype.cg=function(a){this.qc.Ir(a)};c.prototype.controller=function(a,b){this.controllers[a]=b};c.prototype.fk=function(a,b){Qj(a);Q.fk(a,b);this.Ie[a]=b};c.prototype.pF=function(a){this.iv.push(a)};c.prototype.Wv=function(a){return a in this.Ie?JSON.parse(JSON.stringify(this.Ie[a].defaults||
{})):{}};c.prototype.hk=function(a,b,c,e){void 0===c&&(c={});void 0===e&&(e=null);if("object"!==typeof a||"string"!==typeof b)throw Error("Bad arguments passed to createComponent");return Q.hk(a,b,c,e)};c.prototype.HB=function(a){Q.detach(a);B(a).remove()};c.prototype.rd=function(a,b){var c=B.Fc(a);if(!c)throw Error("Zwibbler.attach: Cannot find element from "+a);return ji(c,b,!0)};c.prototype.detach=function(a){F.ha("detach",arguments,F.HTMLElement);Q.detach(a)};c.prototype.nA=function(a){return"string"!==
typeof a.url?Promise.reject(Error("Zwibbler.ajax: settings.url missing")):Xa({url:a.url,method:a.method,qs:a.params,mimeType:a.mimeType,contentType:a.contentType,withCredentials:a.withCredentials,data:a.data,ov:a.delay,cancel:a.cancel,headers:a.headers}).then(function(a){Q.digest();return a},function(a){Q.digest();throw a;})};c.prototype.qG=function(a,b){F.ha("setHashValue",arguments,F.String,F.cb(F.String,F.Number));var c=a,e=b;var f=Ob();f[c]=e;var h;e=[];c=!0;for(h in f)f.hasOwnProperty(h)&&("/"===
h.charAt(0)?(c||e.unshift("&"),""!==f[h]&&(e.unshift(encodeURIComponent(f[h])),e.unshift("=")),e.unshift("/"+encodeURIComponent(h.substr(1))),c=!1):(c||e.push("&"),c=!1,e.push(encodeURIComponent(h)),""!==f[h]&&(e.push("="),e.push(encodeURIComponent(f[h])))));window.location.hash=e.join("")};c.prototype.ND=function(){return Ob()};c.prototype.OD=function(){return Pb()};c.prototype.GB=function(){for(var a=0,b=this.dj.concat();a<b.length;a++)b[a].Sa();this.qc.Sa();this.fonts.xF();Q.Sa();this.buttons.length=
0;this.Nm={};this.wq={};this.Mg&&this.Mg.Sa();this.wk&&this.wk.Sa()};c.prototype.gn=function(a,b){F.ha("formatText",arguments,Ch,Oj);var c=new ee;b.text&&c.kd(b.text);if(b.font){var e=Pe(b.font);c.El(e.fontFamily||"arial",parseFloat(e.fontSize),"bold"===e.fontWeight,"italic"===e.fontStyle,b.textDecoration||"")}c.Bl(b.halign||null,b.valign||null);c.format(a,b.width||0,b.height||0);e=c.kn();return{draw:function(a,b,d){c.ka(a,b,d)},x:e.x,y:e.y,width:e.width,height:e.height}};c.prototype.Az=function(a,
b){F.ha("NewPointerListener",arguments,F.Element);var c=new Af(a,{jp:b.useCapture,Zy:b.useDocument});return{on:function(a,b){F.ha("on",arguments,F.String,F.Function);c.pa(a,function(a){b({type:a.type,originalEvent:a.qb,pageX:a.pageX,pageY:a.pageY,target:a.target,buttons:a.buttons,pointerId:a.pointerId,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey,preventDefault:function(){a.preventDefault()},stopPropagation:function(){a.stopPropagation()},getVector:function(){var b=a.PD();return{x:b.x,y:b.y}},
isTouch:function(){return a.Vb()},setCapture:function(){a.setCapture()}});Q.digest()})},removeListener:function(a,b){F.ha("removeListener",arguments,F.String,F.Function);c.removeListener(a,b)},destroy:function(){c.Sa()}}};c.prototype.GE=function(a,b){F.ha("newPdfContext",arguments,F.cc,F.cc);return new Rj(new K(0,0,a,b),this.fonts)};c.prototype.Bz=function(a){return new lf(a)};c.prototype.LB=function(a,b){F.ha("downloadBlob",arguments,F.bm(Blob),F.String);this.Mg||(this.Mg=new $a);this.Mg.Ms(a,b)};
c.prototype.mj=function(a){F.ha("openFile",arguments,F.Wa(F.Mc("OpenFileArgs",{accept:F.dc,format:F.wi("text","data-uri","ArrayBuffer","File"),capture:F.dc})));a||(a={});this.wk||(this.wk=new Za);return this.wk.open({accept:a.accept,format:a.format||"data-uri",capture:a.capture}).then(function(a){Q.digest();return{data:a.data,contentType:a.contentType}})};c.prototype.cj=function(a){var b=B(a),c={setOffset:function(d,f){b.Aj({left:d.left,top:d.top});f&&a instanceof HTMLElement&&bd(a);return c},getOffset:function(){var a=
b.wb();return{left:a.left,top:a.top,width:a.width,height:a.height}}};return c};c.prototype.yB=function(){console.log("Undestroyed elements:",Q.all)};return c}(),Rj=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}__extends(a,c);a.prototype.download=function(a){var b=this.toBlob(),c=new $a;c.Ms(b,a);setTimeout(function(){c.Sa()},1010)};return a}(Eg);
document.addEventListener("dragstart",function(c){var a=c.target;if("IMG"===a.tagName){var b={},d=a.getAttribute("zwibbler-props");if(d)try{b=JSON.parse(d)}catch(e){console.warn(Error("Could not parse z-property value as JSON:"+d))}a={"zwibbler-src":a.getAttribute("zwibbler-src"),"zwibbler-width":a.getAttribute("zwibbler-width"),"zwibbler-size":a.getAttribute("zwibbler-size"),"zwibbler-props":b};a["zwibbler-src"]&&c.dataTransfer.setData("text",JSON.stringify(a))}});var E=new Y,Sj=Pb(bh).module||"Zwibbler";
"function"===typeof define&&define.amd&&define(Sj,["exports"],function(c){c.Zwibbler=E});"undefined"!==typeof globalModule&&globalModule.exports&&(globalModule.exports.Zwibbler=E);var Tj=window;"object"===typeof Tj[Sj]&&(E.GraphingCalculator=Tj[Sj].GraphingCalculator);Tj[Sj]=E;bc.resolve(E);E.instances=E.dj;Y.prototype.addCustomBackground=Y.prototype.aA;Y.prototype.addButton=Y.prototype.Zz;Y.prototype.addCustomNode=Y.prototype.bA;Y.prototype.Popup=Y.prototype.Gz;Y.prototype.Dialog=Y.prototype.vp;
Y.prototype.createPreview=Y.prototype.tB;Y.prototype.directive=Y.prototype.Mb;Y.prototype.getBuildDate=Y.prototype.IC;Y.prototype.getContext=Y.prototype.getContext;Y.prototype.render=Y.prototype.dh;Y.prototype.save=Y.prototype.save;Y.prototype.getPageCount=Y.prototype.ob;Y.prototype.parseColour=Y.prototype.dF;Y.prototype.makeColour=Y.prototype.rE;Y.prototype.getAbsoluteUrl=Y.prototype.zC;Y.prototype.getCustomBackground=Y.prototype.cr;Y.prototype.base64Encode=Y.prototype.AA;Y.prototype.addFont=Y.prototype.dA;
Y.prototype.PathCommands=Y.prototype.Fz;Y.prototype.CommandsFromSvgPath=Y.prototype.Ot;Y.prototype.commandsFromSVGPath=Y.prototype.bB;Y.prototype.drawSVGPath=Y.prototype.SB;Y.prototype.getImageSize=Y.prototype.Zv;Y.prototype.loadImage=Y.prototype.eg;Y.prototype.setColourOpacity=Y.prototype.cG;Y.prototype.toggleFullScreen=Y.prototype.oH;Y.prototype.isFullscreenSupported=Y.prototype.Tn;Y.prototype.toggleFullscreen=Y.prototype.Ql;Y.prototype.isFullScreen=Y.prototype.eE;Y.prototype.isFullscreen=Y.prototype.Or;
Y.prototype.enableConsoleLogging=Y.prototype.bC;Y.prototype.hasConfig=Y.prototype.mw;Y.prototype.injectStyle=Y.prototype.cg;Y.prototype.controller=Y.prototype.controller;Y.prototype.component=Y.prototype.fk;Y.prototype.propertyPanel=Y.prototype.pF;Y.prototype.createComponent=Y.prototype.hk;Y.prototype.destroyComponent=Y.prototype.HB;Y.prototype.attach=Y.prototype.rd;Y.prototype.detach=Y.prototype.detach;Y.prototype.ajax=Y.prototype.nA;Y.prototype.setHashValue=Y.prototype.qG;
Y.prototype.getUrlHash=Y.prototype.ND;Y.prototype.getUrlQuery=Y.prototype.OD;Y.prototype.destroyAll=Y.prototype.GB;Y.prototype.formatText=Y.prototype.gn;Y.prototype.NewPointerListener=Y.prototype.Az;Y.prototype.newPdfContext=Y.prototype.GE;Y.prototype.NewSvgImage=Y.prototype.Bz;Y.prototype.downloadBlob=Y.prototype.LB;Y.prototype.openFile=Y.prototype.mj;Y.prototype.html=Y.prototype.cj;Y.prototype.debugDump=Y.prototype.yB;Y.prototype.Context=Y.prototype.qz;Rj.prototype.download=Rj.prototype.download;
window.Zwibbler=E;var Uj=v.create("RESIZE"),Vj=function(){function c(a,b,c){this.Da=a;this.node=b;this.mb=c;Uj("Enter resize behaviour");this.rect=b.rect.clone();this.Da.Df(!0);this.Da.zb(Je(c))}c.prototype.Vd=function(){};c.prototype.Qc=function(){this.Da.Df(!1);this.Da.zb("default");Uj("Exit RESIZE")};c.prototype.Fb=function(a,b,c){b=(c.pageX-c.Jb)/this.Da.scale;var d=(c.pageY-c.Kb)/this.Da.scale;c=this.rect.clone();a=this.mb;if(a&16){var f=Math.min(Math.abs(b),Math.abs(d));b=Math.sign(b)*f;d=Math.sign(d)*f}switch(a){case 25:case 22:d=
b;break;case 19:case 28:d=-b}a&1&&(c.y+=d,c.height-=d);a&4&&(c.height+=d);a&8&&(c.x+=b,c.width-=b);a&2&&(c.width+=b);this.node.format(this.Da.ma,this.Da.request);this.Da.ka();if(this.node.ea){a=this.node.ea;f=a.offsetParent;b=c.x;for(d=c.y;f instanceof HTMLElement&&f!==this.Da.aa.cd;)b-=f.offsetLeft,d-=f.offsetTop,f=f.offsetParent;f=B(a).Ti();a.style.left=b-f.left+"px";a.style.top=d-f.top+"px";a.style.width=c.width-f.Vr-f.Ls+"px";a.style.height=c.height-f.vt-f.bq+"px";this.node.Il(c)}return!0};c.prototype.oc=
function(a,b,c){this.Fb(a,b,c);if(!this.node.ea)throw Error("Expected element to be created");this.Da.Xa(new Og(this.Da));this.Da.aa.lb();this.Da.aa.Ab([this.node.id],{"style.left":this.node.ea.style.left,"style.top":this.node.ea.style.top,"style.width":this.node.ea.style.width,"style.height":this.node.ea.style.height});this.Da.aa.Ea(!1);return!0};return c}();var Wj=v.create("DefaultBehaviour"),Og=function(){function c(a){this.view=a;this.view.Fl("");this.Rc=new Gf(a);this.fa=a.fa}c.prototype.Vd=function(){Wj("Entering pick tool.");this.view.zb("default")};c.prototype.Qc=function(){Wj("Leaving pick tool.")};c.prototype.yb=function(a){return this.Rc.yb(a)};c.prototype.Eb=function(a,b,c){if(c.buttons&&1!==c.buttons)return Wj("   -- not main button. ignore."),!1;if(this.view.fa.get("readOnly")){var d=this.view.aa.Db(a,b,this.view.Hc(c.Vb()),this.view.scale,
this.view.Ub);d.node?(Wj("layer=%s active=%s",d.node.Gc(),this.view.Ub),this.view.ra.ua("node-clicked",d.node.id,a,b),d.Of&&d.Of.click(d.node,c.qb)):Wj("readOnly mode: Ignoring click.");return!1}if(this.view.ya){var f=this.view.ya;var h=f.bg(a,b,this.view.Hc(c.Vb()),this.view.scale);if(null!==h)return this.view.Xa(new Xj(this.view,f,h,a,b,this,c)),!0}if(h=this.view.lr(a,b,c.Vb())){if(!h.Tu())return h.click(c),this.view.ra.digest(),!0;this.view.Xa(new Xf(this.view,h,!1,a,b,c));return!0}h=!1;d||(h=
this.view.aa.Db(a,b,this.view.Hc(c.Vb()),this.view.scale,this.view.Ub),d=h.node,h=null!==h.Of);d||(d=this.view.aa.kr(c.target));if(h)return!0;h=d&&5===(d.jb&5)&&2>this.view.selection.length&&!d.Un();f=this.view.kh.ur(a,b);if(d&&this.view.Ub.has(d.Gc())&&!this.view.aa.Pr(d)){f=d===this.view.ya;var k=this.view.Th(d);Wj("wasEditNode: %s, wasSelected: %s curselsize=%s",f,k,this.view.selection.length);k||(this.fa.get("multiPick")||this.view.pb(),this.view.bf(d),this.view.xc());var l=this.Tv(d,a,b,c),n=
l.handle;l=l.ya;if(null!==n&&l)return this.view.Xa(new Xj(this.view,l,n,a,b,this,c)),!0;if(h)return!1;this.view.Xa(new Xf(this.view,this.view.xj?new Sf(Kf,d.Pa(),d.xa):new Tf,!f&&k,a,b,c))}else if(this.view.Jx(a,b,this.view.Hc(c.Vb()))){if(h)return!1;this.view.Xa(new Xf(this.view,this.view.xj?new Sf(Kf,this.view.selection[0].Pa(),this.view.selection[0].xa):new Tf,!0,a,b,c))}else{if(!this.view.fa.CC())return Wj("Disabled select box -- mobile touch active."),this.view.fh(null),this.view.pb(),this.view.xc(),
this.view.ka(),!1;0==f.length&&(d=this.view.fa.get("allowSelectBox"),"pan"===d||c.Vb()&&!0!==d?c.setData("clearOnClick",!0):(this.view.fh(null),this.view.Xa(new Jf(this.view,this,a,b,c))))}return!0};c.prototype.Fb=function(a,b,c){if(this.view.fa.get("readOnly"))return!1;var d=this.view.kh.ur(a,b),f="default",h="",k=this.view.Hc(c.Vb());d.length&&!B.dg(c.qb.target)&&(f=Je(d[0].mb),h=d[0].id);c.qb.target instanceof HTMLElement&&c.qb.target.matches("[z-editable], [z-editable] *")&&(f="text");d=this.view.aa.Db(a,
b,k,this.view.scale,this.view.Ub);this.view.$F(d.Of);d.node&&(k=this.Tv(d.node,a,b,c).handle,null!==k?f=(k instanceof Object?k.getCursor():"")||"pointer":d.node.id!==h&&(f="pointer"));("default"===f||"pointer"===f)&&(k=this.view.lr(a,b,c.Vb()))&&(f=k.Lh());this.view.zb(f);return!1};c.prototype.Tv=function(a,b,c,e){if(!B.dg(e.qb.target)){for(var d=null;;){if(a&&0!=(a.jb&16)&&a.Fr()){d=a;break}if(a&&a.parent&&N(a.parent))a=a.parent;else break}if(d)return{handle:d.bg(b,c,this.view.Hc(e.Vb()),this.view.scale),
ya:d}}return{handle:null,ya:null}};c.prototype.oc=function(){Wj("onMouseUp");return!1};c.prototype.to=function(a,b,c){var d=this.view.aa.Db(a,b,this.view.Hc(c.Vb()),this.view.scale,this.view.Ub);d.node&&(this.view.ra.ua("node-clicked",d.node.id,a,b),d.Of&&d.Of.click(d.node,c.qb));c.getData("clearOnClick")&&(this.view.fh(null),this.view.pb(),this.view.xc(),this.view.ka());return!1};c.prototype.uo=function(a,b,c){Wj("Mouse drag!");if(this.Rc.Yd())return!0;var d=!1,f=this.view.Hc(c.Vb());if(1===c.buttons){if(B.dg(c.getData("target"))&&
!this.view.Qr||this.view.fa.get("readOnly"))return!1;var h=this.view.Ed(c.Jb,c.Kb,!0);d=this.view.kh.ur(h.x,h.y);if((f=d.length?this.view.aa.Ob(d[0].id):this.view.aa.Db(h.x,h.y,f,this.view.scale,this.view.Ub).node)&&Uc(f)&&this.view.Ub.has(f.Gc())&&(h=f.ea.hasAttribute("z-fixture"),!h)){h=void 0;var k;if(k=d.length)a:{switch(d[0].mb){case 25:case 33:case 19:case 34:case 22:case 36:case 28:case 40:k=!0;break a}k=!1}if(k){k=f;var l=d[0].mb;k=k.ea.hasAttribute("z-sizeable")&&!k.ia("lockSize")&&(!k.ia("lockAspectRatio")||
l&16)}k?h=new Vj(this.view,f,d[0].mb):f.ia("lockPosition")||(c.ctrlKey&&c.altKey&&(f=this.view.aa.za(this.view.aa.duplicate([f.id],new L)[0],!1),this.view.update()),f&&Uc(f)&&(this.view.Th(f)&&1!==this.view.selection.length||f.Un()?Wj("Not dragging html -- multiple nodes selected."):h=new mh(this.view,c,f,0)));h&&this.view.Xa(h)}d=!!f;if(!f){a:{for(d=c.qb.target;d;){if(d.hasAttribute("z-drag-to-create")){d={ea:d,type:d.getAttribute("z-drag-to-create")};break a}d=d.parentElement}d=null}if(d){h=E.Wv(d.type);
h.$component=d.type;k=d.ea;l={};for(var n=0;n<k.attributes.length;n++){var r=k.attributes[n].name,u=k.attributes[n].value;if(r.startsWith("z-prop:")){r=r.substr(7);for(var x=!1,w="",y=0;y<r.length;y++){var z=r[y];"-"===z?x=!0:x?(w+=z.toUpperCase(),x=!1):w+=z.toLowerCase()}r=w;u=ng.bn(l,u,k);h[r]=u}}k=new pi(this.view.aa.Gk(),this.view.aa);k.Qb(h);k.format(this.view.ma,this.view.request);this.view.Xa(new mh(this.view,c,k,1))}else(f=this.view.aa.kr(c.target))&&Uc(f)&&((h=f.ea.hasAttribute("z-fixture"))||
this.view.Xa(new mh(this.view,c,f,2)));d=!!f||!!d}}f=this.view.fa.get("allowSelectBox");!d&&(c.Vb()&&!1!==f||"pan"===this.view.fa.get("allowSelectBox"))&&(f=new Rg(this.view),this.view.Xa(f),h=this.view.Ed(c.Jb,c.Kb,!0),f.aH(h.x,h.y,c,this),f.Fb(a,b,c));return!1};c.prototype.Dd=function(a,b){Wj("keyboard: %s on target %s",a,b.target.tagName);if(!B.dg(b.target,b)){var c=!0,e=this.view.fa.get("nudge");b&&b.ctrlKey&&(e=this.view.fa.get("preciseNudge"));var f=this.view.Ta.Wb;switch(a){case "bring-to-front":this.view.Sd(0);
break;case "send-to-back":this.view.Sd(1);break;case "left":f||this.view.ko(-1,0,e)||(this.view.Bb=Math.min(this.view.Bb+16,0),this.view.Qd(),this.view.ka());break;case "right":f||this.view.ko(1,0,e)||(a=this.view.Ck().width,this.view.Bb=Math.max(-(a*this.view.scale-a),this.view.Bb-16),this.view.Qd(),this.view.ka());break;case "up":f||this.view.ko(0,-1,e)||(this.view.Cb=Math.min(this.view.Cb+16,0),this.view.Qd(),this.view.ka());break;case "down":f||this.view.ko(0,1,e)||(a=this.view.Ck().height,this.view.Cb=
Math.max(-(a*this.view.scale-a),this.view.Cb-16),this.view.Qd(),this.view.ka());break;case "select-none":this.view.pb();this.view.xc();this.view.ka();f&&this.view.$c.ua("goto-toolbar");break;case "select-all":var h=[];this.view.aa.Oc(function(a){h.push(a)});this.view.selectNodes(h);this.view.ka();f&&this.view.$c.ua("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Sd(2);break;case "move-down":this.view.Sd(3);break;case "delete":this.view.Sm();break;case "curve-tool":this.view.hv({});
break;case "line-tool":this.view.Vw({},!1,!1,!1,this.view.fa.get("autoPickTool"));break;case "group":this.view.group();break;case "ungroup":this.view.Nj();break;case "undo":this.view.nd();break;case "redo":this.view.We();break;case "cut":this.view.yq();break;case "copy":this.view.Ah(!1,this.view.Xd(!1));break;case "paste":this.view.sl();break;case "zoom-normal":this.view.fa.get("allowZoom")?(a=this.view.$b(),e=this.view.Ne(!0),a.x=a.x+a.width/2-e.width/2,a.y=a.y+a.height/2-e.height/2,a.width=e.width,
a.height=e.height,this.view.Gd(a)):Wj("Zooming is disabled.");break;case "zoom-in":this.view.fa.get("allowZoom")?this.view.qp():Wj("Zooming is disabled.");break;case "zoom-out":this.view.fa.get("allowZoom")?this.view.rp():Wj("Zooming is disabled.");break;default:c=!1}c&&(b.preventDefault(),b.stopPropagation());return c}};c.prototype.Wg=function(a,b){b?(this.view.Td=ad(this.view.Td,a),this.view.Yc=ad(this.view.Yc,a)):this.view.Ke=ad(this.view.Ke,a);this.view.at(a,b)};c.prototype.ks=function(a,b,c){Wj("onDoubleClick");
var d=this.view.Hc(c.Vb()),f=this.view.aa.Db(a,b,this.view.Hc(c.Vb()),this.view.scale,this.view.Ub).node;Wj("hittest: %s, hasText: %s",null!==f,null!==f&&f.Rg());this.view.ra.ua("double-click",a,b,f?f.id:null);if(f&&f===this.view.ya&&0!=(f.jb&16)){var h=f.bg(a,b,d,this.view.scale);if(!h&&(h=f.$v(a,b,d))){var k=f.Bw(h),l=f.id;this.view.aa.transaction(function(a){a.Ab([l],k)});return!1}}d=f&&Yf(this.view,f);if(!f||"PathNode"!==f.type()&&"SvgNode"!==f.type()||d)if(f&&f.Rg()&&d&&!this.view.fa.get("readOnly"))Wj("Text double-clicked."),
this.view.ot({},!0),this.view.ta instanceof $f&&this.view.ta.ht(f,a,b,c);else return!1;else Wj("Editing text in shape is disabled.");return!0};c.prototype.ad=function(){return"pick"};return c}();var Xj=function(){function c(a,b,c,e,f,h,k){this.view=a;this.node=b;this.handle=c;this.ii=h;this.log=v.create("MoveEditNode");this.Xg=b.pn(c)||new J(e,f);this.Ib=b.ia("snap")||0;this.Eb(e,f,k)}c.prototype.Vd=function(){this.log("Entering MoveEditNode")};c.prototype.Qc=function(){this.view.Df(!1);this.log("Leaving MoveEditNode")};c.prototype.Eb=function(a,b){this.log("onMouseDown(%s,%s)",a,b);this.view.Df(!0);return!0};c.prototype.Fj=function(a,b,c){c=this.view.Nh(this.Ib||c);0<c&&(a=this.Xg.x+Math.round((a-
this.Xg.x)/c)*c,b=this.Xg.y+Math.round((b-this.Xg.y)/c)*c);return new J(a,b)};c.prototype.Fb=function(a,b,c){a=this.Fj(a,b,c);this.node.Qb(this.node.xf(this.handle,a.x,a.y,0<this.view.Nh(this.Ib||c)));this.node.format(this.view.ma,this.view.request);this.view.ka();return!1};c.prototype.oc=function(a,b,c){var d=this,f=this.Fj(a,b,c);a=f.x;b=f.y;this.log("onMouseUp(%s,%s)",a,b);a!==this.Xg.x||b!==this.Xg.y?(this.node.Qb(this.node.xf(this.handle,this.Xg.x,this.Xg.y,!1)),this.view.aa.transaction(function(){d.view.aa.xf(d.node.id,
d.handle,a,b,0<d.view.Nh(d.Ib||c))})):this.view.WF(this.node.id,this.handle);this.view.ka();this.view.Xa(this.ii||new Og(this.view));return!0};return c}();var Yj=[];v.addListener(function(c,a){Yj.push(c+": "+a)});(function(){function c(){this.font=""}c.prototype.measureText=function(a){return{width:10*Cd.wz(a)}};return c})();}).call(typeof module !== 'undefined' ? module : undefined);
//# sourceMappingURL=zwibbler2.js.map
